<!doctype html><html><head><title>Chroma Style Gallery</title><style>body { font-family: sans-serif; margin: 4em; } h1 { border-bottom: 3px solid red; margin-bottom: 2em; } pre { display: inline-block; margin: 2em; padding: 3em 5em 3em 2em; box-shadow: 5px 5px 5px rgba(68, 68, 68, 0.6); border-radius: 7px; border: 2px solid black;} #stylelink:link { text-decoration: none; color: black; } #stylelink:visited { color: black; } #stylelink:hover { color: #4682B4; } a { color: #1E385B; }</style></head><body><h1>Chroma Style Gallery</h1><a name='abap'><h2><a id='stylelink' href='abap.html' alt='View only abap'>abap</a></h2></a><code><pre style="background-color: #ffffff;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #0000ff">package</span> <span style="color: #000000">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #888888; font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #888888; font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #888888; font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #888888; font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #55aa22">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #55aa22">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #55aa22">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #55aa22">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #55aa22">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #55aa22">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #55aa22">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">width</span><span class="p">,</span> <span style="color: #000000">height</span>      <span class="p">=</span> <span style="color: #33aaff">1920</span><span class="p">,</span> <span style="color: #33aaff">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">ssWidth</span><span class="p">,</span> <span style="color: #000000">ssHeight</span>  <span class="p">=</span> <span style="color: #33aaff">3840</span><span class="p">,</span> <span style="color: #33aaff">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">aspectRatio</span>        <span class="p">=</span> <span style="color: #000000">float64</span><span class="p">(</span><span style="color: #000000">ssWidth</span><span class="p">)</span> <span class="o">/</span> <span style="color: #000000">float64</span><span class="p">(</span><span style="color: #000000">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">fov</span>                <span class="p">=</span> <span style="color: #000000">math</span><span class="p">.</span><span style="color: #000000">Pi</span> <span class="o">/</span> <span style="color: #33aaff">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">maxIter</span>            <span class="p">=</span> <span style="color: #33aaff">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">power</span>              <span class="p">=</span> <span style="color: #33aaff">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">escapeRadius</span>       <span class="p">=</span> <span style="color: #33aaff">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">supersamplingRatio</span> <span class="p">=</span> <span style="color: #33aaff">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">var</span> <span style="color: #000000">wg</span> <span style="color: #000000">sync</span><span class="p">.</span><span style="color: #000000">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">type</span> <span style="color: #000000">vec3</span> <span style="color: #0000ff">struct</span><span class="p">{</span> <span style="color: #000000">x</span><span class="p">,</span> <span style="color: #000000">y</span><span class="p">,</span> <span style="color: #000000">z</span> <span style="color: #0000ff">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">func</span> <span class="p">(</span><span style="color: #000000">v</span> <span style="color: #000000">vec3</span><span class="p">)</span> <span style="color: #000000">add</span><span class="p">(</span><span style="color: #000000">w</span> <span style="color: #000000">vec3</span><span class="p">)</span> <span style="color: #000000">vec3</span>    <span class="p">{</span> <span style="color: #0000ff">return</span> <span style="color: #000000">vec3</span><span class="p">{</span><span style="color: #000000">v</span><span class="p">.</span><span style="color: #000000">x</span> <span class="o">+</span> <span style="color: #000000">w</span><span class="p">.</span><span style="color: #000000">x</span><span class="p">,</span> <span style="color: #000000">v</span><span class="p">.</span><span style="color: #000000">y</span> <span class="o">+</span> <span style="color: #000000">w</span><span class="p">.</span><span style="color: #000000">y</span><span class="p">,</span> <span style="color: #000000">v</span><span class="p">.</span><span style="color: #000000">z</span> <span class="o">+</span> <span style="color: #000000">w</span><span class="p">.</span><span style="color: #000000">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">func</span> <span class="p">(</span><span style="color: #000000">v</span> <span style="color: #000000">vec3</span><span class="p">)</span> <span style="color: #000000">mul</span><span class="p">(</span><span style="color: #000000">s</span> <span style="color: #0000ff">float64</span><span class="p">)</span> <span style="color: #000000">vec3</span> <span class="p">{</span> <span style="color: #0000ff">return</span> <span style="color: #000000">vec3</span><span class="p">{</span><span style="color: #000000">v</span><span class="p">.</span><span style="color: #000000">x</span> <span class="o">*</span> <span style="color: #000000">s</span><span class="p">,</span> <span style="color: #000000">v</span><span class="p">.</span><span style="color: #000000">y</span> <span class="o">*</span> <span style="color: #000000">s</span><span class="p">,</span> <span style="color: #000000">v</span><span class="p">.</span><span style="color: #000000">z</span> <span class="o">*</span> <span style="color: #000000">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">func</span> <span class="p">(</span><span style="color: #000000">v</span> <span style="color: #000000">vec3</span><span class="p">)</span> <span style="color: #000000">length</span><span class="p">()</span> <span style="color: #0000ff">float64</span>    <span class="p">{</span> <span style="color: #0000ff">return</span> <span style="color: #000000">math</span><span class="p">.</span><span style="color: #000000">Sqrt</span><span class="p">(</span><span style="color: #000000">v</span><span class="p">.</span><span style="color: #000000">x</span><span class="o">*</span><span style="color: #000000">v</span><span class="p">.</span><span style="color: #000000">x</span> <span class="o">+</span> <span style="color: #000000">v</span><span class="p">.</span><span style="color: #000000">y</span><span class="o">*</span><span style="color: #000000">v</span><span class="p">.</span><span style="color: #000000">y</span> <span class="o">+</span> <span style="color: #000000">v</span><span class="p">.</span><span style="color: #000000">z</span><span class="o">*</span><span style="color: #000000">v</span><span class="p">.</span><span style="color: #000000">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">func</span> <span class="p">(</span><span style="color: #000000">v</span> <span style="color: #000000">vec3</span><span class="p">)</span> <span style="color: #000000">normalize</span><span class="p">()</span> <span style="color: #000000">vec3</span>    <span class="p">{</span> <span style="color: #0000ff">return</span> <span style="color: #000000">v</span><span class="p">.</span><span style="color: #000000">mul</span><span class="p">(</span><span style="color: #33aaff">1</span> <span class="o">/</span> <span style="color: #000000">v</span><span class="p">.</span><span style="color: #000000">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">func</span> <span style="color: #000000">mandelbulb</span><span class="p">(</span><span style="color: #000000">p</span> <span style="color: #000000">vec3</span><span class="p">)</span> <span style="color: #0000ff">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">z</span><span class="p">,</span> <span style="color: #000000">r</span><span class="p">,</span> <span style="color: #000000">theta</span><span class="p">,</span> <span style="color: #000000">phi</span> <span class="o">:=</span> <span style="color: #000000">p</span><span class="p">,</span> <span style="color: #33aaff">0.0</span><span class="p">,</span> <span style="color: #33aaff">0.0</span><span class="p">,</span> <span style="color: #33aaff">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">for</span> <span style="color: #000000">i</span> <span class="o">:=</span> <span style="color: #33aaff">0</span><span class="p">;</span> <span style="color: #000000">i</span> <span class="p">&lt;</span> <span style="color: #000000">maxIter</span><span class="p">;</span> <span style="color: #000000">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000">r</span> <span class="p">=</span> <span style="color: #000000">z</span><span class="p">.</span><span style="color: #000000">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000ff">if</span> <span style="color: #000000">r</span> <span class="p">&gt;</span> <span style="color: #000000">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #0000ff">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000">theta</span><span class="p">,</span> <span style="color: #000000">phi</span> <span class="p">=</span> <span style="color: #000000">math</span><span class="p">.</span><span style="color: #000000">Acos</span><span class="p">(</span><span style="color: #000000">z</span><span class="p">.</span><span style="color: #000000">z</span><span class="o">/</span><span style="color: #000000">r</span><span class="p">)</span><span class="o">*</span><span style="color: #000000">power</span><span class="p">,</span> <span style="color: #000000">math</span><span class="p">.</span><span style="color: #000000">Atan2</span><span class="p">(</span><span style="color: #000000">z</span><span class="p">.</span><span style="color: #000000">y</span><span class="p">,</span> <span style="color: #000000">z</span><span class="p">.</span><span style="color: #000000">x</span><span class="p">)</span><span class="o">*</span><span style="color: #000000">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000">r</span> <span class="p">=</span> <span style="color: #000000">math</span><span class="p">.</span><span style="color: #000000">Pow</span><span class="p">(</span><span style="color: #000000">r</span><span class="p">,</span> <span style="color: #000000">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000">z</span><span class="p">.</span><span style="color: #000000">x</span><span class="p">,</span> <span style="color: #000000">z</span><span class="p">.</span><span style="color: #000000">y</span><span class="p">,</span> <span style="color: #000000">z</span><span class="p">.</span><span style="color: #000000">z</span> <span class="p">=</span> <span style="color: #000000">p</span><span class="p">.</span><span style="color: #000000">x</span><span class="o">+</span><span style="color: #000000">r</span><span class="o">*</span><span style="color: #000000">math</span><span class="p">.</span><span style="color: #000000">Sin</span><span class="p">(</span><span style="color: #000000">theta</span><span class="p">)</span><span class="o">*</span><span style="color: #000000">math</span><span class="p">.</span><span style="color: #000000">Cos</span><span class="p">(</span><span style="color: #000000">phi</span><span class="p">),</span> <span style="color: #000000">p</span><span class="p">.</span><span style="color: #000000">y</span><span class="o">+</span><span style="color: #000000">r</span><span class="o">*</span><span style="color: #000000">math</span><span class="p">.</span><span style="color: #000000">Sin</span><span class="p">(</span><span style="color: #000000">theta</span><span class="p">)</span><span class="o">*</span><span style="color: #000000">math</span><span class="p">.</span><span style="color: #000000">Sin</span><span class="p">(</span><span style="color: #000000">phi</span><span class="p">),</span> <span style="color: #000000">p</span><span class="p">.</span><span style="color: #000000">z</span><span class="o">+</span><span style="color: #000000">r</span><span class="o">*</span><span style="color: #000000">math</span><span class="p">.</span><span style="color: #000000">Cos</span><span class="p">(</span><span style="color: #000000">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">return</span> <span style="color: #000000">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">func</span> <span style="color: #000000">renderPixel</span><span class="p">(</span><span style="color: #000000">x</span><span class="p">,</span> <span style="color: #000000">y</span> <span style="color: #0000ff">int</span><span class="p">)</span> <span style="color: #000000">color</span><span class="p">.</span><span style="color: #000000">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">px</span><span class="p">,</span> <span style="color: #000000">py</span> <span class="o">:=</span> <span class="p">(</span><span style="color: #33aaff">2</span><span class="o">*</span><span style="color: #000000">float64</span><span class="p">(</span><span style="color: #000000">x</span><span class="p">)</span><span class="o">/</span><span style="color: #000000">float64</span><span class="p">(</span><span style="color: #000000">ssWidth</span><span class="p">)</span><span class="o">-</span><span style="color: #33aaff">1</span><span class="p">)</span><span class="o">*</span><span style="color: #000000">aspectRatio</span><span class="o">*</span><span style="color: #000000">math</span><span class="p">.</span><span style="color: #000000">Tan</span><span class="p">(</span><span style="color: #000000">fov</span><span class="o">/</span><span style="color: #33aaff">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #33aaff">1</span><span class="o">-</span><span style="color: #33aaff">2</span><span class="o">*</span><span style="color: #000000">float64</span><span class="p">(</span><span style="color: #000000">y</span><span class="p">)</span><span class="o">/</span><span style="color: #000000">float64</span><span class="p">(</span><span style="color: #000000">ssHeight</span><span class="p">))</span><span class="o">*</span><span style="color: #000000">math</span><span class="p">.</span><span style="color: #000000">Tan</span><span class="p">(</span><span style="color: #000000">fov</span><span class="o">/</span><span style="color: #33aaff">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">direction</span> <span class="o">:=</span> <span style="color: #000000">vec3</span><span class="p">{</span><span style="color: #000000">px</span><span class="p">,</span> <span style="color: #000000">py</span><span class="p">,</span> <span class="o">-</span><span style="color: #33aaff">1</span><span class="p">}.</span><span style="color: #000000">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">t</span> <span class="o">:=</span> <span style="color: #33aaff">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">for</span> <span style="color: #000000">i</span> <span class="o">:=</span> <span style="color: #33aaff">0</span><span class="p">;</span> <span style="color: #000000">i</span> <span class="p">&lt;</span> <span style="color: #000000">maxIter</span><span class="p">;</span> <span style="color: #000000">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000">p</span> <span class="o">:=</span> <span style="color: #000000">direction</span><span class="p">.</span><span style="color: #000000">mul</span><span class="p">(</span><span style="color: #000000">t</span><span class="p">).</span><span style="color: #000000">add</span><span class="p">(</span><span style="color: #000000">vec3</span><span class="p">{</span><span style="color: #33aaff">0</span><span class="p">,</span> <span style="color: #33aaff">0</span><span class="p">,</span> <span style="color: #33aaff">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000">d</span> <span class="o">:=</span> <span style="color: #000000">mandelbulb</span><span class="p">(</span><span style="color: #000000">p</span><span class="p">)</span> <span class="o">-</span> <span style="color: #33aaff">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000ff">if</span> <span style="color: #000000">d</span> <span class="p">&lt;</span> <span style="color: #33aaff">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #0000ff">return</span> <span style="color: #000000">color</span><span class="p">.</span><span style="color: #000000">Gray</span><span class="p">{</span><span style="color: #000000">uint8</span><span class="p">(</span><span style="color: #33aaff">255</span> <span class="o">-</span> <span style="color: #000000">t</span><span class="o">*</span><span style="color: #33aaff">255</span><span class="o">/</span><span style="color: #33aaff">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000">t</span> <span class="o">+=</span> <span style="color: #000000">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000ff">if</span> <span style="color: #000000">t</span> <span class="p">&gt;</span> <span style="color: #33aaff">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #0000ff">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">return</span> <span style="color: #000000">color</span><span class="p">.</span><span style="color: #000000">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">func</span> <span style="color: #000000">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">ssImg</span> <span class="o">:=</span> <span style="color: #000000">image</span><span class="p">.</span><span style="color: #000000">NewRGBA</span><span class="p">(</span><span style="color: #000000">image</span><span class="p">.</span><span style="color: #000000">Rect</span><span class="p">(</span><span style="color: #33aaff">0</span><span class="p">,</span> <span style="color: #33aaff">0</span><span class="p">,</span> <span style="color: #000000">ssWidth</span><span class="p">,</span> <span style="color: #000000">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">for</span> <span style="color: #000000">y</span> <span class="o">:=</span> <span style="color: #33aaff">0</span><span class="p">;</span> <span style="color: #000000">y</span> <span class="p">&lt;</span> <span style="color: #000000">ssHeight</span><span class="p">;</span> <span style="color: #000000">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000">wg</span><span class="p">.</span><span style="color: #000000">Add</span><span class="p">(</span><span style="color: #33aaff">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000ff">go</span> <span style="color: #0000ff">func</span><span class="p">(</span><span style="color: #000000">y</span> <span style="color: #0000ff">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #0000ff">defer</span> <span style="color: #000000">wg</span><span class="p">.</span><span style="color: #000000">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #0000ff">for</span> <span style="color: #000000">x</span> <span class="o">:=</span> <span style="color: #33aaff">0</span><span class="p">;</span> <span style="color: #000000">x</span> <span class="p">&lt;</span> <span style="color: #000000">ssWidth</span><span class="p">;</span> <span style="color: #000000">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #000000">ssImg</span><span class="p">.</span><span style="color: #000000">Set</span><span class="p">(</span><span style="color: #000000">x</span><span class="p">,</span> <span style="color: #000000">y</span><span class="p">,</span> <span style="color: #000000">renderPixel</span><span class="p">(</span><span style="color: #000000">x</span><span class="p">,</span> <span style="color: #000000">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span style="color: #000000">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">wg</span><span class="p">.</span><span style="color: #000000">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">img</span> <span class="o">:=</span> <span style="color: #000000">image</span><span class="p">.</span><span style="color: #000000">NewRGBA</span><span class="p">(</span><span style="color: #000000">image</span><span class="p">.</span><span style="color: #000000">Rect</span><span class="p">(</span><span style="color: #33aaff">0</span><span class="p">,</span> <span style="color: #33aaff">0</span><span class="p">,</span> <span style="color: #000000">width</span><span class="p">,</span> <span style="color: #000000">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">for</span> <span style="color: #000000">y</span> <span class="o">:=</span> <span style="color: #33aaff">0</span><span class="p">;</span> <span style="color: #000000">y</span> <span class="p">&lt;</span> <span style="color: #000000">height</span><span class="p">;</span> <span style="color: #000000">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000ff">for</span> <span style="color: #000000">x</span> <span class="o">:=</span> <span style="color: #33aaff">0</span><span class="p">;</span> <span style="color: #000000">x</span> <span class="p">&lt;</span> <span style="color: #000000">width</span><span class="p">;</span> <span style="color: #000000">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000000">r</span><span class="p">,</span> <span style="color: #000000">g</span><span class="p">,</span> <span style="color: #000000">b</span><span class="p">,</span> <span style="color: #000000">a</span> <span class="o">:=</span> <span style="color: #33aaff">0</span><span class="p">,</span> <span style="color: #33aaff">0</span><span class="p">,</span> <span style="color: #33aaff">0</span><span class="p">,</span> <span style="color: #33aaff">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #0000ff">for</span> <span style="color: #000000">dy</span> <span class="o">:=</span> <span style="color: #33aaff">0</span><span class="p">;</span> <span style="color: #000000">dy</span> <span class="p">&lt;</span> <span style="color: #000000">supersamplingRatio</span><span class="p">;</span> <span style="color: #000000">dy</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #0000ff">for</span> <span style="color: #000000">dx</span> <span class="o">:=</span> <span style="color: #33aaff">0</span><span class="p">;</span> <span style="color: #000000">dx</span> <span class="p">&lt;</span> <span style="color: #000000">supersamplingRatio</span><span class="p">;</span> <span style="color: #000000">dx</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #000000">c</span> <span class="o">:=</span> <span style="color: #000000">ssImg</span><span class="p">.</span><span style="color: #000000">RGBAAt</span><span class="p">(</span><span style="color: #000000">x</span><span class="o">*</span><span style="color: #000000">supersamplingRatio</span><span class="o">+</span><span style="color: #000000">dx</span><span class="p">,</span> <span style="color: #000000">y</span><span class="o">*</span><span style="color: #000000">supersamplingRatio</span><span class="o">+</span><span style="color: #000000">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #000000">r</span> <span class="o">+=</span> <span style="color: #000000">int</span><span class="p">(</span><span style="color: #000000">c</span><span class="p">.</span><span style="color: #000000">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #000000">g</span> <span class="o">+=</span> <span style="color: #000000">int</span><span class="p">(</span><span style="color: #000000">c</span><span class="p">.</span><span style="color: #000000">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #000000">b</span> <span class="o">+=</span> <span style="color: #000000">int</span><span class="p">(</span><span style="color: #000000">c</span><span class="p">.</span><span style="color: #000000">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #000000">a</span> <span class="o">+=</span> <span style="color: #000000">int</span><span class="p">(</span><span style="color: #000000">c</span><span class="p">.</span><span style="color: #000000">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000000">r</span> <span class="o">/=</span> <span style="color: #000000">supersamplingRatio</span> <span class="o">*</span> <span style="color: #000000">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000000">g</span> <span class="o">/=</span> <span style="color: #000000">supersamplingRatio</span> <span class="o">*</span> <span style="color: #000000">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000000">b</span> <span class="o">/=</span> <span style="color: #000000">supersamplingRatio</span> <span class="o">*</span> <span style="color: #000000">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000000">a</span> <span class="o">/=</span> <span style="color: #000000">supersamplingRatio</span> <span class="o">*</span> <span style="color: #000000">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000000">img</span><span class="p">.</span><span style="color: #000000">Set</span><span class="p">(</span><span style="color: #000000">x</span><span class="p">,</span> <span style="color: #000000">y</span><span class="p">,</span> <span style="color: #000000">color</span><span class="p">.</span><span style="color: #000000">RGBA</span><span class="p">{</span><span style="color: #000000">uint8</span><span class="p">(</span><span style="color: #000000">r</span><span class="p">),</span> <span style="color: #000000">uint8</span><span class="p">(</span><span style="color: #000000">g</span><span class="p">),</span> <span style="color: #000000">uint8</span><span class="p">(</span><span style="color: #000000">b</span><span class="p">),</span> <span style="color: #000000">uint8</span><span class="p">(</span><span style="color: #000000">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">file</span><span class="p">,</span> <span style="color: #000000">err</span> <span class="o">:=</span> <span style="color: #000000">os</span><span class="p">.</span><span style="color: #000000">Create</span><span class="p">(</span><span style="color: #55aa22">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">if</span> <span style="color: #000000">err</span> <span class="o">!=</span> <span style="color: #0000ff">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000">fmt</span><span class="p">.</span><span style="color: #000000">Println</span><span class="p">(</span><span style="color: #55aa22">&#34;Error creating file:&#34;</span><span class="p">,</span> <span style="color: #000000">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000ff">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">defer</span> <span style="color: #000000">file</span><span class="p">.</span><span style="color: #000000">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">err</span> <span class="p">=</span> <span style="color: #000000">png</span><span class="p">.</span><span style="color: #000000">Encode</span><span class="p">(</span><span style="color: #000000">file</span><span class="p">,</span> <span style="color: #000000">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">if</span> <span style="color: #000000">err</span> <span class="o">!=</span> <span style="color: #0000ff">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000">fmt</span><span class="p">.</span><span style="color: #000000">Println</span><span class="p">(</span><span style="color: #55aa22">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span style="color: #000000">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='algol'><h2><a id='stylelink' href='algol.html' alt='View only algol'>algol</a></h2></a><code><pre style="background-color: #ffffff;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="font-weight: bold; text-decoration: underline">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #888888; font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #888888; font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #888888; font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #888888; font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold; text-decoration: underline">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #666666; font-style: italic">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #666666; font-style: italic">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #666666; font-style: italic">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #666666; font-style: italic">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #666666; font-style: italic">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #666666; font-style: italic">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #666666; font-style: italic">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold; font-style: italic; text-decoration: underline">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span class="mi">1920</span><span class="p">,</span> <span class="mi">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span class="mi">3840</span><span class="p">,</span> <span class="mi">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span style="font-weight: bold; font-style: italic">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span class="o">/</span> <span style="font-weight: bold; font-style: italic">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span class="o">/</span> <span class="mi">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span class="mi">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span class="mi">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span class="mf">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span class="mi">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold; font-style: italic; text-decoration: underline">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold; font-style: italic; text-decoration: underline">type</span> <span class="nx">vec3</span> <span style="font-weight: bold; font-style: italic; text-decoration: underline">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="font-weight: bold; text-decoration: underline">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold; font-style: italic; text-decoration: underline">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #666666; font-weight: bold; font-style: italic">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="font-weight: bold; text-decoration: underline">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold; font-style: italic; text-decoration: underline">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #666666; font-weight: bold; font-style: italic">mul</span><span class="p">(</span><span class="nx">s</span> <span style="font-weight: bold; text-decoration: underline">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="font-weight: bold; text-decoration: underline">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold; font-style: italic; text-decoration: underline">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #666666; font-weight: bold; font-style: italic">length</span><span class="p">()</span> <span style="font-weight: bold; text-decoration: underline">float64</span>    <span class="p">{</span> <span style="font-weight: bold; text-decoration: underline">return</span> <span class="nx">math</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold; font-style: italic; text-decoration: underline">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #666666; font-weight: bold; font-style: italic">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="font-weight: bold; text-decoration: underline">return</span> <span class="nx">v</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">mul</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="nx">v</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold; font-style: italic; text-decoration: underline">func</span> <span style="color: #666666; font-weight: bold; font-style: italic">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="font-weight: bold; text-decoration: underline">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="o">:=</span> <span class="nx">p</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold; text-decoration: underline">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="font-weight: bold; text-decoration: underline">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="font-weight: bold; text-decoration: underline">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span class="o">/</span><span class="nx">r</span><span class="p">)</span><span class="o">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="o">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold; text-decoration: underline">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold; font-style: italic; text-decoration: underline">func</span> <span style="color: #666666; font-weight: bold; font-style: italic">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="font-weight: bold; text-decoration: underline">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span class="o">:=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span style="font-weight: bold; font-style: italic">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="o">/</span><span style="font-weight: bold; font-style: italic">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nx">aspectRatio</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Tan</span><span class="p">(</span><span class="nx">fov</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span style="font-weight: bold; font-style: italic">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span class="o">/</span><span style="font-weight: bold; font-style: italic">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Tan</span><span class="p">(</span><span class="nx">fov</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span class="o">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">}.</span><span style="color: #666666; font-weight: bold; font-style: italic">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span class="o">:=</span> <span class="mf">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold; text-decoration: underline">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span class="o">:=</span> <span class="nx">direction</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span style="color: #666666; font-weight: bold; font-style: italic">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span class="o">:=</span> <span style="color: #666666; font-weight: bold; font-style: italic">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="font-weight: bold; text-decoration: underline">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span class="mf">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="font-weight: bold; text-decoration: underline">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span style="font-weight: bold; font-style: italic">uint8</span><span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">t</span><span class="o">*</span><span class="mi">255</span><span class="o">/</span><span class="mi">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span class="o">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="font-weight: bold; text-decoration: underline">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span class="mi">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="font-weight: bold; text-decoration: underline">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold; text-decoration: underline">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold; font-style: italic; text-decoration: underline">func</span> <span style="color: #666666; font-weight: bold; font-style: italic">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Rect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold; text-decoration: underline">for</span> <span class="nx">y</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="font-weight: bold; text-decoration: underline">go</span> <span style="font-weight: bold; font-style: italic; text-decoration: underline">func</span><span class="p">(</span><span class="nx">y</span> <span style="font-weight: bold; text-decoration: underline">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="font-weight: bold; text-decoration: underline">defer</span> <span class="nx">wg</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="font-weight: bold; text-decoration: underline">for</span> <span class="nx">x</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span style="color: #666666; font-weight: bold; font-style: italic">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Rect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold; text-decoration: underline">for</span> <span class="nx">y</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="font-weight: bold; text-decoration: underline">for</span> <span class="nx">x</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="font-weight: bold; text-decoration: underline">for</span> <span class="nx">dy</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="font-weight: bold; text-decoration: underline">for</span> <span class="nx">dx</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span class="o">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span class="o">*</span><span class="nx">supersamplingRatio</span><span class="o">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span class="o">*</span><span class="nx">supersamplingRatio</span><span class="o">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span class="o">+=</span> <span style="font-weight: bold; font-style: italic">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span class="o">+=</span> <span style="font-weight: bold; font-style: italic">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span class="o">+=</span> <span style="font-weight: bold; font-style: italic">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span class="o">+=</span> <span style="font-weight: bold; font-style: italic">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span style="font-weight: bold; font-style: italic">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span style="font-weight: bold; font-style: italic">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span style="font-weight: bold; font-style: italic">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span style="font-weight: bold; font-style: italic">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Create</span><span class="p">(</span><span style="color: #666666; font-style: italic">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold; text-decoration: underline">if</span> <span class="nx">err</span> <span class="o">!=</span> <span style="font-weight: bold; text-decoration: underline">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Println</span><span class="p">(</span><span style="color: #666666; font-style: italic">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="font-weight: bold; text-decoration: underline">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold; text-decoration: underline">defer</span> <span class="nx">file</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold; text-decoration: underline">if</span> <span class="nx">err</span> <span class="o">!=</span> <span style="font-weight: bold; text-decoration: underline">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Println</span><span class="p">(</span><span style="color: #666666; font-style: italic">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='algol_nu'><h2><a id='stylelink' href='algol_nu.html' alt='View only algol_nu'>algol_nu</a></h2></a><code><pre style="background-color: #ffffff;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="font-weight: bold">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #888888; font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #888888; font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #888888; font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #888888; font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #666666; font-style: italic">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #666666; font-style: italic">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #666666; font-style: italic">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #666666; font-style: italic">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #666666; font-style: italic">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #666666; font-style: italic">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #666666; font-style: italic">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold; font-style: italic">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span class="mi">1920</span><span class="p">,</span> <span class="mi">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span class="mi">3840</span><span class="p">,</span> <span class="mi">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span style="font-weight: bold; font-style: italic">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span class="o">/</span> <span style="font-weight: bold; font-style: italic">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span class="o">/</span> <span class="mi">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span class="mi">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span class="mi">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span class="mf">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span class="mi">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold; font-style: italic">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold; font-style: italic">type</span> <span class="nx">vec3</span> <span style="font-weight: bold; font-style: italic">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="font-weight: bold">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold; font-style: italic">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #666666; font-weight: bold; font-style: italic">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold; font-style: italic">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #666666; font-weight: bold; font-style: italic">mul</span><span class="p">(</span><span class="nx">s</span> <span style="font-weight: bold">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold; font-style: italic">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #666666; font-weight: bold; font-style: italic">length</span><span class="p">()</span> <span style="font-weight: bold">float64</span>    <span class="p">{</span> <span style="font-weight: bold">return</span> <span class="nx">math</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold; font-style: italic">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #666666; font-weight: bold; font-style: italic">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="font-weight: bold">return</span> <span class="nx">v</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">mul</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="nx">v</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold; font-style: italic">func</span> <span style="color: #666666; font-weight: bold; font-style: italic">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="font-weight: bold">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="o">:=</span> <span class="nx">p</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="font-weight: bold">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span class="o">/</span><span class="nx">r</span><span class="p">)</span><span class="o">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="o">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold; font-style: italic">func</span> <span style="color: #666666; font-weight: bold; font-style: italic">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="font-weight: bold">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span class="o">:=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span style="font-weight: bold; font-style: italic">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="o">/</span><span style="font-weight: bold; font-style: italic">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nx">aspectRatio</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Tan</span><span class="p">(</span><span class="nx">fov</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span style="font-weight: bold; font-style: italic">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span class="o">/</span><span style="font-weight: bold; font-style: italic">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Tan</span><span class="p">(</span><span class="nx">fov</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span class="o">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">}.</span><span style="color: #666666; font-weight: bold; font-style: italic">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span class="o">:=</span> <span class="mf">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span class="o">:=</span> <span class="nx">direction</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span style="color: #666666; font-weight: bold; font-style: italic">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span class="o">:=</span> <span style="color: #666666; font-weight: bold; font-style: italic">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="font-weight: bold">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span class="mf">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span style="font-weight: bold; font-style: italic">uint8</span><span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">t</span><span class="o">*</span><span class="mi">255</span><span class="o">/</span><span class="mi">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span class="o">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="font-weight: bold">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span class="mi">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold; font-style: italic">func</span> <span style="color: #666666; font-weight: bold; font-style: italic">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Rect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold">for</span> <span class="nx">y</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="font-weight: bold">go</span> <span style="font-weight: bold; font-style: italic">func</span><span class="p">(</span><span class="nx">y</span> <span style="font-weight: bold">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="font-weight: bold">defer</span> <span class="nx">wg</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="font-weight: bold">for</span> <span class="nx">x</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span style="color: #666666; font-weight: bold; font-style: italic">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Rect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold">for</span> <span class="nx">y</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="font-weight: bold">for</span> <span class="nx">x</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="font-weight: bold">for</span> <span class="nx">dy</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="font-weight: bold">for</span> <span class="nx">dx</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span class="o">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span class="o">*</span><span class="nx">supersamplingRatio</span><span class="o">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span class="o">*</span><span class="nx">supersamplingRatio</span><span class="o">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span class="o">+=</span> <span style="font-weight: bold; font-style: italic">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span class="o">+=</span> <span style="font-weight: bold; font-style: italic">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span class="o">+=</span> <span style="font-weight: bold; font-style: italic">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span class="o">+=</span> <span style="font-weight: bold; font-style: italic">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span style="font-weight: bold; font-style: italic">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span style="font-weight: bold; font-style: italic">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span style="font-weight: bold; font-style: italic">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span style="font-weight: bold; font-style: italic">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Create</span><span class="p">(</span><span style="color: #666666; font-style: italic">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold">if</span> <span class="nx">err</span> <span class="o">!=</span> <span style="font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Println</span><span class="p">(</span><span style="color: #666666; font-style: italic">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="font-weight: bold">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold">defer</span> <span class="nx">file</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold">if</span> <span class="nx">err</span> <span class="o">!=</span> <span style="font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #666666; font-weight: bold; font-style: italic">Println</span><span class="p">(</span><span style="color: #666666; font-style: italic">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='arduino'><h2><a id='stylelink' href='arduino.html' alt='View only arduino'>arduino</a></h2></a><code><pre style="background-color: #ffffff;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #728e00">package</span> <span style="color: #728e00">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #95a5a6">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #95a5a6"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #95a5a6"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #95a5a6"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #728e00">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #7f8c8d">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #7f8c8d">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #7f8c8d">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #7f8c8d">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #7f8c8d">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #7f8c8d">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #7f8c8d">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #728e00">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #728e00">width</span><span class="p">,</span> <span style="color: #728e00">height</span>      <span class="p">=</span> <span style="color: #8a7b52">1920</span><span class="p">,</span> <span style="color: #8a7b52">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #728e00">ssWidth</span><span class="p">,</span> <span style="color: #728e00">ssHeight</span>  <span class="p">=</span> <span style="color: #8a7b52">3840</span><span class="p">,</span> <span style="color: #8a7b52">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #728e00">aspectRatio</span>        <span class="p">=</span> <span style="color: #728e00">float64</span><span class="p">(</span><span style="color: #728e00">ssWidth</span><span class="p">)</span> <span style="color: #728e00">/</span> <span style="color: #728e00">float64</span><span class="p">(</span><span style="color: #728e00">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #728e00">fov</span>                <span class="p">=</span> <span style="color: #728e00">math</span><span class="p">.</span><span style="color: #728e00">Pi</span> <span style="color: #728e00">/</span> <span style="color: #8a7b52">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #728e00">maxIter</span>            <span class="p">=</span> <span style="color: #8a7b52">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #728e00">power</span>              <span class="p">=</span> <span style="color: #8a7b52">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #728e00">escapeRadius</span>       <span class="p">=</span> <span style="color: #8a7b52">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #728e00">supersamplingRatio</span> <span class="p">=</span> <span style="color: #8a7b52">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #728e00">var</span> <span style="color: #728e00">wg</span> <span style="color: #728e00">sync</span><span class="p">.</span><span style="color: #728e00">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #728e00">type</span> <span style="color: #728e00">vec3</span> <span style="color: #728e00">struct</span><span class="p">{</span> <span style="color: #728e00">x</span><span class="p">,</span> <span style="color: #728e00">y</span><span class="p">,</span> <span style="color: #728e00">z</span> <span style="color: #00979d">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #728e00">func</span> <span class="p">(</span><span style="color: #728e00">v</span> <span style="color: #728e00">vec3</span><span class="p">)</span> <span style="color: #d35400">add</span><span class="p">(</span><span style="color: #728e00">w</span> <span style="color: #728e00">vec3</span><span class="p">)</span> <span style="color: #728e00">vec3</span>    <span class="p">{</span> <span style="color: #728e00">return</span> <span style="color: #728e00">vec3</span><span class="p">{</span><span style="color: #728e00">v</span><span class="p">.</span><span style="color: #728e00">x</span> <span style="color: #728e00">+</span> <span style="color: #728e00">w</span><span class="p">.</span><span style="color: #728e00">x</span><span class="p">,</span> <span style="color: #728e00">v</span><span class="p">.</span><span style="color: #728e00">y</span> <span style="color: #728e00">+</span> <span style="color: #728e00">w</span><span class="p">.</span><span style="color: #728e00">y</span><span class="p">,</span> <span style="color: #728e00">v</span><span class="p">.</span><span style="color: #728e00">z</span> <span style="color: #728e00">+</span> <span style="color: #728e00">w</span><span class="p">.</span><span style="color: #728e00">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #728e00">func</span> <span class="p">(</span><span style="color: #728e00">v</span> <span style="color: #728e00">vec3</span><span class="p">)</span> <span style="color: #d35400">mul</span><span class="p">(</span><span style="color: #728e00">s</span> <span style="color: #00979d">float64</span><span class="p">)</span> <span style="color: #728e00">vec3</span> <span class="p">{</span> <span style="color: #728e00">return</span> <span style="color: #728e00">vec3</span><span class="p">{</span><span style="color: #728e00">v</span><span class="p">.</span><span style="color: #728e00">x</span> <span style="color: #728e00">*</span> <span style="color: #728e00">s</span><span class="p">,</span> <span style="color: #728e00">v</span><span class="p">.</span><span style="color: #728e00">y</span> <span style="color: #728e00">*</span> <span style="color: #728e00">s</span><span class="p">,</span> <span style="color: #728e00">v</span><span class="p">.</span><span style="color: #728e00">z</span> <span style="color: #728e00">*</span> <span style="color: #728e00">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #728e00">func</span> <span class="p">(</span><span style="color: #728e00">v</span> <span style="color: #728e00">vec3</span><span class="p">)</span> <span style="color: #d35400">length</span><span class="p">()</span> <span style="color: #00979d">float64</span>    <span class="p">{</span> <span style="color: #728e00">return</span> <span style="color: #728e00">math</span><span class="p">.</span><span style="color: #d35400">Sqrt</span><span class="p">(</span><span style="color: #728e00">v</span><span class="p">.</span><span style="color: #728e00">x</span><span style="color: #728e00">*</span><span style="color: #728e00">v</span><span class="p">.</span><span style="color: #728e00">x</span> <span style="color: #728e00">+</span> <span style="color: #728e00">v</span><span class="p">.</span><span style="color: #728e00">y</span><span style="color: #728e00">*</span><span style="color: #728e00">v</span><span class="p">.</span><span style="color: #728e00">y</span> <span style="color: #728e00">+</span> <span style="color: #728e00">v</span><span class="p">.</span><span style="color: #728e00">z</span><span style="color: #728e00">*</span><span style="color: #728e00">v</span><span class="p">.</span><span style="color: #728e00">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #728e00">func</span> <span class="p">(</span><span style="color: #728e00">v</span> <span style="color: #728e00">vec3</span><span class="p">)</span> <span style="color: #d35400">normalize</span><span class="p">()</span> <span style="color: #728e00">vec3</span>    <span class="p">{</span> <span style="color: #728e00">return</span> <span style="color: #728e00">v</span><span class="p">.</span><span style="color: #d35400">mul</span><span class="p">(</span><span style="color: #8a7b52">1</span> <span style="color: #728e00">/</span> <span style="color: #728e00">v</span><span class="p">.</span><span style="color: #d35400">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #728e00">func</span> <span style="color: #d35400">mandelbulb</span><span class="p">(</span><span style="color: #728e00">p</span> <span style="color: #728e00">vec3</span><span class="p">)</span> <span style="color: #00979d">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #728e00">z</span><span class="p">,</span> <span style="color: #728e00">r</span><span class="p">,</span> <span style="color: #728e00">theta</span><span class="p">,</span> <span style="color: #728e00">phi</span> <span style="color: #728e00">:=</span> <span style="color: #728e00">p</span><span class="p">,</span> <span style="color: #8a7b52">0.0</span><span class="p">,</span> <span style="color: #8a7b52">0.0</span><span class="p">,</span> <span style="color: #8a7b52">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #728e00">for</span> <span style="color: #728e00">i</span> <span style="color: #728e00">:=</span> <span style="color: #8a7b52">0</span><span class="p">;</span> <span style="color: #728e00">i</span> <span class="p">&lt;</span> <span style="color: #728e00">maxIter</span><span class="p">;</span> <span style="color: #728e00">i</span><span style="color: #728e00">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #728e00">r</span> <span class="p">=</span> <span style="color: #728e00">z</span><span class="p">.</span><span style="color: #d35400">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #728e00">if</span> <span style="color: #728e00">r</span> <span class="p">&gt;</span> <span style="color: #728e00">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #728e00">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #728e00">theta</span><span class="p">,</span> <span style="color: #728e00">phi</span> <span class="p">=</span> <span style="color: #728e00">math</span><span class="p">.</span><span style="color: #d35400">Acos</span><span class="p">(</span><span style="color: #728e00">z</span><span class="p">.</span><span style="color: #728e00">z</span><span style="color: #728e00">/</span><span style="color: #728e00">r</span><span class="p">)</span><span style="color: #728e00">*</span><span style="color: #728e00">power</span><span class="p">,</span> <span style="color: #728e00">math</span><span class="p">.</span><span style="color: #d35400">Atan2</span><span class="p">(</span><span style="color: #728e00">z</span><span class="p">.</span><span style="color: #728e00">y</span><span class="p">,</span> <span style="color: #728e00">z</span><span class="p">.</span><span style="color: #728e00">x</span><span class="p">)</span><span style="color: #728e00">*</span><span style="color: #728e00">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #728e00">r</span> <span class="p">=</span> <span style="color: #728e00">math</span><span class="p">.</span><span style="color: #d35400">Pow</span><span class="p">(</span><span style="color: #728e00">r</span><span class="p">,</span> <span style="color: #728e00">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #728e00">z</span><span class="p">.</span><span style="color: #728e00">x</span><span class="p">,</span> <span style="color: #728e00">z</span><span class="p">.</span><span style="color: #728e00">y</span><span class="p">,</span> <span style="color: #728e00">z</span><span class="p">.</span><span style="color: #728e00">z</span> <span class="p">=</span> <span style="color: #728e00">p</span><span class="p">.</span><span style="color: #728e00">x</span><span style="color: #728e00">+</span><span style="color: #728e00">r</span><span style="color: #728e00">*</span><span style="color: #728e00">math</span><span class="p">.</span><span style="color: #d35400">Sin</span><span class="p">(</span><span style="color: #728e00">theta</span><span class="p">)</span><span style="color: #728e00">*</span><span style="color: #728e00">math</span><span class="p">.</span><span style="color: #d35400">Cos</span><span class="p">(</span><span style="color: #728e00">phi</span><span class="p">),</span> <span style="color: #728e00">p</span><span class="p">.</span><span style="color: #728e00">y</span><span style="color: #728e00">+</span><span style="color: #728e00">r</span><span style="color: #728e00">*</span><span style="color: #728e00">math</span><span class="p">.</span><span style="color: #d35400">Sin</span><span class="p">(</span><span style="color: #728e00">theta</span><span class="p">)</span><span style="color: #728e00">*</span><span style="color: #728e00">math</span><span class="p">.</span><span style="color: #d35400">Sin</span><span class="p">(</span><span style="color: #728e00">phi</span><span class="p">),</span> <span style="color: #728e00">p</span><span class="p">.</span><span style="color: #728e00">z</span><span style="color: #728e00">+</span><span style="color: #728e00">r</span><span style="color: #728e00">*</span><span style="color: #728e00">math</span><span class="p">.</span><span style="color: #d35400">Cos</span><span class="p">(</span><span style="color: #728e00">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #728e00">return</span> <span style="color: #728e00">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #728e00">func</span> <span style="color: #d35400">renderPixel</span><span class="p">(</span><span style="color: #728e00">x</span><span class="p">,</span> <span style="color: #728e00">y</span> <span style="color: #00979d">int</span><span class="p">)</span> <span style="color: #728e00">color</span><span class="p">.</span><span style="color: #728e00">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #728e00">px</span><span class="p">,</span> <span style="color: #728e00">py</span> <span style="color: #728e00">:=</span> <span class="p">(</span><span style="color: #8a7b52">2</span><span style="color: #728e00">*</span><span style="color: #728e00">float64</span><span class="p">(</span><span style="color: #728e00">x</span><span class="p">)</span><span style="color: #728e00">/</span><span style="color: #728e00">float64</span><span class="p">(</span><span style="color: #728e00">ssWidth</span><span class="p">)</span><span style="color: #728e00">-</span><span style="color: #8a7b52">1</span><span class="p">)</span><span style="color: #728e00">*</span><span style="color: #728e00">aspectRatio</span><span style="color: #728e00">*</span><span style="color: #728e00">math</span><span class="p">.</span><span style="color: #d35400">Tan</span><span class="p">(</span><span style="color: #728e00">fov</span><span style="color: #728e00">/</span><span style="color: #8a7b52">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #8a7b52">1</span><span style="color: #728e00">-</span><span style="color: #8a7b52">2</span><span style="color: #728e00">*</span><span style="color: #728e00">float64</span><span class="p">(</span><span style="color: #728e00">y</span><span class="p">)</span><span style="color: #728e00">/</span><span style="color: #728e00">float64</span><span class="p">(</span><span style="color: #728e00">ssHeight</span><span class="p">))</span><span style="color: #728e00">*</span><span style="color: #728e00">math</span><span class="p">.</span><span style="color: #d35400">Tan</span><span class="p">(</span><span style="color: #728e00">fov</span><span style="color: #728e00">/</span><span style="color: #8a7b52">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #728e00">direction</span> <span style="color: #728e00">:=</span> <span style="color: #728e00">vec3</span><span class="p">{</span><span style="color: #728e00">px</span><span class="p">,</span> <span style="color: #728e00">py</span><span class="p">,</span> <span style="color: #728e00">-</span><span style="color: #8a7b52">1</span><span class="p">}.</span><span style="color: #d35400">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #728e00">t</span> <span style="color: #728e00">:=</span> <span style="color: #8a7b52">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #728e00">for</span> <span style="color: #728e00">i</span> <span style="color: #728e00">:=</span> <span style="color: #8a7b52">0</span><span class="p">;</span> <span style="color: #728e00">i</span> <span class="p">&lt;</span> <span style="color: #728e00">maxIter</span><span class="p">;</span> <span style="color: #728e00">i</span><span style="color: #728e00">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #728e00">p</span> <span style="color: #728e00">:=</span> <span style="color: #728e00">direction</span><span class="p">.</span><span style="color: #d35400">mul</span><span class="p">(</span><span style="color: #728e00">t</span><span class="p">).</span><span style="color: #d35400">add</span><span class="p">(</span><span style="color: #728e00">vec3</span><span class="p">{</span><span style="color: #8a7b52">0</span><span class="p">,</span> <span style="color: #8a7b52">0</span><span class="p">,</span> <span style="color: #8a7b52">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #728e00">d</span> <span style="color: #728e00">:=</span> <span style="color: #d35400">mandelbulb</span><span class="p">(</span><span style="color: #728e00">p</span><span class="p">)</span> <span style="color: #728e00">-</span> <span style="color: #8a7b52">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #728e00">if</span> <span style="color: #728e00">d</span> <span class="p">&lt;</span> <span style="color: #8a7b52">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #728e00">return</span> <span style="color: #728e00">color</span><span class="p">.</span><span style="color: #728e00">Gray</span><span class="p">{</span><span style="color: #728e00">uint8</span><span class="p">(</span><span style="color: #8a7b52">255</span> <span style="color: #728e00">-</span> <span style="color: #728e00">t</span><span style="color: #728e00">*</span><span style="color: #8a7b52">255</span><span style="color: #728e00">/</span><span style="color: #8a7b52">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #728e00">t</span> <span style="color: #728e00">+=</span> <span style="color: #728e00">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #728e00">if</span> <span style="color: #728e00">t</span> <span class="p">&gt;</span> <span style="color: #8a7b52">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #728e00">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #728e00">return</span> <span style="color: #728e00">color</span><span class="p">.</span><span style="color: #728e00">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #728e00">func</span> <span style="color: #d35400">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #728e00">ssImg</span> <span style="color: #728e00">:=</span> <span style="color: #728e00">image</span><span class="p">.</span><span style="color: #d35400">NewRGBA</span><span class="p">(</span><span style="color: #728e00">image</span><span class="p">.</span><span style="color: #d35400">Rect</span><span class="p">(</span><span style="color: #8a7b52">0</span><span class="p">,</span> <span style="color: #8a7b52">0</span><span class="p">,</span> <span style="color: #728e00">ssWidth</span><span class="p">,</span> <span style="color: #728e00">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #728e00">for</span> <span style="color: #728e00">y</span> <span style="color: #728e00">:=</span> <span style="color: #8a7b52">0</span><span class="p">;</span> <span style="color: #728e00">y</span> <span class="p">&lt;</span> <span style="color: #728e00">ssHeight</span><span class="p">;</span> <span style="color: #728e00">y</span><span style="color: #728e00">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #728e00">wg</span><span class="p">.</span><span style="color: #d35400">Add</span><span class="p">(</span><span style="color: #8a7b52">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #728e00">go</span> <span style="color: #728e00">func</span><span class="p">(</span><span style="color: #728e00">y</span> <span style="color: #00979d">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #728e00">defer</span> <span style="color: #728e00">wg</span><span class="p">.</span><span style="color: #d35400">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #728e00">for</span> <span style="color: #728e00">x</span> <span style="color: #728e00">:=</span> <span style="color: #8a7b52">0</span><span class="p">;</span> <span style="color: #728e00">x</span> <span class="p">&lt;</span> <span style="color: #728e00">ssWidth</span><span class="p">;</span> <span style="color: #728e00">x</span><span style="color: #728e00">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #728e00">ssImg</span><span class="p">.</span><span style="color: #d35400">Set</span><span class="p">(</span><span style="color: #728e00">x</span><span class="p">,</span> <span style="color: #728e00">y</span><span class="p">,</span> <span style="color: #d35400">renderPixel</span><span class="p">(</span><span style="color: #728e00">x</span><span class="p">,</span> <span style="color: #728e00">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span style="color: #728e00">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #728e00">wg</span><span class="p">.</span><span style="color: #d35400">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #728e00">img</span> <span style="color: #728e00">:=</span> <span style="color: #728e00">image</span><span class="p">.</span><span style="color: #d35400">NewRGBA</span><span class="p">(</span><span style="color: #728e00">image</span><span class="p">.</span><span style="color: #d35400">Rect</span><span class="p">(</span><span style="color: #8a7b52">0</span><span class="p">,</span> <span style="color: #8a7b52">0</span><span class="p">,</span> <span style="color: #728e00">width</span><span class="p">,</span> <span style="color: #728e00">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #728e00">for</span> <span style="color: #728e00">y</span> <span style="color: #728e00">:=</span> <span style="color: #8a7b52">0</span><span class="p">;</span> <span style="color: #728e00">y</span> <span class="p">&lt;</span> <span style="color: #728e00">height</span><span class="p">;</span> <span style="color: #728e00">y</span><span style="color: #728e00">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #728e00">for</span> <span style="color: #728e00">x</span> <span style="color: #728e00">:=</span> <span style="color: #8a7b52">0</span><span class="p">;</span> <span style="color: #728e00">x</span> <span class="p">&lt;</span> <span style="color: #728e00">width</span><span class="p">;</span> <span style="color: #728e00">x</span><span style="color: #728e00">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #728e00">r</span><span class="p">,</span> <span style="color: #728e00">g</span><span class="p">,</span> <span style="color: #728e00">b</span><span class="p">,</span> <span style="color: #728e00">a</span> <span style="color: #728e00">:=</span> <span style="color: #8a7b52">0</span><span class="p">,</span> <span style="color: #8a7b52">0</span><span class="p">,</span> <span style="color: #8a7b52">0</span><span class="p">,</span> <span style="color: #8a7b52">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #728e00">for</span> <span style="color: #728e00">dy</span> <span style="color: #728e00">:=</span> <span style="color: #8a7b52">0</span><span class="p">;</span> <span style="color: #728e00">dy</span> <span class="p">&lt;</span> <span style="color: #728e00">supersamplingRatio</span><span class="p">;</span> <span style="color: #728e00">dy</span><span style="color: #728e00">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #728e00">for</span> <span style="color: #728e00">dx</span> <span style="color: #728e00">:=</span> <span style="color: #8a7b52">0</span><span class="p">;</span> <span style="color: #728e00">dx</span> <span class="p">&lt;</span> <span style="color: #728e00">supersamplingRatio</span><span class="p">;</span> <span style="color: #728e00">dx</span><span style="color: #728e00">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #728e00">c</span> <span style="color: #728e00">:=</span> <span style="color: #728e00">ssImg</span><span class="p">.</span><span style="color: #d35400">RGBAAt</span><span class="p">(</span><span style="color: #728e00">x</span><span style="color: #728e00">*</span><span style="color: #728e00">supersamplingRatio</span><span style="color: #728e00">+</span><span style="color: #728e00">dx</span><span class="p">,</span> <span style="color: #728e00">y</span><span style="color: #728e00">*</span><span style="color: #728e00">supersamplingRatio</span><span style="color: #728e00">+</span><span style="color: #728e00">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #728e00">r</span> <span style="color: #728e00">+=</span> <span style="color: #728e00">int</span><span class="p">(</span><span style="color: #728e00">c</span><span class="p">.</span><span style="color: #728e00">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #728e00">g</span> <span style="color: #728e00">+=</span> <span style="color: #728e00">int</span><span class="p">(</span><span style="color: #728e00">c</span><span class="p">.</span><span style="color: #728e00">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #728e00">b</span> <span style="color: #728e00">+=</span> <span style="color: #728e00">int</span><span class="p">(</span><span style="color: #728e00">c</span><span class="p">.</span><span style="color: #728e00">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #728e00">a</span> <span style="color: #728e00">+=</span> <span style="color: #728e00">int</span><span class="p">(</span><span style="color: #728e00">c</span><span class="p">.</span><span style="color: #728e00">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #728e00">r</span> <span style="color: #728e00">/=</span> <span style="color: #728e00">supersamplingRatio</span> <span style="color: #728e00">*</span> <span style="color: #728e00">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #728e00">g</span> <span style="color: #728e00">/=</span> <span style="color: #728e00">supersamplingRatio</span> <span style="color: #728e00">*</span> <span style="color: #728e00">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #728e00">b</span> <span style="color: #728e00">/=</span> <span style="color: #728e00">supersamplingRatio</span> <span style="color: #728e00">*</span> <span style="color: #728e00">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #728e00">a</span> <span style="color: #728e00">/=</span> <span style="color: #728e00">supersamplingRatio</span> <span style="color: #728e00">*</span> <span style="color: #728e00">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #728e00">img</span><span class="p">.</span><span style="color: #d35400">Set</span><span class="p">(</span><span style="color: #728e00">x</span><span class="p">,</span> <span style="color: #728e00">y</span><span class="p">,</span> <span style="color: #728e00">color</span><span class="p">.</span><span style="color: #728e00">RGBA</span><span class="p">{</span><span style="color: #728e00">uint8</span><span class="p">(</span><span style="color: #728e00">r</span><span class="p">),</span> <span style="color: #728e00">uint8</span><span class="p">(</span><span style="color: #728e00">g</span><span class="p">),</span> <span style="color: #728e00">uint8</span><span class="p">(</span><span style="color: #728e00">b</span><span class="p">),</span> <span style="color: #728e00">uint8</span><span class="p">(</span><span style="color: #728e00">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #728e00">file</span><span class="p">,</span> <span style="color: #728e00">err</span> <span style="color: #728e00">:=</span> <span style="color: #728e00">os</span><span class="p">.</span><span style="color: #d35400">Create</span><span class="p">(</span><span style="color: #7f8c8d">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #728e00">if</span> <span style="color: #728e00">err</span> <span style="color: #728e00">!=</span> <span style="color: #00979d">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #728e00">fmt</span><span class="p">.</span><span style="color: #d35400">Println</span><span class="p">(</span><span style="color: #7f8c8d">&#34;Error creating file:&#34;</span><span class="p">,</span> <span style="color: #728e00">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #728e00">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #728e00">defer</span> <span style="color: #728e00">file</span><span class="p">.</span><span style="color: #d35400">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #728e00">err</span> <span class="p">=</span> <span style="color: #728e00">png</span><span class="p">.</span><span style="color: #d35400">Encode</span><span class="p">(</span><span style="color: #728e00">file</span><span class="p">,</span> <span style="color: #728e00">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #728e00">if</span> <span style="color: #728e00">err</span> <span style="color: #728e00">!=</span> <span style="color: #00979d">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #728e00">fmt</span><span class="p">.</span><span style="color: #d35400">Println</span><span class="p">(</span><span style="color: #7f8c8d">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span style="color: #728e00">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='autumn'><h2><a id='stylelink' href='autumn.html' alt='View only autumn'>autumn</a></h2></a><code><pre style="background-color: #ffffff;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #0000aa">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #aaaaaa; font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #aaaaaa; font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #aaaaaa; font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #aaaaaa; font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000aa">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa5500">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa5500">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa5500">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa5500">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa5500">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa5500">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa5500">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000aa">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span style="color: #009999">1920</span><span class="p">,</span> <span style="color: #009999">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span style="color: #009999">3840</span><span class="p">,</span> <span style="color: #009999">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span style="color: #00aaaa">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span class="o">/</span> <span style="color: #00aaaa">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span class="o">/</span> <span style="color: #009999">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span style="color: #009999">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span style="color: #009999">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span style="color: #009999">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span style="color: #009999">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000aa">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000aa">type</span> <span class="nx">vec3</span> <span style="color: #0000aa">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #00aaaa">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000aa">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #00aa00">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #0000aa">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000aa">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #00aa00">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #00aaaa">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #0000aa">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000aa">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #00aa00">length</span><span class="p">()</span> <span style="color: #00aaaa">float64</span>    <span class="p">{</span> <span style="color: #0000aa">return</span> <span class="nx">math</span><span class="p">.</span><span style="color: #00aa00">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000aa">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #00aa00">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #0000aa">return</span> <span class="nx">v</span><span class="p">.</span><span style="color: #00aa00">mul</span><span class="p">(</span><span style="color: #009999">1</span> <span class="o">/</span> <span class="nx">v</span><span class="p">.</span><span style="color: #00aa00">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000aa">func</span> <span style="color: #00aa00">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #00aaaa">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="o">:=</span> <span class="nx">p</span><span class="p">,</span> <span style="color: #009999">0.0</span><span class="p">,</span> <span style="color: #009999">0.0</span><span class="p">,</span> <span style="color: #009999">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000aa">for</span> <span class="nx">i</span> <span class="o">:=</span> <span style="color: #009999">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span style="color: #00aa00">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000aa">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #0000aa">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #00aa00">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span class="o">/</span><span class="nx">r</span><span class="p">)</span><span class="o">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span style="color: #00aa00">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="o">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #00aa00">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #00aa00">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #00aa00">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #00aa00">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #00aa00">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #00aa00">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000aa">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000aa">func</span> <span style="color: #00aa00">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #00aaaa">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span class="o">:=</span> <span class="p">(</span><span style="color: #009999">2</span><span class="o">*</span><span style="color: #00aaaa">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="o">/</span><span style="color: #00aaaa">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span class="o">-</span><span style="color: #009999">1</span><span class="p">)</span><span class="o">*</span><span class="nx">aspectRatio</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #00aa00">Tan</span><span class="p">(</span><span class="nx">fov</span><span class="o">/</span><span style="color: #009999">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #009999">1</span><span class="o">-</span><span style="color: #009999">2</span><span class="o">*</span><span style="color: #00aaaa">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span class="o">/</span><span style="color: #00aaaa">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #00aa00">Tan</span><span class="p">(</span><span class="nx">fov</span><span class="o">/</span><span style="color: #009999">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span class="o">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span class="o">-</span><span style="color: #009999">1</span><span class="p">}.</span><span style="color: #00aa00">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span class="o">:=</span> <span style="color: #009999">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000aa">for</span> <span class="nx">i</span> <span class="o">:=</span> <span style="color: #009999">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span class="o">:=</span> <span class="nx">direction</span><span class="p">.</span><span style="color: #00aa00">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span style="color: #00aa00">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span style="color: #009999">0</span><span class="p">,</span> <span style="color: #009999">0</span><span class="p">,</span> <span style="color: #009999">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span class="o">:=</span> <span style="color: #00aa00">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="o">-</span> <span style="color: #009999">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000aa">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span style="color: #009999">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #0000aa">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span style="color: #00aaaa">uint8</span><span class="p">(</span><span style="color: #009999">255</span> <span class="o">-</span> <span class="nx">t</span><span class="o">*</span><span style="color: #009999">255</span><span class="o">/</span><span style="color: #009999">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span class="o">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000aa">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span style="color: #009999">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #0000aa">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000aa">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000aa">func</span> <span style="color: #00aa00">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #00aa00">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #00aa00">Rect</span><span class="p">(</span><span style="color: #009999">0</span><span class="p">,</span> <span style="color: #009999">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000aa">for</span> <span class="nx">y</span> <span class="o">:=</span> <span style="color: #009999">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span style="color: #00aa00">Add</span><span class="p">(</span><span style="color: #009999">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000aa">go</span> <span style="color: #0000aa">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #00aaaa">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #0000aa">defer</span> <span class="nx">wg</span><span class="p">.</span><span style="color: #00aa00">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #0000aa">for</span> <span class="nx">x</span> <span class="o">:=</span> <span style="color: #009999">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span style="color: #00aa00">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span style="color: #00aa00">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span style="color: #00aa00">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #00aa00">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #00aa00">Rect</span><span class="p">(</span><span style="color: #009999">0</span><span class="p">,</span> <span style="color: #009999">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000aa">for</span> <span class="nx">y</span> <span class="o">:=</span> <span style="color: #009999">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000aa">for</span> <span class="nx">x</span> <span class="o">:=</span> <span style="color: #009999">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span class="o">:=</span> <span style="color: #009999">0</span><span class="p">,</span> <span style="color: #009999">0</span><span class="p">,</span> <span style="color: #009999">0</span><span class="p">,</span> <span style="color: #009999">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #0000aa">for</span> <span class="nx">dy</span> <span class="o">:=</span> <span style="color: #009999">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #0000aa">for</span> <span class="nx">dx</span> <span class="o">:=</span> <span style="color: #009999">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span class="o">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span style="color: #00aa00">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span class="o">*</span><span class="nx">supersamplingRatio</span><span class="o">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span class="o">*</span><span class="nx">supersamplingRatio</span><span class="o">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span class="o">+=</span> <span style="color: #00aaaa">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span class="o">+=</span> <span style="color: #00aaaa">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span class="o">+=</span> <span style="color: #00aaaa">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span class="o">+=</span> <span style="color: #00aaaa">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span style="color: #00aa00">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span style="color: #00aaaa">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span style="color: #00aaaa">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span style="color: #00aaaa">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span style="color: #00aaaa">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span style="color: #00aa00">Create</span><span class="p">(</span><span style="color: #aa5500">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000aa">if</span> <span class="nx">err</span> <span class="o">!=</span> <span style="color: #0000aa">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #00aa00">Println</span><span class="p">(</span><span style="color: #aa5500">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000aa">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000aa">defer</span> <span class="nx">file</span><span class="p">.</span><span style="color: #00aa00">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span style="color: #00aa00">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000aa">if</span> <span class="nx">err</span> <span class="o">!=</span> <span style="color: #0000aa">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #00aa00">Println</span><span class="p">(</span><span style="color: #aa5500">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='average'><h2><a id='stylelink' href='average.html' alt='View only average'>average</a></h2></a><code><pre style="color: #757575; background-color: #000000;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #ec0000">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span class="cm">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span class="cm"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span class="cm"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span class="cm"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ec0000">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008900">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008900">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008900">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008900">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008900">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008900">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008900">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ec0000">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span style="color: #008900">1920</span><span class="p">,</span> <span style="color: #008900">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span style="color: #008900">3840</span><span class="p">,</span> <span style="color: #008900">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span style="color: #ec0000">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span style="color: #ec0000">/</span> <span style="color: #ec0000">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span style="color: #ec0000">/</span> <span style="color: #008900">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span style="color: #008900">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span style="color: #008900">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span style="color: #008900">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span style="color: #008900">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ec0000">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ec0000">type</span> <span class="nx">vec3</span> <span style="color: #ec0000">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #5f5fff">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ec0000">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #5f5fff">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #ec0000">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #ec0000">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #ec0000">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #ec0000">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ec0000">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #5f5fff">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #5f5fff">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #ec0000">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #ec0000">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #ec0000">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #ec0000">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ec0000">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #5f5fff">length</span><span class="p">()</span> <span style="color: #5f5fff">float64</span>    <span class="p">{</span> <span style="color: #ec0000">return</span> <span class="nx">math</span><span class="p">.</span><span style="color: #5f5fff">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span style="color: #ec0000">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #ec0000">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span style="color: #ec0000">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #ec0000">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span style="color: #ec0000">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ec0000">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #5f5fff">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #ec0000">return</span> <span class="nx">v</span><span class="p">.</span><span style="color: #5f5fff">mul</span><span class="p">(</span><span style="color: #008900">1</span> <span style="color: #ec0000">/</span> <span class="nx">v</span><span class="p">.</span><span style="color: #5f5fff">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ec0000">func</span> <span style="color: #5f5fff">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #5f5fff">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span style="color: #ec0000">:=</span> <span class="nx">p</span><span class="p">,</span> <span style="color: #008900">0.0</span><span class="p">,</span> <span style="color: #008900">0.0</span><span class="p">,</span> <span style="color: #008900">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ec0000">for</span> <span class="nx">i</span> <span style="color: #ec0000">:=</span> <span style="color: #008900">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #ec0000">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span style="color: #5f5fff">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ec0000">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ec0000">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #5f5fff">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span style="color: #ec0000">/</span><span class="nx">r</span><span class="p">)</span><span style="color: #ec0000">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span style="color: #5f5fff">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span style="color: #ec0000">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #5f5fff">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span style="color: #ec0000">+</span><span class="nx">r</span><span style="color: #ec0000">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #5f5fff">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #ec0000">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #5f5fff">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span style="color: #ec0000">+</span><span class="nx">r</span><span style="color: #ec0000">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #5f5fff">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #ec0000">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #5f5fff">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span style="color: #ec0000">+</span><span class="nx">r</span><span style="color: #ec0000">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #5f5fff">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ec0000">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ec0000">func</span> <span style="color: #5f5fff">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #5f5fff">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span style="color: #ec0000">:=</span> <span class="p">(</span><span style="color: #008900">2</span><span style="color: #ec0000">*</span><span style="color: #ec0000">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span style="color: #ec0000">/</span><span style="color: #ec0000">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span style="color: #ec0000">-</span><span style="color: #008900">1</span><span class="p">)</span><span style="color: #ec0000">*</span><span class="nx">aspectRatio</span><span style="color: #ec0000">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #5f5fff">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #ec0000">/</span><span style="color: #008900">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #008900">1</span><span style="color: #ec0000">-</span><span style="color: #008900">2</span><span style="color: #ec0000">*</span><span style="color: #ec0000">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span style="color: #ec0000">/</span><span style="color: #ec0000">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span style="color: #ec0000">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #5f5fff">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #ec0000">/</span><span style="color: #008900">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span style="color: #ec0000">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span style="color: #ec0000">-</span><span style="color: #008900">1</span><span class="p">}.</span><span style="color: #5f5fff">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span style="color: #ec0000">:=</span> <span style="color: #008900">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ec0000">for</span> <span class="nx">i</span> <span style="color: #ec0000">:=</span> <span style="color: #008900">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #ec0000">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span style="color: #ec0000">:=</span> <span class="nx">direction</span><span class="p">.</span><span style="color: #5f5fff">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span style="color: #5f5fff">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span style="color: #008900">0</span><span class="p">,</span> <span style="color: #008900">0</span><span class="p">,</span> <span style="color: #008900">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span style="color: #ec0000">:=</span> <span style="color: #5f5fff">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span style="color: #ec0000">-</span> <span style="color: #008900">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ec0000">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span style="color: #008900">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ec0000">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span style="color: #ec0000">uint8</span><span class="p">(</span><span style="color: #008900">255</span> <span style="color: #ec0000">-</span> <span class="nx">t</span><span style="color: #ec0000">*</span><span style="color: #008900">255</span><span style="color: #ec0000">/</span><span style="color: #008900">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span style="color: #ec0000">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ec0000">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span style="color: #008900">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ec0000">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ec0000">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ec0000">func</span> <span style="color: #5f5fff">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span style="color: #ec0000">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #5f5fff">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #5f5fff">Rect</span><span class="p">(</span><span style="color: #008900">0</span><span class="p">,</span> <span style="color: #008900">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ec0000">for</span> <span class="nx">y</span> <span style="color: #ec0000">:=</span> <span style="color: #008900">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span style="color: #ec0000">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span style="color: #5f5fff">Add</span><span class="p">(</span><span style="color: #008900">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ec0000">go</span> <span style="color: #ec0000">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #5f5fff">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ec0000">defer</span> <span class="nx">wg</span><span class="p">.</span><span style="color: #5f5fff">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ec0000">for</span> <span class="nx">x</span> <span style="color: #ec0000">:=</span> <span style="color: #008900">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span style="color: #ec0000">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span style="color: #5f5fff">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span style="color: #5f5fff">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span style="color: #5f5fff">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span style="color: #ec0000">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #5f5fff">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #5f5fff">Rect</span><span class="p">(</span><span style="color: #008900">0</span><span class="p">,</span> <span style="color: #008900">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ec0000">for</span> <span class="nx">y</span> <span style="color: #ec0000">:=</span> <span style="color: #008900">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span style="color: #ec0000">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ec0000">for</span> <span class="nx">x</span> <span style="color: #ec0000">:=</span> <span style="color: #008900">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span style="color: #ec0000">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span style="color: #ec0000">:=</span> <span style="color: #008900">0</span><span class="p">,</span> <span style="color: #008900">0</span><span class="p">,</span> <span style="color: #008900">0</span><span class="p">,</span> <span style="color: #008900">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ec0000">for</span> <span class="nx">dy</span> <span style="color: #ec0000">:=</span> <span style="color: #008900">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span style="color: #ec0000">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #ec0000">for</span> <span class="nx">dx</span> <span style="color: #ec0000">:=</span> <span style="color: #008900">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span style="color: #ec0000">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span style="color: #ec0000">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span style="color: #5f5fff">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span style="color: #ec0000">*</span><span class="nx">supersamplingRatio</span><span style="color: #ec0000">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span style="color: #ec0000">*</span><span class="nx">supersamplingRatio</span><span style="color: #ec0000">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span style="color: #ec0000">+=</span> <span style="color: #ec0000">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span style="color: #ec0000">+=</span> <span style="color: #ec0000">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span style="color: #ec0000">+=</span> <span style="color: #ec0000">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span style="color: #ec0000">+=</span> <span style="color: #ec0000">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span style="color: #ec0000">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #ec0000">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span style="color: #ec0000">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #ec0000">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span style="color: #ec0000">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #ec0000">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span style="color: #ec0000">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #ec0000">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span style="color: #5f5fff">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span style="color: #ec0000">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span style="color: #ec0000">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span style="color: #ec0000">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span style="color: #ec0000">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span style="color: #ec0000">:=</span> <span class="nx">os</span><span class="p">.</span><span style="color: #5f5fff">Create</span><span class="p">(</span><span style="color: #008900">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ec0000">if</span> <span class="nx">err</span> <span style="color: #ec0000">!=</span> <span style="color: #ec0000">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #5f5fff">Println</span><span class="p">(</span><span style="color: #008900">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ec0000">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ec0000">defer</span> <span class="nx">file</span><span class="p">.</span><span style="color: #5f5fff">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span style="color: #5f5fff">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ec0000">if</span> <span class="nx">err</span> <span style="color: #ec0000">!=</span> <span style="color: #ec0000">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #5f5fff">Println</span><span class="p">(</span><span style="color: #008900">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='base16-snazzy'><h2><a id='stylelink' href='base16-snazzy.html' alt='View only base16-snazzy'>base16-snazzy</a></h2></a><code><pre style="color: #e2e4e5; background-color: #282a36;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #ff6ac1">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #78787e">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #78787e"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #78787e"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #78787e"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff6ac1">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #5af78e">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #5af78e">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #5af78e">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #5af78e">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #5af78e">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #5af78e">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #5af78e">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff5c57">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span style="color: #ff9f43">1920</span><span class="p">,</span> <span style="color: #ff9f43">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span style="color: #ff9f43">3840</span><span class="p">,</span> <span style="color: #ff9f43">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span style="color: #ff5c57">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span style="color: #ff6ac1">/</span> <span style="color: #ff5c57">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span style="color: #ff6ac1">/</span> <span style="color: #ff9f43">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span style="color: #ff9f43">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span style="color: #ff9f43">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span style="color: #ff9f43">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span style="color: #ff9f43">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff5c57">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff5c57">type</span> <span class="nx">vec3</span> <span style="color: #ff5c57">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #9aedfe">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff5c57">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #57c7ff">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #ff6ac1">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #ff6ac1">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #ff6ac1">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #ff6ac1">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff5c57">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #57c7ff">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #9aedfe">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #ff6ac1">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #ff6ac1">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #ff6ac1">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #ff6ac1">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff5c57">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #57c7ff">length</span><span class="p">()</span> <span style="color: #9aedfe">float64</span>    <span class="p">{</span> <span style="color: #ff6ac1">return</span> <span class="nx">math</span><span class="p">.</span><span style="color: #57c7ff">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span style="color: #ff6ac1">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #ff6ac1">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span style="color: #ff6ac1">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #ff6ac1">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span style="color: #ff6ac1">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff5c57">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #57c7ff">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #ff6ac1">return</span> <span class="nx">v</span><span class="p">.</span><span style="color: #57c7ff">mul</span><span class="p">(</span><span style="color: #ff9f43">1</span> <span style="color: #ff6ac1">/</span> <span class="nx">v</span><span class="p">.</span><span style="color: #57c7ff">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff5c57">func</span> <span style="color: #57c7ff">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #9aedfe">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span style="color: #ff6ac1">:=</span> <span class="nx">p</span><span class="p">,</span> <span style="color: #ff9f43">0.0</span><span class="p">,</span> <span style="color: #ff9f43">0.0</span><span class="p">,</span> <span style="color: #ff9f43">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff6ac1">for</span> <span class="nx">i</span> <span style="color: #ff6ac1">:=</span> <span style="color: #ff9f43">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #ff6ac1">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span style="color: #57c7ff">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff6ac1">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff6ac1">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #57c7ff">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span style="color: #ff6ac1">/</span><span class="nx">r</span><span class="p">)</span><span style="color: #ff6ac1">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span style="color: #57c7ff">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span style="color: #ff6ac1">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #57c7ff">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span style="color: #ff6ac1">+</span><span class="nx">r</span><span style="color: #ff6ac1">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #57c7ff">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #ff6ac1">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #57c7ff">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span style="color: #ff6ac1">+</span><span class="nx">r</span><span style="color: #ff6ac1">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #57c7ff">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #ff6ac1">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #57c7ff">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span style="color: #ff6ac1">+</span><span class="nx">r</span><span style="color: #ff6ac1">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #57c7ff">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff6ac1">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff5c57">func</span> <span style="color: #57c7ff">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #9aedfe">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span style="color: #ff6ac1">:=</span> <span class="p">(</span><span style="color: #ff9f43">2</span><span style="color: #ff6ac1">*</span><span style="color: #ff5c57">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span style="color: #ff6ac1">/</span><span style="color: #ff5c57">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span style="color: #ff6ac1">-</span><span style="color: #ff9f43">1</span><span class="p">)</span><span style="color: #ff6ac1">*</span><span class="nx">aspectRatio</span><span style="color: #ff6ac1">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #57c7ff">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #ff6ac1">/</span><span style="color: #ff9f43">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #ff9f43">1</span><span style="color: #ff6ac1">-</span><span style="color: #ff9f43">2</span><span style="color: #ff6ac1">*</span><span style="color: #ff5c57">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span style="color: #ff6ac1">/</span><span style="color: #ff5c57">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span style="color: #ff6ac1">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #57c7ff">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #ff6ac1">/</span><span style="color: #ff9f43">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span style="color: #ff6ac1">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span style="color: #ff6ac1">-</span><span style="color: #ff9f43">1</span><span class="p">}.</span><span style="color: #57c7ff">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span style="color: #ff6ac1">:=</span> <span style="color: #ff9f43">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff6ac1">for</span> <span class="nx">i</span> <span style="color: #ff6ac1">:=</span> <span style="color: #ff9f43">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #ff6ac1">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span style="color: #ff6ac1">:=</span> <span class="nx">direction</span><span class="p">.</span><span style="color: #57c7ff">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span style="color: #57c7ff">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span style="color: #ff9f43">0</span><span class="p">,</span> <span style="color: #ff9f43">0</span><span class="p">,</span> <span style="color: #ff9f43">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span style="color: #ff6ac1">:=</span> <span style="color: #57c7ff">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span style="color: #ff6ac1">-</span> <span style="color: #ff9f43">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff6ac1">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span style="color: #ff9f43">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff6ac1">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span style="color: #ff5c57">uint8</span><span class="p">(</span><span style="color: #ff9f43">255</span> <span style="color: #ff6ac1">-</span> <span class="nx">t</span><span style="color: #ff6ac1">*</span><span style="color: #ff9f43">255</span><span style="color: #ff6ac1">/</span><span style="color: #ff9f43">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span style="color: #ff6ac1">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff6ac1">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span style="color: #ff9f43">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff6ac1">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff6ac1">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff5c57">func</span> <span style="color: #57c7ff">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span style="color: #ff6ac1">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #57c7ff">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #57c7ff">Rect</span><span class="p">(</span><span style="color: #ff9f43">0</span><span class="p">,</span> <span style="color: #ff9f43">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff6ac1">for</span> <span class="nx">y</span> <span style="color: #ff6ac1">:=</span> <span style="color: #ff9f43">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span style="color: #ff6ac1">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span style="color: #57c7ff">Add</span><span class="p">(</span><span style="color: #ff9f43">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff6ac1">go</span> <span style="color: #ff5c57">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #9aedfe">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff6ac1">defer</span> <span class="nx">wg</span><span class="p">.</span><span style="color: #57c7ff">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff6ac1">for</span> <span class="nx">x</span> <span style="color: #ff6ac1">:=</span> <span style="color: #ff9f43">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span style="color: #ff6ac1">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span style="color: #57c7ff">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span style="color: #57c7ff">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span style="color: #57c7ff">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span style="color: #ff6ac1">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #57c7ff">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #57c7ff">Rect</span><span class="p">(</span><span style="color: #ff9f43">0</span><span class="p">,</span> <span style="color: #ff9f43">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff6ac1">for</span> <span class="nx">y</span> <span style="color: #ff6ac1">:=</span> <span style="color: #ff9f43">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span style="color: #ff6ac1">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff6ac1">for</span> <span class="nx">x</span> <span style="color: #ff6ac1">:=</span> <span style="color: #ff9f43">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span style="color: #ff6ac1">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span style="color: #ff6ac1">:=</span> <span style="color: #ff9f43">0</span><span class="p">,</span> <span style="color: #ff9f43">0</span><span class="p">,</span> <span style="color: #ff9f43">0</span><span class="p">,</span> <span style="color: #ff9f43">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff6ac1">for</span> <span class="nx">dy</span> <span style="color: #ff6ac1">:=</span> <span style="color: #ff9f43">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span style="color: #ff6ac1">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #ff6ac1">for</span> <span class="nx">dx</span> <span style="color: #ff6ac1">:=</span> <span style="color: #ff9f43">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span style="color: #ff6ac1">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span style="color: #ff6ac1">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span style="color: #57c7ff">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span style="color: #ff6ac1">*</span><span class="nx">supersamplingRatio</span><span style="color: #ff6ac1">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span style="color: #ff6ac1">*</span><span class="nx">supersamplingRatio</span><span style="color: #ff6ac1">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span style="color: #ff6ac1">+=</span> <span style="color: #ff5c57">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span style="color: #ff6ac1">+=</span> <span style="color: #ff5c57">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span style="color: #ff6ac1">+=</span> <span style="color: #ff5c57">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span style="color: #ff6ac1">+=</span> <span style="color: #ff5c57">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span style="color: #ff6ac1">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #ff6ac1">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span style="color: #ff6ac1">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #ff6ac1">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span style="color: #ff6ac1">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #ff6ac1">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span style="color: #ff6ac1">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #ff6ac1">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span style="color: #57c7ff">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span style="color: #ff5c57">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span style="color: #ff5c57">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span style="color: #ff5c57">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span style="color: #ff5c57">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span style="color: #ff6ac1">:=</span> <span class="nx">os</span><span class="p">.</span><span style="color: #57c7ff">Create</span><span class="p">(</span><span style="color: #5af78e">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff6ac1">if</span> <span class="nx">err</span> <span style="color: #ff6ac1">!=</span> <span style="color: #ff6ac1">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #57c7ff">Println</span><span class="p">(</span><span style="color: #5af78e">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff6ac1">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff6ac1">defer</span> <span class="nx">file</span><span class="p">.</span><span style="color: #57c7ff">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span style="color: #57c7ff">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff6ac1">if</span> <span class="nx">err</span> <span style="color: #ff6ac1">!=</span> <span style="color: #ff6ac1">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #57c7ff">Println</span><span class="p">(</span><span style="color: #5af78e">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='borland'><h2><a id='stylelink' href='borland.html' alt='View only borland'>borland</a></h2></a><code><pre style="background-color: #ffffff;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #000080; font-weight: bold">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #000080; font-weight: bold">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #000080; font-weight: bold">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span style="color: #0000ff">1920</span><span class="p">,</span> <span style="color: #0000ff">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span style="color: #0000ff">3840</span><span class="p">,</span> <span style="color: #0000ff">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span class="nb">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span class="o">/</span> <span style="color: #0000ff">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span style="color: #0000ff">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span style="color: #0000ff">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span style="color: #0000ff">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span style="color: #0000ff">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #000080; font-weight: bold">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #000080; font-weight: bold">type</span> <span class="nx">vec3</span> <span style="color: #000080; font-weight: bold">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #000080; font-weight: bold">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #000080; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nf">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #000080; font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #000080; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nf">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #000080; font-weight: bold">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #000080; font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #000080; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nf">length</span><span class="p">()</span> <span style="color: #000080; font-weight: bold">float64</span>    <span class="p">{</span> <span style="color: #000080; font-weight: bold">return</span> <span class="nx">math</span><span class="p">.</span><span class="nf">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #000080; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nf">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #000080; font-weight: bold">return</span> <span class="nx">v</span><span class="p">.</span><span class="nf">mul</span><span class="p">(</span><span style="color: #0000ff">1</span> <span class="o">/</span> <span class="nx">v</span><span class="p">.</span><span class="nf">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #000080; font-weight: bold">func</span> <span class="nf">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #000080; font-weight: bold">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="o">:=</span> <span class="nx">p</span><span class="p">,</span> <span style="color: #0000ff">0.0</span><span class="p">,</span> <span style="color: #0000ff">0.0</span><span class="p">,</span> <span style="color: #0000ff">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000080; font-weight: bold">for</span> <span class="nx">i</span> <span class="o">:=</span> <span style="color: #0000ff">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span class="nf">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000080; font-weight: bold">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000080; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nf">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span class="o">/</span><span class="nx">r</span><span class="p">)</span><span class="o">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span class="nf">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="o">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nf">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000080; font-weight: bold">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #000080; font-weight: bold">func</span> <span class="nf">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #000080; font-weight: bold">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span class="o">:=</span> <span class="p">(</span><span style="color: #0000ff">2</span><span class="o">*</span><span class="nb">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="o">/</span><span class="nb">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span class="o">-</span><span style="color: #0000ff">1</span><span class="p">)</span><span class="o">*</span><span class="nx">aspectRatio</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Tan</span><span class="p">(</span><span class="nx">fov</span><span class="o">/</span><span style="color: #0000ff">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #0000ff">1</span><span class="o">-</span><span style="color: #0000ff">2</span><span class="o">*</span><span class="nb">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span class="o">/</span><span class="nb">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Tan</span><span class="p">(</span><span class="nx">fov</span><span class="o">/</span><span style="color: #0000ff">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span class="o">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span class="o">-</span><span style="color: #0000ff">1</span><span class="p">}.</span><span class="nf">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span class="o">:=</span> <span style="color: #0000ff">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000080; font-weight: bold">for</span> <span class="nx">i</span> <span class="o">:=</span> <span style="color: #0000ff">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span class="o">:=</span> <span class="nx">direction</span><span class="p">.</span><span class="nf">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span class="nf">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span style="color: #0000ff">0</span><span class="p">,</span> <span style="color: #0000ff">0</span><span class="p">,</span> <span style="color: #0000ff">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span class="o">:=</span> <span class="nf">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="o">-</span> <span style="color: #0000ff">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000080; font-weight: bold">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span style="color: #0000ff">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000080; font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span class="nb">uint8</span><span class="p">(</span><span style="color: #0000ff">255</span> <span class="o">-</span> <span class="nx">t</span><span class="o">*</span><span style="color: #0000ff">255</span><span class="o">/</span><span style="color: #0000ff">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span class="o">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000080; font-weight: bold">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span style="color: #0000ff">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000080; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000080; font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #000080; font-weight: bold">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span class="nf">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span class="nf">Rect</span><span class="p">(</span><span style="color: #0000ff">0</span><span class="p">,</span> <span style="color: #0000ff">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000080; font-weight: bold">for</span> <span class="nx">y</span> <span class="o">:=</span> <span style="color: #0000ff">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span style="color: #0000ff">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000080; font-weight: bold">go</span> <span style="color: #000080; font-weight: bold">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #000080; font-weight: bold">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000080; font-weight: bold">defer</span> <span class="nx">wg</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000080; font-weight: bold">for</span> <span class="nx">x</span> <span class="o">:=</span> <span style="color: #0000ff">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nf">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span class="nf">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span class="nf">Rect</span><span class="p">(</span><span style="color: #0000ff">0</span><span class="p">,</span> <span style="color: #0000ff">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000080; font-weight: bold">for</span> <span class="nx">y</span> <span class="o">:=</span> <span style="color: #0000ff">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000080; font-weight: bold">for</span> <span class="nx">x</span> <span class="o">:=</span> <span style="color: #0000ff">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span class="o">:=</span> <span style="color: #0000ff">0</span><span class="p">,</span> <span style="color: #0000ff">0</span><span class="p">,</span> <span style="color: #0000ff">0</span><span class="p">,</span> <span style="color: #0000ff">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000080; font-weight: bold">for</span> <span class="nx">dy</span> <span class="o">:=</span> <span style="color: #0000ff">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #000080; font-weight: bold">for</span> <span class="nx">dx</span> <span class="o">:=</span> <span style="color: #0000ff">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span class="o">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span class="nf">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span class="o">*</span><span class="nx">supersamplingRatio</span><span class="o">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span class="o">*</span><span class="nx">supersamplingRatio</span><span class="o">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span class="nb">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span style="color: #0000ff">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000080; font-weight: bold">if</span> <span class="nx">err</span> <span class="o">!=</span> <span style="color: #000080; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span style="color: #0000ff">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000080; font-weight: bold">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000080; font-weight: bold">defer</span> <span class="nx">file</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span class="nf">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000080; font-weight: bold">if</span> <span class="nx">err</span> <span class="o">!=</span> <span style="color: #000080; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span style="color: #0000ff">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='bw'><h2><a id='stylelink' href='bw.html' alt='View only bw'>bw</a></h2></a><code><pre style="background-color: #ffffff;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="font-weight: bold">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-style: italic">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-style: italic">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-style: italic">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-style: italic">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-style: italic">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-style: italic">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-style: italic">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span class="mi">1920</span><span class="p">,</span> <span class="mi">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span class="mi">3840</span><span class="p">,</span> <span class="mi">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span class="nb">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span class="o">/</span> <span class="mi">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span class="mi">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span class="mi">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span class="mf">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span class="mi">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold">type</span> <span class="nx">vec3</span> <span style="font-weight: bold">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nf">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nf">mul</span><span class="p">(</span><span class="nx">s</span> <span style="">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nf">length</span><span class="p">()</span> <span style="">float64</span>    <span class="p">{</span> <span style="font-weight: bold">return</span> <span class="nx">math</span><span class="p">.</span><span class="nf">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nf">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="font-weight: bold">return</span> <span class="nx">v</span><span class="p">.</span><span class="nf">mul</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="nx">v</span><span class="p">.</span><span class="nf">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold">func</span> <span class="nf">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="o">:=</span> <span class="nx">p</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span class="nf">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="font-weight: bold">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nf">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span class="o">/</span><span class="nx">r</span><span class="p">)</span><span class="o">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span class="nf">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="o">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nf">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold">func</span> <span class="nf">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span class="o">:=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nb">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="o">/</span><span class="nb">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nx">aspectRatio</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Tan</span><span class="p">(</span><span class="nx">fov</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="nb">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span class="o">/</span><span class="nb">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Tan</span><span class="p">(</span><span class="nx">fov</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span class="o">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">}.</span><span class="nf">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span class="o">:=</span> <span class="mf">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span class="o">:=</span> <span class="nx">direction</span><span class="p">.</span><span class="nf">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span class="nf">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span class="o">:=</span> <span class="nf">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="font-weight: bold">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span class="mf">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span class="nb">uint8</span><span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">t</span><span class="o">*</span><span class="mi">255</span><span class="o">/</span><span class="mi">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span class="o">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="font-weight: bold">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span class="mi">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span class="nf">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span class="nf">Rect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold">for</span> <span class="nx">y</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="font-weight: bold">go</span> <span style="font-weight: bold">func</span><span class="p">(</span><span class="nx">y</span> <span style="">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="font-weight: bold">defer</span> <span class="nx">wg</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="font-weight: bold">for</span> <span class="nx">x</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nf">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span class="nf">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span class="nf">Rect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold">for</span> <span class="nx">y</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="font-weight: bold">for</span> <span class="nx">x</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="font-weight: bold">for</span> <span class="nx">dy</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="font-weight: bold">for</span> <span class="nx">dx</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span class="o">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span class="nf">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span class="o">*</span><span class="nx">supersamplingRatio</span><span class="o">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span class="o">*</span><span class="nx">supersamplingRatio</span><span class="o">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span class="nb">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span style="font-style: italic">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold">if</span> <span class="nx">err</span> <span class="o">!=</span> <span style="font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span style="font-style: italic">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="font-weight: bold">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold">defer</span> <span class="nx">file</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span class="nf">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold">if</span> <span class="nx">err</span> <span class="o">!=</span> <span style="font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span style="font-style: italic">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='catppuccin-frappe'><h2><a id='stylelink' href='catppuccin-frappe.html' alt='View only catppuccin-frappe'>catppuccin-frappe</a></h2></a><code><pre style="color: #ef9f76; background-color: #303446;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #ca9ee6">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #626880; font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #626880; font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #626880; font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #626880; font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ca9ee6">import</span> <span style="color: #c6d0f5">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6d189">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6d189">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6d189">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6d189">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6d189">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6d189">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6d189">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c6d0f5">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ca9ee6">const</span> <span style="color: #c6d0f5">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span style="color: #c6d0f5">,</span> <span class="nx">height</span>      <span style="color: #c6d0f5">=</span> <span class="mi">1920</span><span style="color: #c6d0f5">,</span> <span class="mi">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span style="color: #c6d0f5">,</span> <span class="nx">ssHeight</span>  <span style="color: #c6d0f5">=</span> <span class="mi">3840</span><span style="color: #c6d0f5">,</span> <span class="mi">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span style="color: #c6d0f5">=</span> <span style="color: #c6d0f5; font-style: italic">float64</span><span style="color: #c6d0f5">(</span><span class="nx">ssWidth</span><span style="color: #c6d0f5">)</span> <span style="color: #99d1db">/</span> <span style="color: #c6d0f5; font-style: italic">float64</span><span style="color: #c6d0f5">(</span><span class="nx">ssHeight</span><span style="color: #c6d0f5">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span style="color: #c6d0f5">=</span> <span class="nx">math</span><span style="color: #c6d0f5">.</span><span class="nx">Pi</span> <span style="color: #99d1db">/</span> <span class="mi">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span style="color: #c6d0f5">=</span> <span class="mi">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span style="color: #c6d0f5">=</span> <span class="mi">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span style="color: #c6d0f5">=</span> <span class="mf">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span style="color: #c6d0f5">=</span> <span class="mi">2</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c6d0f5">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ca9ee6">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span style="color: #c6d0f5">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ca9ee6">type</span> <span class="nx">vec3</span> <span style="color: #ca9ee6">struct</span><span style="color: #c6d0f5">{</span> <span class="nx">x</span><span style="color: #c6d0f5">,</span> <span class="nx">y</span><span style="color: #c6d0f5">,</span> <span class="nx">z</span> <span style="color: #e5c890">float64</span> <span style="color: #c6d0f5">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ca9ee6">func</span> <span style="color: #c6d0f5">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #c6d0f5">)</span> <span style="color: #99d1db">add</span><span style="color: #c6d0f5">(</span><span class="nx">w</span> <span class="nx">vec3</span><span style="color: #c6d0f5">)</span> <span class="nx">vec3</span>    <span style="color: #c6d0f5">{</span> <span style="color: #ca9ee6">return</span> <span class="nx">vec3</span><span style="color: #c6d0f5">{</span><span class="nx">v</span><span style="color: #c6d0f5">.</span><span class="nx">x</span> <span style="color: #99d1db">+</span> <span class="nx">w</span><span style="color: #c6d0f5">.</span><span class="nx">x</span><span style="color: #c6d0f5">,</span> <span class="nx">v</span><span style="color: #c6d0f5">.</span><span class="nx">y</span> <span style="color: #99d1db">+</span> <span class="nx">w</span><span style="color: #c6d0f5">.</span><span class="nx">y</span><span style="color: #c6d0f5">,</span> <span class="nx">v</span><span style="color: #c6d0f5">.</span><span class="nx">z</span> <span style="color: #99d1db">+</span> <span class="nx">w</span><span style="color: #c6d0f5">.</span><span class="nx">z</span><span style="color: #c6d0f5">}</span> <span style="color: #c6d0f5">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ca9ee6">func</span> <span style="color: #c6d0f5">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #c6d0f5">)</span> <span style="color: #99d1db">mul</span><span style="color: #c6d0f5">(</span><span class="nx">s</span> <span style="color: #e5c890">float64</span><span style="color: #c6d0f5">)</span> <span class="nx">vec3</span> <span style="color: #c6d0f5">{</span> <span style="color: #ca9ee6">return</span> <span class="nx">vec3</span><span style="color: #c6d0f5">{</span><span class="nx">v</span><span style="color: #c6d0f5">.</span><span class="nx">x</span> <span style="color: #99d1db">*</span> <span class="nx">s</span><span style="color: #c6d0f5">,</span> <span class="nx">v</span><span style="color: #c6d0f5">.</span><span class="nx">y</span> <span style="color: #99d1db">*</span> <span class="nx">s</span><span style="color: #c6d0f5">,</span> <span class="nx">v</span><span style="color: #c6d0f5">.</span><span class="nx">z</span> <span style="color: #99d1db">*</span> <span class="nx">s</span><span style="color: #c6d0f5">}</span> <span style="color: #c6d0f5">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ca9ee6">func</span> <span style="color: #c6d0f5">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #c6d0f5">)</span> <span style="color: #99d1db">length</span><span style="color: #c6d0f5">()</span> <span style="color: #e5c890">float64</span>    <span style="color: #c6d0f5">{</span> <span style="color: #ca9ee6">return</span> <span class="nx">math</span><span style="color: #c6d0f5">.</span><span style="color: #99d1db">Sqrt</span><span style="color: #c6d0f5">(</span><span class="nx">v</span><span style="color: #c6d0f5">.</span><span class="nx">x</span><span style="color: #99d1db">*</span><span class="nx">v</span><span style="color: #c6d0f5">.</span><span class="nx">x</span> <span style="color: #99d1db">+</span> <span class="nx">v</span><span style="color: #c6d0f5">.</span><span class="nx">y</span><span style="color: #99d1db">*</span><span class="nx">v</span><span style="color: #c6d0f5">.</span><span class="nx">y</span> <span style="color: #99d1db">+</span> <span class="nx">v</span><span style="color: #c6d0f5">.</span><span class="nx">z</span><span style="color: #99d1db">*</span><span class="nx">v</span><span style="color: #c6d0f5">.</span><span class="nx">z</span><span style="color: #c6d0f5">)</span> <span style="color: #c6d0f5">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ca9ee6">func</span> <span style="color: #c6d0f5">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #c6d0f5">)</span> <span style="color: #99d1db">normalize</span><span style="color: #c6d0f5">()</span> <span class="nx">vec3</span>    <span style="color: #c6d0f5">{</span> <span style="color: #ca9ee6">return</span> <span class="nx">v</span><span style="color: #c6d0f5">.</span><span style="color: #99d1db">mul</span><span style="color: #c6d0f5">(</span><span class="mi">1</span> <span style="color: #99d1db">/</span> <span class="nx">v</span><span style="color: #c6d0f5">.</span><span style="color: #99d1db">length</span><span style="color: #c6d0f5">())</span> <span style="color: #c6d0f5">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ca9ee6">func</span> <span style="color: #99d1db">mandelbulb</span><span style="color: #c6d0f5">(</span><span class="nx">p</span> <span class="nx">vec3</span><span style="color: #c6d0f5">)</span> <span style="color: #e5c890">float64</span> <span style="color: #c6d0f5">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span style="color: #c6d0f5">,</span> <span class="nx">r</span><span style="color: #c6d0f5">,</span> <span class="nx">theta</span><span style="color: #c6d0f5">,</span> <span class="nx">phi</span> <span style="color: #99d1db">:=</span> <span class="nx">p</span><span style="color: #c6d0f5">,</span> <span class="mf">0.0</span><span style="color: #c6d0f5">,</span> <span class="mf">0.0</span><span style="color: #c6d0f5">,</span> <span class="mf">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ca9ee6">for</span> <span class="nx">i</span> <span style="color: #99d1db">:=</span> <span class="mi">0</span><span style="color: #c6d0f5">;</span> <span class="nx">i</span> <span style="color: #c6d0f5">&lt;</span> <span class="nx">maxIter</span><span style="color: #c6d0f5">;</span> <span class="nx">i</span><span style="color: #99d1db">++</span> <span style="color: #c6d0f5">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span style="color: #c6d0f5">=</span> <span class="nx">z</span><span style="color: #c6d0f5">.</span><span style="color: #99d1db">length</span><span style="color: #c6d0f5">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ca9ee6">if</span> <span class="nx">r</span> <span style="color: #c6d0f5">&gt;</span> <span class="nx">escapeRadius</span> <span style="color: #c6d0f5">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ca9ee6">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c6d0f5">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span style="color: #c6d0f5">,</span> <span class="nx">phi</span> <span style="color: #c6d0f5">=</span> <span class="nx">math</span><span style="color: #c6d0f5">.</span><span style="color: #99d1db">Acos</span><span style="color: #c6d0f5">(</span><span class="nx">z</span><span style="color: #c6d0f5">.</span><span class="nx">z</span><span style="color: #99d1db">/</span><span class="nx">r</span><span style="color: #c6d0f5">)</span><span style="color: #99d1db">*</span><span class="nx">power</span><span style="color: #c6d0f5">,</span> <span class="nx">math</span><span style="color: #c6d0f5">.</span><span style="color: #99d1db">Atan2</span><span style="color: #c6d0f5">(</span><span class="nx">z</span><span style="color: #c6d0f5">.</span><span class="nx">y</span><span style="color: #c6d0f5">,</span> <span class="nx">z</span><span style="color: #c6d0f5">.</span><span class="nx">x</span><span style="color: #c6d0f5">)</span><span style="color: #99d1db">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span style="color: #c6d0f5">=</span> <span class="nx">math</span><span style="color: #c6d0f5">.</span><span style="color: #99d1db">Pow</span><span style="color: #c6d0f5">(</span><span class="nx">r</span><span style="color: #c6d0f5">,</span> <span class="nx">power</span><span style="color: #c6d0f5">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span style="color: #c6d0f5">.</span><span class="nx">x</span><span style="color: #c6d0f5">,</span> <span class="nx">z</span><span style="color: #c6d0f5">.</span><span class="nx">y</span><span style="color: #c6d0f5">,</span> <span class="nx">z</span><span style="color: #c6d0f5">.</span><span class="nx">z</span> <span style="color: #c6d0f5">=</span> <span class="nx">p</span><span style="color: #c6d0f5">.</span><span class="nx">x</span><span style="color: #99d1db">+</span><span class="nx">r</span><span style="color: #99d1db">*</span><span class="nx">math</span><span style="color: #c6d0f5">.</span><span style="color: #99d1db">Sin</span><span style="color: #c6d0f5">(</span><span class="nx">theta</span><span style="color: #c6d0f5">)</span><span style="color: #99d1db">*</span><span class="nx">math</span><span style="color: #c6d0f5">.</span><span style="color: #99d1db">Cos</span><span style="color: #c6d0f5">(</span><span class="nx">phi</span><span style="color: #c6d0f5">),</span> <span class="nx">p</span><span style="color: #c6d0f5">.</span><span class="nx">y</span><span style="color: #99d1db">+</span><span class="nx">r</span><span style="color: #99d1db">*</span><span class="nx">math</span><span style="color: #c6d0f5">.</span><span style="color: #99d1db">Sin</span><span style="color: #c6d0f5">(</span><span class="nx">theta</span><span style="color: #c6d0f5">)</span><span style="color: #99d1db">*</span><span class="nx">math</span><span style="color: #c6d0f5">.</span><span style="color: #99d1db">Sin</span><span style="color: #c6d0f5">(</span><span class="nx">phi</span><span style="color: #c6d0f5">),</span> <span class="nx">p</span><span style="color: #c6d0f5">.</span><span class="nx">z</span><span style="color: #99d1db">+</span><span class="nx">r</span><span style="color: #99d1db">*</span><span class="nx">math</span><span style="color: #c6d0f5">.</span><span style="color: #99d1db">Cos</span><span style="color: #c6d0f5">(</span><span class="nx">theta</span><span style="color: #c6d0f5">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c6d0f5">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ca9ee6">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c6d0f5">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ca9ee6">func</span> <span style="color: #99d1db">renderPixel</span><span style="color: #c6d0f5">(</span><span class="nx">x</span><span style="color: #c6d0f5">,</span> <span class="nx">y</span> <span style="color: #e5c890">int</span><span style="color: #c6d0f5">)</span> <span class="nx">color</span><span style="color: #c6d0f5">.</span><span class="nx">Color</span> <span style="color: #c6d0f5">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span style="color: #c6d0f5">,</span> <span class="nx">py</span> <span style="color: #99d1db">:=</span> <span style="color: #c6d0f5">(</span><span class="mi">2</span><span style="color: #99d1db">*</span><span style="color: #c6d0f5; font-style: italic">float64</span><span style="color: #c6d0f5">(</span><span class="nx">x</span><span style="color: #c6d0f5">)</span><span style="color: #99d1db">/</span><span style="color: #c6d0f5; font-style: italic">float64</span><span style="color: #c6d0f5">(</span><span class="nx">ssWidth</span><span style="color: #c6d0f5">)</span><span style="color: #99d1db">-</span><span class="mi">1</span><span style="color: #c6d0f5">)</span><span style="color: #99d1db">*</span><span class="nx">aspectRatio</span><span style="color: #99d1db">*</span><span class="nx">math</span><span style="color: #c6d0f5">.</span><span style="color: #99d1db">Tan</span><span style="color: #c6d0f5">(</span><span class="nx">fov</span><span style="color: #99d1db">/</span><span class="mi">2</span><span style="color: #c6d0f5">),</span> <span style="color: #c6d0f5">(</span><span class="mi">1</span><span style="color: #99d1db">-</span><span class="mi">2</span><span style="color: #99d1db">*</span><span style="color: #c6d0f5; font-style: italic">float64</span><span style="color: #c6d0f5">(</span><span class="nx">y</span><span style="color: #c6d0f5">)</span><span style="color: #99d1db">/</span><span style="color: #c6d0f5; font-style: italic">float64</span><span style="color: #c6d0f5">(</span><span class="nx">ssHeight</span><span style="color: #c6d0f5">))</span><span style="color: #99d1db">*</span><span class="nx">math</span><span style="color: #c6d0f5">.</span><span style="color: #99d1db">Tan</span><span style="color: #c6d0f5">(</span><span class="nx">fov</span><span style="color: #99d1db">/</span><span class="mi">2</span><span style="color: #c6d0f5">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span style="color: #99d1db">:=</span> <span class="nx">vec3</span><span style="color: #c6d0f5">{</span><span class="nx">px</span><span style="color: #c6d0f5">,</span> <span class="nx">py</span><span style="color: #c6d0f5">,</span> <span style="color: #99d1db">-</span><span class="mi">1</span><span style="color: #c6d0f5">}.</span><span style="color: #99d1db">normalize</span><span style="color: #c6d0f5">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span style="color: #99d1db">:=</span> <span class="mf">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ca9ee6">for</span> <span class="nx">i</span> <span style="color: #99d1db">:=</span> <span class="mi">0</span><span style="color: #c6d0f5">;</span> <span class="nx">i</span> <span style="color: #c6d0f5">&lt;</span> <span class="nx">maxIter</span><span style="color: #c6d0f5">;</span> <span class="nx">i</span><span style="color: #99d1db">++</span> <span style="color: #c6d0f5">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span style="color: #99d1db">:=</span> <span class="nx">direction</span><span style="color: #c6d0f5">.</span><span style="color: #99d1db">mul</span><span style="color: #c6d0f5">(</span><span class="nx">t</span><span style="color: #c6d0f5">).</span><span style="color: #99d1db">add</span><span style="color: #c6d0f5">(</span><span class="nx">vec3</span><span style="color: #c6d0f5">{</span><span class="mi">0</span><span style="color: #c6d0f5">,</span> <span class="mi">0</span><span style="color: #c6d0f5">,</span> <span class="mi">5</span><span style="color: #c6d0f5">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span style="color: #99d1db">:=</span> <span style="color: #99d1db">mandelbulb</span><span style="color: #c6d0f5">(</span><span class="nx">p</span><span style="color: #c6d0f5">)</span> <span style="color: #99d1db">-</span> <span class="mi">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ca9ee6">if</span> <span class="nx">d</span> <span style="color: #c6d0f5">&lt;</span> <span class="mf">0.001</span> <span style="color: #c6d0f5">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ca9ee6">return</span> <span class="nx">color</span><span style="color: #c6d0f5">.</span><span class="nx">Gray</span><span style="color: #c6d0f5">{</span><span style="color: #c6d0f5; font-style: italic">uint8</span><span style="color: #c6d0f5">(</span><span class="mi">255</span> <span style="color: #99d1db">-</span> <span class="nx">t</span><span style="color: #99d1db">*</span><span class="mi">255</span><span style="color: #99d1db">/</span><span class="mi">100</span><span style="color: #c6d0f5">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c6d0f5">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span style="color: #99d1db">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ca9ee6">if</span> <span class="nx">t</span> <span style="color: #c6d0f5">&gt;</span> <span class="mi">100</span> <span style="color: #c6d0f5">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ca9ee6">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c6d0f5">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c6d0f5">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ca9ee6">return</span> <span class="nx">color</span><span style="color: #c6d0f5">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c6d0f5">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ca9ee6">func</span> <span style="color: #99d1db">main</span><span style="color: #c6d0f5">()</span> <span style="color: #c6d0f5">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span style="color: #99d1db">:=</span> <span class="nx">image</span><span style="color: #c6d0f5">.</span><span style="color: #99d1db">NewRGBA</span><span style="color: #c6d0f5">(</span><span class="nx">image</span><span style="color: #c6d0f5">.</span><span style="color: #99d1db">Rect</span><span style="color: #c6d0f5">(</span><span class="mi">0</span><span style="color: #c6d0f5">,</span> <span class="mi">0</span><span style="color: #c6d0f5">,</span> <span class="nx">ssWidth</span><span style="color: #c6d0f5">,</span> <span class="nx">ssHeight</span><span style="color: #c6d0f5">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ca9ee6">for</span> <span class="nx">y</span> <span style="color: #99d1db">:=</span> <span class="mi">0</span><span style="color: #c6d0f5">;</span> <span class="nx">y</span> <span style="color: #c6d0f5">&lt;</span> <span class="nx">ssHeight</span><span style="color: #c6d0f5">;</span> <span class="nx">y</span><span style="color: #99d1db">++</span> <span style="color: #c6d0f5">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span style="color: #c6d0f5">.</span><span style="color: #99d1db">Add</span><span style="color: #c6d0f5">(</span><span class="mi">1</span><span style="color: #c6d0f5">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ca9ee6">go</span> <span style="color: #ca9ee6">func</span><span style="color: #c6d0f5">(</span><span class="nx">y</span> <span style="color: #e5c890">int</span><span style="color: #c6d0f5">)</span> <span style="color: #c6d0f5">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ca9ee6">defer</span> <span class="nx">wg</span><span style="color: #c6d0f5">.</span><span style="color: #99d1db">Done</span><span style="color: #c6d0f5">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ca9ee6">for</span> <span class="nx">x</span> <span style="color: #99d1db">:=</span> <span class="mi">0</span><span style="color: #c6d0f5">;</span> <span class="nx">x</span> <span style="color: #c6d0f5">&lt;</span> <span class="nx">ssWidth</span><span style="color: #c6d0f5">;</span> <span class="nx">x</span><span style="color: #99d1db">++</span> <span style="color: #c6d0f5">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span style="color: #c6d0f5">.</span><span style="color: #99d1db">Set</span><span style="color: #c6d0f5">(</span><span class="nx">x</span><span style="color: #c6d0f5">,</span> <span class="nx">y</span><span style="color: #c6d0f5">,</span> <span style="color: #99d1db">renderPixel</span><span style="color: #c6d0f5">(</span><span class="nx">x</span><span style="color: #c6d0f5">,</span> <span class="nx">y</span><span style="color: #c6d0f5">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c6d0f5">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c6d0f5">}(</span><span class="nx">y</span><span style="color: #c6d0f5">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c6d0f5">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span style="color: #c6d0f5">.</span><span style="color: #99d1db">Wait</span><span style="color: #c6d0f5">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span style="color: #99d1db">:=</span> <span class="nx">image</span><span style="color: #c6d0f5">.</span><span style="color: #99d1db">NewRGBA</span><span style="color: #c6d0f5">(</span><span class="nx">image</span><span style="color: #c6d0f5">.</span><span style="color: #99d1db">Rect</span><span style="color: #c6d0f5">(</span><span class="mi">0</span><span style="color: #c6d0f5">,</span> <span class="mi">0</span><span style="color: #c6d0f5">,</span> <span class="nx">width</span><span style="color: #c6d0f5">,</span> <span class="nx">height</span><span style="color: #c6d0f5">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ca9ee6">for</span> <span class="nx">y</span> <span style="color: #99d1db">:=</span> <span class="mi">0</span><span style="color: #c6d0f5">;</span> <span class="nx">y</span> <span style="color: #c6d0f5">&lt;</span> <span class="nx">height</span><span style="color: #c6d0f5">;</span> <span class="nx">y</span><span style="color: #99d1db">++</span> <span style="color: #c6d0f5">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ca9ee6">for</span> <span class="nx">x</span> <span style="color: #99d1db">:=</span> <span class="mi">0</span><span style="color: #c6d0f5">;</span> <span class="nx">x</span> <span style="color: #c6d0f5">&lt;</span> <span class="nx">width</span><span style="color: #c6d0f5">;</span> <span class="nx">x</span><span style="color: #99d1db">++</span> <span style="color: #c6d0f5">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span style="color: #c6d0f5">,</span> <span class="nx">g</span><span style="color: #c6d0f5">,</span> <span class="nx">b</span><span style="color: #c6d0f5">,</span> <span class="nx">a</span> <span style="color: #99d1db">:=</span> <span class="mi">0</span><span style="color: #c6d0f5">,</span> <span class="mi">0</span><span style="color: #c6d0f5">,</span> <span class="mi">0</span><span style="color: #c6d0f5">,</span> <span class="mi">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ca9ee6">for</span> <span class="nx">dy</span> <span style="color: #99d1db">:=</span> <span class="mi">0</span><span style="color: #c6d0f5">;</span> <span class="nx">dy</span> <span style="color: #c6d0f5">&lt;</span> <span class="nx">supersamplingRatio</span><span style="color: #c6d0f5">;</span> <span class="nx">dy</span><span style="color: #99d1db">++</span> <span style="color: #c6d0f5">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #ca9ee6">for</span> <span class="nx">dx</span> <span style="color: #99d1db">:=</span> <span class="mi">0</span><span style="color: #c6d0f5">;</span> <span class="nx">dx</span> <span style="color: #c6d0f5">&lt;</span> <span class="nx">supersamplingRatio</span><span style="color: #c6d0f5">;</span> <span class="nx">dx</span><span style="color: #99d1db">++</span> <span style="color: #c6d0f5">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span style="color: #99d1db">:=</span> <span class="nx">ssImg</span><span style="color: #c6d0f5">.</span><span style="color: #99d1db">RGBAAt</span><span style="color: #c6d0f5">(</span><span class="nx">x</span><span style="color: #99d1db">*</span><span class="nx">supersamplingRatio</span><span style="color: #99d1db">+</span><span class="nx">dx</span><span style="color: #c6d0f5">,</span> <span class="nx">y</span><span style="color: #99d1db">*</span><span class="nx">supersamplingRatio</span><span style="color: #99d1db">+</span><span class="nx">dy</span><span style="color: #c6d0f5">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span style="color: #99d1db">+=</span> <span style="color: #c6d0f5; font-style: italic">int</span><span style="color: #c6d0f5">(</span><span class="nx">c</span><span style="color: #c6d0f5">.</span><span class="nx">R</span><span style="color: #c6d0f5">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span style="color: #99d1db">+=</span> <span style="color: #c6d0f5; font-style: italic">int</span><span style="color: #c6d0f5">(</span><span class="nx">c</span><span style="color: #c6d0f5">.</span><span class="nx">G</span><span style="color: #c6d0f5">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span style="color: #99d1db">+=</span> <span style="color: #c6d0f5; font-style: italic">int</span><span style="color: #c6d0f5">(</span><span class="nx">c</span><span style="color: #c6d0f5">.</span><span class="nx">B</span><span style="color: #c6d0f5">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span style="color: #99d1db">+=</span> <span style="color: #c6d0f5; font-style: italic">int</span><span style="color: #c6d0f5">(</span><span class="nx">c</span><span style="color: #c6d0f5">.</span><span class="nx">A</span><span style="color: #c6d0f5">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #c6d0f5">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c6d0f5">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span style="color: #99d1db">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #99d1db">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span style="color: #99d1db">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #99d1db">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span style="color: #99d1db">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #99d1db">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span style="color: #99d1db">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #99d1db">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span style="color: #c6d0f5">.</span><span style="color: #99d1db">Set</span><span style="color: #c6d0f5">(</span><span class="nx">x</span><span style="color: #c6d0f5">,</span> <span class="nx">y</span><span style="color: #c6d0f5">,</span> <span class="nx">color</span><span style="color: #c6d0f5">.</span><span class="nx">RGBA</span><span style="color: #c6d0f5">{</span><span style="color: #c6d0f5; font-style: italic">uint8</span><span style="color: #c6d0f5">(</span><span class="nx">r</span><span style="color: #c6d0f5">),</span> <span style="color: #c6d0f5; font-style: italic">uint8</span><span style="color: #c6d0f5">(</span><span class="nx">g</span><span style="color: #c6d0f5">),</span> <span style="color: #c6d0f5; font-style: italic">uint8</span><span style="color: #c6d0f5">(</span><span class="nx">b</span><span style="color: #c6d0f5">),</span> <span style="color: #c6d0f5; font-style: italic">uint8</span><span style="color: #c6d0f5">(</span><span class="nx">a</span><span style="color: #c6d0f5">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c6d0f5">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c6d0f5">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span style="color: #c6d0f5">,</span> <span class="nx">err</span> <span style="color: #99d1db">:=</span> <span class="nx">os</span><span style="color: #c6d0f5">.</span><span style="color: #99d1db">Create</span><span style="color: #c6d0f5">(</span><span style="color: #a6d189">&#34;mandelbulb.png&#34;</span><span style="color: #c6d0f5">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ca9ee6">if</span> <span class="nx">err</span> <span style="color: #99d1db">!=</span> <span style="color: #ca9ee6; font-style: italic">nil</span> <span style="color: #c6d0f5">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span style="color: #c6d0f5">.</span><span style="color: #99d1db">Println</span><span style="color: #c6d0f5">(</span><span style="color: #a6d189">&#34;Error creating file:&#34;</span><span style="color: #c6d0f5">,</span> <span class="nx">err</span><span style="color: #c6d0f5">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ca9ee6">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c6d0f5">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ca9ee6">defer</span> <span class="nx">file</span><span style="color: #c6d0f5">.</span><span style="color: #99d1db">Close</span><span style="color: #c6d0f5">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span style="color: #c6d0f5">=</span> <span class="nx">png</span><span style="color: #c6d0f5">.</span><span style="color: #99d1db">Encode</span><span style="color: #c6d0f5">(</span><span class="nx">file</span><span style="color: #c6d0f5">,</span> <span class="nx">img</span><span style="color: #c6d0f5">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ca9ee6">if</span> <span class="nx">err</span> <span style="color: #99d1db">!=</span> <span style="color: #ca9ee6; font-style: italic">nil</span> <span style="color: #c6d0f5">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span style="color: #c6d0f5">.</span><span style="color: #99d1db">Println</span><span style="color: #c6d0f5">(</span><span style="color: #a6d189">&#34;Error encoding image:&#34;</span><span style="color: #c6d0f5">,</span> <span class="nx">err</span><span style="color: #c6d0f5">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c6d0f5">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c6d0f5">}</span></span></span></code></pre></code><a name='catppuccin-latte'><h2><a id='stylelink' href='catppuccin-latte.html' alt='View only catppuccin-latte'>catppuccin-latte</a></h2></a><code><pre style="color: #fe640b; background-color: #eff1f5;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #8839ef">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #acb0be; font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #acb0be; font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #acb0be; font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #acb0be; font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8839ef">import</span> <span style="color: #4c4f69">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #40a02b">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #40a02b">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #40a02b">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #40a02b">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #40a02b">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #40a02b">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #40a02b">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #4c4f69">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8839ef">const</span> <span style="color: #4c4f69">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span style="color: #4c4f69">,</span> <span class="nx">height</span>      <span style="color: #4c4f69">=</span> <span class="mi">1920</span><span style="color: #4c4f69">,</span> <span class="mi">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span style="color: #4c4f69">,</span> <span class="nx">ssHeight</span>  <span style="color: #4c4f69">=</span> <span class="mi">3840</span><span style="color: #4c4f69">,</span> <span class="mi">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span style="color: #4c4f69">=</span> <span style="font-style: italic">float64</span><span style="color: #4c4f69">(</span><span class="nx">ssWidth</span><span style="color: #4c4f69">)</span> <span style="color: #04a5e5">/</span> <span style="font-style: italic">float64</span><span style="color: #4c4f69">(</span><span class="nx">ssHeight</span><span style="color: #4c4f69">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span style="color: #4c4f69">=</span> <span class="nx">math</span><span style="color: #4c4f69">.</span><span class="nx">Pi</span> <span style="color: #04a5e5">/</span> <span class="mi">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span style="color: #4c4f69">=</span> <span class="mi">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span style="color: #4c4f69">=</span> <span class="mi">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span style="color: #4c4f69">=</span> <span class="mf">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span style="color: #4c4f69">=</span> <span class="mi">2</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #4c4f69">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8839ef">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span style="color: #4c4f69">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8839ef">type</span> <span class="nx">vec3</span> <span style="color: #8839ef">struct</span><span style="color: #4c4f69">{</span> <span class="nx">x</span><span style="color: #4c4f69">,</span> <span class="nx">y</span><span style="color: #4c4f69">,</span> <span class="nx">z</span> <span style="color: #df8e1d">float64</span> <span style="color: #4c4f69">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8839ef">func</span> <span style="color: #4c4f69">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #4c4f69">)</span> <span style="color: #04a5e5">add</span><span style="color: #4c4f69">(</span><span class="nx">w</span> <span class="nx">vec3</span><span style="color: #4c4f69">)</span> <span class="nx">vec3</span>    <span style="color: #4c4f69">{</span> <span style="color: #8839ef">return</span> <span class="nx">vec3</span><span style="color: #4c4f69">{</span><span class="nx">v</span><span style="color: #4c4f69">.</span><span class="nx">x</span> <span style="color: #04a5e5">+</span> <span class="nx">w</span><span style="color: #4c4f69">.</span><span class="nx">x</span><span style="color: #4c4f69">,</span> <span class="nx">v</span><span style="color: #4c4f69">.</span><span class="nx">y</span> <span style="color: #04a5e5">+</span> <span class="nx">w</span><span style="color: #4c4f69">.</span><span class="nx">y</span><span style="color: #4c4f69">,</span> <span class="nx">v</span><span style="color: #4c4f69">.</span><span class="nx">z</span> <span style="color: #04a5e5">+</span> <span class="nx">w</span><span style="color: #4c4f69">.</span><span class="nx">z</span><span style="color: #4c4f69">}</span> <span style="color: #4c4f69">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8839ef">func</span> <span style="color: #4c4f69">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #4c4f69">)</span> <span style="color: #04a5e5">mul</span><span style="color: #4c4f69">(</span><span class="nx">s</span> <span style="color: #df8e1d">float64</span><span style="color: #4c4f69">)</span> <span class="nx">vec3</span> <span style="color: #4c4f69">{</span> <span style="color: #8839ef">return</span> <span class="nx">vec3</span><span style="color: #4c4f69">{</span><span class="nx">v</span><span style="color: #4c4f69">.</span><span class="nx">x</span> <span style="color: #04a5e5">*</span> <span class="nx">s</span><span style="color: #4c4f69">,</span> <span class="nx">v</span><span style="color: #4c4f69">.</span><span class="nx">y</span> <span style="color: #04a5e5">*</span> <span class="nx">s</span><span style="color: #4c4f69">,</span> <span class="nx">v</span><span style="color: #4c4f69">.</span><span class="nx">z</span> <span style="color: #04a5e5">*</span> <span class="nx">s</span><span style="color: #4c4f69">}</span> <span style="color: #4c4f69">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8839ef">func</span> <span style="color: #4c4f69">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #4c4f69">)</span> <span style="color: #04a5e5">length</span><span style="color: #4c4f69">()</span> <span style="color: #df8e1d">float64</span>    <span style="color: #4c4f69">{</span> <span style="color: #8839ef">return</span> <span class="nx">math</span><span style="color: #4c4f69">.</span><span style="color: #04a5e5">Sqrt</span><span style="color: #4c4f69">(</span><span class="nx">v</span><span style="color: #4c4f69">.</span><span class="nx">x</span><span style="color: #04a5e5">*</span><span class="nx">v</span><span style="color: #4c4f69">.</span><span class="nx">x</span> <span style="color: #04a5e5">+</span> <span class="nx">v</span><span style="color: #4c4f69">.</span><span class="nx">y</span><span style="color: #04a5e5">*</span><span class="nx">v</span><span style="color: #4c4f69">.</span><span class="nx">y</span> <span style="color: #04a5e5">+</span> <span class="nx">v</span><span style="color: #4c4f69">.</span><span class="nx">z</span><span style="color: #04a5e5">*</span><span class="nx">v</span><span style="color: #4c4f69">.</span><span class="nx">z</span><span style="color: #4c4f69">)</span> <span style="color: #4c4f69">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8839ef">func</span> <span style="color: #4c4f69">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #4c4f69">)</span> <span style="color: #04a5e5">normalize</span><span style="color: #4c4f69">()</span> <span class="nx">vec3</span>    <span style="color: #4c4f69">{</span> <span style="color: #8839ef">return</span> <span class="nx">v</span><span style="color: #4c4f69">.</span><span style="color: #04a5e5">mul</span><span style="color: #4c4f69">(</span><span class="mi">1</span> <span style="color: #04a5e5">/</span> <span class="nx">v</span><span style="color: #4c4f69">.</span><span style="color: #04a5e5">length</span><span style="color: #4c4f69">())</span> <span style="color: #4c4f69">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8839ef">func</span> <span style="color: #04a5e5">mandelbulb</span><span style="color: #4c4f69">(</span><span class="nx">p</span> <span class="nx">vec3</span><span style="color: #4c4f69">)</span> <span style="color: #df8e1d">float64</span> <span style="color: #4c4f69">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span style="color: #4c4f69">,</span> <span class="nx">r</span><span style="color: #4c4f69">,</span> <span class="nx">theta</span><span style="color: #4c4f69">,</span> <span class="nx">phi</span> <span style="color: #04a5e5">:=</span> <span class="nx">p</span><span style="color: #4c4f69">,</span> <span class="mf">0.0</span><span style="color: #4c4f69">,</span> <span class="mf">0.0</span><span style="color: #4c4f69">,</span> <span class="mf">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #8839ef">for</span> <span class="nx">i</span> <span style="color: #04a5e5">:=</span> <span class="mi">0</span><span style="color: #4c4f69">;</span> <span class="nx">i</span> <span style="color: #4c4f69">&lt;</span> <span class="nx">maxIter</span><span style="color: #4c4f69">;</span> <span class="nx">i</span><span style="color: #04a5e5">++</span> <span style="color: #4c4f69">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span style="color: #4c4f69">=</span> <span class="nx">z</span><span style="color: #4c4f69">.</span><span style="color: #04a5e5">length</span><span style="color: #4c4f69">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #8839ef">if</span> <span class="nx">r</span> <span style="color: #4c4f69">&gt;</span> <span class="nx">escapeRadius</span> <span style="color: #4c4f69">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #8839ef">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #4c4f69">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span style="color: #4c4f69">,</span> <span class="nx">phi</span> <span style="color: #4c4f69">=</span> <span class="nx">math</span><span style="color: #4c4f69">.</span><span style="color: #04a5e5">Acos</span><span style="color: #4c4f69">(</span><span class="nx">z</span><span style="color: #4c4f69">.</span><span class="nx">z</span><span style="color: #04a5e5">/</span><span class="nx">r</span><span style="color: #4c4f69">)</span><span style="color: #04a5e5">*</span><span class="nx">power</span><span style="color: #4c4f69">,</span> <span class="nx">math</span><span style="color: #4c4f69">.</span><span style="color: #04a5e5">Atan2</span><span style="color: #4c4f69">(</span><span class="nx">z</span><span style="color: #4c4f69">.</span><span class="nx">y</span><span style="color: #4c4f69">,</span> <span class="nx">z</span><span style="color: #4c4f69">.</span><span class="nx">x</span><span style="color: #4c4f69">)</span><span style="color: #04a5e5">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span style="color: #4c4f69">=</span> <span class="nx">math</span><span style="color: #4c4f69">.</span><span style="color: #04a5e5">Pow</span><span style="color: #4c4f69">(</span><span class="nx">r</span><span style="color: #4c4f69">,</span> <span class="nx">power</span><span style="color: #4c4f69">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span style="color: #4c4f69">.</span><span class="nx">x</span><span style="color: #4c4f69">,</span> <span class="nx">z</span><span style="color: #4c4f69">.</span><span class="nx">y</span><span style="color: #4c4f69">,</span> <span class="nx">z</span><span style="color: #4c4f69">.</span><span class="nx">z</span> <span style="color: #4c4f69">=</span> <span class="nx">p</span><span style="color: #4c4f69">.</span><span class="nx">x</span><span style="color: #04a5e5">+</span><span class="nx">r</span><span style="color: #04a5e5">*</span><span class="nx">math</span><span style="color: #4c4f69">.</span><span style="color: #04a5e5">Sin</span><span style="color: #4c4f69">(</span><span class="nx">theta</span><span style="color: #4c4f69">)</span><span style="color: #04a5e5">*</span><span class="nx">math</span><span style="color: #4c4f69">.</span><span style="color: #04a5e5">Cos</span><span style="color: #4c4f69">(</span><span class="nx">phi</span><span style="color: #4c4f69">),</span> <span class="nx">p</span><span style="color: #4c4f69">.</span><span class="nx">y</span><span style="color: #04a5e5">+</span><span class="nx">r</span><span style="color: #04a5e5">*</span><span class="nx">math</span><span style="color: #4c4f69">.</span><span style="color: #04a5e5">Sin</span><span style="color: #4c4f69">(</span><span class="nx">theta</span><span style="color: #4c4f69">)</span><span style="color: #04a5e5">*</span><span class="nx">math</span><span style="color: #4c4f69">.</span><span style="color: #04a5e5">Sin</span><span style="color: #4c4f69">(</span><span class="nx">phi</span><span style="color: #4c4f69">),</span> <span class="nx">p</span><span style="color: #4c4f69">.</span><span class="nx">z</span><span style="color: #04a5e5">+</span><span class="nx">r</span><span style="color: #04a5e5">*</span><span class="nx">math</span><span style="color: #4c4f69">.</span><span style="color: #04a5e5">Cos</span><span style="color: #4c4f69">(</span><span class="nx">theta</span><span style="color: #4c4f69">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #4c4f69">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #8839ef">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #4c4f69">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8839ef">func</span> <span style="color: #04a5e5">renderPixel</span><span style="color: #4c4f69">(</span><span class="nx">x</span><span style="color: #4c4f69">,</span> <span class="nx">y</span> <span style="color: #df8e1d">int</span><span style="color: #4c4f69">)</span> <span class="nx">color</span><span style="color: #4c4f69">.</span><span class="nx">Color</span> <span style="color: #4c4f69">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span style="color: #4c4f69">,</span> <span class="nx">py</span> <span style="color: #04a5e5">:=</span> <span style="color: #4c4f69">(</span><span class="mi">2</span><span style="color: #04a5e5">*</span><span style="font-style: italic">float64</span><span style="color: #4c4f69">(</span><span class="nx">x</span><span style="color: #4c4f69">)</span><span style="color: #04a5e5">/</span><span style="font-style: italic">float64</span><span style="color: #4c4f69">(</span><span class="nx">ssWidth</span><span style="color: #4c4f69">)</span><span style="color: #04a5e5">-</span><span class="mi">1</span><span style="color: #4c4f69">)</span><span style="color: #04a5e5">*</span><span class="nx">aspectRatio</span><span style="color: #04a5e5">*</span><span class="nx">math</span><span style="color: #4c4f69">.</span><span style="color: #04a5e5">Tan</span><span style="color: #4c4f69">(</span><span class="nx">fov</span><span style="color: #04a5e5">/</span><span class="mi">2</span><span style="color: #4c4f69">),</span> <span style="color: #4c4f69">(</span><span class="mi">1</span><span style="color: #04a5e5">-</span><span class="mi">2</span><span style="color: #04a5e5">*</span><span style="font-style: italic">float64</span><span style="color: #4c4f69">(</span><span class="nx">y</span><span style="color: #4c4f69">)</span><span style="color: #04a5e5">/</span><span style="font-style: italic">float64</span><span style="color: #4c4f69">(</span><span class="nx">ssHeight</span><span style="color: #4c4f69">))</span><span style="color: #04a5e5">*</span><span class="nx">math</span><span style="color: #4c4f69">.</span><span style="color: #04a5e5">Tan</span><span style="color: #4c4f69">(</span><span class="nx">fov</span><span style="color: #04a5e5">/</span><span class="mi">2</span><span style="color: #4c4f69">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span style="color: #04a5e5">:=</span> <span class="nx">vec3</span><span style="color: #4c4f69">{</span><span class="nx">px</span><span style="color: #4c4f69">,</span> <span class="nx">py</span><span style="color: #4c4f69">,</span> <span style="color: #04a5e5">-</span><span class="mi">1</span><span style="color: #4c4f69">}.</span><span style="color: #04a5e5">normalize</span><span style="color: #4c4f69">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span style="color: #04a5e5">:=</span> <span class="mf">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #8839ef">for</span> <span class="nx">i</span> <span style="color: #04a5e5">:=</span> <span class="mi">0</span><span style="color: #4c4f69">;</span> <span class="nx">i</span> <span style="color: #4c4f69">&lt;</span> <span class="nx">maxIter</span><span style="color: #4c4f69">;</span> <span class="nx">i</span><span style="color: #04a5e5">++</span> <span style="color: #4c4f69">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span style="color: #04a5e5">:=</span> <span class="nx">direction</span><span style="color: #4c4f69">.</span><span style="color: #04a5e5">mul</span><span style="color: #4c4f69">(</span><span class="nx">t</span><span style="color: #4c4f69">).</span><span style="color: #04a5e5">add</span><span style="color: #4c4f69">(</span><span class="nx">vec3</span><span style="color: #4c4f69">{</span><span class="mi">0</span><span style="color: #4c4f69">,</span> <span class="mi">0</span><span style="color: #4c4f69">,</span> <span class="mi">5</span><span style="color: #4c4f69">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span style="color: #04a5e5">:=</span> <span style="color: #04a5e5">mandelbulb</span><span style="color: #4c4f69">(</span><span class="nx">p</span><span style="color: #4c4f69">)</span> <span style="color: #04a5e5">-</span> <span class="mi">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #8839ef">if</span> <span class="nx">d</span> <span style="color: #4c4f69">&lt;</span> <span class="mf">0.001</span> <span style="color: #4c4f69">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #8839ef">return</span> <span class="nx">color</span><span style="color: #4c4f69">.</span><span class="nx">Gray</span><span style="color: #4c4f69">{</span><span style="font-style: italic">uint8</span><span style="color: #4c4f69">(</span><span class="mi">255</span> <span style="color: #04a5e5">-</span> <span class="nx">t</span><span style="color: #04a5e5">*</span><span class="mi">255</span><span style="color: #04a5e5">/</span><span class="mi">100</span><span style="color: #4c4f69">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #4c4f69">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span style="color: #04a5e5">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #8839ef">if</span> <span class="nx">t</span> <span style="color: #4c4f69">&gt;</span> <span class="mi">100</span> <span style="color: #4c4f69">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #8839ef">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #4c4f69">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #4c4f69">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #8839ef">return</span> <span class="nx">color</span><span style="color: #4c4f69">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #4c4f69">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8839ef">func</span> <span style="color: #04a5e5">main</span><span style="color: #4c4f69">()</span> <span style="color: #4c4f69">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span style="color: #04a5e5">:=</span> <span class="nx">image</span><span style="color: #4c4f69">.</span><span style="color: #04a5e5">NewRGBA</span><span style="color: #4c4f69">(</span><span class="nx">image</span><span style="color: #4c4f69">.</span><span style="color: #04a5e5">Rect</span><span style="color: #4c4f69">(</span><span class="mi">0</span><span style="color: #4c4f69">,</span> <span class="mi">0</span><span style="color: #4c4f69">,</span> <span class="nx">ssWidth</span><span style="color: #4c4f69">,</span> <span class="nx">ssHeight</span><span style="color: #4c4f69">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #8839ef">for</span> <span class="nx">y</span> <span style="color: #04a5e5">:=</span> <span class="mi">0</span><span style="color: #4c4f69">;</span> <span class="nx">y</span> <span style="color: #4c4f69">&lt;</span> <span class="nx">ssHeight</span><span style="color: #4c4f69">;</span> <span class="nx">y</span><span style="color: #04a5e5">++</span> <span style="color: #4c4f69">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span style="color: #4c4f69">.</span><span style="color: #04a5e5">Add</span><span style="color: #4c4f69">(</span><span class="mi">1</span><span style="color: #4c4f69">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #8839ef">go</span> <span style="color: #8839ef">func</span><span style="color: #4c4f69">(</span><span class="nx">y</span> <span style="color: #df8e1d">int</span><span style="color: #4c4f69">)</span> <span style="color: #4c4f69">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #8839ef">defer</span> <span class="nx">wg</span><span style="color: #4c4f69">.</span><span style="color: #04a5e5">Done</span><span style="color: #4c4f69">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #8839ef">for</span> <span class="nx">x</span> <span style="color: #04a5e5">:=</span> <span class="mi">0</span><span style="color: #4c4f69">;</span> <span class="nx">x</span> <span style="color: #4c4f69">&lt;</span> <span class="nx">ssWidth</span><span style="color: #4c4f69">;</span> <span class="nx">x</span><span style="color: #04a5e5">++</span> <span style="color: #4c4f69">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span style="color: #4c4f69">.</span><span style="color: #04a5e5">Set</span><span style="color: #4c4f69">(</span><span class="nx">x</span><span style="color: #4c4f69">,</span> <span class="nx">y</span><span style="color: #4c4f69">,</span> <span style="color: #04a5e5">renderPixel</span><span style="color: #4c4f69">(</span><span class="nx">x</span><span style="color: #4c4f69">,</span> <span class="nx">y</span><span style="color: #4c4f69">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #4c4f69">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #4c4f69">}(</span><span class="nx">y</span><span style="color: #4c4f69">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #4c4f69">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span style="color: #4c4f69">.</span><span style="color: #04a5e5">Wait</span><span style="color: #4c4f69">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span style="color: #04a5e5">:=</span> <span class="nx">image</span><span style="color: #4c4f69">.</span><span style="color: #04a5e5">NewRGBA</span><span style="color: #4c4f69">(</span><span class="nx">image</span><span style="color: #4c4f69">.</span><span style="color: #04a5e5">Rect</span><span style="color: #4c4f69">(</span><span class="mi">0</span><span style="color: #4c4f69">,</span> <span class="mi">0</span><span style="color: #4c4f69">,</span> <span class="nx">width</span><span style="color: #4c4f69">,</span> <span class="nx">height</span><span style="color: #4c4f69">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #8839ef">for</span> <span class="nx">y</span> <span style="color: #04a5e5">:=</span> <span class="mi">0</span><span style="color: #4c4f69">;</span> <span class="nx">y</span> <span style="color: #4c4f69">&lt;</span> <span class="nx">height</span><span style="color: #4c4f69">;</span> <span class="nx">y</span><span style="color: #04a5e5">++</span> <span style="color: #4c4f69">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #8839ef">for</span> <span class="nx">x</span> <span style="color: #04a5e5">:=</span> <span class="mi">0</span><span style="color: #4c4f69">;</span> <span class="nx">x</span> <span style="color: #4c4f69">&lt;</span> <span class="nx">width</span><span style="color: #4c4f69">;</span> <span class="nx">x</span><span style="color: #04a5e5">++</span> <span style="color: #4c4f69">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span style="color: #4c4f69">,</span> <span class="nx">g</span><span style="color: #4c4f69">,</span> <span class="nx">b</span><span style="color: #4c4f69">,</span> <span class="nx">a</span> <span style="color: #04a5e5">:=</span> <span class="mi">0</span><span style="color: #4c4f69">,</span> <span class="mi">0</span><span style="color: #4c4f69">,</span> <span class="mi">0</span><span style="color: #4c4f69">,</span> <span class="mi">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #8839ef">for</span> <span class="nx">dy</span> <span style="color: #04a5e5">:=</span> <span class="mi">0</span><span style="color: #4c4f69">;</span> <span class="nx">dy</span> <span style="color: #4c4f69">&lt;</span> <span class="nx">supersamplingRatio</span><span style="color: #4c4f69">;</span> <span class="nx">dy</span><span style="color: #04a5e5">++</span> <span style="color: #4c4f69">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #8839ef">for</span> <span class="nx">dx</span> <span style="color: #04a5e5">:=</span> <span class="mi">0</span><span style="color: #4c4f69">;</span> <span class="nx">dx</span> <span style="color: #4c4f69">&lt;</span> <span class="nx">supersamplingRatio</span><span style="color: #4c4f69">;</span> <span class="nx">dx</span><span style="color: #04a5e5">++</span> <span style="color: #4c4f69">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span style="color: #04a5e5">:=</span> <span class="nx">ssImg</span><span style="color: #4c4f69">.</span><span style="color: #04a5e5">RGBAAt</span><span style="color: #4c4f69">(</span><span class="nx">x</span><span style="color: #04a5e5">*</span><span class="nx">supersamplingRatio</span><span style="color: #04a5e5">+</span><span class="nx">dx</span><span style="color: #4c4f69">,</span> <span class="nx">y</span><span style="color: #04a5e5">*</span><span class="nx">supersamplingRatio</span><span style="color: #04a5e5">+</span><span class="nx">dy</span><span style="color: #4c4f69">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span style="color: #04a5e5">+=</span> <span style="font-style: italic">int</span><span style="color: #4c4f69">(</span><span class="nx">c</span><span style="color: #4c4f69">.</span><span class="nx">R</span><span style="color: #4c4f69">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span style="color: #04a5e5">+=</span> <span style="font-style: italic">int</span><span style="color: #4c4f69">(</span><span class="nx">c</span><span style="color: #4c4f69">.</span><span class="nx">G</span><span style="color: #4c4f69">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span style="color: #04a5e5">+=</span> <span style="font-style: italic">int</span><span style="color: #4c4f69">(</span><span class="nx">c</span><span style="color: #4c4f69">.</span><span class="nx">B</span><span style="color: #4c4f69">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span style="color: #04a5e5">+=</span> <span style="font-style: italic">int</span><span style="color: #4c4f69">(</span><span class="nx">c</span><span style="color: #4c4f69">.</span><span class="nx">A</span><span style="color: #4c4f69">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #4c4f69">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #4c4f69">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span style="color: #04a5e5">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #04a5e5">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span style="color: #04a5e5">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #04a5e5">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span style="color: #04a5e5">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #04a5e5">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span style="color: #04a5e5">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #04a5e5">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span style="color: #4c4f69">.</span><span style="color: #04a5e5">Set</span><span style="color: #4c4f69">(</span><span class="nx">x</span><span style="color: #4c4f69">,</span> <span class="nx">y</span><span style="color: #4c4f69">,</span> <span class="nx">color</span><span style="color: #4c4f69">.</span><span class="nx">RGBA</span><span style="color: #4c4f69">{</span><span style="font-style: italic">uint8</span><span style="color: #4c4f69">(</span><span class="nx">r</span><span style="color: #4c4f69">),</span> <span style="font-style: italic">uint8</span><span style="color: #4c4f69">(</span><span class="nx">g</span><span style="color: #4c4f69">),</span> <span style="font-style: italic">uint8</span><span style="color: #4c4f69">(</span><span class="nx">b</span><span style="color: #4c4f69">),</span> <span style="font-style: italic">uint8</span><span style="color: #4c4f69">(</span><span class="nx">a</span><span style="color: #4c4f69">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #4c4f69">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #4c4f69">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span style="color: #4c4f69">,</span> <span class="nx">err</span> <span style="color: #04a5e5">:=</span> <span class="nx">os</span><span style="color: #4c4f69">.</span><span style="color: #04a5e5">Create</span><span style="color: #4c4f69">(</span><span style="color: #40a02b">&#34;mandelbulb.png&#34;</span><span style="color: #4c4f69">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #8839ef">if</span> <span class="nx">err</span> <span style="color: #04a5e5">!=</span> <span style="color: #8839ef; font-style: italic">nil</span> <span style="color: #4c4f69">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span style="color: #4c4f69">.</span><span style="color: #04a5e5">Println</span><span style="color: #4c4f69">(</span><span style="color: #40a02b">&#34;Error creating file:&#34;</span><span style="color: #4c4f69">,</span> <span class="nx">err</span><span style="color: #4c4f69">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #8839ef">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #4c4f69">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #8839ef">defer</span> <span class="nx">file</span><span style="color: #4c4f69">.</span><span style="color: #04a5e5">Close</span><span style="color: #4c4f69">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span style="color: #4c4f69">=</span> <span class="nx">png</span><span style="color: #4c4f69">.</span><span style="color: #04a5e5">Encode</span><span style="color: #4c4f69">(</span><span class="nx">file</span><span style="color: #4c4f69">,</span> <span class="nx">img</span><span style="color: #4c4f69">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #8839ef">if</span> <span class="nx">err</span> <span style="color: #04a5e5">!=</span> <span style="color: #8839ef; font-style: italic">nil</span> <span style="color: #4c4f69">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span style="color: #4c4f69">.</span><span style="color: #04a5e5">Println</span><span style="color: #4c4f69">(</span><span style="color: #40a02b">&#34;Error encoding image:&#34;</span><span style="color: #4c4f69">,</span> <span class="nx">err</span><span style="color: #4c4f69">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #4c4f69">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #4c4f69">}</span></span></span></code></pre></code><a name='catppuccin-macchiato'><h2><a id='stylelink' href='catppuccin-macchiato.html' alt='View only catppuccin-macchiato'>catppuccin-macchiato</a></h2></a><code><pre style="color: #f5a97f; background-color: #24273a;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #c6a0f6">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #5b6078; font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #5b6078; font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #5b6078; font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #5b6078; font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c6a0f6">import</span> <span style="color: #cad3f5">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6da95">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6da95">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6da95">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6da95">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6da95">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6da95">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6da95">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #cad3f5">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c6a0f6">const</span> <span style="color: #cad3f5">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span style="color: #cad3f5">,</span> <span class="nx">height</span>      <span style="color: #cad3f5">=</span> <span class="mi">1920</span><span style="color: #cad3f5">,</span> <span class="mi">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span style="color: #cad3f5">,</span> <span class="nx">ssHeight</span>  <span style="color: #cad3f5">=</span> <span class="mi">3840</span><span style="color: #cad3f5">,</span> <span class="mi">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span style="color: #cad3f5">=</span> <span style="font-style: italic">float64</span><span style="color: #cad3f5">(</span><span class="nx">ssWidth</span><span style="color: #cad3f5">)</span> <span style="color: #91d7e3">/</span> <span style="font-style: italic">float64</span><span style="color: #cad3f5">(</span><span class="nx">ssHeight</span><span style="color: #cad3f5">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span style="color: #cad3f5">=</span> <span class="nx">math</span><span style="color: #cad3f5">.</span><span class="nx">Pi</span> <span style="color: #91d7e3">/</span> <span class="mi">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span style="color: #cad3f5">=</span> <span class="mi">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span style="color: #cad3f5">=</span> <span class="mi">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span style="color: #cad3f5">=</span> <span class="mf">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span style="color: #cad3f5">=</span> <span class="mi">2</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #cad3f5">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c6a0f6">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span style="color: #cad3f5">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c6a0f6">type</span> <span class="nx">vec3</span> <span style="color: #c6a0f6">struct</span><span style="color: #cad3f5">{</span> <span class="nx">x</span><span style="color: #cad3f5">,</span> <span class="nx">y</span><span style="color: #cad3f5">,</span> <span class="nx">z</span> <span style="color: #eed49f">float64</span> <span style="color: #cad3f5">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c6a0f6">func</span> <span style="color: #cad3f5">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #cad3f5">)</span> <span style="color: #91d7e3">add</span><span style="color: #cad3f5">(</span><span class="nx">w</span> <span class="nx">vec3</span><span style="color: #cad3f5">)</span> <span class="nx">vec3</span>    <span style="color: #cad3f5">{</span> <span style="color: #c6a0f6">return</span> <span class="nx">vec3</span><span style="color: #cad3f5">{</span><span class="nx">v</span><span style="color: #cad3f5">.</span><span class="nx">x</span> <span style="color: #91d7e3">+</span> <span class="nx">w</span><span style="color: #cad3f5">.</span><span class="nx">x</span><span style="color: #cad3f5">,</span> <span class="nx">v</span><span style="color: #cad3f5">.</span><span class="nx">y</span> <span style="color: #91d7e3">+</span> <span class="nx">w</span><span style="color: #cad3f5">.</span><span class="nx">y</span><span style="color: #cad3f5">,</span> <span class="nx">v</span><span style="color: #cad3f5">.</span><span class="nx">z</span> <span style="color: #91d7e3">+</span> <span class="nx">w</span><span style="color: #cad3f5">.</span><span class="nx">z</span><span style="color: #cad3f5">}</span> <span style="color: #cad3f5">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c6a0f6">func</span> <span style="color: #cad3f5">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #cad3f5">)</span> <span style="color: #91d7e3">mul</span><span style="color: #cad3f5">(</span><span class="nx">s</span> <span style="color: #eed49f">float64</span><span style="color: #cad3f5">)</span> <span class="nx">vec3</span> <span style="color: #cad3f5">{</span> <span style="color: #c6a0f6">return</span> <span class="nx">vec3</span><span style="color: #cad3f5">{</span><span class="nx">v</span><span style="color: #cad3f5">.</span><span class="nx">x</span> <span style="color: #91d7e3">*</span> <span class="nx">s</span><span style="color: #cad3f5">,</span> <span class="nx">v</span><span style="color: #cad3f5">.</span><span class="nx">y</span> <span style="color: #91d7e3">*</span> <span class="nx">s</span><span style="color: #cad3f5">,</span> <span class="nx">v</span><span style="color: #cad3f5">.</span><span class="nx">z</span> <span style="color: #91d7e3">*</span> <span class="nx">s</span><span style="color: #cad3f5">}</span> <span style="color: #cad3f5">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c6a0f6">func</span> <span style="color: #cad3f5">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #cad3f5">)</span> <span style="color: #91d7e3">length</span><span style="color: #cad3f5">()</span> <span style="color: #eed49f">float64</span>    <span style="color: #cad3f5">{</span> <span style="color: #c6a0f6">return</span> <span class="nx">math</span><span style="color: #cad3f5">.</span><span style="color: #91d7e3">Sqrt</span><span style="color: #cad3f5">(</span><span class="nx">v</span><span style="color: #cad3f5">.</span><span class="nx">x</span><span style="color: #91d7e3">*</span><span class="nx">v</span><span style="color: #cad3f5">.</span><span class="nx">x</span> <span style="color: #91d7e3">+</span> <span class="nx">v</span><span style="color: #cad3f5">.</span><span class="nx">y</span><span style="color: #91d7e3">*</span><span class="nx">v</span><span style="color: #cad3f5">.</span><span class="nx">y</span> <span style="color: #91d7e3">+</span> <span class="nx">v</span><span style="color: #cad3f5">.</span><span class="nx">z</span><span style="color: #91d7e3">*</span><span class="nx">v</span><span style="color: #cad3f5">.</span><span class="nx">z</span><span style="color: #cad3f5">)</span> <span style="color: #cad3f5">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c6a0f6">func</span> <span style="color: #cad3f5">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #cad3f5">)</span> <span style="color: #91d7e3">normalize</span><span style="color: #cad3f5">()</span> <span class="nx">vec3</span>    <span style="color: #cad3f5">{</span> <span style="color: #c6a0f6">return</span> <span class="nx">v</span><span style="color: #cad3f5">.</span><span style="color: #91d7e3">mul</span><span style="color: #cad3f5">(</span><span class="mi">1</span> <span style="color: #91d7e3">/</span> <span class="nx">v</span><span style="color: #cad3f5">.</span><span style="color: #91d7e3">length</span><span style="color: #cad3f5">())</span> <span style="color: #cad3f5">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c6a0f6">func</span> <span style="color: #91d7e3">mandelbulb</span><span style="color: #cad3f5">(</span><span class="nx">p</span> <span class="nx">vec3</span><span style="color: #cad3f5">)</span> <span style="color: #eed49f">float64</span> <span style="color: #cad3f5">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span style="color: #cad3f5">,</span> <span class="nx">r</span><span style="color: #cad3f5">,</span> <span class="nx">theta</span><span style="color: #cad3f5">,</span> <span class="nx">phi</span> <span style="color: #91d7e3">:=</span> <span class="nx">p</span><span style="color: #cad3f5">,</span> <span class="mf">0.0</span><span style="color: #cad3f5">,</span> <span class="mf">0.0</span><span style="color: #cad3f5">,</span> <span class="mf">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c6a0f6">for</span> <span class="nx">i</span> <span style="color: #91d7e3">:=</span> <span class="mi">0</span><span style="color: #cad3f5">;</span> <span class="nx">i</span> <span style="color: #cad3f5">&lt;</span> <span class="nx">maxIter</span><span style="color: #cad3f5">;</span> <span class="nx">i</span><span style="color: #91d7e3">++</span> <span style="color: #cad3f5">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span style="color: #cad3f5">=</span> <span class="nx">z</span><span style="color: #cad3f5">.</span><span style="color: #91d7e3">length</span><span style="color: #cad3f5">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c6a0f6">if</span> <span class="nx">r</span> <span style="color: #cad3f5">&gt;</span> <span class="nx">escapeRadius</span> <span style="color: #cad3f5">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c6a0f6">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #cad3f5">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span style="color: #cad3f5">,</span> <span class="nx">phi</span> <span style="color: #cad3f5">=</span> <span class="nx">math</span><span style="color: #cad3f5">.</span><span style="color: #91d7e3">Acos</span><span style="color: #cad3f5">(</span><span class="nx">z</span><span style="color: #cad3f5">.</span><span class="nx">z</span><span style="color: #91d7e3">/</span><span class="nx">r</span><span style="color: #cad3f5">)</span><span style="color: #91d7e3">*</span><span class="nx">power</span><span style="color: #cad3f5">,</span> <span class="nx">math</span><span style="color: #cad3f5">.</span><span style="color: #91d7e3">Atan2</span><span style="color: #cad3f5">(</span><span class="nx">z</span><span style="color: #cad3f5">.</span><span class="nx">y</span><span style="color: #cad3f5">,</span> <span class="nx">z</span><span style="color: #cad3f5">.</span><span class="nx">x</span><span style="color: #cad3f5">)</span><span style="color: #91d7e3">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span style="color: #cad3f5">=</span> <span class="nx">math</span><span style="color: #cad3f5">.</span><span style="color: #91d7e3">Pow</span><span style="color: #cad3f5">(</span><span class="nx">r</span><span style="color: #cad3f5">,</span> <span class="nx">power</span><span style="color: #cad3f5">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span style="color: #cad3f5">.</span><span class="nx">x</span><span style="color: #cad3f5">,</span> <span class="nx">z</span><span style="color: #cad3f5">.</span><span class="nx">y</span><span style="color: #cad3f5">,</span> <span class="nx">z</span><span style="color: #cad3f5">.</span><span class="nx">z</span> <span style="color: #cad3f5">=</span> <span class="nx">p</span><span style="color: #cad3f5">.</span><span class="nx">x</span><span style="color: #91d7e3">+</span><span class="nx">r</span><span style="color: #91d7e3">*</span><span class="nx">math</span><span style="color: #cad3f5">.</span><span style="color: #91d7e3">Sin</span><span style="color: #cad3f5">(</span><span class="nx">theta</span><span style="color: #cad3f5">)</span><span style="color: #91d7e3">*</span><span class="nx">math</span><span style="color: #cad3f5">.</span><span style="color: #91d7e3">Cos</span><span style="color: #cad3f5">(</span><span class="nx">phi</span><span style="color: #cad3f5">),</span> <span class="nx">p</span><span style="color: #cad3f5">.</span><span class="nx">y</span><span style="color: #91d7e3">+</span><span class="nx">r</span><span style="color: #91d7e3">*</span><span class="nx">math</span><span style="color: #cad3f5">.</span><span style="color: #91d7e3">Sin</span><span style="color: #cad3f5">(</span><span class="nx">theta</span><span style="color: #cad3f5">)</span><span style="color: #91d7e3">*</span><span class="nx">math</span><span style="color: #cad3f5">.</span><span style="color: #91d7e3">Sin</span><span style="color: #cad3f5">(</span><span class="nx">phi</span><span style="color: #cad3f5">),</span> <span class="nx">p</span><span style="color: #cad3f5">.</span><span class="nx">z</span><span style="color: #91d7e3">+</span><span class="nx">r</span><span style="color: #91d7e3">*</span><span class="nx">math</span><span style="color: #cad3f5">.</span><span style="color: #91d7e3">Cos</span><span style="color: #cad3f5">(</span><span class="nx">theta</span><span style="color: #cad3f5">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cad3f5">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c6a0f6">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #cad3f5">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c6a0f6">func</span> <span style="color: #91d7e3">renderPixel</span><span style="color: #cad3f5">(</span><span class="nx">x</span><span style="color: #cad3f5">,</span> <span class="nx">y</span> <span style="color: #eed49f">int</span><span style="color: #cad3f5">)</span> <span class="nx">color</span><span style="color: #cad3f5">.</span><span class="nx">Color</span> <span style="color: #cad3f5">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span style="color: #cad3f5">,</span> <span class="nx">py</span> <span style="color: #91d7e3">:=</span> <span style="color: #cad3f5">(</span><span class="mi">2</span><span style="color: #91d7e3">*</span><span style="font-style: italic">float64</span><span style="color: #cad3f5">(</span><span class="nx">x</span><span style="color: #cad3f5">)</span><span style="color: #91d7e3">/</span><span style="font-style: italic">float64</span><span style="color: #cad3f5">(</span><span class="nx">ssWidth</span><span style="color: #cad3f5">)</span><span style="color: #91d7e3">-</span><span class="mi">1</span><span style="color: #cad3f5">)</span><span style="color: #91d7e3">*</span><span class="nx">aspectRatio</span><span style="color: #91d7e3">*</span><span class="nx">math</span><span style="color: #cad3f5">.</span><span style="color: #91d7e3">Tan</span><span style="color: #cad3f5">(</span><span class="nx">fov</span><span style="color: #91d7e3">/</span><span class="mi">2</span><span style="color: #cad3f5">),</span> <span style="color: #cad3f5">(</span><span class="mi">1</span><span style="color: #91d7e3">-</span><span class="mi">2</span><span style="color: #91d7e3">*</span><span style="font-style: italic">float64</span><span style="color: #cad3f5">(</span><span class="nx">y</span><span style="color: #cad3f5">)</span><span style="color: #91d7e3">/</span><span style="font-style: italic">float64</span><span style="color: #cad3f5">(</span><span class="nx">ssHeight</span><span style="color: #cad3f5">))</span><span style="color: #91d7e3">*</span><span class="nx">math</span><span style="color: #cad3f5">.</span><span style="color: #91d7e3">Tan</span><span style="color: #cad3f5">(</span><span class="nx">fov</span><span style="color: #91d7e3">/</span><span class="mi">2</span><span style="color: #cad3f5">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span style="color: #91d7e3">:=</span> <span class="nx">vec3</span><span style="color: #cad3f5">{</span><span class="nx">px</span><span style="color: #cad3f5">,</span> <span class="nx">py</span><span style="color: #cad3f5">,</span> <span style="color: #91d7e3">-</span><span class="mi">1</span><span style="color: #cad3f5">}.</span><span style="color: #91d7e3">normalize</span><span style="color: #cad3f5">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span style="color: #91d7e3">:=</span> <span class="mf">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c6a0f6">for</span> <span class="nx">i</span> <span style="color: #91d7e3">:=</span> <span class="mi">0</span><span style="color: #cad3f5">;</span> <span class="nx">i</span> <span style="color: #cad3f5">&lt;</span> <span class="nx">maxIter</span><span style="color: #cad3f5">;</span> <span class="nx">i</span><span style="color: #91d7e3">++</span> <span style="color: #cad3f5">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span style="color: #91d7e3">:=</span> <span class="nx">direction</span><span style="color: #cad3f5">.</span><span style="color: #91d7e3">mul</span><span style="color: #cad3f5">(</span><span class="nx">t</span><span style="color: #cad3f5">).</span><span style="color: #91d7e3">add</span><span style="color: #cad3f5">(</span><span class="nx">vec3</span><span style="color: #cad3f5">{</span><span class="mi">0</span><span style="color: #cad3f5">,</span> <span class="mi">0</span><span style="color: #cad3f5">,</span> <span class="mi">5</span><span style="color: #cad3f5">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span style="color: #91d7e3">:=</span> <span style="color: #91d7e3">mandelbulb</span><span style="color: #cad3f5">(</span><span class="nx">p</span><span style="color: #cad3f5">)</span> <span style="color: #91d7e3">-</span> <span class="mi">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c6a0f6">if</span> <span class="nx">d</span> <span style="color: #cad3f5">&lt;</span> <span class="mf">0.001</span> <span style="color: #cad3f5">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c6a0f6">return</span> <span class="nx">color</span><span style="color: #cad3f5">.</span><span class="nx">Gray</span><span style="color: #cad3f5">{</span><span style="font-style: italic">uint8</span><span style="color: #cad3f5">(</span><span class="mi">255</span> <span style="color: #91d7e3">-</span> <span class="nx">t</span><span style="color: #91d7e3">*</span><span class="mi">255</span><span style="color: #91d7e3">/</span><span class="mi">100</span><span style="color: #cad3f5">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #cad3f5">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span style="color: #91d7e3">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c6a0f6">if</span> <span class="nx">t</span> <span style="color: #cad3f5">&gt;</span> <span class="mi">100</span> <span style="color: #cad3f5">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c6a0f6">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #cad3f5">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cad3f5">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c6a0f6">return</span> <span class="nx">color</span><span style="color: #cad3f5">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #cad3f5">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c6a0f6">func</span> <span style="color: #91d7e3">main</span><span style="color: #cad3f5">()</span> <span style="color: #cad3f5">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span style="color: #91d7e3">:=</span> <span class="nx">image</span><span style="color: #cad3f5">.</span><span style="color: #91d7e3">NewRGBA</span><span style="color: #cad3f5">(</span><span class="nx">image</span><span style="color: #cad3f5">.</span><span style="color: #91d7e3">Rect</span><span style="color: #cad3f5">(</span><span class="mi">0</span><span style="color: #cad3f5">,</span> <span class="mi">0</span><span style="color: #cad3f5">,</span> <span class="nx">ssWidth</span><span style="color: #cad3f5">,</span> <span class="nx">ssHeight</span><span style="color: #cad3f5">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c6a0f6">for</span> <span class="nx">y</span> <span style="color: #91d7e3">:=</span> <span class="mi">0</span><span style="color: #cad3f5">;</span> <span class="nx">y</span> <span style="color: #cad3f5">&lt;</span> <span class="nx">ssHeight</span><span style="color: #cad3f5">;</span> <span class="nx">y</span><span style="color: #91d7e3">++</span> <span style="color: #cad3f5">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span style="color: #cad3f5">.</span><span style="color: #91d7e3">Add</span><span style="color: #cad3f5">(</span><span class="mi">1</span><span style="color: #cad3f5">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c6a0f6">go</span> <span style="color: #c6a0f6">func</span><span style="color: #cad3f5">(</span><span class="nx">y</span> <span style="color: #eed49f">int</span><span style="color: #cad3f5">)</span> <span style="color: #cad3f5">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c6a0f6">defer</span> <span class="nx">wg</span><span style="color: #cad3f5">.</span><span style="color: #91d7e3">Done</span><span style="color: #cad3f5">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c6a0f6">for</span> <span class="nx">x</span> <span style="color: #91d7e3">:=</span> <span class="mi">0</span><span style="color: #cad3f5">;</span> <span class="nx">x</span> <span style="color: #cad3f5">&lt;</span> <span class="nx">ssWidth</span><span style="color: #cad3f5">;</span> <span class="nx">x</span><span style="color: #91d7e3">++</span> <span style="color: #cad3f5">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span style="color: #cad3f5">.</span><span style="color: #91d7e3">Set</span><span style="color: #cad3f5">(</span><span class="nx">x</span><span style="color: #cad3f5">,</span> <span class="nx">y</span><span style="color: #cad3f5">,</span> <span style="color: #91d7e3">renderPixel</span><span style="color: #cad3f5">(</span><span class="nx">x</span><span style="color: #cad3f5">,</span> <span class="nx">y</span><span style="color: #cad3f5">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #cad3f5">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #cad3f5">}(</span><span class="nx">y</span><span style="color: #cad3f5">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cad3f5">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span style="color: #cad3f5">.</span><span style="color: #91d7e3">Wait</span><span style="color: #cad3f5">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span style="color: #91d7e3">:=</span> <span class="nx">image</span><span style="color: #cad3f5">.</span><span style="color: #91d7e3">NewRGBA</span><span style="color: #cad3f5">(</span><span class="nx">image</span><span style="color: #cad3f5">.</span><span style="color: #91d7e3">Rect</span><span style="color: #cad3f5">(</span><span class="mi">0</span><span style="color: #cad3f5">,</span> <span class="mi">0</span><span style="color: #cad3f5">,</span> <span class="nx">width</span><span style="color: #cad3f5">,</span> <span class="nx">height</span><span style="color: #cad3f5">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c6a0f6">for</span> <span class="nx">y</span> <span style="color: #91d7e3">:=</span> <span class="mi">0</span><span style="color: #cad3f5">;</span> <span class="nx">y</span> <span style="color: #cad3f5">&lt;</span> <span class="nx">height</span><span style="color: #cad3f5">;</span> <span class="nx">y</span><span style="color: #91d7e3">++</span> <span style="color: #cad3f5">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c6a0f6">for</span> <span class="nx">x</span> <span style="color: #91d7e3">:=</span> <span class="mi">0</span><span style="color: #cad3f5">;</span> <span class="nx">x</span> <span style="color: #cad3f5">&lt;</span> <span class="nx">width</span><span style="color: #cad3f5">;</span> <span class="nx">x</span><span style="color: #91d7e3">++</span> <span style="color: #cad3f5">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span style="color: #cad3f5">,</span> <span class="nx">g</span><span style="color: #cad3f5">,</span> <span class="nx">b</span><span style="color: #cad3f5">,</span> <span class="nx">a</span> <span style="color: #91d7e3">:=</span> <span class="mi">0</span><span style="color: #cad3f5">,</span> <span class="mi">0</span><span style="color: #cad3f5">,</span> <span class="mi">0</span><span style="color: #cad3f5">,</span> <span class="mi">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c6a0f6">for</span> <span class="nx">dy</span> <span style="color: #91d7e3">:=</span> <span class="mi">0</span><span style="color: #cad3f5">;</span> <span class="nx">dy</span> <span style="color: #cad3f5">&lt;</span> <span class="nx">supersamplingRatio</span><span style="color: #cad3f5">;</span> <span class="nx">dy</span><span style="color: #91d7e3">++</span> <span style="color: #cad3f5">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #c6a0f6">for</span> <span class="nx">dx</span> <span style="color: #91d7e3">:=</span> <span class="mi">0</span><span style="color: #cad3f5">;</span> <span class="nx">dx</span> <span style="color: #cad3f5">&lt;</span> <span class="nx">supersamplingRatio</span><span style="color: #cad3f5">;</span> <span class="nx">dx</span><span style="color: #91d7e3">++</span> <span style="color: #cad3f5">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span style="color: #91d7e3">:=</span> <span class="nx">ssImg</span><span style="color: #cad3f5">.</span><span style="color: #91d7e3">RGBAAt</span><span style="color: #cad3f5">(</span><span class="nx">x</span><span style="color: #91d7e3">*</span><span class="nx">supersamplingRatio</span><span style="color: #91d7e3">+</span><span class="nx">dx</span><span style="color: #cad3f5">,</span> <span class="nx">y</span><span style="color: #91d7e3">*</span><span class="nx">supersamplingRatio</span><span style="color: #91d7e3">+</span><span class="nx">dy</span><span style="color: #cad3f5">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span style="color: #91d7e3">+=</span> <span style="font-style: italic">int</span><span style="color: #cad3f5">(</span><span class="nx">c</span><span style="color: #cad3f5">.</span><span class="nx">R</span><span style="color: #cad3f5">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span style="color: #91d7e3">+=</span> <span style="font-style: italic">int</span><span style="color: #cad3f5">(</span><span class="nx">c</span><span style="color: #cad3f5">.</span><span class="nx">G</span><span style="color: #cad3f5">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span style="color: #91d7e3">+=</span> <span style="font-style: italic">int</span><span style="color: #cad3f5">(</span><span class="nx">c</span><span style="color: #cad3f5">.</span><span class="nx">B</span><span style="color: #cad3f5">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span style="color: #91d7e3">+=</span> <span style="font-style: italic">int</span><span style="color: #cad3f5">(</span><span class="nx">c</span><span style="color: #cad3f5">.</span><span class="nx">A</span><span style="color: #cad3f5">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #cad3f5">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #cad3f5">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span style="color: #91d7e3">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #91d7e3">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span style="color: #91d7e3">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #91d7e3">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span style="color: #91d7e3">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #91d7e3">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span style="color: #91d7e3">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #91d7e3">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span style="color: #cad3f5">.</span><span style="color: #91d7e3">Set</span><span style="color: #cad3f5">(</span><span class="nx">x</span><span style="color: #cad3f5">,</span> <span class="nx">y</span><span style="color: #cad3f5">,</span> <span class="nx">color</span><span style="color: #cad3f5">.</span><span class="nx">RGBA</span><span style="color: #cad3f5">{</span><span style="font-style: italic">uint8</span><span style="color: #cad3f5">(</span><span class="nx">r</span><span style="color: #cad3f5">),</span> <span style="font-style: italic">uint8</span><span style="color: #cad3f5">(</span><span class="nx">g</span><span style="color: #cad3f5">),</span> <span style="font-style: italic">uint8</span><span style="color: #cad3f5">(</span><span class="nx">b</span><span style="color: #cad3f5">),</span> <span style="font-style: italic">uint8</span><span style="color: #cad3f5">(</span><span class="nx">a</span><span style="color: #cad3f5">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #cad3f5">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cad3f5">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span style="color: #cad3f5">,</span> <span class="nx">err</span> <span style="color: #91d7e3">:=</span> <span class="nx">os</span><span style="color: #cad3f5">.</span><span style="color: #91d7e3">Create</span><span style="color: #cad3f5">(</span><span style="color: #a6da95">&#34;mandelbulb.png&#34;</span><span style="color: #cad3f5">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c6a0f6">if</span> <span class="nx">err</span> <span style="color: #91d7e3">!=</span> <span style="color: #c6a0f6; font-style: italic">nil</span> <span style="color: #cad3f5">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span style="color: #cad3f5">.</span><span style="color: #91d7e3">Println</span><span style="color: #cad3f5">(</span><span style="color: #a6da95">&#34;Error creating file:&#34;</span><span style="color: #cad3f5">,</span> <span class="nx">err</span><span style="color: #cad3f5">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c6a0f6">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cad3f5">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c6a0f6">defer</span> <span class="nx">file</span><span style="color: #cad3f5">.</span><span style="color: #91d7e3">Close</span><span style="color: #cad3f5">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span style="color: #cad3f5">=</span> <span class="nx">png</span><span style="color: #cad3f5">.</span><span style="color: #91d7e3">Encode</span><span style="color: #cad3f5">(</span><span class="nx">file</span><span style="color: #cad3f5">,</span> <span class="nx">img</span><span style="color: #cad3f5">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c6a0f6">if</span> <span class="nx">err</span> <span style="color: #91d7e3">!=</span> <span style="color: #c6a0f6; font-style: italic">nil</span> <span style="color: #cad3f5">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span style="color: #cad3f5">.</span><span style="color: #91d7e3">Println</span><span style="color: #cad3f5">(</span><span style="color: #a6da95">&#34;Error encoding image:&#34;</span><span style="color: #cad3f5">,</span> <span class="nx">err</span><span style="color: #cad3f5">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cad3f5">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #cad3f5">}</span></span></span></code></pre></code><a name='catppuccin-mocha'><h2><a id='stylelink' href='catppuccin-mocha.html' alt='View only catppuccin-mocha'>catppuccin-mocha</a></h2></a><code><pre style="color: #fab387; background-color: #1e1e2e;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #cba6f7">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #585b70; font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #585b70; font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #585b70; font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #585b70; font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #cba6f7">import</span> <span style="color: #cdd6f4">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6e3a1">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6e3a1">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6e3a1">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6e3a1">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6e3a1">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6e3a1">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6e3a1">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #cdd6f4">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #cba6f7">const</span> <span style="color: #cdd6f4">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span style="color: #cdd6f4">,</span> <span class="nx">height</span>      <span style="color: #cdd6f4">=</span> <span class="mi">1920</span><span style="color: #cdd6f4">,</span> <span class="mi">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span style="color: #cdd6f4">,</span> <span class="nx">ssHeight</span>  <span style="color: #cdd6f4">=</span> <span class="mi">3840</span><span style="color: #cdd6f4">,</span> <span class="mi">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span style="color: #cdd6f4">=</span> <span style="font-style: italic">float64</span><span style="color: #cdd6f4">(</span><span class="nx">ssWidth</span><span style="color: #cdd6f4">)</span> <span style="color: #89dceb">/</span> <span style="font-style: italic">float64</span><span style="color: #cdd6f4">(</span><span class="nx">ssHeight</span><span style="color: #cdd6f4">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span style="color: #cdd6f4">=</span> <span class="nx">math</span><span style="color: #cdd6f4">.</span><span class="nx">Pi</span> <span style="color: #89dceb">/</span> <span class="mi">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span style="color: #cdd6f4">=</span> <span class="mi">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span style="color: #cdd6f4">=</span> <span class="mi">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span style="color: #cdd6f4">=</span> <span class="mf">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span style="color: #cdd6f4">=</span> <span class="mi">2</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #cdd6f4">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #cba6f7">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span style="color: #cdd6f4">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #cba6f7">type</span> <span class="nx">vec3</span> <span style="color: #cba6f7">struct</span><span style="color: #cdd6f4">{</span> <span class="nx">x</span><span style="color: #cdd6f4">,</span> <span class="nx">y</span><span style="color: #cdd6f4">,</span> <span class="nx">z</span> <span style="color: #f9e2af">float64</span> <span style="color: #cdd6f4">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #cba6f7">func</span> <span style="color: #cdd6f4">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #cdd6f4">)</span> <span style="color: #89dceb">add</span><span style="color: #cdd6f4">(</span><span class="nx">w</span> <span class="nx">vec3</span><span style="color: #cdd6f4">)</span> <span class="nx">vec3</span>    <span style="color: #cdd6f4">{</span> <span style="color: #cba6f7">return</span> <span class="nx">vec3</span><span style="color: #cdd6f4">{</span><span class="nx">v</span><span style="color: #cdd6f4">.</span><span class="nx">x</span> <span style="color: #89dceb">+</span> <span class="nx">w</span><span style="color: #cdd6f4">.</span><span class="nx">x</span><span style="color: #cdd6f4">,</span> <span class="nx">v</span><span style="color: #cdd6f4">.</span><span class="nx">y</span> <span style="color: #89dceb">+</span> <span class="nx">w</span><span style="color: #cdd6f4">.</span><span class="nx">y</span><span style="color: #cdd6f4">,</span> <span class="nx">v</span><span style="color: #cdd6f4">.</span><span class="nx">z</span> <span style="color: #89dceb">+</span> <span class="nx">w</span><span style="color: #cdd6f4">.</span><span class="nx">z</span><span style="color: #cdd6f4">}</span> <span style="color: #cdd6f4">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #cba6f7">func</span> <span style="color: #cdd6f4">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #cdd6f4">)</span> <span style="color: #89dceb">mul</span><span style="color: #cdd6f4">(</span><span class="nx">s</span> <span style="color: #f9e2af">float64</span><span style="color: #cdd6f4">)</span> <span class="nx">vec3</span> <span style="color: #cdd6f4">{</span> <span style="color: #cba6f7">return</span> <span class="nx">vec3</span><span style="color: #cdd6f4">{</span><span class="nx">v</span><span style="color: #cdd6f4">.</span><span class="nx">x</span> <span style="color: #89dceb">*</span> <span class="nx">s</span><span style="color: #cdd6f4">,</span> <span class="nx">v</span><span style="color: #cdd6f4">.</span><span class="nx">y</span> <span style="color: #89dceb">*</span> <span class="nx">s</span><span style="color: #cdd6f4">,</span> <span class="nx">v</span><span style="color: #cdd6f4">.</span><span class="nx">z</span> <span style="color: #89dceb">*</span> <span class="nx">s</span><span style="color: #cdd6f4">}</span> <span style="color: #cdd6f4">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #cba6f7">func</span> <span style="color: #cdd6f4">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #cdd6f4">)</span> <span style="color: #89dceb">length</span><span style="color: #cdd6f4">()</span> <span style="color: #f9e2af">float64</span>    <span style="color: #cdd6f4">{</span> <span style="color: #cba6f7">return</span> <span class="nx">math</span><span style="color: #cdd6f4">.</span><span style="color: #89dceb">Sqrt</span><span style="color: #cdd6f4">(</span><span class="nx">v</span><span style="color: #cdd6f4">.</span><span class="nx">x</span><span style="color: #89dceb">*</span><span class="nx">v</span><span style="color: #cdd6f4">.</span><span class="nx">x</span> <span style="color: #89dceb">+</span> <span class="nx">v</span><span style="color: #cdd6f4">.</span><span class="nx">y</span><span style="color: #89dceb">*</span><span class="nx">v</span><span style="color: #cdd6f4">.</span><span class="nx">y</span> <span style="color: #89dceb">+</span> <span class="nx">v</span><span style="color: #cdd6f4">.</span><span class="nx">z</span><span style="color: #89dceb">*</span><span class="nx">v</span><span style="color: #cdd6f4">.</span><span class="nx">z</span><span style="color: #cdd6f4">)</span> <span style="color: #cdd6f4">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #cba6f7">func</span> <span style="color: #cdd6f4">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #cdd6f4">)</span> <span style="color: #89dceb">normalize</span><span style="color: #cdd6f4">()</span> <span class="nx">vec3</span>    <span style="color: #cdd6f4">{</span> <span style="color: #cba6f7">return</span> <span class="nx">v</span><span style="color: #cdd6f4">.</span><span style="color: #89dceb">mul</span><span style="color: #cdd6f4">(</span><span class="mi">1</span> <span style="color: #89dceb">/</span> <span class="nx">v</span><span style="color: #cdd6f4">.</span><span style="color: #89dceb">length</span><span style="color: #cdd6f4">())</span> <span style="color: #cdd6f4">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #cba6f7">func</span> <span style="color: #89dceb">mandelbulb</span><span style="color: #cdd6f4">(</span><span class="nx">p</span> <span class="nx">vec3</span><span style="color: #cdd6f4">)</span> <span style="color: #f9e2af">float64</span> <span style="color: #cdd6f4">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span style="color: #cdd6f4">,</span> <span class="nx">r</span><span style="color: #cdd6f4">,</span> <span class="nx">theta</span><span style="color: #cdd6f4">,</span> <span class="nx">phi</span> <span style="color: #89dceb">:=</span> <span class="nx">p</span><span style="color: #cdd6f4">,</span> <span class="mf">0.0</span><span style="color: #cdd6f4">,</span> <span class="mf">0.0</span><span style="color: #cdd6f4">,</span> <span class="mf">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cba6f7">for</span> <span class="nx">i</span> <span style="color: #89dceb">:=</span> <span class="mi">0</span><span style="color: #cdd6f4">;</span> <span class="nx">i</span> <span style="color: #cdd6f4">&lt;</span> <span class="nx">maxIter</span><span style="color: #cdd6f4">;</span> <span class="nx">i</span><span style="color: #89dceb">++</span> <span style="color: #cdd6f4">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span style="color: #cdd6f4">=</span> <span class="nx">z</span><span style="color: #cdd6f4">.</span><span style="color: #89dceb">length</span><span style="color: #cdd6f4">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #cba6f7">if</span> <span class="nx">r</span> <span style="color: #cdd6f4">&gt;</span> <span class="nx">escapeRadius</span> <span style="color: #cdd6f4">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #cba6f7">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #cdd6f4">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span style="color: #cdd6f4">,</span> <span class="nx">phi</span> <span style="color: #cdd6f4">=</span> <span class="nx">math</span><span style="color: #cdd6f4">.</span><span style="color: #89dceb">Acos</span><span style="color: #cdd6f4">(</span><span class="nx">z</span><span style="color: #cdd6f4">.</span><span class="nx">z</span><span style="color: #89dceb">/</span><span class="nx">r</span><span style="color: #cdd6f4">)</span><span style="color: #89dceb">*</span><span class="nx">power</span><span style="color: #cdd6f4">,</span> <span class="nx">math</span><span style="color: #cdd6f4">.</span><span style="color: #89dceb">Atan2</span><span style="color: #cdd6f4">(</span><span class="nx">z</span><span style="color: #cdd6f4">.</span><span class="nx">y</span><span style="color: #cdd6f4">,</span> <span class="nx">z</span><span style="color: #cdd6f4">.</span><span class="nx">x</span><span style="color: #cdd6f4">)</span><span style="color: #89dceb">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span style="color: #cdd6f4">=</span> <span class="nx">math</span><span style="color: #cdd6f4">.</span><span style="color: #89dceb">Pow</span><span style="color: #cdd6f4">(</span><span class="nx">r</span><span style="color: #cdd6f4">,</span> <span class="nx">power</span><span style="color: #cdd6f4">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span style="color: #cdd6f4">.</span><span class="nx">x</span><span style="color: #cdd6f4">,</span> <span class="nx">z</span><span style="color: #cdd6f4">.</span><span class="nx">y</span><span style="color: #cdd6f4">,</span> <span class="nx">z</span><span style="color: #cdd6f4">.</span><span class="nx">z</span> <span style="color: #cdd6f4">=</span> <span class="nx">p</span><span style="color: #cdd6f4">.</span><span class="nx">x</span><span style="color: #89dceb">+</span><span class="nx">r</span><span style="color: #89dceb">*</span><span class="nx">math</span><span style="color: #cdd6f4">.</span><span style="color: #89dceb">Sin</span><span style="color: #cdd6f4">(</span><span class="nx">theta</span><span style="color: #cdd6f4">)</span><span style="color: #89dceb">*</span><span class="nx">math</span><span style="color: #cdd6f4">.</span><span style="color: #89dceb">Cos</span><span style="color: #cdd6f4">(</span><span class="nx">phi</span><span style="color: #cdd6f4">),</span> <span class="nx">p</span><span style="color: #cdd6f4">.</span><span class="nx">y</span><span style="color: #89dceb">+</span><span class="nx">r</span><span style="color: #89dceb">*</span><span class="nx">math</span><span style="color: #cdd6f4">.</span><span style="color: #89dceb">Sin</span><span style="color: #cdd6f4">(</span><span class="nx">theta</span><span style="color: #cdd6f4">)</span><span style="color: #89dceb">*</span><span class="nx">math</span><span style="color: #cdd6f4">.</span><span style="color: #89dceb">Sin</span><span style="color: #cdd6f4">(</span><span class="nx">phi</span><span style="color: #cdd6f4">),</span> <span class="nx">p</span><span style="color: #cdd6f4">.</span><span class="nx">z</span><span style="color: #89dceb">+</span><span class="nx">r</span><span style="color: #89dceb">*</span><span class="nx">math</span><span style="color: #cdd6f4">.</span><span style="color: #89dceb">Cos</span><span style="color: #cdd6f4">(</span><span class="nx">theta</span><span style="color: #cdd6f4">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cdd6f4">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cba6f7">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #cdd6f4">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #cba6f7">func</span> <span style="color: #89dceb">renderPixel</span><span style="color: #cdd6f4">(</span><span class="nx">x</span><span style="color: #cdd6f4">,</span> <span class="nx">y</span> <span style="color: #f9e2af">int</span><span style="color: #cdd6f4">)</span> <span class="nx">color</span><span style="color: #cdd6f4">.</span><span class="nx">Color</span> <span style="color: #cdd6f4">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span style="color: #cdd6f4">,</span> <span class="nx">py</span> <span style="color: #89dceb">:=</span> <span style="color: #cdd6f4">(</span><span class="mi">2</span><span style="color: #89dceb">*</span><span style="font-style: italic">float64</span><span style="color: #cdd6f4">(</span><span class="nx">x</span><span style="color: #cdd6f4">)</span><span style="color: #89dceb">/</span><span style="font-style: italic">float64</span><span style="color: #cdd6f4">(</span><span class="nx">ssWidth</span><span style="color: #cdd6f4">)</span><span style="color: #89dceb">-</span><span class="mi">1</span><span style="color: #cdd6f4">)</span><span style="color: #89dceb">*</span><span class="nx">aspectRatio</span><span style="color: #89dceb">*</span><span class="nx">math</span><span style="color: #cdd6f4">.</span><span style="color: #89dceb">Tan</span><span style="color: #cdd6f4">(</span><span class="nx">fov</span><span style="color: #89dceb">/</span><span class="mi">2</span><span style="color: #cdd6f4">),</span> <span style="color: #cdd6f4">(</span><span class="mi">1</span><span style="color: #89dceb">-</span><span class="mi">2</span><span style="color: #89dceb">*</span><span style="font-style: italic">float64</span><span style="color: #cdd6f4">(</span><span class="nx">y</span><span style="color: #cdd6f4">)</span><span style="color: #89dceb">/</span><span style="font-style: italic">float64</span><span style="color: #cdd6f4">(</span><span class="nx">ssHeight</span><span style="color: #cdd6f4">))</span><span style="color: #89dceb">*</span><span class="nx">math</span><span style="color: #cdd6f4">.</span><span style="color: #89dceb">Tan</span><span style="color: #cdd6f4">(</span><span class="nx">fov</span><span style="color: #89dceb">/</span><span class="mi">2</span><span style="color: #cdd6f4">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span style="color: #89dceb">:=</span> <span class="nx">vec3</span><span style="color: #cdd6f4">{</span><span class="nx">px</span><span style="color: #cdd6f4">,</span> <span class="nx">py</span><span style="color: #cdd6f4">,</span> <span style="color: #89dceb">-</span><span class="mi">1</span><span style="color: #cdd6f4">}.</span><span style="color: #89dceb">normalize</span><span style="color: #cdd6f4">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span style="color: #89dceb">:=</span> <span class="mf">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cba6f7">for</span> <span class="nx">i</span> <span style="color: #89dceb">:=</span> <span class="mi">0</span><span style="color: #cdd6f4">;</span> <span class="nx">i</span> <span style="color: #cdd6f4">&lt;</span> <span class="nx">maxIter</span><span style="color: #cdd6f4">;</span> <span class="nx">i</span><span style="color: #89dceb">++</span> <span style="color: #cdd6f4">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span style="color: #89dceb">:=</span> <span class="nx">direction</span><span style="color: #cdd6f4">.</span><span style="color: #89dceb">mul</span><span style="color: #cdd6f4">(</span><span class="nx">t</span><span style="color: #cdd6f4">).</span><span style="color: #89dceb">add</span><span style="color: #cdd6f4">(</span><span class="nx">vec3</span><span style="color: #cdd6f4">{</span><span class="mi">0</span><span style="color: #cdd6f4">,</span> <span class="mi">0</span><span style="color: #cdd6f4">,</span> <span class="mi">5</span><span style="color: #cdd6f4">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span style="color: #89dceb">:=</span> <span style="color: #89dceb">mandelbulb</span><span style="color: #cdd6f4">(</span><span class="nx">p</span><span style="color: #cdd6f4">)</span> <span style="color: #89dceb">-</span> <span class="mi">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #cba6f7">if</span> <span class="nx">d</span> <span style="color: #cdd6f4">&lt;</span> <span class="mf">0.001</span> <span style="color: #cdd6f4">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #cba6f7">return</span> <span class="nx">color</span><span style="color: #cdd6f4">.</span><span class="nx">Gray</span><span style="color: #cdd6f4">{</span><span style="font-style: italic">uint8</span><span style="color: #cdd6f4">(</span><span class="mi">255</span> <span style="color: #89dceb">-</span> <span class="nx">t</span><span style="color: #89dceb">*</span><span class="mi">255</span><span style="color: #89dceb">/</span><span class="mi">100</span><span style="color: #cdd6f4">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #cdd6f4">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span style="color: #89dceb">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #cba6f7">if</span> <span class="nx">t</span> <span style="color: #cdd6f4">&gt;</span> <span class="mi">100</span> <span style="color: #cdd6f4">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #cba6f7">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #cdd6f4">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cdd6f4">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cba6f7">return</span> <span class="nx">color</span><span style="color: #cdd6f4">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #cdd6f4">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #cba6f7">func</span> <span style="color: #89dceb">main</span><span style="color: #cdd6f4">()</span> <span style="color: #cdd6f4">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span style="color: #89dceb">:=</span> <span class="nx">image</span><span style="color: #cdd6f4">.</span><span style="color: #89dceb">NewRGBA</span><span style="color: #cdd6f4">(</span><span class="nx">image</span><span style="color: #cdd6f4">.</span><span style="color: #89dceb">Rect</span><span style="color: #cdd6f4">(</span><span class="mi">0</span><span style="color: #cdd6f4">,</span> <span class="mi">0</span><span style="color: #cdd6f4">,</span> <span class="nx">ssWidth</span><span style="color: #cdd6f4">,</span> <span class="nx">ssHeight</span><span style="color: #cdd6f4">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cba6f7">for</span> <span class="nx">y</span> <span style="color: #89dceb">:=</span> <span class="mi">0</span><span style="color: #cdd6f4">;</span> <span class="nx">y</span> <span style="color: #cdd6f4">&lt;</span> <span class="nx">ssHeight</span><span style="color: #cdd6f4">;</span> <span class="nx">y</span><span style="color: #89dceb">++</span> <span style="color: #cdd6f4">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span style="color: #cdd6f4">.</span><span style="color: #89dceb">Add</span><span style="color: #cdd6f4">(</span><span class="mi">1</span><span style="color: #cdd6f4">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #cba6f7">go</span> <span style="color: #cba6f7">func</span><span style="color: #cdd6f4">(</span><span class="nx">y</span> <span style="color: #f9e2af">int</span><span style="color: #cdd6f4">)</span> <span style="color: #cdd6f4">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #cba6f7">defer</span> <span class="nx">wg</span><span style="color: #cdd6f4">.</span><span style="color: #89dceb">Done</span><span style="color: #cdd6f4">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #cba6f7">for</span> <span class="nx">x</span> <span style="color: #89dceb">:=</span> <span class="mi">0</span><span style="color: #cdd6f4">;</span> <span class="nx">x</span> <span style="color: #cdd6f4">&lt;</span> <span class="nx">ssWidth</span><span style="color: #cdd6f4">;</span> <span class="nx">x</span><span style="color: #89dceb">++</span> <span style="color: #cdd6f4">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span style="color: #cdd6f4">.</span><span style="color: #89dceb">Set</span><span style="color: #cdd6f4">(</span><span class="nx">x</span><span style="color: #cdd6f4">,</span> <span class="nx">y</span><span style="color: #cdd6f4">,</span> <span style="color: #89dceb">renderPixel</span><span style="color: #cdd6f4">(</span><span class="nx">x</span><span style="color: #cdd6f4">,</span> <span class="nx">y</span><span style="color: #cdd6f4">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #cdd6f4">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #cdd6f4">}(</span><span class="nx">y</span><span style="color: #cdd6f4">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cdd6f4">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span style="color: #cdd6f4">.</span><span style="color: #89dceb">Wait</span><span style="color: #cdd6f4">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span style="color: #89dceb">:=</span> <span class="nx">image</span><span style="color: #cdd6f4">.</span><span style="color: #89dceb">NewRGBA</span><span style="color: #cdd6f4">(</span><span class="nx">image</span><span style="color: #cdd6f4">.</span><span style="color: #89dceb">Rect</span><span style="color: #cdd6f4">(</span><span class="mi">0</span><span style="color: #cdd6f4">,</span> <span class="mi">0</span><span style="color: #cdd6f4">,</span> <span class="nx">width</span><span style="color: #cdd6f4">,</span> <span class="nx">height</span><span style="color: #cdd6f4">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cba6f7">for</span> <span class="nx">y</span> <span style="color: #89dceb">:=</span> <span class="mi">0</span><span style="color: #cdd6f4">;</span> <span class="nx">y</span> <span style="color: #cdd6f4">&lt;</span> <span class="nx">height</span><span style="color: #cdd6f4">;</span> <span class="nx">y</span><span style="color: #89dceb">++</span> <span style="color: #cdd6f4">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #cba6f7">for</span> <span class="nx">x</span> <span style="color: #89dceb">:=</span> <span class="mi">0</span><span style="color: #cdd6f4">;</span> <span class="nx">x</span> <span style="color: #cdd6f4">&lt;</span> <span class="nx">width</span><span style="color: #cdd6f4">;</span> <span class="nx">x</span><span style="color: #89dceb">++</span> <span style="color: #cdd6f4">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span style="color: #cdd6f4">,</span> <span class="nx">g</span><span style="color: #cdd6f4">,</span> <span class="nx">b</span><span style="color: #cdd6f4">,</span> <span class="nx">a</span> <span style="color: #89dceb">:=</span> <span class="mi">0</span><span style="color: #cdd6f4">,</span> <span class="mi">0</span><span style="color: #cdd6f4">,</span> <span class="mi">0</span><span style="color: #cdd6f4">,</span> <span class="mi">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #cba6f7">for</span> <span class="nx">dy</span> <span style="color: #89dceb">:=</span> <span class="mi">0</span><span style="color: #cdd6f4">;</span> <span class="nx">dy</span> <span style="color: #cdd6f4">&lt;</span> <span class="nx">supersamplingRatio</span><span style="color: #cdd6f4">;</span> <span class="nx">dy</span><span style="color: #89dceb">++</span> <span style="color: #cdd6f4">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #cba6f7">for</span> <span class="nx">dx</span> <span style="color: #89dceb">:=</span> <span class="mi">0</span><span style="color: #cdd6f4">;</span> <span class="nx">dx</span> <span style="color: #cdd6f4">&lt;</span> <span class="nx">supersamplingRatio</span><span style="color: #cdd6f4">;</span> <span class="nx">dx</span><span style="color: #89dceb">++</span> <span style="color: #cdd6f4">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span style="color: #89dceb">:=</span> <span class="nx">ssImg</span><span style="color: #cdd6f4">.</span><span style="color: #89dceb">RGBAAt</span><span style="color: #cdd6f4">(</span><span class="nx">x</span><span style="color: #89dceb">*</span><span class="nx">supersamplingRatio</span><span style="color: #89dceb">+</span><span class="nx">dx</span><span style="color: #cdd6f4">,</span> <span class="nx">y</span><span style="color: #89dceb">*</span><span class="nx">supersamplingRatio</span><span style="color: #89dceb">+</span><span class="nx">dy</span><span style="color: #cdd6f4">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span style="color: #89dceb">+=</span> <span style="font-style: italic">int</span><span style="color: #cdd6f4">(</span><span class="nx">c</span><span style="color: #cdd6f4">.</span><span class="nx">R</span><span style="color: #cdd6f4">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span style="color: #89dceb">+=</span> <span style="font-style: italic">int</span><span style="color: #cdd6f4">(</span><span class="nx">c</span><span style="color: #cdd6f4">.</span><span class="nx">G</span><span style="color: #cdd6f4">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span style="color: #89dceb">+=</span> <span style="font-style: italic">int</span><span style="color: #cdd6f4">(</span><span class="nx">c</span><span style="color: #cdd6f4">.</span><span class="nx">B</span><span style="color: #cdd6f4">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span style="color: #89dceb">+=</span> <span style="font-style: italic">int</span><span style="color: #cdd6f4">(</span><span class="nx">c</span><span style="color: #cdd6f4">.</span><span class="nx">A</span><span style="color: #cdd6f4">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #cdd6f4">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #cdd6f4">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span style="color: #89dceb">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #89dceb">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span style="color: #89dceb">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #89dceb">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span style="color: #89dceb">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #89dceb">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span style="color: #89dceb">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #89dceb">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span style="color: #cdd6f4">.</span><span style="color: #89dceb">Set</span><span style="color: #cdd6f4">(</span><span class="nx">x</span><span style="color: #cdd6f4">,</span> <span class="nx">y</span><span style="color: #cdd6f4">,</span> <span class="nx">color</span><span style="color: #cdd6f4">.</span><span class="nx">RGBA</span><span style="color: #cdd6f4">{</span><span style="font-style: italic">uint8</span><span style="color: #cdd6f4">(</span><span class="nx">r</span><span style="color: #cdd6f4">),</span> <span style="font-style: italic">uint8</span><span style="color: #cdd6f4">(</span><span class="nx">g</span><span style="color: #cdd6f4">),</span> <span style="font-style: italic">uint8</span><span style="color: #cdd6f4">(</span><span class="nx">b</span><span style="color: #cdd6f4">),</span> <span style="font-style: italic">uint8</span><span style="color: #cdd6f4">(</span><span class="nx">a</span><span style="color: #cdd6f4">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #cdd6f4">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cdd6f4">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span style="color: #cdd6f4">,</span> <span class="nx">err</span> <span style="color: #89dceb">:=</span> <span class="nx">os</span><span style="color: #cdd6f4">.</span><span style="color: #89dceb">Create</span><span style="color: #cdd6f4">(</span><span style="color: #a6e3a1">&#34;mandelbulb.png&#34;</span><span style="color: #cdd6f4">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cba6f7">if</span> <span class="nx">err</span> <span style="color: #89dceb">!=</span> <span style="color: #cba6f7; font-style: italic">nil</span> <span style="color: #cdd6f4">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span style="color: #cdd6f4">.</span><span style="color: #89dceb">Println</span><span style="color: #cdd6f4">(</span><span style="color: #a6e3a1">&#34;Error creating file:&#34;</span><span style="color: #cdd6f4">,</span> <span class="nx">err</span><span style="color: #cdd6f4">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #cba6f7">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cdd6f4">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cba6f7">defer</span> <span class="nx">file</span><span style="color: #cdd6f4">.</span><span style="color: #89dceb">Close</span><span style="color: #cdd6f4">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span style="color: #cdd6f4">=</span> <span class="nx">png</span><span style="color: #cdd6f4">.</span><span style="color: #89dceb">Encode</span><span style="color: #cdd6f4">(</span><span class="nx">file</span><span style="color: #cdd6f4">,</span> <span class="nx">img</span><span style="color: #cdd6f4">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cba6f7">if</span> <span class="nx">err</span> <span style="color: #89dceb">!=</span> <span style="color: #cba6f7; font-style: italic">nil</span> <span style="color: #cdd6f4">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span style="color: #cdd6f4">.</span><span style="color: #89dceb">Println</span><span style="color: #cdd6f4">(</span><span style="color: #a6e3a1">&#34;Error encoding image:&#34;</span><span style="color: #cdd6f4">,</span> <span class="nx">err</span><span style="color: #cdd6f4">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cdd6f4">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #cdd6f4">}</span></span></span></code></pre></code><a name='colorful'><h2><a id='stylelink' href='colorful.html' alt='View only colorful'>colorful</a></h2></a><code><pre style="background-color: #ffffff;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #008800; font-weight: bold">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #888888">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #888888"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #888888"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #888888"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; font-weight: bold">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="background-color: #fff0f0">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="background-color: #fff0f0">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="background-color: #fff0f0">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="background-color: #fff0f0">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="background-color: #fff0f0">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="background-color: #fff0f0">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="background-color: #fff0f0">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; font-weight: bold">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span style="color: #0000dd; font-weight: bold">1920</span><span class="p">,</span> <span style="color: #0000dd; font-weight: bold">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span style="color: #0000dd; font-weight: bold">3840</span><span class="p">,</span> <span style="color: #0000dd; font-weight: bold">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span style="color: #007020">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span style="color: #333333">/</span> <span style="color: #007020">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span style="color: #333333">/</span> <span style="color: #0000dd; font-weight: bold">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span style="color: #0000dd; font-weight: bold">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span style="color: #0000dd; font-weight: bold">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span style="color: #6600ee; font-weight: bold">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span style="color: #0000dd; font-weight: bold">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; font-weight: bold">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; font-weight: bold">type</span> <span class="nx">vec3</span> <span style="color: #008800; font-weight: bold">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #333399; font-weight: bold">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #0066bb; font-weight: bold">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #008800; font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #333333">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #333333">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #333333">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #0066bb; font-weight: bold">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #333399; font-weight: bold">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #008800; font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #333333">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #333333">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #333333">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #0066bb; font-weight: bold">length</span><span class="p">()</span> <span style="color: #333399; font-weight: bold">float64</span>    <span class="p">{</span> <span style="color: #008800; font-weight: bold">return</span> <span class="nx">math</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span style="color: #333333">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #333333">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span style="color: #333333">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #333333">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span style="color: #333333">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #0066bb; font-weight: bold">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #008800; font-weight: bold">return</span> <span class="nx">v</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">mul</span><span class="p">(</span><span style="color: #0000dd; font-weight: bold">1</span> <span style="color: #333333">/</span> <span class="nx">v</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; font-weight: bold">func</span> <span style="color: #0066bb; font-weight: bold">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #333399; font-weight: bold">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span style="color: #333333">:=</span> <span class="nx">p</span><span class="p">,</span> <span style="color: #6600ee; font-weight: bold">0.0</span><span class="p">,</span> <span style="color: #6600ee; font-weight: bold">0.0</span><span class="p">,</span> <span style="color: #6600ee; font-weight: bold">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008800; font-weight: bold">for</span> <span class="nx">i</span> <span style="color: #333333">:=</span> <span style="color: #0000dd; font-weight: bold">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #333333">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #008800; font-weight: bold">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #008800; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span style="color: #333333">/</span><span class="nx">r</span><span class="p">)</span><span style="color: #333333">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span style="color: #333333">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span style="color: #333333">+</span><span class="nx">r</span><span style="color: #333333">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #333333">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span style="color: #333333">+</span><span class="nx">r</span><span style="color: #333333">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #333333">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span style="color: #333333">+</span><span class="nx">r</span><span style="color: #333333">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008800; font-weight: bold">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; font-weight: bold">func</span> <span style="color: #0066bb; font-weight: bold">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #333399; font-weight: bold">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span style="color: #333333">:=</span> <span class="p">(</span><span style="color: #0000dd; font-weight: bold">2</span><span style="color: #333333">*</span><span style="color: #007020">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span style="color: #333333">/</span><span style="color: #007020">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span style="color: #333333">-</span><span style="color: #0000dd; font-weight: bold">1</span><span class="p">)</span><span style="color: #333333">*</span><span class="nx">aspectRatio</span><span style="color: #333333">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #333333">/</span><span style="color: #0000dd; font-weight: bold">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #0000dd; font-weight: bold">1</span><span style="color: #333333">-</span><span style="color: #0000dd; font-weight: bold">2</span><span style="color: #333333">*</span><span style="color: #007020">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span style="color: #333333">/</span><span style="color: #007020">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span style="color: #333333">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #333333">/</span><span style="color: #0000dd; font-weight: bold">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span style="color: #333333">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span style="color: #333333">-</span><span style="color: #0000dd; font-weight: bold">1</span><span class="p">}.</span><span style="color: #0066bb; font-weight: bold">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span style="color: #333333">:=</span> <span style="color: #6600ee; font-weight: bold">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008800; font-weight: bold">for</span> <span class="nx">i</span> <span style="color: #333333">:=</span> <span style="color: #0000dd; font-weight: bold">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #333333">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span style="color: #333333">:=</span> <span class="nx">direction</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span style="color: #0066bb; font-weight: bold">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span style="color: #0000dd; font-weight: bold">0</span><span class="p">,</span> <span style="color: #0000dd; font-weight: bold">0</span><span class="p">,</span> <span style="color: #0000dd; font-weight: bold">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span style="color: #333333">:=</span> <span style="color: #0066bb; font-weight: bold">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span style="color: #333333">-</span> <span style="color: #0000dd; font-weight: bold">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #008800; font-weight: bold">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span style="color: #6600ee; font-weight: bold">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #008800; font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span style="color: #007020">uint8</span><span class="p">(</span><span style="color: #0000dd; font-weight: bold">255</span> <span style="color: #333333">-</span> <span class="nx">t</span><span style="color: #333333">*</span><span style="color: #0000dd; font-weight: bold">255</span><span style="color: #333333">/</span><span style="color: #0000dd; font-weight: bold">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span style="color: #333333">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #008800; font-weight: bold">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span style="color: #0000dd; font-weight: bold">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #008800; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008800; font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; font-weight: bold">func</span> <span style="color: #0066bb; font-weight: bold">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span style="color: #333333">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Rect</span><span class="p">(</span><span style="color: #0000dd; font-weight: bold">0</span><span class="p">,</span> <span style="color: #0000dd; font-weight: bold">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008800; font-weight: bold">for</span> <span class="nx">y</span> <span style="color: #333333">:=</span> <span style="color: #0000dd; font-weight: bold">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span style="color: #333333">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Add</span><span class="p">(</span><span style="color: #0000dd; font-weight: bold">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #008800; font-weight: bold">go</span> <span style="color: #008800; font-weight: bold">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #333399; font-weight: bold">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #008800; font-weight: bold">defer</span> <span class="nx">wg</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #008800; font-weight: bold">for</span> <span class="nx">x</span> <span style="color: #333333">:=</span> <span style="color: #0000dd; font-weight: bold">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span style="color: #333333">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span style="color: #0066bb; font-weight: bold">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span style="color: #333333">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Rect</span><span class="p">(</span><span style="color: #0000dd; font-weight: bold">0</span><span class="p">,</span> <span style="color: #0000dd; font-weight: bold">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008800; font-weight: bold">for</span> <span class="nx">y</span> <span style="color: #333333">:=</span> <span style="color: #0000dd; font-weight: bold">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span style="color: #333333">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #008800; font-weight: bold">for</span> <span class="nx">x</span> <span style="color: #333333">:=</span> <span style="color: #0000dd; font-weight: bold">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span style="color: #333333">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span style="color: #333333">:=</span> <span style="color: #0000dd; font-weight: bold">0</span><span class="p">,</span> <span style="color: #0000dd; font-weight: bold">0</span><span class="p">,</span> <span style="color: #0000dd; font-weight: bold">0</span><span class="p">,</span> <span style="color: #0000dd; font-weight: bold">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #008800; font-weight: bold">for</span> <span class="nx">dy</span> <span style="color: #333333">:=</span> <span style="color: #0000dd; font-weight: bold">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span style="color: #333333">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #008800; font-weight: bold">for</span> <span class="nx">dx</span> <span style="color: #333333">:=</span> <span style="color: #0000dd; font-weight: bold">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span style="color: #333333">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span style="color: #333333">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span style="color: #333333">*</span><span class="nx">supersamplingRatio</span><span style="color: #333333">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span style="color: #333333">*</span><span class="nx">supersamplingRatio</span><span style="color: #333333">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span style="color: #333333">+=</span> <span style="color: #007020">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span style="color: #333333">+=</span> <span style="color: #007020">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span style="color: #333333">+=</span> <span style="color: #007020">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span style="color: #333333">+=</span> <span style="color: #007020">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span style="color: #333333">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #333333">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span style="color: #333333">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #333333">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span style="color: #333333">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #333333">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span style="color: #333333">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #333333">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span style="color: #007020">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span style="color: #007020">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span style="color: #007020">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span style="color: #007020">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span style="color: #333333">:=</span> <span class="nx">os</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Create</span><span class="p">(</span><span style="background-color: #fff0f0">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008800; font-weight: bold">if</span> <span class="nx">err</span> <span style="color: #333333">!=</span> <span style="color: #008800; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Println</span><span class="p">(</span><span style="background-color: #fff0f0">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #008800; font-weight: bold">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008800; font-weight: bold">defer</span> <span class="nx">file</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008800; font-weight: bold">if</span> <span class="nx">err</span> <span style="color: #333333">!=</span> <span style="color: #008800; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Println</span><span class="p">(</span><span style="background-color: #fff0f0">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='doom-one'><h2><a id='stylelink' href='doom-one.html' alt='View only doom-one'>doom-one</a></h2></a><code><pre style="color: #b0c4de; background-color: #282c34;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #c678dd">package</span> <span style="color: #c1abea">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8a93a5; font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #8a93a5; font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #8a93a5; font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #8a93a5; font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c678dd">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #98c379">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #98c379">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #98c379">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #98c379">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #98c379">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #98c379">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #98c379">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c678dd">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c1abea">width</span><span class="p">,</span> <span style="color: #c1abea">height</span>      <span class="p">=</span> <span style="color: #d19a66">1920</span><span class="p">,</span> <span style="color: #d19a66">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c1abea">ssWidth</span><span class="p">,</span> <span style="color: #c1abea">ssHeight</span>  <span class="p">=</span> <span style="color: #d19a66">3840</span><span class="p">,</span> <span style="color: #d19a66">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c1abea">aspectRatio</span>        <span class="p">=</span> <span style="color: #ef8383">float64</span><span class="p">(</span><span style="color: #c1abea">ssWidth</span><span class="p">)</span> <span style="color: #c7bf54">/</span> <span style="color: #ef8383">float64</span><span class="p">(</span><span style="color: #c1abea">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c1abea">fov</span>                <span class="p">=</span> <span style="color: #c1abea">math</span><span class="p">.</span><span style="color: #c1abea">Pi</span> <span style="color: #c7bf54">/</span> <span style="color: #d19a66">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c1abea">maxIter</span>            <span class="p">=</span> <span style="color: #d19a66">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c1abea">power</span>              <span class="p">=</span> <span style="color: #d19a66">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c1abea">escapeRadius</span>       <span class="p">=</span> <span style="color: #d19a66">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c1abea">supersamplingRatio</span> <span class="p">=</span> <span style="color: #d19a66">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c678dd">var</span> <span style="color: #c1abea">wg</span> <span style="color: #c1abea">sync</span><span class="p">.</span><span style="color: #c1abea">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c678dd">type</span> <span style="color: #c1abea">vec3</span> <span style="color: #c678dd">struct</span><span class="p">{</span> <span style="color: #c1abea">x</span><span class="p">,</span> <span style="color: #c1abea">y</span><span class="p">,</span> <span style="color: #c1abea">z</span> <span style="color: #ef8383">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c678dd">func</span> <span class="p">(</span><span style="color: #c1abea">v</span> <span style="color: #c1abea">vec3</span><span class="p">)</span> <span style="color: #00b1f7">add</span><span class="p">(</span><span style="color: #c1abea">w</span> <span style="color: #c1abea">vec3</span><span class="p">)</span> <span style="color: #c1abea">vec3</span>    <span class="p">{</span> <span style="color: #c678dd">return</span> <span style="color: #c1abea">vec3</span><span class="p">{</span><span style="color: #c1abea">v</span><span class="p">.</span><span style="color: #c1abea">x</span> <span style="color: #c7bf54">+</span> <span style="color: #c1abea">w</span><span class="p">.</span><span style="color: #c1abea">x</span><span class="p">,</span> <span style="color: #c1abea">v</span><span class="p">.</span><span style="color: #c1abea">y</span> <span style="color: #c7bf54">+</span> <span style="color: #c1abea">w</span><span class="p">.</span><span style="color: #c1abea">y</span><span class="p">,</span> <span style="color: #c1abea">v</span><span class="p">.</span><span style="color: #c1abea">z</span> <span style="color: #c7bf54">+</span> <span style="color: #c1abea">w</span><span class="p">.</span><span style="color: #c1abea">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c678dd">func</span> <span class="p">(</span><span style="color: #c1abea">v</span> <span style="color: #c1abea">vec3</span><span class="p">)</span> <span style="color: #00b1f7">mul</span><span class="p">(</span><span style="color: #c1abea">s</span> <span style="color: #ef8383">float64</span><span class="p">)</span> <span style="color: #c1abea">vec3</span> <span class="p">{</span> <span style="color: #c678dd">return</span> <span style="color: #c1abea">vec3</span><span class="p">{</span><span style="color: #c1abea">v</span><span class="p">.</span><span style="color: #c1abea">x</span> <span style="color: #c7bf54">*</span> <span style="color: #c1abea">s</span><span class="p">,</span> <span style="color: #c1abea">v</span><span class="p">.</span><span style="color: #c1abea">y</span> <span style="color: #c7bf54">*</span> <span style="color: #c1abea">s</span><span class="p">,</span> <span style="color: #c1abea">v</span><span class="p">.</span><span style="color: #c1abea">z</span> <span style="color: #c7bf54">*</span> <span style="color: #c1abea">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c678dd">func</span> <span class="p">(</span><span style="color: #c1abea">v</span> <span style="color: #c1abea">vec3</span><span class="p">)</span> <span style="color: #00b1f7">length</span><span class="p">()</span> <span style="color: #ef8383">float64</span>    <span class="p">{</span> <span style="color: #c678dd">return</span> <span style="color: #c1abea">math</span><span class="p">.</span><span style="color: #00b1f7">Sqrt</span><span class="p">(</span><span style="color: #c1abea">v</span><span class="p">.</span><span style="color: #c1abea">x</span><span style="color: #c7bf54">*</span><span style="color: #c1abea">v</span><span class="p">.</span><span style="color: #c1abea">x</span> <span style="color: #c7bf54">+</span> <span style="color: #c1abea">v</span><span class="p">.</span><span style="color: #c1abea">y</span><span style="color: #c7bf54">*</span><span style="color: #c1abea">v</span><span class="p">.</span><span style="color: #c1abea">y</span> <span style="color: #c7bf54">+</span> <span style="color: #c1abea">v</span><span class="p">.</span><span style="color: #c1abea">z</span><span style="color: #c7bf54">*</span><span style="color: #c1abea">v</span><span class="p">.</span><span style="color: #c1abea">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c678dd">func</span> <span class="p">(</span><span style="color: #c1abea">v</span> <span style="color: #c1abea">vec3</span><span class="p">)</span> <span style="color: #00b1f7">normalize</span><span class="p">()</span> <span style="color: #c1abea">vec3</span>    <span class="p">{</span> <span style="color: #c678dd">return</span> <span style="color: #c1abea">v</span><span class="p">.</span><span style="color: #00b1f7">mul</span><span class="p">(</span><span style="color: #d19a66">1</span> <span style="color: #c7bf54">/</span> <span style="color: #c1abea">v</span><span class="p">.</span><span style="color: #00b1f7">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c678dd">func</span> <span style="color: #00b1f7">mandelbulb</span><span class="p">(</span><span style="color: #c1abea">p</span> <span style="color: #c1abea">vec3</span><span class="p">)</span> <span style="color: #ef8383">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c1abea">z</span><span class="p">,</span> <span style="color: #c1abea">r</span><span class="p">,</span> <span style="color: #c1abea">theta</span><span class="p">,</span> <span style="color: #c1abea">phi</span> <span style="color: #c7bf54">:=</span> <span style="color: #c1abea">p</span><span class="p">,</span> <span style="color: #d19a66">0.0</span><span class="p">,</span> <span style="color: #d19a66">0.0</span><span class="p">,</span> <span style="color: #d19a66">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c678dd">for</span> <span style="color: #c1abea">i</span> <span style="color: #c7bf54">:=</span> <span style="color: #d19a66">0</span><span class="p">;</span> <span style="color: #c1abea">i</span> <span class="p">&lt;</span> <span style="color: #c1abea">maxIter</span><span class="p">;</span> <span style="color: #c1abea">i</span><span style="color: #c7bf54">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c1abea">r</span> <span class="p">=</span> <span style="color: #c1abea">z</span><span class="p">.</span><span style="color: #00b1f7">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c678dd">if</span> <span style="color: #c1abea">r</span> <span class="p">&gt;</span> <span style="color: #c1abea">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c678dd">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c1abea">theta</span><span class="p">,</span> <span style="color: #c1abea">phi</span> <span class="p">=</span> <span style="color: #c1abea">math</span><span class="p">.</span><span style="color: #00b1f7">Acos</span><span class="p">(</span><span style="color: #c1abea">z</span><span class="p">.</span><span style="color: #c1abea">z</span><span style="color: #c7bf54">/</span><span style="color: #c1abea">r</span><span class="p">)</span><span style="color: #c7bf54">*</span><span style="color: #c1abea">power</span><span class="p">,</span> <span style="color: #c1abea">math</span><span class="p">.</span><span style="color: #00b1f7">Atan2</span><span class="p">(</span><span style="color: #c1abea">z</span><span class="p">.</span><span style="color: #c1abea">y</span><span class="p">,</span> <span style="color: #c1abea">z</span><span class="p">.</span><span style="color: #c1abea">x</span><span class="p">)</span><span style="color: #c7bf54">*</span><span style="color: #c1abea">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c1abea">r</span> <span class="p">=</span> <span style="color: #c1abea">math</span><span class="p">.</span><span style="color: #00b1f7">Pow</span><span class="p">(</span><span style="color: #c1abea">r</span><span class="p">,</span> <span style="color: #c1abea">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c1abea">z</span><span class="p">.</span><span style="color: #c1abea">x</span><span class="p">,</span> <span style="color: #c1abea">z</span><span class="p">.</span><span style="color: #c1abea">y</span><span class="p">,</span> <span style="color: #c1abea">z</span><span class="p">.</span><span style="color: #c1abea">z</span> <span class="p">=</span> <span style="color: #c1abea">p</span><span class="p">.</span><span style="color: #c1abea">x</span><span style="color: #c7bf54">+</span><span style="color: #c1abea">r</span><span style="color: #c7bf54">*</span><span style="color: #c1abea">math</span><span class="p">.</span><span style="color: #00b1f7">Sin</span><span class="p">(</span><span style="color: #c1abea">theta</span><span class="p">)</span><span style="color: #c7bf54">*</span><span style="color: #c1abea">math</span><span class="p">.</span><span style="color: #00b1f7">Cos</span><span class="p">(</span><span style="color: #c1abea">phi</span><span class="p">),</span> <span style="color: #c1abea">p</span><span class="p">.</span><span style="color: #c1abea">y</span><span style="color: #c7bf54">+</span><span style="color: #c1abea">r</span><span style="color: #c7bf54">*</span><span style="color: #c1abea">math</span><span class="p">.</span><span style="color: #00b1f7">Sin</span><span class="p">(</span><span style="color: #c1abea">theta</span><span class="p">)</span><span style="color: #c7bf54">*</span><span style="color: #c1abea">math</span><span class="p">.</span><span style="color: #00b1f7">Sin</span><span class="p">(</span><span style="color: #c1abea">phi</span><span class="p">),</span> <span style="color: #c1abea">p</span><span class="p">.</span><span style="color: #c1abea">z</span><span style="color: #c7bf54">+</span><span style="color: #c1abea">r</span><span style="color: #c7bf54">*</span><span style="color: #c1abea">math</span><span class="p">.</span><span style="color: #00b1f7">Cos</span><span class="p">(</span><span style="color: #c1abea">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c678dd">return</span> <span style="color: #c1abea">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c678dd">func</span> <span style="color: #00b1f7">renderPixel</span><span class="p">(</span><span style="color: #c1abea">x</span><span class="p">,</span> <span style="color: #c1abea">y</span> <span style="color: #ef8383">int</span><span class="p">)</span> <span style="color: #c1abea">color</span><span class="p">.</span><span style="color: #c1abea">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c1abea">px</span><span class="p">,</span> <span style="color: #c1abea">py</span> <span style="color: #c7bf54">:=</span> <span class="p">(</span><span style="color: #d19a66">2</span><span style="color: #c7bf54">*</span><span style="color: #ef8383">float64</span><span class="p">(</span><span style="color: #c1abea">x</span><span class="p">)</span><span style="color: #c7bf54">/</span><span style="color: #ef8383">float64</span><span class="p">(</span><span style="color: #c1abea">ssWidth</span><span class="p">)</span><span style="color: #c7bf54">-</span><span style="color: #d19a66">1</span><span class="p">)</span><span style="color: #c7bf54">*</span><span style="color: #c1abea">aspectRatio</span><span style="color: #c7bf54">*</span><span style="color: #c1abea">math</span><span class="p">.</span><span style="color: #00b1f7">Tan</span><span class="p">(</span><span style="color: #c1abea">fov</span><span style="color: #c7bf54">/</span><span style="color: #d19a66">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #d19a66">1</span><span style="color: #c7bf54">-</span><span style="color: #d19a66">2</span><span style="color: #c7bf54">*</span><span style="color: #ef8383">float64</span><span class="p">(</span><span style="color: #c1abea">y</span><span class="p">)</span><span style="color: #c7bf54">/</span><span style="color: #ef8383">float64</span><span class="p">(</span><span style="color: #c1abea">ssHeight</span><span class="p">))</span><span style="color: #c7bf54">*</span><span style="color: #c1abea">math</span><span class="p">.</span><span style="color: #00b1f7">Tan</span><span class="p">(</span><span style="color: #c1abea">fov</span><span style="color: #c7bf54">/</span><span style="color: #d19a66">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c1abea">direction</span> <span style="color: #c7bf54">:=</span> <span style="color: #c1abea">vec3</span><span class="p">{</span><span style="color: #c1abea">px</span><span class="p">,</span> <span style="color: #c1abea">py</span><span class="p">,</span> <span style="color: #c7bf54">-</span><span style="color: #d19a66">1</span><span class="p">}.</span><span style="color: #00b1f7">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c1abea">t</span> <span style="color: #c7bf54">:=</span> <span style="color: #d19a66">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c678dd">for</span> <span style="color: #c1abea">i</span> <span style="color: #c7bf54">:=</span> <span style="color: #d19a66">0</span><span class="p">;</span> <span style="color: #c1abea">i</span> <span class="p">&lt;</span> <span style="color: #c1abea">maxIter</span><span class="p">;</span> <span style="color: #c1abea">i</span><span style="color: #c7bf54">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c1abea">p</span> <span style="color: #c7bf54">:=</span> <span style="color: #c1abea">direction</span><span class="p">.</span><span style="color: #00b1f7">mul</span><span class="p">(</span><span style="color: #c1abea">t</span><span class="p">).</span><span style="color: #00b1f7">add</span><span class="p">(</span><span style="color: #c1abea">vec3</span><span class="p">{</span><span style="color: #d19a66">0</span><span class="p">,</span> <span style="color: #d19a66">0</span><span class="p">,</span> <span style="color: #d19a66">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c1abea">d</span> <span style="color: #c7bf54">:=</span> <span style="color: #00b1f7">mandelbulb</span><span class="p">(</span><span style="color: #c1abea">p</span><span class="p">)</span> <span style="color: #c7bf54">-</span> <span style="color: #d19a66">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c678dd">if</span> <span style="color: #c1abea">d</span> <span class="p">&lt;</span> <span style="color: #d19a66">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c678dd">return</span> <span style="color: #c1abea">color</span><span class="p">.</span><span style="color: #c1abea">Gray</span><span class="p">{</span><span style="color: #ef8383">uint8</span><span class="p">(</span><span style="color: #d19a66">255</span> <span style="color: #c7bf54">-</span> <span style="color: #c1abea">t</span><span style="color: #c7bf54">*</span><span style="color: #d19a66">255</span><span style="color: #c7bf54">/</span><span style="color: #d19a66">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c1abea">t</span> <span style="color: #c7bf54">+=</span> <span style="color: #c1abea">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c678dd">if</span> <span style="color: #c1abea">t</span> <span class="p">&gt;</span> <span style="color: #d19a66">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c678dd">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c678dd">return</span> <span style="color: #c1abea">color</span><span class="p">.</span><span style="color: #c1abea">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c678dd">func</span> <span style="color: #00b1f7">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c1abea">ssImg</span> <span style="color: #c7bf54">:=</span> <span style="color: #c1abea">image</span><span class="p">.</span><span style="color: #00b1f7">NewRGBA</span><span class="p">(</span><span style="color: #c1abea">image</span><span class="p">.</span><span style="color: #00b1f7">Rect</span><span class="p">(</span><span style="color: #d19a66">0</span><span class="p">,</span> <span style="color: #d19a66">0</span><span class="p">,</span> <span style="color: #c1abea">ssWidth</span><span class="p">,</span> <span style="color: #c1abea">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c678dd">for</span> <span style="color: #c1abea">y</span> <span style="color: #c7bf54">:=</span> <span style="color: #d19a66">0</span><span class="p">;</span> <span style="color: #c1abea">y</span> <span class="p">&lt;</span> <span style="color: #c1abea">ssHeight</span><span class="p">;</span> <span style="color: #c1abea">y</span><span style="color: #c7bf54">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c1abea">wg</span><span class="p">.</span><span style="color: #00b1f7">Add</span><span class="p">(</span><span style="color: #d19a66">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c678dd">go</span> <span style="color: #c678dd">func</span><span class="p">(</span><span style="color: #c1abea">y</span> <span style="color: #ef8383">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c678dd">defer</span> <span style="color: #c1abea">wg</span><span class="p">.</span><span style="color: #00b1f7">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c678dd">for</span> <span style="color: #c1abea">x</span> <span style="color: #c7bf54">:=</span> <span style="color: #d19a66">0</span><span class="p">;</span> <span style="color: #c1abea">x</span> <span class="p">&lt;</span> <span style="color: #c1abea">ssWidth</span><span class="p">;</span> <span style="color: #c1abea">x</span><span style="color: #c7bf54">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #c1abea">ssImg</span><span class="p">.</span><span style="color: #00b1f7">Set</span><span class="p">(</span><span style="color: #c1abea">x</span><span class="p">,</span> <span style="color: #c1abea">y</span><span class="p">,</span> <span style="color: #00b1f7">renderPixel</span><span class="p">(</span><span style="color: #c1abea">x</span><span class="p">,</span> <span style="color: #c1abea">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span style="color: #c1abea">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c1abea">wg</span><span class="p">.</span><span style="color: #00b1f7">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c1abea">img</span> <span style="color: #c7bf54">:=</span> <span style="color: #c1abea">image</span><span class="p">.</span><span style="color: #00b1f7">NewRGBA</span><span class="p">(</span><span style="color: #c1abea">image</span><span class="p">.</span><span style="color: #00b1f7">Rect</span><span class="p">(</span><span style="color: #d19a66">0</span><span class="p">,</span> <span style="color: #d19a66">0</span><span class="p">,</span> <span style="color: #c1abea">width</span><span class="p">,</span> <span style="color: #c1abea">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c678dd">for</span> <span style="color: #c1abea">y</span> <span style="color: #c7bf54">:=</span> <span style="color: #d19a66">0</span><span class="p">;</span> <span style="color: #c1abea">y</span> <span class="p">&lt;</span> <span style="color: #c1abea">height</span><span class="p">;</span> <span style="color: #c1abea">y</span><span style="color: #c7bf54">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c678dd">for</span> <span style="color: #c1abea">x</span> <span style="color: #c7bf54">:=</span> <span style="color: #d19a66">0</span><span class="p">;</span> <span style="color: #c1abea">x</span> <span class="p">&lt;</span> <span style="color: #c1abea">width</span><span class="p">;</span> <span style="color: #c1abea">x</span><span style="color: #c7bf54">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c1abea">r</span><span class="p">,</span> <span style="color: #c1abea">g</span><span class="p">,</span> <span style="color: #c1abea">b</span><span class="p">,</span> <span style="color: #c1abea">a</span> <span style="color: #c7bf54">:=</span> <span style="color: #d19a66">0</span><span class="p">,</span> <span style="color: #d19a66">0</span><span class="p">,</span> <span style="color: #d19a66">0</span><span class="p">,</span> <span style="color: #d19a66">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c678dd">for</span> <span style="color: #c1abea">dy</span> <span style="color: #c7bf54">:=</span> <span style="color: #d19a66">0</span><span class="p">;</span> <span style="color: #c1abea">dy</span> <span class="p">&lt;</span> <span style="color: #c1abea">supersamplingRatio</span><span class="p">;</span> <span style="color: #c1abea">dy</span><span style="color: #c7bf54">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #c678dd">for</span> <span style="color: #c1abea">dx</span> <span style="color: #c7bf54">:=</span> <span style="color: #d19a66">0</span><span class="p">;</span> <span style="color: #c1abea">dx</span> <span class="p">&lt;</span> <span style="color: #c1abea">supersamplingRatio</span><span class="p">;</span> <span style="color: #c1abea">dx</span><span style="color: #c7bf54">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #c1abea">c</span> <span style="color: #c7bf54">:=</span> <span style="color: #c1abea">ssImg</span><span class="p">.</span><span style="color: #00b1f7">RGBAAt</span><span class="p">(</span><span style="color: #c1abea">x</span><span style="color: #c7bf54">*</span><span style="color: #c1abea">supersamplingRatio</span><span style="color: #c7bf54">+</span><span style="color: #c1abea">dx</span><span class="p">,</span> <span style="color: #c1abea">y</span><span style="color: #c7bf54">*</span><span style="color: #c1abea">supersamplingRatio</span><span style="color: #c7bf54">+</span><span style="color: #c1abea">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #c1abea">r</span> <span style="color: #c7bf54">+=</span> <span style="color: #ef8383">int</span><span class="p">(</span><span style="color: #c1abea">c</span><span class="p">.</span><span style="color: #c1abea">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #c1abea">g</span> <span style="color: #c7bf54">+=</span> <span style="color: #ef8383">int</span><span class="p">(</span><span style="color: #c1abea">c</span><span class="p">.</span><span style="color: #c1abea">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #c1abea">b</span> <span style="color: #c7bf54">+=</span> <span style="color: #ef8383">int</span><span class="p">(</span><span style="color: #c1abea">c</span><span class="p">.</span><span style="color: #c1abea">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #c1abea">a</span> <span style="color: #c7bf54">+=</span> <span style="color: #ef8383">int</span><span class="p">(</span><span style="color: #c1abea">c</span><span class="p">.</span><span style="color: #c1abea">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c1abea">r</span> <span style="color: #c7bf54">/=</span> <span style="color: #c1abea">supersamplingRatio</span> <span style="color: #c7bf54">*</span> <span style="color: #c1abea">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c1abea">g</span> <span style="color: #c7bf54">/=</span> <span style="color: #c1abea">supersamplingRatio</span> <span style="color: #c7bf54">*</span> <span style="color: #c1abea">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c1abea">b</span> <span style="color: #c7bf54">/=</span> <span style="color: #c1abea">supersamplingRatio</span> <span style="color: #c7bf54">*</span> <span style="color: #c1abea">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c1abea">a</span> <span style="color: #c7bf54">/=</span> <span style="color: #c1abea">supersamplingRatio</span> <span style="color: #c7bf54">*</span> <span style="color: #c1abea">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c1abea">img</span><span class="p">.</span><span style="color: #00b1f7">Set</span><span class="p">(</span><span style="color: #c1abea">x</span><span class="p">,</span> <span style="color: #c1abea">y</span><span class="p">,</span> <span style="color: #c1abea">color</span><span class="p">.</span><span style="color: #c1abea">RGBA</span><span class="p">{</span><span style="color: #ef8383">uint8</span><span class="p">(</span><span style="color: #c1abea">r</span><span class="p">),</span> <span style="color: #ef8383">uint8</span><span class="p">(</span><span style="color: #c1abea">g</span><span class="p">),</span> <span style="color: #ef8383">uint8</span><span class="p">(</span><span style="color: #c1abea">b</span><span class="p">),</span> <span style="color: #ef8383">uint8</span><span class="p">(</span><span style="color: #c1abea">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c1abea">file</span><span class="p">,</span> <span style="color: #c1abea">err</span> <span style="color: #c7bf54">:=</span> <span style="color: #c1abea">os</span><span class="p">.</span><span style="color: #00b1f7">Create</span><span class="p">(</span><span style="color: #98c379">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c678dd">if</span> <span style="color: #c1abea">err</span> <span style="color: #c7bf54">!=</span> <span style="color: #b756ff; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c1abea">fmt</span><span class="p">.</span><span style="color: #00b1f7">Println</span><span class="p">(</span><span style="color: #98c379">&#34;Error creating file:&#34;</span><span class="p">,</span> <span style="color: #c1abea">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c678dd">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c678dd">defer</span> <span style="color: #c1abea">file</span><span class="p">.</span><span style="color: #00b1f7">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c1abea">err</span> <span class="p">=</span> <span style="color: #c1abea">png</span><span class="p">.</span><span style="color: #00b1f7">Encode</span><span class="p">(</span><span style="color: #c1abea">file</span><span class="p">,</span> <span style="color: #c1abea">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c678dd">if</span> <span style="color: #c1abea">err</span> <span style="color: #c7bf54">!=</span> <span style="color: #b756ff; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c1abea">fmt</span><span class="p">.</span><span style="color: #00b1f7">Println</span><span class="p">(</span><span style="color: #98c379">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span style="color: #c1abea">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='doom-one2'><h2><a id='stylelink' href='doom-one2.html' alt='View only doom-one2'>doom-one2</a></h2></a><code><pre style="color: #b0c4de; background-color: #282c34;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #76a9f9">package</span> <span style="color: #aa89ea">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8a93a5; font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #8a93a5; font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #8a93a5; font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #8a93a5; font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #76a9f9">import</span> <span style="color: #abb2bf">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #98c379">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #98c379">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #98c379">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #98c379">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #98c379">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #98c379">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #98c379">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #abb2bf">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #76a9f9">const</span> <span style="color: #abb2bf">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa89ea">width</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">height</span>      <span style="color: #abb2bf">=</span> <span style="color: #d19a66">1920</span><span style="color: #abb2bf">,</span> <span style="color: #d19a66">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa89ea">ssWidth</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">ssHeight</span>  <span style="color: #abb2bf">=</span> <span style="color: #d19a66">3840</span><span style="color: #abb2bf">,</span> <span style="color: #d19a66">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa89ea">aspectRatio</span>        <span style="color: #abb2bf">=</span> <span style="color: #e5c07b">float64</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">ssWidth</span><span style="color: #abb2bf">)</span> <span style="color: #54b1c7">/</span> <span style="color: #e5c07b">float64</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">ssHeight</span><span style="color: #abb2bf">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa89ea">fov</span>                <span style="color: #abb2bf">=</span> <span style="color: #aa89ea">math</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">Pi</span> <span style="color: #54b1c7">/</span> <span style="color: #d19a66">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa89ea">maxIter</span>            <span style="color: #abb2bf">=</span> <span style="color: #d19a66">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa89ea">power</span>              <span style="color: #abb2bf">=</span> <span style="color: #d19a66">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa89ea">escapeRadius</span>       <span style="color: #abb2bf">=</span> <span style="color: #d19a66">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa89ea">supersamplingRatio</span> <span style="color: #abb2bf">=</span> <span style="color: #d19a66">2</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #abb2bf">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #76a9f9">var</span> <span style="color: #aa89ea">wg</span> <span style="color: #aa89ea">sync</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #76a9f9">type</span> <span style="color: #aa89ea">vec3</span> <span style="color: #76a9f9">struct</span><span style="color: #abb2bf">{</span> <span style="color: #aa89ea">x</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">y</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">z</span> <span style="color: #e5c07b">float64</span> <span style="color: #abb2bf">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #76a9f9">func</span> <span style="color: #abb2bf">(</span><span style="color: #aa89ea">v</span> <span style="color: #aa89ea">vec3</span><span style="color: #abb2bf">)</span> <span style="color: #00b1f7">add</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">w</span> <span style="color: #aa89ea">vec3</span><span style="color: #abb2bf">)</span> <span style="color: #aa89ea">vec3</span>    <span style="color: #abb2bf">{</span> <span style="color: #76a9f9">return</span> <span style="color: #aa89ea">vec3</span><span style="color: #abb2bf">{</span><span style="color: #aa89ea">v</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">x</span> <span style="color: #54b1c7">+</span> <span style="color: #aa89ea">w</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">x</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">v</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">y</span> <span style="color: #54b1c7">+</span> <span style="color: #aa89ea">w</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">y</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">v</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">z</span> <span style="color: #54b1c7">+</span> <span style="color: #aa89ea">w</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">z</span><span style="color: #abb2bf">}</span> <span style="color: #abb2bf">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #76a9f9">func</span> <span style="color: #abb2bf">(</span><span style="color: #aa89ea">v</span> <span style="color: #aa89ea">vec3</span><span style="color: #abb2bf">)</span> <span style="color: #00b1f7">mul</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">s</span> <span style="color: #e5c07b">float64</span><span style="color: #abb2bf">)</span> <span style="color: #aa89ea">vec3</span> <span style="color: #abb2bf">{</span> <span style="color: #76a9f9">return</span> <span style="color: #aa89ea">vec3</span><span style="color: #abb2bf">{</span><span style="color: #aa89ea">v</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">x</span> <span style="color: #54b1c7">*</span> <span style="color: #aa89ea">s</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">v</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">y</span> <span style="color: #54b1c7">*</span> <span style="color: #aa89ea">s</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">v</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">z</span> <span style="color: #54b1c7">*</span> <span style="color: #aa89ea">s</span><span style="color: #abb2bf">}</span> <span style="color: #abb2bf">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #76a9f9">func</span> <span style="color: #abb2bf">(</span><span style="color: #aa89ea">v</span> <span style="color: #aa89ea">vec3</span><span style="color: #abb2bf">)</span> <span style="color: #00b1f7">length</span><span style="color: #abb2bf">()</span> <span style="color: #e5c07b">float64</span>    <span style="color: #abb2bf">{</span> <span style="color: #76a9f9">return</span> <span style="color: #aa89ea">math</span><span style="color: #abb2bf">.</span><span style="color: #00b1f7">Sqrt</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">v</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">x</span><span style="color: #54b1c7">*</span><span style="color: #aa89ea">v</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">x</span> <span style="color: #54b1c7">+</span> <span style="color: #aa89ea">v</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">y</span><span style="color: #54b1c7">*</span><span style="color: #aa89ea">v</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">y</span> <span style="color: #54b1c7">+</span> <span style="color: #aa89ea">v</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">z</span><span style="color: #54b1c7">*</span><span style="color: #aa89ea">v</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">z</span><span style="color: #abb2bf">)</span> <span style="color: #abb2bf">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #76a9f9">func</span> <span style="color: #abb2bf">(</span><span style="color: #aa89ea">v</span> <span style="color: #aa89ea">vec3</span><span style="color: #abb2bf">)</span> <span style="color: #00b1f7">normalize</span><span style="color: #abb2bf">()</span> <span style="color: #aa89ea">vec3</span>    <span style="color: #abb2bf">{</span> <span style="color: #76a9f9">return</span> <span style="color: #aa89ea">v</span><span style="color: #abb2bf">.</span><span style="color: #00b1f7">mul</span><span style="color: #abb2bf">(</span><span style="color: #d19a66">1</span> <span style="color: #54b1c7">/</span> <span style="color: #aa89ea">v</span><span style="color: #abb2bf">.</span><span style="color: #00b1f7">length</span><span style="color: #abb2bf">())</span> <span style="color: #abb2bf">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #76a9f9">func</span> <span style="color: #00b1f7">mandelbulb</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">p</span> <span style="color: #aa89ea">vec3</span><span style="color: #abb2bf">)</span> <span style="color: #e5c07b">float64</span> <span style="color: #abb2bf">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa89ea">z</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">r</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">theta</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">phi</span> <span style="color: #54b1c7">:=</span> <span style="color: #aa89ea">p</span><span style="color: #abb2bf">,</span> <span style="color: #d19a66">0.0</span><span style="color: #abb2bf">,</span> <span style="color: #d19a66">0.0</span><span style="color: #abb2bf">,</span> <span style="color: #d19a66">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #76a9f9">for</span> <span style="color: #aa89ea">i</span> <span style="color: #54b1c7">:=</span> <span style="color: #d19a66">0</span><span style="color: #abb2bf">;</span> <span style="color: #aa89ea">i</span> <span style="color: #abb2bf">&lt;</span> <span style="color: #aa89ea">maxIter</span><span style="color: #abb2bf">;</span> <span style="color: #aa89ea">i</span><span style="color: #54b1c7">++</span> <span style="color: #abb2bf">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #aa89ea">r</span> <span style="color: #abb2bf">=</span> <span style="color: #aa89ea">z</span><span style="color: #abb2bf">.</span><span style="color: #00b1f7">length</span><span style="color: #abb2bf">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #76a9f9">if</span> <span style="color: #aa89ea">r</span> <span style="color: #abb2bf">&gt;</span> <span style="color: #aa89ea">escapeRadius</span> <span style="color: #abb2bf">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #76a9f9">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #abb2bf">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #aa89ea">theta</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">phi</span> <span style="color: #abb2bf">=</span> <span style="color: #aa89ea">math</span><span style="color: #abb2bf">.</span><span style="color: #00b1f7">Acos</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">z</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">z</span><span style="color: #54b1c7">/</span><span style="color: #aa89ea">r</span><span style="color: #abb2bf">)</span><span style="color: #54b1c7">*</span><span style="color: #aa89ea">power</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">math</span><span style="color: #abb2bf">.</span><span style="color: #00b1f7">Atan2</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">z</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">y</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">z</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">x</span><span style="color: #abb2bf">)</span><span style="color: #54b1c7">*</span><span style="color: #aa89ea">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #aa89ea">r</span> <span style="color: #abb2bf">=</span> <span style="color: #aa89ea">math</span><span style="color: #abb2bf">.</span><span style="color: #00b1f7">Pow</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">r</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">power</span><span style="color: #abb2bf">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #aa89ea">z</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">x</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">z</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">y</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">z</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">z</span> <span style="color: #abb2bf">=</span> <span style="color: #aa89ea">p</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">x</span><span style="color: #54b1c7">+</span><span style="color: #aa89ea">r</span><span style="color: #54b1c7">*</span><span style="color: #aa89ea">math</span><span style="color: #abb2bf">.</span><span style="color: #00b1f7">Sin</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">theta</span><span style="color: #abb2bf">)</span><span style="color: #54b1c7">*</span><span style="color: #aa89ea">math</span><span style="color: #abb2bf">.</span><span style="color: #00b1f7">Cos</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">phi</span><span style="color: #abb2bf">),</span> <span style="color: #aa89ea">p</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">y</span><span style="color: #54b1c7">+</span><span style="color: #aa89ea">r</span><span style="color: #54b1c7">*</span><span style="color: #aa89ea">math</span><span style="color: #abb2bf">.</span><span style="color: #00b1f7">Sin</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">theta</span><span style="color: #abb2bf">)</span><span style="color: #54b1c7">*</span><span style="color: #aa89ea">math</span><span style="color: #abb2bf">.</span><span style="color: #00b1f7">Sin</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">phi</span><span style="color: #abb2bf">),</span> <span style="color: #aa89ea">p</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">z</span><span style="color: #54b1c7">+</span><span style="color: #aa89ea">r</span><span style="color: #54b1c7">*</span><span style="color: #aa89ea">math</span><span style="color: #abb2bf">.</span><span style="color: #00b1f7">Cos</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">theta</span><span style="color: #abb2bf">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #abb2bf">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #76a9f9">return</span> <span style="color: #aa89ea">r</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #abb2bf">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #76a9f9">func</span> <span style="color: #00b1f7">renderPixel</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">x</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">y</span> <span style="color: #e5c07b">int</span><span style="color: #abb2bf">)</span> <span style="color: #aa89ea">color</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">Color</span> <span style="color: #abb2bf">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa89ea">px</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">py</span> <span style="color: #54b1c7">:=</span> <span style="color: #abb2bf">(</span><span style="color: #d19a66">2</span><span style="color: #54b1c7">*</span><span style="color: #e5c07b">float64</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">x</span><span style="color: #abb2bf">)</span><span style="color: #54b1c7">/</span><span style="color: #e5c07b">float64</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">ssWidth</span><span style="color: #abb2bf">)</span><span style="color: #54b1c7">-</span><span style="color: #d19a66">1</span><span style="color: #abb2bf">)</span><span style="color: #54b1c7">*</span><span style="color: #aa89ea">aspectRatio</span><span style="color: #54b1c7">*</span><span style="color: #aa89ea">math</span><span style="color: #abb2bf">.</span><span style="color: #00b1f7">Tan</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">fov</span><span style="color: #54b1c7">/</span><span style="color: #d19a66">2</span><span style="color: #abb2bf">),</span> <span style="color: #abb2bf">(</span><span style="color: #d19a66">1</span><span style="color: #54b1c7">-</span><span style="color: #d19a66">2</span><span style="color: #54b1c7">*</span><span style="color: #e5c07b">float64</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">y</span><span style="color: #abb2bf">)</span><span style="color: #54b1c7">/</span><span style="color: #e5c07b">float64</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">ssHeight</span><span style="color: #abb2bf">))</span><span style="color: #54b1c7">*</span><span style="color: #aa89ea">math</span><span style="color: #abb2bf">.</span><span style="color: #00b1f7">Tan</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">fov</span><span style="color: #54b1c7">/</span><span style="color: #d19a66">2</span><span style="color: #abb2bf">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa89ea">direction</span> <span style="color: #54b1c7">:=</span> <span style="color: #aa89ea">vec3</span><span style="color: #abb2bf">{</span><span style="color: #aa89ea">px</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">py</span><span style="color: #abb2bf">,</span> <span style="color: #54b1c7">-</span><span style="color: #d19a66">1</span><span style="color: #abb2bf">}.</span><span style="color: #00b1f7">normalize</span><span style="color: #abb2bf">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa89ea">t</span> <span style="color: #54b1c7">:=</span> <span style="color: #d19a66">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #76a9f9">for</span> <span style="color: #aa89ea">i</span> <span style="color: #54b1c7">:=</span> <span style="color: #d19a66">0</span><span style="color: #abb2bf">;</span> <span style="color: #aa89ea">i</span> <span style="color: #abb2bf">&lt;</span> <span style="color: #aa89ea">maxIter</span><span style="color: #abb2bf">;</span> <span style="color: #aa89ea">i</span><span style="color: #54b1c7">++</span> <span style="color: #abb2bf">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #aa89ea">p</span> <span style="color: #54b1c7">:=</span> <span style="color: #aa89ea">direction</span><span style="color: #abb2bf">.</span><span style="color: #00b1f7">mul</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">t</span><span style="color: #abb2bf">).</span><span style="color: #00b1f7">add</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">vec3</span><span style="color: #abb2bf">{</span><span style="color: #d19a66">0</span><span style="color: #abb2bf">,</span> <span style="color: #d19a66">0</span><span style="color: #abb2bf">,</span> <span style="color: #d19a66">5</span><span style="color: #abb2bf">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #aa89ea">d</span> <span style="color: #54b1c7">:=</span> <span style="color: #00b1f7">mandelbulb</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">p</span><span style="color: #abb2bf">)</span> <span style="color: #54b1c7">-</span> <span style="color: #d19a66">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #76a9f9">if</span> <span style="color: #aa89ea">d</span> <span style="color: #abb2bf">&lt;</span> <span style="color: #d19a66">0.001</span> <span style="color: #abb2bf">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #76a9f9">return</span> <span style="color: #aa89ea">color</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">Gray</span><span style="color: #abb2bf">{</span><span style="color: #e5c07b">uint8</span><span style="color: #abb2bf">(</span><span style="color: #d19a66">255</span> <span style="color: #54b1c7">-</span> <span style="color: #aa89ea">t</span><span style="color: #54b1c7">*</span><span style="color: #d19a66">255</span><span style="color: #54b1c7">/</span><span style="color: #d19a66">100</span><span style="color: #abb2bf">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #abb2bf">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #aa89ea">t</span> <span style="color: #54b1c7">+=</span> <span style="color: #aa89ea">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #76a9f9">if</span> <span style="color: #aa89ea">t</span> <span style="color: #abb2bf">&gt;</span> <span style="color: #d19a66">100</span> <span style="color: #abb2bf">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #76a9f9">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #abb2bf">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #abb2bf">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #76a9f9">return</span> <span style="color: #aa89ea">color</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #abb2bf">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #76a9f9">func</span> <span style="color: #00b1f7">main</span><span style="color: #abb2bf">()</span> <span style="color: #abb2bf">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa89ea">ssImg</span> <span style="color: #54b1c7">:=</span> <span style="color: #aa89ea">image</span><span style="color: #abb2bf">.</span><span style="color: #00b1f7">NewRGBA</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">image</span><span style="color: #abb2bf">.</span><span style="color: #00b1f7">Rect</span><span style="color: #abb2bf">(</span><span style="color: #d19a66">0</span><span style="color: #abb2bf">,</span> <span style="color: #d19a66">0</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">ssWidth</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">ssHeight</span><span style="color: #abb2bf">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #76a9f9">for</span> <span style="color: #aa89ea">y</span> <span style="color: #54b1c7">:=</span> <span style="color: #d19a66">0</span><span style="color: #abb2bf">;</span> <span style="color: #aa89ea">y</span> <span style="color: #abb2bf">&lt;</span> <span style="color: #aa89ea">ssHeight</span><span style="color: #abb2bf">;</span> <span style="color: #aa89ea">y</span><span style="color: #54b1c7">++</span> <span style="color: #abb2bf">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #aa89ea">wg</span><span style="color: #abb2bf">.</span><span style="color: #00b1f7">Add</span><span style="color: #abb2bf">(</span><span style="color: #d19a66">1</span><span style="color: #abb2bf">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #76a9f9">go</span> <span style="color: #76a9f9">func</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">y</span> <span style="color: #e5c07b">int</span><span style="color: #abb2bf">)</span> <span style="color: #abb2bf">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #76a9f9">defer</span> <span style="color: #aa89ea">wg</span><span style="color: #abb2bf">.</span><span style="color: #00b1f7">Done</span><span style="color: #abb2bf">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #76a9f9">for</span> <span style="color: #aa89ea">x</span> <span style="color: #54b1c7">:=</span> <span style="color: #d19a66">0</span><span style="color: #abb2bf">;</span> <span style="color: #aa89ea">x</span> <span style="color: #abb2bf">&lt;</span> <span style="color: #aa89ea">ssWidth</span><span style="color: #abb2bf">;</span> <span style="color: #aa89ea">x</span><span style="color: #54b1c7">++</span> <span style="color: #abb2bf">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #aa89ea">ssImg</span><span style="color: #abb2bf">.</span><span style="color: #00b1f7">Set</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">x</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">y</span><span style="color: #abb2bf">,</span> <span style="color: #00b1f7">renderPixel</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">x</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">y</span><span style="color: #abb2bf">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #abb2bf">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #abb2bf">}(</span><span style="color: #aa89ea">y</span><span style="color: #abb2bf">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #abb2bf">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa89ea">wg</span><span style="color: #abb2bf">.</span><span style="color: #00b1f7">Wait</span><span style="color: #abb2bf">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa89ea">img</span> <span style="color: #54b1c7">:=</span> <span style="color: #aa89ea">image</span><span style="color: #abb2bf">.</span><span style="color: #00b1f7">NewRGBA</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">image</span><span style="color: #abb2bf">.</span><span style="color: #00b1f7">Rect</span><span style="color: #abb2bf">(</span><span style="color: #d19a66">0</span><span style="color: #abb2bf">,</span> <span style="color: #d19a66">0</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">width</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">height</span><span style="color: #abb2bf">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #76a9f9">for</span> <span style="color: #aa89ea">y</span> <span style="color: #54b1c7">:=</span> <span style="color: #d19a66">0</span><span style="color: #abb2bf">;</span> <span style="color: #aa89ea">y</span> <span style="color: #abb2bf">&lt;</span> <span style="color: #aa89ea">height</span><span style="color: #abb2bf">;</span> <span style="color: #aa89ea">y</span><span style="color: #54b1c7">++</span> <span style="color: #abb2bf">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #76a9f9">for</span> <span style="color: #aa89ea">x</span> <span style="color: #54b1c7">:=</span> <span style="color: #d19a66">0</span><span style="color: #abb2bf">;</span> <span style="color: #aa89ea">x</span> <span style="color: #abb2bf">&lt;</span> <span style="color: #aa89ea">width</span><span style="color: #abb2bf">;</span> <span style="color: #aa89ea">x</span><span style="color: #54b1c7">++</span> <span style="color: #abb2bf">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #aa89ea">r</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">g</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">b</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">a</span> <span style="color: #54b1c7">:=</span> <span style="color: #d19a66">0</span><span style="color: #abb2bf">,</span> <span style="color: #d19a66">0</span><span style="color: #abb2bf">,</span> <span style="color: #d19a66">0</span><span style="color: #abb2bf">,</span> <span style="color: #d19a66">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #76a9f9">for</span> <span style="color: #aa89ea">dy</span> <span style="color: #54b1c7">:=</span> <span style="color: #d19a66">0</span><span style="color: #abb2bf">;</span> <span style="color: #aa89ea">dy</span> <span style="color: #abb2bf">&lt;</span> <span style="color: #aa89ea">supersamplingRatio</span><span style="color: #abb2bf">;</span> <span style="color: #aa89ea">dy</span><span style="color: #54b1c7">++</span> <span style="color: #abb2bf">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #76a9f9">for</span> <span style="color: #aa89ea">dx</span> <span style="color: #54b1c7">:=</span> <span style="color: #d19a66">0</span><span style="color: #abb2bf">;</span> <span style="color: #aa89ea">dx</span> <span style="color: #abb2bf">&lt;</span> <span style="color: #aa89ea">supersamplingRatio</span><span style="color: #abb2bf">;</span> <span style="color: #aa89ea">dx</span><span style="color: #54b1c7">++</span> <span style="color: #abb2bf">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #aa89ea">c</span> <span style="color: #54b1c7">:=</span> <span style="color: #aa89ea">ssImg</span><span style="color: #abb2bf">.</span><span style="color: #00b1f7">RGBAAt</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">x</span><span style="color: #54b1c7">*</span><span style="color: #aa89ea">supersamplingRatio</span><span style="color: #54b1c7">+</span><span style="color: #aa89ea">dx</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">y</span><span style="color: #54b1c7">*</span><span style="color: #aa89ea">supersamplingRatio</span><span style="color: #54b1c7">+</span><span style="color: #aa89ea">dy</span><span style="color: #abb2bf">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #aa89ea">r</span> <span style="color: #54b1c7">+=</span> <span style="color: #e5c07b">int</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">c</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">R</span><span style="color: #abb2bf">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #aa89ea">g</span> <span style="color: #54b1c7">+=</span> <span style="color: #e5c07b">int</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">c</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">G</span><span style="color: #abb2bf">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #aa89ea">b</span> <span style="color: #54b1c7">+=</span> <span style="color: #e5c07b">int</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">c</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">B</span><span style="color: #abb2bf">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #aa89ea">a</span> <span style="color: #54b1c7">+=</span> <span style="color: #e5c07b">int</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">c</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">A</span><span style="color: #abb2bf">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #abb2bf">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #abb2bf">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #aa89ea">r</span> <span style="color: #54b1c7">/=</span> <span style="color: #aa89ea">supersamplingRatio</span> <span style="color: #54b1c7">*</span> <span style="color: #aa89ea">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #aa89ea">g</span> <span style="color: #54b1c7">/=</span> <span style="color: #aa89ea">supersamplingRatio</span> <span style="color: #54b1c7">*</span> <span style="color: #aa89ea">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #aa89ea">b</span> <span style="color: #54b1c7">/=</span> <span style="color: #aa89ea">supersamplingRatio</span> <span style="color: #54b1c7">*</span> <span style="color: #aa89ea">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #aa89ea">a</span> <span style="color: #54b1c7">/=</span> <span style="color: #aa89ea">supersamplingRatio</span> <span style="color: #54b1c7">*</span> <span style="color: #aa89ea">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #aa89ea">img</span><span style="color: #abb2bf">.</span><span style="color: #00b1f7">Set</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">x</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">y</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">color</span><span style="color: #abb2bf">.</span><span style="color: #aa89ea">RGBA</span><span style="color: #abb2bf">{</span><span style="color: #e5c07b">uint8</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">r</span><span style="color: #abb2bf">),</span> <span style="color: #e5c07b">uint8</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">g</span><span style="color: #abb2bf">),</span> <span style="color: #e5c07b">uint8</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">b</span><span style="color: #abb2bf">),</span> <span style="color: #e5c07b">uint8</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">a</span><span style="color: #abb2bf">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #abb2bf">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #abb2bf">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa89ea">file</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">err</span> <span style="color: #54b1c7">:=</span> <span style="color: #aa89ea">os</span><span style="color: #abb2bf">.</span><span style="color: #00b1f7">Create</span><span style="color: #abb2bf">(</span><span style="color: #98c379">&#34;mandelbulb.png&#34;</span><span style="color: #abb2bf">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #76a9f9">if</span> <span style="color: #aa89ea">err</span> <span style="color: #54b1c7">!=</span> <span style="color: #e5c07b">nil</span> <span style="color: #abb2bf">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #aa89ea">fmt</span><span style="color: #abb2bf">.</span><span style="color: #00b1f7">Println</span><span style="color: #abb2bf">(</span><span style="color: #98c379">&#34;Error creating file:&#34;</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">err</span><span style="color: #abb2bf">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #76a9f9">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #abb2bf">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #76a9f9">defer</span> <span style="color: #aa89ea">file</span><span style="color: #abb2bf">.</span><span style="color: #00b1f7">Close</span><span style="color: #abb2bf">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa89ea">err</span> <span style="color: #abb2bf">=</span> <span style="color: #aa89ea">png</span><span style="color: #abb2bf">.</span><span style="color: #00b1f7">Encode</span><span style="color: #abb2bf">(</span><span style="color: #aa89ea">file</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">img</span><span style="color: #abb2bf">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #76a9f9">if</span> <span style="color: #aa89ea">err</span> <span style="color: #54b1c7">!=</span> <span style="color: #e5c07b">nil</span> <span style="color: #abb2bf">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #aa89ea">fmt</span><span style="color: #abb2bf">.</span><span style="color: #00b1f7">Println</span><span style="color: #abb2bf">(</span><span style="color: #98c379">&#34;Error encoding image:&#34;</span><span style="color: #abb2bf">,</span> <span style="color: #aa89ea">err</span><span style="color: #abb2bf">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #abb2bf">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #abb2bf">}</span></span></span></code></pre></code><a name='dracula'><h2><a id='stylelink' href='dracula.html' alt='View only dracula'>dracula</a></h2></a><code><pre style="color: #f8f8f2; background-color: #282a36;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #ff79c6">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #6272a4">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #6272a4"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #6272a4"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #6272a4"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff79c6">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #f1fa8c">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #f1fa8c">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #f1fa8c">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #f1fa8c">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #f1fa8c">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #f1fa8c">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #f1fa8c">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8be9fd; font-style: italic">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span style="color: #bd93f9">1920</span><span class="p">,</span> <span style="color: #bd93f9">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span style="color: #bd93f9">3840</span><span class="p">,</span> <span style="color: #bd93f9">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span style="color: #8be9fd; font-style: italic">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span style="color: #ff79c6">/</span> <span style="color: #8be9fd; font-style: italic">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span style="color: #ff79c6">/</span> <span style="color: #bd93f9">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span style="color: #bd93f9">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span style="color: #bd93f9">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span style="color: #bd93f9">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span style="color: #bd93f9">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8be9fd; font-style: italic">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8be9fd; font-style: italic">type</span> <span class="nx">vec3</span> <span style="color: #8be9fd; font-style: italic">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #8be9fd">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8be9fd; font-style: italic">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #50fa7b">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #ff79c6">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #ff79c6">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #ff79c6">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #ff79c6">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8be9fd; font-style: italic">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #50fa7b">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #8be9fd">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #ff79c6">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #ff79c6">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #ff79c6">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #ff79c6">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8be9fd; font-style: italic">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #50fa7b">length</span><span class="p">()</span> <span style="color: #8be9fd">float64</span>    <span class="p">{</span> <span style="color: #ff79c6">return</span> <span class="nx">math</span><span class="p">.</span><span style="color: #50fa7b">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span style="color: #ff79c6">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #ff79c6">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span style="color: #ff79c6">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #ff79c6">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span style="color: #ff79c6">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8be9fd; font-style: italic">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #50fa7b">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #ff79c6">return</span> <span class="nx">v</span><span class="p">.</span><span style="color: #50fa7b">mul</span><span class="p">(</span><span style="color: #bd93f9">1</span> <span style="color: #ff79c6">/</span> <span class="nx">v</span><span class="p">.</span><span style="color: #50fa7b">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8be9fd; font-style: italic">func</span> <span style="color: #50fa7b">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #8be9fd">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span style="color: #ff79c6">:=</span> <span class="nx">p</span><span class="p">,</span> <span style="color: #bd93f9">0.0</span><span class="p">,</span> <span style="color: #bd93f9">0.0</span><span class="p">,</span> <span style="color: #bd93f9">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff79c6">for</span> <span class="nx">i</span> <span style="color: #ff79c6">:=</span> <span style="color: #bd93f9">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #ff79c6">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span style="color: #50fa7b">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff79c6">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff79c6">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #50fa7b">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span style="color: #ff79c6">/</span><span class="nx">r</span><span class="p">)</span><span style="color: #ff79c6">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span style="color: #50fa7b">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span style="color: #ff79c6">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #50fa7b">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span style="color: #ff79c6">+</span><span class="nx">r</span><span style="color: #ff79c6">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #50fa7b">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #ff79c6">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #50fa7b">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span style="color: #ff79c6">+</span><span class="nx">r</span><span style="color: #ff79c6">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #50fa7b">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #ff79c6">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #50fa7b">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span style="color: #ff79c6">+</span><span class="nx">r</span><span style="color: #ff79c6">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #50fa7b">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff79c6">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8be9fd; font-style: italic">func</span> <span style="color: #50fa7b">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #8be9fd">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span style="color: #ff79c6">:=</span> <span class="p">(</span><span style="color: #bd93f9">2</span><span style="color: #ff79c6">*</span><span style="color: #8be9fd; font-style: italic">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span style="color: #ff79c6">/</span><span style="color: #8be9fd; font-style: italic">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span style="color: #ff79c6">-</span><span style="color: #bd93f9">1</span><span class="p">)</span><span style="color: #ff79c6">*</span><span class="nx">aspectRatio</span><span style="color: #ff79c6">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #50fa7b">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #ff79c6">/</span><span style="color: #bd93f9">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #bd93f9">1</span><span style="color: #ff79c6">-</span><span style="color: #bd93f9">2</span><span style="color: #ff79c6">*</span><span style="color: #8be9fd; font-style: italic">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span style="color: #ff79c6">/</span><span style="color: #8be9fd; font-style: italic">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span style="color: #ff79c6">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #50fa7b">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #ff79c6">/</span><span style="color: #bd93f9">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span style="color: #ff79c6">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span style="color: #ff79c6">-</span><span style="color: #bd93f9">1</span><span class="p">}.</span><span style="color: #50fa7b">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span style="color: #ff79c6">:=</span> <span style="color: #bd93f9">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff79c6">for</span> <span class="nx">i</span> <span style="color: #ff79c6">:=</span> <span style="color: #bd93f9">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #ff79c6">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span style="color: #ff79c6">:=</span> <span class="nx">direction</span><span class="p">.</span><span style="color: #50fa7b">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span style="color: #50fa7b">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span style="color: #bd93f9">0</span><span class="p">,</span> <span style="color: #bd93f9">0</span><span class="p">,</span> <span style="color: #bd93f9">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span style="color: #ff79c6">:=</span> <span style="color: #50fa7b">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span style="color: #ff79c6">-</span> <span style="color: #bd93f9">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff79c6">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span style="color: #bd93f9">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff79c6">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span style="color: #8be9fd; font-style: italic">uint8</span><span class="p">(</span><span style="color: #bd93f9">255</span> <span style="color: #ff79c6">-</span> <span class="nx">t</span><span style="color: #ff79c6">*</span><span style="color: #bd93f9">255</span><span style="color: #ff79c6">/</span><span style="color: #bd93f9">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span style="color: #ff79c6">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff79c6">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span style="color: #bd93f9">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff79c6">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff79c6">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8be9fd; font-style: italic">func</span> <span style="color: #50fa7b">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span style="color: #ff79c6">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #50fa7b">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #50fa7b">Rect</span><span class="p">(</span><span style="color: #bd93f9">0</span><span class="p">,</span> <span style="color: #bd93f9">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff79c6">for</span> <span class="nx">y</span> <span style="color: #ff79c6">:=</span> <span style="color: #bd93f9">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span style="color: #ff79c6">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span style="color: #50fa7b">Add</span><span class="p">(</span><span style="color: #bd93f9">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff79c6">go</span> <span style="color: #8be9fd; font-style: italic">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #8be9fd">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff79c6">defer</span> <span class="nx">wg</span><span class="p">.</span><span style="color: #50fa7b">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff79c6">for</span> <span class="nx">x</span> <span style="color: #ff79c6">:=</span> <span style="color: #bd93f9">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span style="color: #ff79c6">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span style="color: #50fa7b">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span style="color: #50fa7b">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span style="color: #50fa7b">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span style="color: #ff79c6">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #50fa7b">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #50fa7b">Rect</span><span class="p">(</span><span style="color: #bd93f9">0</span><span class="p">,</span> <span style="color: #bd93f9">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff79c6">for</span> <span class="nx">y</span> <span style="color: #ff79c6">:=</span> <span style="color: #bd93f9">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span style="color: #ff79c6">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff79c6">for</span> <span class="nx">x</span> <span style="color: #ff79c6">:=</span> <span style="color: #bd93f9">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span style="color: #ff79c6">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span style="color: #ff79c6">:=</span> <span style="color: #bd93f9">0</span><span class="p">,</span> <span style="color: #bd93f9">0</span><span class="p">,</span> <span style="color: #bd93f9">0</span><span class="p">,</span> <span style="color: #bd93f9">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff79c6">for</span> <span class="nx">dy</span> <span style="color: #ff79c6">:=</span> <span style="color: #bd93f9">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span style="color: #ff79c6">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #ff79c6">for</span> <span class="nx">dx</span> <span style="color: #ff79c6">:=</span> <span style="color: #bd93f9">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span style="color: #ff79c6">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span style="color: #ff79c6">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span style="color: #50fa7b">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span style="color: #ff79c6">*</span><span class="nx">supersamplingRatio</span><span style="color: #ff79c6">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span style="color: #ff79c6">*</span><span class="nx">supersamplingRatio</span><span style="color: #ff79c6">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span style="color: #ff79c6">+=</span> <span style="color: #8be9fd; font-style: italic">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span style="color: #ff79c6">+=</span> <span style="color: #8be9fd; font-style: italic">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span style="color: #ff79c6">+=</span> <span style="color: #8be9fd; font-style: italic">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span style="color: #ff79c6">+=</span> <span style="color: #8be9fd; font-style: italic">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span style="color: #ff79c6">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #ff79c6">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span style="color: #ff79c6">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #ff79c6">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span style="color: #ff79c6">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #ff79c6">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span style="color: #ff79c6">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #ff79c6">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span style="color: #50fa7b">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span style="color: #8be9fd; font-style: italic">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span style="color: #8be9fd; font-style: italic">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span style="color: #8be9fd; font-style: italic">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span style="color: #8be9fd; font-style: italic">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span style="color: #ff79c6">:=</span> <span class="nx">os</span><span class="p">.</span><span style="color: #50fa7b">Create</span><span class="p">(</span><span style="color: #f1fa8c">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff79c6">if</span> <span class="nx">err</span> <span style="color: #ff79c6">!=</span> <span style="color: #ff79c6">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #50fa7b">Println</span><span class="p">(</span><span style="color: #f1fa8c">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff79c6">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff79c6">defer</span> <span class="nx">file</span><span class="p">.</span><span style="color: #50fa7b">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span style="color: #50fa7b">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff79c6">if</span> <span class="nx">err</span> <span style="color: #ff79c6">!=</span> <span style="color: #ff79c6">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #50fa7b">Println</span><span class="p">(</span><span style="color: #f1fa8c">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='emacs'><h2><a id='stylelink' href='emacs.html' alt='View only emacs'>emacs</a></h2></a><code><pre style="background-color: #f8f8f8;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #aa22ff; font-weight: bold">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #aa22ff; font-weight: bold">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #bb4444">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #bb4444">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #bb4444">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #bb4444">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #bb4444">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #bb4444">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #bb4444">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #aa22ff; font-weight: bold">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span style="color: #666666">1920</span><span class="p">,</span> <span style="color: #666666">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span style="color: #666666">3840</span><span class="p">,</span> <span style="color: #666666">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span style="color: #aa22ff">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span style="color: #666666">/</span> <span style="color: #aa22ff">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span style="color: #666666">/</span> <span style="color: #666666">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span style="color: #666666">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span style="color: #666666">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span style="color: #666666">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span style="color: #666666">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #aa22ff; font-weight: bold">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #aa22ff; font-weight: bold">type</span> <span class="nx">vec3</span> <span style="color: #aa22ff; font-weight: bold">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #00bb00; font-weight: bold">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #aa22ff; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #00a000">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #aa22ff; font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #666666">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #666666">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #666666">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #aa22ff; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #00a000">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #00bb00; font-weight: bold">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #aa22ff; font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #666666">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #666666">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #666666">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #aa22ff; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #00a000">length</span><span class="p">()</span> <span style="color: #00bb00; font-weight: bold">float64</span>    <span class="p">{</span> <span style="color: #aa22ff; font-weight: bold">return</span> <span class="nx">math</span><span class="p">.</span><span style="color: #00a000">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span style="color: #666666">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #666666">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span style="color: #666666">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #666666">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span style="color: #666666">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #aa22ff; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #00a000">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #aa22ff; font-weight: bold">return</span> <span class="nx">v</span><span class="p">.</span><span style="color: #00a000">mul</span><span class="p">(</span><span style="color: #666666">1</span> <span style="color: #666666">/</span> <span class="nx">v</span><span class="p">.</span><span style="color: #00a000">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #aa22ff; font-weight: bold">func</span> <span style="color: #00a000">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #00bb00; font-weight: bold">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span style="color: #666666">:=</span> <span class="nx">p</span><span class="p">,</span> <span style="color: #666666">0.0</span><span class="p">,</span> <span style="color: #666666">0.0</span><span class="p">,</span> <span style="color: #666666">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa22ff; font-weight: bold">for</span> <span class="nx">i</span> <span style="color: #666666">:=</span> <span style="color: #666666">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #666666">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span style="color: #00a000">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #aa22ff; font-weight: bold">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #aa22ff; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #00a000">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span style="color: #666666">/</span><span class="nx">r</span><span class="p">)</span><span style="color: #666666">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span style="color: #00a000">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span style="color: #666666">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #00a000">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span style="color: #666666">+</span><span class="nx">r</span><span style="color: #666666">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #00a000">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #666666">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #00a000">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span style="color: #666666">+</span><span class="nx">r</span><span style="color: #666666">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #00a000">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #666666">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #00a000">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span style="color: #666666">+</span><span class="nx">r</span><span style="color: #666666">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #00a000">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa22ff; font-weight: bold">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #aa22ff; font-weight: bold">func</span> <span style="color: #00a000">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #00bb00; font-weight: bold">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span style="color: #666666">:=</span> <span class="p">(</span><span style="color: #666666">2</span><span style="color: #666666">*</span><span style="color: #aa22ff">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span style="color: #666666">/</span><span style="color: #aa22ff">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span style="color: #666666">-</span><span style="color: #666666">1</span><span class="p">)</span><span style="color: #666666">*</span><span class="nx">aspectRatio</span><span style="color: #666666">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #00a000">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #666666">/</span><span style="color: #666666">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #666666">1</span><span style="color: #666666">-</span><span style="color: #666666">2</span><span style="color: #666666">*</span><span style="color: #aa22ff">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span style="color: #666666">/</span><span style="color: #aa22ff">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span style="color: #666666">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #00a000">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #666666">/</span><span style="color: #666666">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span style="color: #666666">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span style="color: #666666">-</span><span style="color: #666666">1</span><span class="p">}.</span><span style="color: #00a000">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span style="color: #666666">:=</span> <span style="color: #666666">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa22ff; font-weight: bold">for</span> <span class="nx">i</span> <span style="color: #666666">:=</span> <span style="color: #666666">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #666666">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span style="color: #666666">:=</span> <span class="nx">direction</span><span class="p">.</span><span style="color: #00a000">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span style="color: #00a000">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span style="color: #666666">0</span><span class="p">,</span> <span style="color: #666666">0</span><span class="p">,</span> <span style="color: #666666">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span style="color: #666666">:=</span> <span style="color: #00a000">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span style="color: #666666">-</span> <span style="color: #666666">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #aa22ff; font-weight: bold">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span style="color: #666666">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #aa22ff; font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span style="color: #aa22ff">uint8</span><span class="p">(</span><span style="color: #666666">255</span> <span style="color: #666666">-</span> <span class="nx">t</span><span style="color: #666666">*</span><span style="color: #666666">255</span><span style="color: #666666">/</span><span style="color: #666666">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span style="color: #666666">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #aa22ff; font-weight: bold">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span style="color: #666666">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #aa22ff; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa22ff; font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #aa22ff; font-weight: bold">func</span> <span style="color: #00a000">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span style="color: #666666">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #00a000">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #00a000">Rect</span><span class="p">(</span><span style="color: #666666">0</span><span class="p">,</span> <span style="color: #666666">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa22ff; font-weight: bold">for</span> <span class="nx">y</span> <span style="color: #666666">:=</span> <span style="color: #666666">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span style="color: #666666">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span style="color: #00a000">Add</span><span class="p">(</span><span style="color: #666666">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #aa22ff; font-weight: bold">go</span> <span style="color: #aa22ff; font-weight: bold">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #00bb00; font-weight: bold">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #aa22ff; font-weight: bold">defer</span> <span class="nx">wg</span><span class="p">.</span><span style="color: #00a000">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #aa22ff; font-weight: bold">for</span> <span class="nx">x</span> <span style="color: #666666">:=</span> <span style="color: #666666">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span style="color: #666666">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span style="color: #00a000">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span style="color: #00a000">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span style="color: #00a000">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span style="color: #666666">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #00a000">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #00a000">Rect</span><span class="p">(</span><span style="color: #666666">0</span><span class="p">,</span> <span style="color: #666666">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa22ff; font-weight: bold">for</span> <span class="nx">y</span> <span style="color: #666666">:=</span> <span style="color: #666666">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span style="color: #666666">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #aa22ff; font-weight: bold">for</span> <span class="nx">x</span> <span style="color: #666666">:=</span> <span style="color: #666666">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span style="color: #666666">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span style="color: #666666">:=</span> <span style="color: #666666">0</span><span class="p">,</span> <span style="color: #666666">0</span><span class="p">,</span> <span style="color: #666666">0</span><span class="p">,</span> <span style="color: #666666">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #aa22ff; font-weight: bold">for</span> <span class="nx">dy</span> <span style="color: #666666">:=</span> <span style="color: #666666">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span style="color: #666666">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #aa22ff; font-weight: bold">for</span> <span class="nx">dx</span> <span style="color: #666666">:=</span> <span style="color: #666666">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span style="color: #666666">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span style="color: #666666">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span style="color: #00a000">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span style="color: #666666">*</span><span class="nx">supersamplingRatio</span><span style="color: #666666">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span style="color: #666666">*</span><span class="nx">supersamplingRatio</span><span style="color: #666666">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span style="color: #666666">+=</span> <span style="color: #aa22ff">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span style="color: #666666">+=</span> <span style="color: #aa22ff">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span style="color: #666666">+=</span> <span style="color: #aa22ff">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span style="color: #666666">+=</span> <span style="color: #aa22ff">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span style="color: #666666">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #666666">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span style="color: #666666">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #666666">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span style="color: #666666">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #666666">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span style="color: #666666">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #666666">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span style="color: #00a000">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span style="color: #aa22ff">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span style="color: #aa22ff">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span style="color: #aa22ff">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span style="color: #aa22ff">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span style="color: #666666">:=</span> <span class="nx">os</span><span class="p">.</span><span style="color: #00a000">Create</span><span class="p">(</span><span style="color: #bb4444">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa22ff; font-weight: bold">if</span> <span class="nx">err</span> <span style="color: #666666">!=</span> <span style="color: #aa22ff; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #00a000">Println</span><span class="p">(</span><span style="color: #bb4444">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #aa22ff; font-weight: bold">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa22ff; font-weight: bold">defer</span> <span class="nx">file</span><span class="p">.</span><span style="color: #00a000">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span style="color: #00a000">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #aa22ff; font-weight: bold">if</span> <span class="nx">err</span> <span style="color: #666666">!=</span> <span style="color: #aa22ff; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #00a000">Println</span><span class="p">(</span><span style="color: #bb4444">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='friendly'><h2><a id='stylelink' href='friendly.html' alt='View only friendly'>friendly</a></h2></a><code><pre style="background-color: #f0f0f0;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #007020; font-weight: bold">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #60a0b0; font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #60a0b0; font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #60a0b0; font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #60a0b0; font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #007020; font-weight: bold">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #4070a0">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #4070a0">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #4070a0">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #4070a0">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #4070a0">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #4070a0">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #4070a0">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #007020; font-weight: bold">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span style="color: #40a070">1920</span><span class="p">,</span> <span style="color: #40a070">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span style="color: #40a070">3840</span><span class="p">,</span> <span style="color: #40a070">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span style="color: #007020">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span style="color: #666666">/</span> <span style="color: #007020">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span style="color: #666666">/</span> <span style="color: #40a070">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span style="color: #40a070">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span style="color: #40a070">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span style="color: #40a070">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span style="color: #40a070">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #007020; font-weight: bold">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #007020; font-weight: bold">type</span> <span class="nx">vec3</span> <span style="color: #007020; font-weight: bold">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #902000">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #007020; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #06287e">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #007020; font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #666666">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #666666">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #666666">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #007020; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #06287e">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #902000">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #007020; font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #666666">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #666666">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #666666">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #007020; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #06287e">length</span><span class="p">()</span> <span style="color: #902000">float64</span>    <span class="p">{</span> <span style="color: #007020; font-weight: bold">return</span> <span class="nx">math</span><span class="p">.</span><span style="color: #06287e">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span style="color: #666666">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #666666">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span style="color: #666666">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #666666">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span style="color: #666666">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #007020; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #06287e">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #007020; font-weight: bold">return</span> <span class="nx">v</span><span class="p">.</span><span style="color: #06287e">mul</span><span class="p">(</span><span style="color: #40a070">1</span> <span style="color: #666666">/</span> <span class="nx">v</span><span class="p">.</span><span style="color: #06287e">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #007020; font-weight: bold">func</span> <span style="color: #06287e">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #902000">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span style="color: #666666">:=</span> <span class="nx">p</span><span class="p">,</span> <span style="color: #40a070">0.0</span><span class="p">,</span> <span style="color: #40a070">0.0</span><span class="p">,</span> <span style="color: #40a070">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #007020; font-weight: bold">for</span> <span class="nx">i</span> <span style="color: #666666">:=</span> <span style="color: #40a070">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #666666">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span style="color: #06287e">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #007020; font-weight: bold">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #007020; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #06287e">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span style="color: #666666">/</span><span class="nx">r</span><span class="p">)</span><span style="color: #666666">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span style="color: #06287e">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span style="color: #666666">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #06287e">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span style="color: #666666">+</span><span class="nx">r</span><span style="color: #666666">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #06287e">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #666666">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #06287e">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span style="color: #666666">+</span><span class="nx">r</span><span style="color: #666666">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #06287e">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #666666">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #06287e">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span style="color: #666666">+</span><span class="nx">r</span><span style="color: #666666">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #06287e">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #007020; font-weight: bold">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #007020; font-weight: bold">func</span> <span style="color: #06287e">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #902000">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span style="color: #666666">:=</span> <span class="p">(</span><span style="color: #40a070">2</span><span style="color: #666666">*</span><span style="color: #007020">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span style="color: #666666">/</span><span style="color: #007020">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span style="color: #666666">-</span><span style="color: #40a070">1</span><span class="p">)</span><span style="color: #666666">*</span><span class="nx">aspectRatio</span><span style="color: #666666">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #06287e">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #666666">/</span><span style="color: #40a070">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #40a070">1</span><span style="color: #666666">-</span><span style="color: #40a070">2</span><span style="color: #666666">*</span><span style="color: #007020">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span style="color: #666666">/</span><span style="color: #007020">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span style="color: #666666">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #06287e">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #666666">/</span><span style="color: #40a070">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span style="color: #666666">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span style="color: #666666">-</span><span style="color: #40a070">1</span><span class="p">}.</span><span style="color: #06287e">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span style="color: #666666">:=</span> <span style="color: #40a070">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #007020; font-weight: bold">for</span> <span class="nx">i</span> <span style="color: #666666">:=</span> <span style="color: #40a070">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #666666">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span style="color: #666666">:=</span> <span class="nx">direction</span><span class="p">.</span><span style="color: #06287e">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span style="color: #06287e">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span style="color: #40a070">0</span><span class="p">,</span> <span style="color: #40a070">0</span><span class="p">,</span> <span style="color: #40a070">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span style="color: #666666">:=</span> <span style="color: #06287e">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span style="color: #666666">-</span> <span style="color: #40a070">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #007020; font-weight: bold">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span style="color: #40a070">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #007020; font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span style="color: #007020">uint8</span><span class="p">(</span><span style="color: #40a070">255</span> <span style="color: #666666">-</span> <span class="nx">t</span><span style="color: #666666">*</span><span style="color: #40a070">255</span><span style="color: #666666">/</span><span style="color: #40a070">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span style="color: #666666">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #007020; font-weight: bold">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span style="color: #40a070">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #007020; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #007020; font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #007020; font-weight: bold">func</span> <span style="color: #06287e">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span style="color: #666666">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #06287e">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #06287e">Rect</span><span class="p">(</span><span style="color: #40a070">0</span><span class="p">,</span> <span style="color: #40a070">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #007020; font-weight: bold">for</span> <span class="nx">y</span> <span style="color: #666666">:=</span> <span style="color: #40a070">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span style="color: #666666">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span style="color: #06287e">Add</span><span class="p">(</span><span style="color: #40a070">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #007020; font-weight: bold">go</span> <span style="color: #007020; font-weight: bold">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #902000">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #007020; font-weight: bold">defer</span> <span class="nx">wg</span><span class="p">.</span><span style="color: #06287e">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #007020; font-weight: bold">for</span> <span class="nx">x</span> <span style="color: #666666">:=</span> <span style="color: #40a070">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span style="color: #666666">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span style="color: #06287e">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span style="color: #06287e">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span style="color: #06287e">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span style="color: #666666">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #06287e">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #06287e">Rect</span><span class="p">(</span><span style="color: #40a070">0</span><span class="p">,</span> <span style="color: #40a070">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #007020; font-weight: bold">for</span> <span class="nx">y</span> <span style="color: #666666">:=</span> <span style="color: #40a070">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span style="color: #666666">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #007020; font-weight: bold">for</span> <span class="nx">x</span> <span style="color: #666666">:=</span> <span style="color: #40a070">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span style="color: #666666">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span style="color: #666666">:=</span> <span style="color: #40a070">0</span><span class="p">,</span> <span style="color: #40a070">0</span><span class="p">,</span> <span style="color: #40a070">0</span><span class="p">,</span> <span style="color: #40a070">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #007020; font-weight: bold">for</span> <span class="nx">dy</span> <span style="color: #666666">:=</span> <span style="color: #40a070">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span style="color: #666666">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #007020; font-weight: bold">for</span> <span class="nx">dx</span> <span style="color: #666666">:=</span> <span style="color: #40a070">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span style="color: #666666">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span style="color: #666666">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span style="color: #06287e">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span style="color: #666666">*</span><span class="nx">supersamplingRatio</span><span style="color: #666666">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span style="color: #666666">*</span><span class="nx">supersamplingRatio</span><span style="color: #666666">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span style="color: #666666">+=</span> <span style="color: #007020">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span style="color: #666666">+=</span> <span style="color: #007020">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span style="color: #666666">+=</span> <span style="color: #007020">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span style="color: #666666">+=</span> <span style="color: #007020">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span style="color: #666666">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #666666">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span style="color: #666666">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #666666">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span style="color: #666666">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #666666">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span style="color: #666666">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #666666">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span style="color: #06287e">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span style="color: #007020">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span style="color: #007020">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span style="color: #007020">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span style="color: #007020">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span style="color: #666666">:=</span> <span class="nx">os</span><span class="p">.</span><span style="color: #06287e">Create</span><span class="p">(</span><span style="color: #4070a0">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #007020; font-weight: bold">if</span> <span class="nx">err</span> <span style="color: #666666">!=</span> <span style="color: #007020; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #06287e">Println</span><span class="p">(</span><span style="color: #4070a0">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #007020; font-weight: bold">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #007020; font-weight: bold">defer</span> <span class="nx">file</span><span class="p">.</span><span style="color: #06287e">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span style="color: #06287e">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #007020; font-weight: bold">if</span> <span class="nx">err</span> <span style="color: #666666">!=</span> <span style="color: #007020; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #06287e">Println</span><span class="p">(</span><span style="color: #4070a0">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='fruity'><h2><a id='stylelink' href='fruity.html' alt='View only fruity'>fruity</a></h2></a><code><pre style="color: #ffffff; background-color: #111111;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #fb660a; font-weight: bold">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; background-color: #0f140f; font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; background-color: #0f140f; font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; background-color: #0f140f; font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; background-color: #0f140f; font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fb660a; font-weight: bold">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0086d2">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0086d2">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0086d2">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0086d2">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0086d2">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0086d2">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0086d2">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fb660a; font-weight: bold">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span style="color: #0086f7; font-weight: bold">1920</span><span class="p">,</span> <span style="color: #0086f7; font-weight: bold">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span style="color: #0086f7; font-weight: bold">3840</span><span class="p">,</span> <span style="color: #0086f7; font-weight: bold">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span class="nb">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span class="o">/</span> <span style="color: #0086f7; font-weight: bold">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span style="color: #0086f7; font-weight: bold">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span style="color: #0086f7; font-weight: bold">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span style="color: #0086f7; font-weight: bold">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span style="color: #0086f7; font-weight: bold">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fb660a; font-weight: bold">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fb660a; font-weight: bold">type</span> <span class="nx">vec3</span> <span style="color: #fb660a; font-weight: bold">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #cdcaa9; font-weight: bold">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fb660a; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #ff0086; font-weight: bold">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #fb660a; font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fb660a; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #ff0086; font-weight: bold">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #cdcaa9; font-weight: bold">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #fb660a; font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fb660a; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #ff0086; font-weight: bold">length</span><span class="p">()</span> <span style="color: #cdcaa9; font-weight: bold">float64</span>    <span class="p">{</span> <span style="color: #fb660a; font-weight: bold">return</span> <span class="nx">math</span><span class="p">.</span><span style="color: #ff0086; font-weight: bold">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fb660a; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #ff0086; font-weight: bold">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #fb660a; font-weight: bold">return</span> <span class="nx">v</span><span class="p">.</span><span style="color: #ff0086; font-weight: bold">mul</span><span class="p">(</span><span style="color: #0086f7; font-weight: bold">1</span> <span class="o">/</span> <span class="nx">v</span><span class="p">.</span><span style="color: #ff0086; font-weight: bold">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fb660a; font-weight: bold">func</span> <span style="color: #ff0086; font-weight: bold">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #cdcaa9; font-weight: bold">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="o">:=</span> <span class="nx">p</span><span class="p">,</span> <span style="color: #0086f7; font-weight: bold">0.0</span><span class="p">,</span> <span style="color: #0086f7; font-weight: bold">0.0</span><span class="p">,</span> <span style="color: #0086f7; font-weight: bold">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fb660a; font-weight: bold">for</span> <span class="nx">i</span> <span class="o">:=</span> <span style="color: #0086f7; font-weight: bold">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span style="color: #ff0086; font-weight: bold">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #fb660a; font-weight: bold">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #fb660a; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #ff0086; font-weight: bold">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span class="o">/</span><span class="nx">r</span><span class="p">)</span><span class="o">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span style="color: #ff0086; font-weight: bold">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="o">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #ff0086; font-weight: bold">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #ff0086; font-weight: bold">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #ff0086; font-weight: bold">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #ff0086; font-weight: bold">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #ff0086; font-weight: bold">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #ff0086; font-weight: bold">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fb660a; font-weight: bold">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fb660a; font-weight: bold">func</span> <span style="color: #ff0086; font-weight: bold">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #cdcaa9; font-weight: bold">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span class="o">:=</span> <span class="p">(</span><span style="color: #0086f7; font-weight: bold">2</span><span class="o">*</span><span class="nb">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="o">/</span><span class="nb">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span class="o">-</span><span style="color: #0086f7; font-weight: bold">1</span><span class="p">)</span><span class="o">*</span><span class="nx">aspectRatio</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #ff0086; font-weight: bold">Tan</span><span class="p">(</span><span class="nx">fov</span><span class="o">/</span><span style="color: #0086f7; font-weight: bold">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #0086f7; font-weight: bold">1</span><span class="o">-</span><span style="color: #0086f7; font-weight: bold">2</span><span class="o">*</span><span class="nb">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span class="o">/</span><span class="nb">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #ff0086; font-weight: bold">Tan</span><span class="p">(</span><span class="nx">fov</span><span class="o">/</span><span style="color: #0086f7; font-weight: bold">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span class="o">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span class="o">-</span><span style="color: #0086f7; font-weight: bold">1</span><span class="p">}.</span><span style="color: #ff0086; font-weight: bold">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span class="o">:=</span> <span style="color: #0086f7; font-weight: bold">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fb660a; font-weight: bold">for</span> <span class="nx">i</span> <span class="o">:=</span> <span style="color: #0086f7; font-weight: bold">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span class="o">:=</span> <span class="nx">direction</span><span class="p">.</span><span style="color: #ff0086; font-weight: bold">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span style="color: #ff0086; font-weight: bold">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span style="color: #0086f7; font-weight: bold">0</span><span class="p">,</span> <span style="color: #0086f7; font-weight: bold">0</span><span class="p">,</span> <span style="color: #0086f7; font-weight: bold">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span class="o">:=</span> <span style="color: #ff0086; font-weight: bold">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="o">-</span> <span style="color: #0086f7; font-weight: bold">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #fb660a; font-weight: bold">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span style="color: #0086f7; font-weight: bold">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #fb660a; font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span class="nb">uint8</span><span class="p">(</span><span style="color: #0086f7; font-weight: bold">255</span> <span class="o">-</span> <span class="nx">t</span><span class="o">*</span><span style="color: #0086f7; font-weight: bold">255</span><span class="o">/</span><span style="color: #0086f7; font-weight: bold">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span class="o">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #fb660a; font-weight: bold">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span style="color: #0086f7; font-weight: bold">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #fb660a; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fb660a; font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fb660a; font-weight: bold">func</span> <span style="color: #ff0086; font-weight: bold">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #ff0086; font-weight: bold">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #ff0086; font-weight: bold">Rect</span><span class="p">(</span><span style="color: #0086f7; font-weight: bold">0</span><span class="p">,</span> <span style="color: #0086f7; font-weight: bold">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fb660a; font-weight: bold">for</span> <span class="nx">y</span> <span class="o">:=</span> <span style="color: #0086f7; font-weight: bold">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span style="color: #ff0086; font-weight: bold">Add</span><span class="p">(</span><span style="color: #0086f7; font-weight: bold">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #fb660a; font-weight: bold">go</span> <span style="color: #fb660a; font-weight: bold">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #cdcaa9; font-weight: bold">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #fb660a; font-weight: bold">defer</span> <span class="nx">wg</span><span class="p">.</span><span style="color: #ff0086; font-weight: bold">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #fb660a; font-weight: bold">for</span> <span class="nx">x</span> <span class="o">:=</span> <span style="color: #0086f7; font-weight: bold">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span style="color: #ff0086; font-weight: bold">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span style="color: #ff0086; font-weight: bold">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span style="color: #ff0086; font-weight: bold">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #ff0086; font-weight: bold">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #ff0086; font-weight: bold">Rect</span><span class="p">(</span><span style="color: #0086f7; font-weight: bold">0</span><span class="p">,</span> <span style="color: #0086f7; font-weight: bold">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fb660a; font-weight: bold">for</span> <span class="nx">y</span> <span class="o">:=</span> <span style="color: #0086f7; font-weight: bold">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #fb660a; font-weight: bold">for</span> <span class="nx">x</span> <span class="o">:=</span> <span style="color: #0086f7; font-weight: bold">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span class="o">:=</span> <span style="color: #0086f7; font-weight: bold">0</span><span class="p">,</span> <span style="color: #0086f7; font-weight: bold">0</span><span class="p">,</span> <span style="color: #0086f7; font-weight: bold">0</span><span class="p">,</span> <span style="color: #0086f7; font-weight: bold">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #fb660a; font-weight: bold">for</span> <span class="nx">dy</span> <span class="o">:=</span> <span style="color: #0086f7; font-weight: bold">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #fb660a; font-weight: bold">for</span> <span class="nx">dx</span> <span class="o">:=</span> <span style="color: #0086f7; font-weight: bold">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span class="o">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span style="color: #ff0086; font-weight: bold">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span class="o">*</span><span class="nx">supersamplingRatio</span><span class="o">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span class="o">*</span><span class="nx">supersamplingRatio</span><span class="o">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span style="color: #ff0086; font-weight: bold">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span class="nb">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span style="color: #ff0086; font-weight: bold">Create</span><span class="p">(</span><span style="color: #0086d2">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fb660a; font-weight: bold">if</span> <span class="nx">err</span> <span class="o">!=</span> <span style="color: #fb660a; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #ff0086; font-weight: bold">Println</span><span class="p">(</span><span style="color: #0086d2">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #fb660a; font-weight: bold">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fb660a; font-weight: bold">defer</span> <span class="nx">file</span><span class="p">.</span><span style="color: #ff0086; font-weight: bold">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span style="color: #ff0086; font-weight: bold">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fb660a; font-weight: bold">if</span> <span class="nx">err</span> <span class="o">!=</span> <span style="color: #fb660a; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #ff0086; font-weight: bold">Println</span><span class="p">(</span><span style="color: #0086d2">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='github-dark'><h2><a id='stylelink' href='github-dark.html' alt='View only github-dark'>github-dark</a></h2></a><code><pre style="color: #c9d1d9; background-color: #0d1117;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #ff7b72">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8b949e; font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #8b949e; font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #8b949e; font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #8b949e; font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff7b72">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a5d6ff">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a5d6ff">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a5d6ff">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a5d6ff">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a5d6ff">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a5d6ff">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a5d6ff">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff7b72">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span style="color: #a5d6ff">1920</span><span class="p">,</span> <span style="color: #a5d6ff">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span style="color: #a5d6ff">3840</span><span class="p">,</span> <span style="color: #a5d6ff">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span class="nb">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span style="color: #ff7b72; font-weight: bold">/</span> <span class="nb">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span style="color: #ff7b72; font-weight: bold">/</span> <span style="color: #a5d6ff">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span style="color: #a5d6ff">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span style="color: #a5d6ff">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span style="color: #a5d6ff">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span style="color: #a5d6ff">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff7b72">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff7b72">type</span> <span class="nx">vec3</span> <span style="color: #ff7b72">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #ff7b72">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff7b72">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #d2a8ff; font-weight: bold">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #ff7b72">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #ff7b72; font-weight: bold">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #ff7b72; font-weight: bold">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #ff7b72; font-weight: bold">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff7b72">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #d2a8ff; font-weight: bold">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #ff7b72">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #ff7b72">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #ff7b72; font-weight: bold">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #ff7b72; font-weight: bold">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #ff7b72; font-weight: bold">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff7b72">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #d2a8ff; font-weight: bold">length</span><span class="p">()</span> <span style="color: #ff7b72">float64</span>    <span class="p">{</span> <span style="color: #ff7b72">return</span> <span class="nx">math</span><span class="p">.</span><span style="color: #d2a8ff; font-weight: bold">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span style="color: #ff7b72; font-weight: bold">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #ff7b72; font-weight: bold">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span style="color: #ff7b72; font-weight: bold">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #ff7b72; font-weight: bold">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span style="color: #ff7b72; font-weight: bold">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff7b72">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #d2a8ff; font-weight: bold">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #ff7b72">return</span> <span class="nx">v</span><span class="p">.</span><span style="color: #d2a8ff; font-weight: bold">mul</span><span class="p">(</span><span style="color: #a5d6ff">1</span> <span style="color: #ff7b72; font-weight: bold">/</span> <span class="nx">v</span><span class="p">.</span><span style="color: #d2a8ff; font-weight: bold">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff7b72">func</span> <span style="color: #d2a8ff; font-weight: bold">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #ff7b72">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span style="color: #ff7b72; font-weight: bold">:=</span> <span class="nx">p</span><span class="p">,</span> <span style="color: #a5d6ff">0.0</span><span class="p">,</span> <span style="color: #a5d6ff">0.0</span><span class="p">,</span> <span style="color: #a5d6ff">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff7b72">for</span> <span class="nx">i</span> <span style="color: #ff7b72; font-weight: bold">:=</span> <span style="color: #a5d6ff">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #ff7b72; font-weight: bold">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span style="color: #d2a8ff; font-weight: bold">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff7b72">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff7b72">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #d2a8ff; font-weight: bold">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span style="color: #ff7b72; font-weight: bold">/</span><span class="nx">r</span><span class="p">)</span><span style="color: #ff7b72; font-weight: bold">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span style="color: #d2a8ff; font-weight: bold">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span style="color: #ff7b72; font-weight: bold">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #d2a8ff; font-weight: bold">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span style="color: #ff7b72; font-weight: bold">+</span><span class="nx">r</span><span style="color: #ff7b72; font-weight: bold">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #d2a8ff; font-weight: bold">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #ff7b72; font-weight: bold">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #d2a8ff; font-weight: bold">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span style="color: #ff7b72; font-weight: bold">+</span><span class="nx">r</span><span style="color: #ff7b72; font-weight: bold">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #d2a8ff; font-weight: bold">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #ff7b72; font-weight: bold">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #d2a8ff; font-weight: bold">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span style="color: #ff7b72; font-weight: bold">+</span><span class="nx">r</span><span style="color: #ff7b72; font-weight: bold">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #d2a8ff; font-weight: bold">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff7b72">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff7b72">func</span> <span style="color: #d2a8ff; font-weight: bold">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #ff7b72">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span style="color: #ff7b72; font-weight: bold">:=</span> <span class="p">(</span><span style="color: #a5d6ff">2</span><span style="color: #ff7b72; font-weight: bold">*</span><span class="nb">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span style="color: #ff7b72; font-weight: bold">/</span><span class="nb">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span style="color: #ff7b72; font-weight: bold">-</span><span style="color: #a5d6ff">1</span><span class="p">)</span><span style="color: #ff7b72; font-weight: bold">*</span><span class="nx">aspectRatio</span><span style="color: #ff7b72; font-weight: bold">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #d2a8ff; font-weight: bold">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #ff7b72; font-weight: bold">/</span><span style="color: #a5d6ff">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #a5d6ff">1</span><span style="color: #ff7b72; font-weight: bold">-</span><span style="color: #a5d6ff">2</span><span style="color: #ff7b72; font-weight: bold">*</span><span class="nb">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span style="color: #ff7b72; font-weight: bold">/</span><span class="nb">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span style="color: #ff7b72; font-weight: bold">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #d2a8ff; font-weight: bold">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #ff7b72; font-weight: bold">/</span><span style="color: #a5d6ff">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span style="color: #ff7b72; font-weight: bold">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span style="color: #ff7b72; font-weight: bold">-</span><span style="color: #a5d6ff">1</span><span class="p">}.</span><span style="color: #d2a8ff; font-weight: bold">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span style="color: #ff7b72; font-weight: bold">:=</span> <span style="color: #a5d6ff">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff7b72">for</span> <span class="nx">i</span> <span style="color: #ff7b72; font-weight: bold">:=</span> <span style="color: #a5d6ff">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #ff7b72; font-weight: bold">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span style="color: #ff7b72; font-weight: bold">:=</span> <span class="nx">direction</span><span class="p">.</span><span style="color: #d2a8ff; font-weight: bold">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span style="color: #d2a8ff; font-weight: bold">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span style="color: #a5d6ff">0</span><span class="p">,</span> <span style="color: #a5d6ff">0</span><span class="p">,</span> <span style="color: #a5d6ff">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span style="color: #ff7b72; font-weight: bold">:=</span> <span style="color: #d2a8ff; font-weight: bold">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span style="color: #ff7b72; font-weight: bold">-</span> <span style="color: #a5d6ff">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff7b72">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span style="color: #a5d6ff">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff7b72">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span class="nb">uint8</span><span class="p">(</span><span style="color: #a5d6ff">255</span> <span style="color: #ff7b72; font-weight: bold">-</span> <span class="nx">t</span><span style="color: #ff7b72; font-weight: bold">*</span><span style="color: #a5d6ff">255</span><span style="color: #ff7b72; font-weight: bold">/</span><span style="color: #a5d6ff">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span style="color: #ff7b72; font-weight: bold">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff7b72">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span style="color: #a5d6ff">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff7b72">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff7b72">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff7b72">func</span> <span style="color: #d2a8ff; font-weight: bold">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span style="color: #ff7b72; font-weight: bold">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #d2a8ff; font-weight: bold">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #d2a8ff; font-weight: bold">Rect</span><span class="p">(</span><span style="color: #a5d6ff">0</span><span class="p">,</span> <span style="color: #a5d6ff">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff7b72">for</span> <span class="nx">y</span> <span style="color: #ff7b72; font-weight: bold">:=</span> <span style="color: #a5d6ff">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span style="color: #ff7b72; font-weight: bold">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span style="color: #d2a8ff; font-weight: bold">Add</span><span class="p">(</span><span style="color: #a5d6ff">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff7b72">go</span> <span style="color: #ff7b72">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #ff7b72">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff7b72">defer</span> <span class="nx">wg</span><span class="p">.</span><span style="color: #d2a8ff; font-weight: bold">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff7b72">for</span> <span class="nx">x</span> <span style="color: #ff7b72; font-weight: bold">:=</span> <span style="color: #a5d6ff">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span style="color: #ff7b72; font-weight: bold">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span style="color: #d2a8ff; font-weight: bold">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span style="color: #d2a8ff; font-weight: bold">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span style="color: #d2a8ff; font-weight: bold">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span style="color: #ff7b72; font-weight: bold">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #d2a8ff; font-weight: bold">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #d2a8ff; font-weight: bold">Rect</span><span class="p">(</span><span style="color: #a5d6ff">0</span><span class="p">,</span> <span style="color: #a5d6ff">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff7b72">for</span> <span class="nx">y</span> <span style="color: #ff7b72; font-weight: bold">:=</span> <span style="color: #a5d6ff">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span style="color: #ff7b72; font-weight: bold">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff7b72">for</span> <span class="nx">x</span> <span style="color: #ff7b72; font-weight: bold">:=</span> <span style="color: #a5d6ff">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span style="color: #ff7b72; font-weight: bold">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span style="color: #ff7b72; font-weight: bold">:=</span> <span style="color: #a5d6ff">0</span><span class="p">,</span> <span style="color: #a5d6ff">0</span><span class="p">,</span> <span style="color: #a5d6ff">0</span><span class="p">,</span> <span style="color: #a5d6ff">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff7b72">for</span> <span class="nx">dy</span> <span style="color: #ff7b72; font-weight: bold">:=</span> <span style="color: #a5d6ff">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span style="color: #ff7b72; font-weight: bold">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #ff7b72">for</span> <span class="nx">dx</span> <span style="color: #ff7b72; font-weight: bold">:=</span> <span style="color: #a5d6ff">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span style="color: #ff7b72; font-weight: bold">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span style="color: #ff7b72; font-weight: bold">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span style="color: #d2a8ff; font-weight: bold">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span style="color: #ff7b72; font-weight: bold">*</span><span class="nx">supersamplingRatio</span><span style="color: #ff7b72; font-weight: bold">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span style="color: #ff7b72; font-weight: bold">*</span><span class="nx">supersamplingRatio</span><span style="color: #ff7b72; font-weight: bold">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span style="color: #ff7b72; font-weight: bold">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span style="color: #ff7b72; font-weight: bold">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span style="color: #ff7b72; font-weight: bold">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span style="color: #ff7b72; font-weight: bold">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span style="color: #ff7b72; font-weight: bold">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #ff7b72; font-weight: bold">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span style="color: #ff7b72; font-weight: bold">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #ff7b72; font-weight: bold">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span style="color: #ff7b72; font-weight: bold">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #ff7b72; font-weight: bold">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span style="color: #ff7b72; font-weight: bold">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #ff7b72; font-weight: bold">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span style="color: #d2a8ff; font-weight: bold">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span class="nb">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span style="color: #ff7b72; font-weight: bold">:=</span> <span class="nx">os</span><span class="p">.</span><span style="color: #d2a8ff; font-weight: bold">Create</span><span class="p">(</span><span style="color: #a5d6ff">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff7b72">if</span> <span class="nx">err</span> <span style="color: #ff7b72; font-weight: bold">!=</span> <span style="color: #79c0ff">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #d2a8ff; font-weight: bold">Println</span><span class="p">(</span><span style="color: #a5d6ff">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff7b72">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff7b72">defer</span> <span class="nx">file</span><span class="p">.</span><span style="color: #d2a8ff; font-weight: bold">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span style="color: #d2a8ff; font-weight: bold">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff7b72">if</span> <span class="nx">err</span> <span style="color: #ff7b72; font-weight: bold">!=</span> <span style="color: #79c0ff">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #d2a8ff; font-weight: bold">Println</span><span class="p">(</span><span style="color: #a5d6ff">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='github'><h2><a id='stylelink' href='github.html' alt='View only github'>github</a></h2></a><code><pre style="background-color: #ffffff;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #000000; font-weight: bold">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #999988; font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #999988; font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #999988; font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #999988; font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #000000; font-weight: bold">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #dd1144">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #dd1144">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #dd1144">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #dd1144">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #dd1144">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #dd1144">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #dd1144">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #000000; font-weight: bold">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span style="color: #009999">1920</span><span class="p">,</span> <span style="color: #009999">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span style="color: #009999">3840</span><span class="p">,</span> <span style="color: #009999">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span style="color: #0086b3">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span style="color: #000000; font-weight: bold">/</span> <span style="color: #0086b3">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span style="color: #000000; font-weight: bold">/</span> <span style="color: #009999">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span style="color: #009999">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span style="color: #009999">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span style="color: #009999">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span style="color: #009999">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #000000; font-weight: bold">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #000000; font-weight: bold">type</span> <span class="nx">vec3</span> <span style="color: #000000; font-weight: bold">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #445588; font-weight: bold">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #000000; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #990000; font-weight: bold">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #000000; font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #000000; font-weight: bold">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #000000; font-weight: bold">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #000000; font-weight: bold">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #000000; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #990000; font-weight: bold">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #445588; font-weight: bold">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #000000; font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #000000; font-weight: bold">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #000000; font-weight: bold">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #000000; font-weight: bold">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #000000; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #990000; font-weight: bold">length</span><span class="p">()</span> <span style="color: #445588; font-weight: bold">float64</span>    <span class="p">{</span> <span style="color: #000000; font-weight: bold">return</span> <span class="nx">math</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span style="color: #000000; font-weight: bold">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #000000; font-weight: bold">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span style="color: #000000; font-weight: bold">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #000000; font-weight: bold">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span style="color: #000000; font-weight: bold">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #000000; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #990000; font-weight: bold">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #000000; font-weight: bold">return</span> <span class="nx">v</span><span class="p">.</span><span style="color: #990000; font-weight: bold">mul</span><span class="p">(</span><span style="color: #009999">1</span> <span style="color: #000000; font-weight: bold">/</span> <span class="nx">v</span><span class="p">.</span><span style="color: #990000; font-weight: bold">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #000000; font-weight: bold">func</span> <span style="color: #990000; font-weight: bold">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #445588; font-weight: bold">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span style="color: #000000; font-weight: bold">:=</span> <span class="nx">p</span><span class="p">,</span> <span style="color: #009999">0.0</span><span class="p">,</span> <span style="color: #009999">0.0</span><span class="p">,</span> <span style="color: #009999">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000; font-weight: bold">for</span> <span class="nx">i</span> <span style="color: #000000; font-weight: bold">:=</span> <span style="color: #009999">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #000000; font-weight: bold">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span style="color: #990000; font-weight: bold">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000; font-weight: bold">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000000; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span style="color: #000000; font-weight: bold">/</span><span class="nx">r</span><span class="p">)</span><span style="color: #000000; font-weight: bold">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span style="color: #000000; font-weight: bold">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span style="color: #000000; font-weight: bold">+</span><span class="nx">r</span><span style="color: #000000; font-weight: bold">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #000000; font-weight: bold">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span style="color: #000000; font-weight: bold">+</span><span class="nx">r</span><span style="color: #000000; font-weight: bold">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #000000; font-weight: bold">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span style="color: #000000; font-weight: bold">+</span><span class="nx">r</span><span style="color: #000000; font-weight: bold">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000; font-weight: bold">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #000000; font-weight: bold">func</span> <span style="color: #990000; font-weight: bold">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #445588; font-weight: bold">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span style="color: #000000; font-weight: bold">:=</span> <span class="p">(</span><span style="color: #009999">2</span><span style="color: #000000; font-weight: bold">*</span><span style="color: #0086b3">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span style="color: #000000; font-weight: bold">/</span><span style="color: #0086b3">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span style="color: #000000; font-weight: bold">-</span><span style="color: #009999">1</span><span class="p">)</span><span style="color: #000000; font-weight: bold">*</span><span class="nx">aspectRatio</span><span style="color: #000000; font-weight: bold">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #000000; font-weight: bold">/</span><span style="color: #009999">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #009999">1</span><span style="color: #000000; font-weight: bold">-</span><span style="color: #009999">2</span><span style="color: #000000; font-weight: bold">*</span><span style="color: #0086b3">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span style="color: #000000; font-weight: bold">/</span><span style="color: #0086b3">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span style="color: #000000; font-weight: bold">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #000000; font-weight: bold">/</span><span style="color: #009999">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span style="color: #000000; font-weight: bold">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span style="color: #000000; font-weight: bold">-</span><span style="color: #009999">1</span><span class="p">}.</span><span style="color: #990000; font-weight: bold">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span style="color: #000000; font-weight: bold">:=</span> <span style="color: #009999">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000; font-weight: bold">for</span> <span class="nx">i</span> <span style="color: #000000; font-weight: bold">:=</span> <span style="color: #009999">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #000000; font-weight: bold">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span style="color: #000000; font-weight: bold">:=</span> <span class="nx">direction</span><span class="p">.</span><span style="color: #990000; font-weight: bold">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span style="color: #990000; font-weight: bold">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span style="color: #009999">0</span><span class="p">,</span> <span style="color: #009999">0</span><span class="p">,</span> <span style="color: #009999">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span style="color: #000000; font-weight: bold">:=</span> <span style="color: #990000; font-weight: bold">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span style="color: #000000; font-weight: bold">-</span> <span style="color: #009999">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000; font-weight: bold">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span style="color: #009999">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000000; font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span style="color: #0086b3">uint8</span><span class="p">(</span><span style="color: #009999">255</span> <span style="color: #000000; font-weight: bold">-</span> <span class="nx">t</span><span style="color: #000000; font-weight: bold">*</span><span style="color: #009999">255</span><span style="color: #000000; font-weight: bold">/</span><span style="color: #009999">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span style="color: #000000; font-weight: bold">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000; font-weight: bold">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span style="color: #009999">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000000; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000; font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #000000; font-weight: bold">func</span> <span style="color: #990000; font-weight: bold">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span style="color: #000000; font-weight: bold">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #990000; font-weight: bold">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Rect</span><span class="p">(</span><span style="color: #009999">0</span><span class="p">,</span> <span style="color: #009999">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000; font-weight: bold">for</span> <span class="nx">y</span> <span style="color: #000000; font-weight: bold">:=</span> <span style="color: #009999">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span style="color: #000000; font-weight: bold">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Add</span><span class="p">(</span><span style="color: #009999">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000; font-weight: bold">go</span> <span style="color: #000000; font-weight: bold">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #445588; font-weight: bold">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000000; font-weight: bold">defer</span> <span class="nx">wg</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000000; font-weight: bold">for</span> <span class="nx">x</span> <span style="color: #000000; font-weight: bold">:=</span> <span style="color: #009999">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span style="color: #000000; font-weight: bold">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span style="color: #990000; font-weight: bold">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span style="color: #000000; font-weight: bold">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #990000; font-weight: bold">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Rect</span><span class="p">(</span><span style="color: #009999">0</span><span class="p">,</span> <span style="color: #009999">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000; font-weight: bold">for</span> <span class="nx">y</span> <span style="color: #000000; font-weight: bold">:=</span> <span style="color: #009999">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span style="color: #000000; font-weight: bold">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000; font-weight: bold">for</span> <span class="nx">x</span> <span style="color: #000000; font-weight: bold">:=</span> <span style="color: #009999">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span style="color: #000000; font-weight: bold">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span style="color: #000000; font-weight: bold">:=</span> <span style="color: #009999">0</span><span class="p">,</span> <span style="color: #009999">0</span><span class="p">,</span> <span style="color: #009999">0</span><span class="p">,</span> <span style="color: #009999">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000000; font-weight: bold">for</span> <span class="nx">dy</span> <span style="color: #000000; font-weight: bold">:=</span> <span style="color: #009999">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span style="color: #000000; font-weight: bold">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #000000; font-weight: bold">for</span> <span class="nx">dx</span> <span style="color: #000000; font-weight: bold">:=</span> <span style="color: #009999">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span style="color: #000000; font-weight: bold">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span style="color: #000000; font-weight: bold">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span style="color: #990000; font-weight: bold">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span style="color: #000000; font-weight: bold">*</span><span class="nx">supersamplingRatio</span><span style="color: #000000; font-weight: bold">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span style="color: #000000; font-weight: bold">*</span><span class="nx">supersamplingRatio</span><span style="color: #000000; font-weight: bold">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span style="color: #000000; font-weight: bold">+=</span> <span style="color: #0086b3">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span style="color: #000000; font-weight: bold">+=</span> <span style="color: #0086b3">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span style="color: #000000; font-weight: bold">+=</span> <span style="color: #0086b3">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span style="color: #000000; font-weight: bold">+=</span> <span style="color: #0086b3">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span style="color: #000000; font-weight: bold">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #000000; font-weight: bold">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span style="color: #000000; font-weight: bold">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #000000; font-weight: bold">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span style="color: #000000; font-weight: bold">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #000000; font-weight: bold">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span style="color: #000000; font-weight: bold">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #000000; font-weight: bold">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span style="color: #0086b3">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span style="color: #0086b3">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span style="color: #0086b3">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span style="color: #0086b3">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span style="color: #000000; font-weight: bold">:=</span> <span class="nx">os</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Create</span><span class="p">(</span><span style="color: #dd1144">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000; font-weight: bold">if</span> <span class="nx">err</span> <span style="color: #000000; font-weight: bold">!=</span> <span style="color: #000000; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Println</span><span class="p">(</span><span style="color: #dd1144">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000; font-weight: bold">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000; font-weight: bold">defer</span> <span class="nx">file</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000; font-weight: bold">if</span> <span class="nx">err</span> <span style="color: #000000; font-weight: bold">!=</span> <span style="color: #000000; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Println</span><span class="p">(</span><span style="color: #dd1144">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='gruvbox-light'><h2><a id='stylelink' href='gruvbox-light.html' alt='View only gruvbox-light'>gruvbox-light</a></h2></a><code><pre style="color: #3c3836; background-color: #fbf1c7;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #af3a03">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #928374; font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #928374; font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #928374; font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #928374; font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #af3a03">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #79740e">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #79740e">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #79740e">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #79740e">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #79740e">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #79740e">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #79740e">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #af3a03">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span style="color: #8f3f71">1920</span><span class="p">,</span> <span style="color: #8f3f71">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span style="color: #8f3f71">3840</span><span class="p">,</span> <span style="color: #8f3f71">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span style="color: #b57614">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span style="color: #af3a03">/</span> <span style="color: #b57614">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span style="color: #af3a03">/</span> <span style="color: #8f3f71">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span style="color: #8f3f71">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span style="color: #8f3f71">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span style="color: #8f3f71">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span style="color: #8f3f71">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #af3a03">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #af3a03">type</span> <span class="nx">vec3</span> <span style="color: #af3a03">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #b57614">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #af3a03">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #b57614">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #af3a03">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #af3a03">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #af3a03">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #af3a03">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #af3a03">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #b57614">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #b57614">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #af3a03">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #af3a03">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #af3a03">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #af3a03">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #af3a03">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #b57614">length</span><span class="p">()</span> <span style="color: #b57614">float64</span>    <span class="p">{</span> <span style="color: #af3a03">return</span> <span class="nx">math</span><span class="p">.</span><span style="color: #b57614">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span style="color: #af3a03">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #af3a03">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span style="color: #af3a03">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #af3a03">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span style="color: #af3a03">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #af3a03">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #b57614">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #af3a03">return</span> <span class="nx">v</span><span class="p">.</span><span style="color: #b57614">mul</span><span class="p">(</span><span style="color: #8f3f71">1</span> <span style="color: #af3a03">/</span> <span class="nx">v</span><span class="p">.</span><span style="color: #b57614">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #af3a03">func</span> <span style="color: #b57614">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #b57614">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span style="color: #af3a03">:=</span> <span class="nx">p</span><span class="p">,</span> <span style="color: #8f3f71">0.0</span><span class="p">,</span> <span style="color: #8f3f71">0.0</span><span class="p">,</span> <span style="color: #8f3f71">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #af3a03">for</span> <span class="nx">i</span> <span style="color: #af3a03">:=</span> <span style="color: #8f3f71">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #af3a03">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span style="color: #b57614">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #af3a03">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #af3a03">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #b57614">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span style="color: #af3a03">/</span><span class="nx">r</span><span class="p">)</span><span style="color: #af3a03">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span style="color: #b57614">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span style="color: #af3a03">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #b57614">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span style="color: #af3a03">+</span><span class="nx">r</span><span style="color: #af3a03">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #b57614">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #af3a03">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #b57614">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span style="color: #af3a03">+</span><span class="nx">r</span><span style="color: #af3a03">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #b57614">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #af3a03">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #b57614">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span style="color: #af3a03">+</span><span class="nx">r</span><span style="color: #af3a03">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #b57614">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #af3a03">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #af3a03">func</span> <span style="color: #b57614">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #b57614">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span style="color: #af3a03">:=</span> <span class="p">(</span><span style="color: #8f3f71">2</span><span style="color: #af3a03">*</span><span style="color: #b57614">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span style="color: #af3a03">/</span><span style="color: #b57614">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span style="color: #af3a03">-</span><span style="color: #8f3f71">1</span><span class="p">)</span><span style="color: #af3a03">*</span><span class="nx">aspectRatio</span><span style="color: #af3a03">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #b57614">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #af3a03">/</span><span style="color: #8f3f71">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #8f3f71">1</span><span style="color: #af3a03">-</span><span style="color: #8f3f71">2</span><span style="color: #af3a03">*</span><span style="color: #b57614">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span style="color: #af3a03">/</span><span style="color: #b57614">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span style="color: #af3a03">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #b57614">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #af3a03">/</span><span style="color: #8f3f71">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span style="color: #af3a03">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span style="color: #af3a03">-</span><span style="color: #8f3f71">1</span><span class="p">}.</span><span style="color: #b57614">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span style="color: #af3a03">:=</span> <span style="color: #8f3f71">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #af3a03">for</span> <span class="nx">i</span> <span style="color: #af3a03">:=</span> <span style="color: #8f3f71">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #af3a03">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span style="color: #af3a03">:=</span> <span class="nx">direction</span><span class="p">.</span><span style="color: #b57614">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span style="color: #b57614">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span style="color: #8f3f71">0</span><span class="p">,</span> <span style="color: #8f3f71">0</span><span class="p">,</span> <span style="color: #8f3f71">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span style="color: #af3a03">:=</span> <span style="color: #b57614">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span style="color: #af3a03">-</span> <span style="color: #8f3f71">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #af3a03">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span style="color: #8f3f71">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #af3a03">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span style="color: #b57614">uint8</span><span class="p">(</span><span style="color: #8f3f71">255</span> <span style="color: #af3a03">-</span> <span class="nx">t</span><span style="color: #af3a03">*</span><span style="color: #8f3f71">255</span><span style="color: #af3a03">/</span><span style="color: #8f3f71">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span style="color: #af3a03">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #af3a03">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span style="color: #8f3f71">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #af3a03">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #af3a03">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #af3a03">func</span> <span style="color: #b57614">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span style="color: #af3a03">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #b57614">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #b57614">Rect</span><span class="p">(</span><span style="color: #8f3f71">0</span><span class="p">,</span> <span style="color: #8f3f71">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #af3a03">for</span> <span class="nx">y</span> <span style="color: #af3a03">:=</span> <span style="color: #8f3f71">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span style="color: #af3a03">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span style="color: #b57614">Add</span><span class="p">(</span><span style="color: #8f3f71">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #af3a03">go</span> <span style="color: #af3a03">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #b57614">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #af3a03">defer</span> <span class="nx">wg</span><span class="p">.</span><span style="color: #b57614">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #af3a03">for</span> <span class="nx">x</span> <span style="color: #af3a03">:=</span> <span style="color: #8f3f71">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span style="color: #af3a03">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span style="color: #b57614">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span style="color: #b57614">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span style="color: #b57614">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span style="color: #af3a03">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #b57614">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #b57614">Rect</span><span class="p">(</span><span style="color: #8f3f71">0</span><span class="p">,</span> <span style="color: #8f3f71">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #af3a03">for</span> <span class="nx">y</span> <span style="color: #af3a03">:=</span> <span style="color: #8f3f71">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span style="color: #af3a03">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #af3a03">for</span> <span class="nx">x</span> <span style="color: #af3a03">:=</span> <span style="color: #8f3f71">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span style="color: #af3a03">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span style="color: #af3a03">:=</span> <span style="color: #8f3f71">0</span><span class="p">,</span> <span style="color: #8f3f71">0</span><span class="p">,</span> <span style="color: #8f3f71">0</span><span class="p">,</span> <span style="color: #8f3f71">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #af3a03">for</span> <span class="nx">dy</span> <span style="color: #af3a03">:=</span> <span style="color: #8f3f71">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span style="color: #af3a03">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #af3a03">for</span> <span class="nx">dx</span> <span style="color: #af3a03">:=</span> <span style="color: #8f3f71">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span style="color: #af3a03">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span style="color: #af3a03">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span style="color: #b57614">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span style="color: #af3a03">*</span><span class="nx">supersamplingRatio</span><span style="color: #af3a03">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span style="color: #af3a03">*</span><span class="nx">supersamplingRatio</span><span style="color: #af3a03">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span style="color: #af3a03">+=</span> <span style="color: #b57614">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span style="color: #af3a03">+=</span> <span style="color: #b57614">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span style="color: #af3a03">+=</span> <span style="color: #b57614">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span style="color: #af3a03">+=</span> <span style="color: #b57614">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span style="color: #af3a03">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #af3a03">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span style="color: #af3a03">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #af3a03">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span style="color: #af3a03">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #af3a03">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span style="color: #af3a03">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #af3a03">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span style="color: #b57614">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span style="color: #b57614">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span style="color: #b57614">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span style="color: #b57614">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span style="color: #b57614">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span style="color: #af3a03">:=</span> <span class="nx">os</span><span class="p">.</span><span style="color: #b57614">Create</span><span class="p">(</span><span style="color: #79740e">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #af3a03">if</span> <span class="nx">err</span> <span style="color: #af3a03">!=</span> <span style="color: #af3a03">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #b57614">Println</span><span class="p">(</span><span style="color: #79740e">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #af3a03">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #af3a03">defer</span> <span class="nx">file</span><span class="p">.</span><span style="color: #b57614">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span style="color: #b57614">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #af3a03">if</span> <span class="nx">err</span> <span style="color: #af3a03">!=</span> <span style="color: #af3a03">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #b57614">Println</span><span class="p">(</span><span style="color: #79740e">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='gruvbox'><h2><a id='stylelink' href='gruvbox.html' alt='View only gruvbox'>gruvbox</a></h2></a><code><pre style="color: #ebdbb2; background-color: #282828;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #fe8019">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #928374; font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #928374; font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #928374; font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #928374; font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fe8019">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #b8bb26">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #b8bb26">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #b8bb26">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #b8bb26">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #b8bb26">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #b8bb26">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #b8bb26">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fe8019">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span style="color: #d3869b">1920</span><span class="p">,</span> <span style="color: #d3869b">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span style="color: #d3869b">3840</span><span class="p">,</span> <span style="color: #d3869b">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span style="color: #fabd2f">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span style="color: #fe8019">/</span> <span style="color: #fabd2f">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span style="color: #fe8019">/</span> <span style="color: #d3869b">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span style="color: #d3869b">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span style="color: #d3869b">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span style="color: #d3869b">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span style="color: #d3869b">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fe8019">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fe8019">type</span> <span class="nx">vec3</span> <span style="color: #fe8019">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #fabd2f">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fe8019">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #fabd2f">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #fe8019">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #fe8019">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #fe8019">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #fe8019">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fe8019">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #fabd2f">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #fabd2f">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #fe8019">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #fe8019">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #fe8019">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #fe8019">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fe8019">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #fabd2f">length</span><span class="p">()</span> <span style="color: #fabd2f">float64</span>    <span class="p">{</span> <span style="color: #fe8019">return</span> <span class="nx">math</span><span class="p">.</span><span style="color: #fabd2f">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span style="color: #fe8019">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #fe8019">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span style="color: #fe8019">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #fe8019">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span style="color: #fe8019">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fe8019">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #fabd2f">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #fe8019">return</span> <span class="nx">v</span><span class="p">.</span><span style="color: #fabd2f">mul</span><span class="p">(</span><span style="color: #d3869b">1</span> <span style="color: #fe8019">/</span> <span class="nx">v</span><span class="p">.</span><span style="color: #fabd2f">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fe8019">func</span> <span style="color: #fabd2f">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #fabd2f">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span style="color: #fe8019">:=</span> <span class="nx">p</span><span class="p">,</span> <span style="color: #d3869b">0.0</span><span class="p">,</span> <span style="color: #d3869b">0.0</span><span class="p">,</span> <span style="color: #d3869b">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fe8019">for</span> <span class="nx">i</span> <span style="color: #fe8019">:=</span> <span style="color: #d3869b">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #fe8019">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span style="color: #fabd2f">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #fe8019">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #fe8019">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #fabd2f">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span style="color: #fe8019">/</span><span class="nx">r</span><span class="p">)</span><span style="color: #fe8019">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span style="color: #fabd2f">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span style="color: #fe8019">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #fabd2f">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span style="color: #fe8019">+</span><span class="nx">r</span><span style="color: #fe8019">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #fabd2f">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #fe8019">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #fabd2f">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span style="color: #fe8019">+</span><span class="nx">r</span><span style="color: #fe8019">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #fabd2f">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #fe8019">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #fabd2f">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span style="color: #fe8019">+</span><span class="nx">r</span><span style="color: #fe8019">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #fabd2f">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fe8019">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fe8019">func</span> <span style="color: #fabd2f">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #fabd2f">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span style="color: #fe8019">:=</span> <span class="p">(</span><span style="color: #d3869b">2</span><span style="color: #fe8019">*</span><span style="color: #fabd2f">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span style="color: #fe8019">/</span><span style="color: #fabd2f">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span style="color: #fe8019">-</span><span style="color: #d3869b">1</span><span class="p">)</span><span style="color: #fe8019">*</span><span class="nx">aspectRatio</span><span style="color: #fe8019">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #fabd2f">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #fe8019">/</span><span style="color: #d3869b">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #d3869b">1</span><span style="color: #fe8019">-</span><span style="color: #d3869b">2</span><span style="color: #fe8019">*</span><span style="color: #fabd2f">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span style="color: #fe8019">/</span><span style="color: #fabd2f">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span style="color: #fe8019">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #fabd2f">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #fe8019">/</span><span style="color: #d3869b">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span style="color: #fe8019">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span style="color: #fe8019">-</span><span style="color: #d3869b">1</span><span class="p">}.</span><span style="color: #fabd2f">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span style="color: #fe8019">:=</span> <span style="color: #d3869b">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fe8019">for</span> <span class="nx">i</span> <span style="color: #fe8019">:=</span> <span style="color: #d3869b">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #fe8019">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span style="color: #fe8019">:=</span> <span class="nx">direction</span><span class="p">.</span><span style="color: #fabd2f">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span style="color: #fabd2f">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span style="color: #d3869b">0</span><span class="p">,</span> <span style="color: #d3869b">0</span><span class="p">,</span> <span style="color: #d3869b">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span style="color: #fe8019">:=</span> <span style="color: #fabd2f">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span style="color: #fe8019">-</span> <span style="color: #d3869b">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #fe8019">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span style="color: #d3869b">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #fe8019">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span style="color: #fabd2f">uint8</span><span class="p">(</span><span style="color: #d3869b">255</span> <span style="color: #fe8019">-</span> <span class="nx">t</span><span style="color: #fe8019">*</span><span style="color: #d3869b">255</span><span style="color: #fe8019">/</span><span style="color: #d3869b">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span style="color: #fe8019">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #fe8019">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span style="color: #d3869b">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #fe8019">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fe8019">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fe8019">func</span> <span style="color: #fabd2f">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span style="color: #fe8019">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #fabd2f">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #fabd2f">Rect</span><span class="p">(</span><span style="color: #d3869b">0</span><span class="p">,</span> <span style="color: #d3869b">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fe8019">for</span> <span class="nx">y</span> <span style="color: #fe8019">:=</span> <span style="color: #d3869b">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span style="color: #fe8019">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span style="color: #fabd2f">Add</span><span class="p">(</span><span style="color: #d3869b">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #fe8019">go</span> <span style="color: #fe8019">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #fabd2f">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #fe8019">defer</span> <span class="nx">wg</span><span class="p">.</span><span style="color: #fabd2f">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #fe8019">for</span> <span class="nx">x</span> <span style="color: #fe8019">:=</span> <span style="color: #d3869b">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span style="color: #fe8019">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span style="color: #fabd2f">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span style="color: #fabd2f">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span style="color: #fabd2f">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span style="color: #fe8019">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #fabd2f">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #fabd2f">Rect</span><span class="p">(</span><span style="color: #d3869b">0</span><span class="p">,</span> <span style="color: #d3869b">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fe8019">for</span> <span class="nx">y</span> <span style="color: #fe8019">:=</span> <span style="color: #d3869b">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span style="color: #fe8019">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #fe8019">for</span> <span class="nx">x</span> <span style="color: #fe8019">:=</span> <span style="color: #d3869b">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span style="color: #fe8019">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span style="color: #fe8019">:=</span> <span style="color: #d3869b">0</span><span class="p">,</span> <span style="color: #d3869b">0</span><span class="p">,</span> <span style="color: #d3869b">0</span><span class="p">,</span> <span style="color: #d3869b">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #fe8019">for</span> <span class="nx">dy</span> <span style="color: #fe8019">:=</span> <span style="color: #d3869b">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span style="color: #fe8019">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #fe8019">for</span> <span class="nx">dx</span> <span style="color: #fe8019">:=</span> <span style="color: #d3869b">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span style="color: #fe8019">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span style="color: #fe8019">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span style="color: #fabd2f">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span style="color: #fe8019">*</span><span class="nx">supersamplingRatio</span><span style="color: #fe8019">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span style="color: #fe8019">*</span><span class="nx">supersamplingRatio</span><span style="color: #fe8019">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span style="color: #fe8019">+=</span> <span style="color: #fabd2f">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span style="color: #fe8019">+=</span> <span style="color: #fabd2f">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span style="color: #fe8019">+=</span> <span style="color: #fabd2f">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span style="color: #fe8019">+=</span> <span style="color: #fabd2f">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span style="color: #fe8019">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #fe8019">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span style="color: #fe8019">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #fe8019">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span style="color: #fe8019">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #fe8019">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span style="color: #fe8019">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #fe8019">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span style="color: #fabd2f">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span style="color: #fabd2f">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span style="color: #fabd2f">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span style="color: #fabd2f">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span style="color: #fabd2f">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span style="color: #fe8019">:=</span> <span class="nx">os</span><span class="p">.</span><span style="color: #fabd2f">Create</span><span class="p">(</span><span style="color: #b8bb26">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fe8019">if</span> <span class="nx">err</span> <span style="color: #fe8019">!=</span> <span style="color: #fe8019">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #fabd2f">Println</span><span class="p">(</span><span style="color: #b8bb26">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #fe8019">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fe8019">defer</span> <span class="nx">file</span><span class="p">.</span><span style="color: #fabd2f">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span style="color: #fabd2f">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fe8019">if</span> <span class="nx">err</span> <span style="color: #fe8019">!=</span> <span style="color: #fe8019">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #fabd2f">Println</span><span class="p">(</span><span style="color: #b8bb26">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='hr_high_contrast'><h2><a id='stylelink' href='hr_high_contrast.html' alt='View only hr_high_contrast'>hr_high_contrast</a></h2></a><code><pre style="color: #000000;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #467faf">package</span> <span style="color: #ffffff">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #5a8349">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #5a8349"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #5a8349"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #5a8349"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #467faf">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a87662">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a87662">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a87662">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a87662">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a87662">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a87662">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a87662">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #467faf">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ffffff">width</span><span class="p">,</span> <span style="color: #ffffff">height</span>      <span class="p">=</span> <span style="color: #ffffff">1920</span><span class="p">,</span> <span style="color: #ffffff">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ffffff">ssWidth</span><span class="p">,</span> <span style="color: #ffffff">ssHeight</span>  <span class="p">=</span> <span style="color: #ffffff">3840</span><span class="p">,</span> <span style="color: #ffffff">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ffffff">aspectRatio</span>        <span class="p">=</span> <span style="color: #ffffff">float64</span><span class="p">(</span><span style="color: #ffffff">ssWidth</span><span class="p">)</span> <span style="color: #e4e400">/</span> <span style="color: #ffffff">float64</span><span class="p">(</span><span style="color: #ffffff">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ffffff">fov</span>                <span class="p">=</span> <span style="color: #ffffff">math</span><span class="p">.</span><span style="color: #ffffff">Pi</span> <span style="color: #e4e400">/</span> <span style="color: #ffffff">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ffffff">maxIter</span>            <span class="p">=</span> <span style="color: #ffffff">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ffffff">power</span>              <span class="p">=</span> <span style="color: #ffffff">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ffffff">escapeRadius</span>       <span class="p">=</span> <span style="color: #ffffff">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ffffff">supersamplingRatio</span> <span class="p">=</span> <span style="color: #ffffff">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #467faf">var</span> <span style="color: #ffffff">wg</span> <span style="color: #ffffff">sync</span><span class="p">.</span><span style="color: #ffffff">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #467faf">type</span> <span style="color: #ffffff">vec3</span> <span style="color: #467faf">struct</span><span class="p">{</span> <span style="color: #ffffff">x</span><span class="p">,</span> <span style="color: #ffffff">y</span><span class="p">,</span> <span style="color: #ffffff">z</span> <span style="color: #467faf">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #467faf">func</span> <span class="p">(</span><span style="color: #ffffff">v</span> <span style="color: #ffffff">vec3</span><span class="p">)</span> <span style="color: #ffffff">add</span><span class="p">(</span><span style="color: #ffffff">w</span> <span style="color: #ffffff">vec3</span><span class="p">)</span> <span style="color: #ffffff">vec3</span>    <span class="p">{</span> <span style="color: #467faf">return</span> <span style="color: #ffffff">vec3</span><span class="p">{</span><span style="color: #ffffff">v</span><span class="p">.</span><span style="color: #ffffff">x</span> <span style="color: #e4e400">+</span> <span style="color: #ffffff">w</span><span class="p">.</span><span style="color: #ffffff">x</span><span class="p">,</span> <span style="color: #ffffff">v</span><span class="p">.</span><span style="color: #ffffff">y</span> <span style="color: #e4e400">+</span> <span style="color: #ffffff">w</span><span class="p">.</span><span style="color: #ffffff">y</span><span class="p">,</span> <span style="color: #ffffff">v</span><span class="p">.</span><span style="color: #ffffff">z</span> <span style="color: #e4e400">+</span> <span style="color: #ffffff">w</span><span class="p">.</span><span style="color: #ffffff">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #467faf">func</span> <span class="p">(</span><span style="color: #ffffff">v</span> <span style="color: #ffffff">vec3</span><span class="p">)</span> <span style="color: #ffffff">mul</span><span class="p">(</span><span style="color: #ffffff">s</span> <span style="color: #467faf">float64</span><span class="p">)</span> <span style="color: #ffffff">vec3</span> <span class="p">{</span> <span style="color: #467faf">return</span> <span style="color: #ffffff">vec3</span><span class="p">{</span><span style="color: #ffffff">v</span><span class="p">.</span><span style="color: #ffffff">x</span> <span style="color: #e4e400">*</span> <span style="color: #ffffff">s</span><span class="p">,</span> <span style="color: #ffffff">v</span><span class="p">.</span><span style="color: #ffffff">y</span> <span style="color: #e4e400">*</span> <span style="color: #ffffff">s</span><span class="p">,</span> <span style="color: #ffffff">v</span><span class="p">.</span><span style="color: #ffffff">z</span> <span style="color: #e4e400">*</span> <span style="color: #ffffff">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #467faf">func</span> <span class="p">(</span><span style="color: #ffffff">v</span> <span style="color: #ffffff">vec3</span><span class="p">)</span> <span style="color: #ffffff">length</span><span class="p">()</span> <span style="color: #467faf">float64</span>    <span class="p">{</span> <span style="color: #467faf">return</span> <span style="color: #ffffff">math</span><span class="p">.</span><span style="color: #ffffff">Sqrt</span><span class="p">(</span><span style="color: #ffffff">v</span><span class="p">.</span><span style="color: #ffffff">x</span><span style="color: #e4e400">*</span><span style="color: #ffffff">v</span><span class="p">.</span><span style="color: #ffffff">x</span> <span style="color: #e4e400">+</span> <span style="color: #ffffff">v</span><span class="p">.</span><span style="color: #ffffff">y</span><span style="color: #e4e400">*</span><span style="color: #ffffff">v</span><span class="p">.</span><span style="color: #ffffff">y</span> <span style="color: #e4e400">+</span> <span style="color: #ffffff">v</span><span class="p">.</span><span style="color: #ffffff">z</span><span style="color: #e4e400">*</span><span style="color: #ffffff">v</span><span class="p">.</span><span style="color: #ffffff">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #467faf">func</span> <span class="p">(</span><span style="color: #ffffff">v</span> <span style="color: #ffffff">vec3</span><span class="p">)</span> <span style="color: #ffffff">normalize</span><span class="p">()</span> <span style="color: #ffffff">vec3</span>    <span class="p">{</span> <span style="color: #467faf">return</span> <span style="color: #ffffff">v</span><span class="p">.</span><span style="color: #ffffff">mul</span><span class="p">(</span><span style="color: #ffffff">1</span> <span style="color: #e4e400">/</span> <span style="color: #ffffff">v</span><span class="p">.</span><span style="color: #ffffff">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #467faf">func</span> <span style="color: #ffffff">mandelbulb</span><span class="p">(</span><span style="color: #ffffff">p</span> <span style="color: #ffffff">vec3</span><span class="p">)</span> <span style="color: #467faf">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ffffff">z</span><span class="p">,</span> <span style="color: #ffffff">r</span><span class="p">,</span> <span style="color: #ffffff">theta</span><span class="p">,</span> <span style="color: #ffffff">phi</span> <span style="color: #e4e400">:=</span> <span style="color: #ffffff">p</span><span class="p">,</span> <span style="color: #ffffff">0.0</span><span class="p">,</span> <span style="color: #ffffff">0.0</span><span class="p">,</span> <span style="color: #ffffff">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #467faf">for</span> <span style="color: #ffffff">i</span> <span style="color: #e4e400">:=</span> <span style="color: #ffffff">0</span><span class="p">;</span> <span style="color: #ffffff">i</span> <span class="p">&lt;</span> <span style="color: #ffffff">maxIter</span><span class="p">;</span> <span style="color: #ffffff">i</span><span style="color: #e4e400">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ffffff">r</span> <span class="p">=</span> <span style="color: #ffffff">z</span><span class="p">.</span><span style="color: #ffffff">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #467faf">if</span> <span style="color: #ffffff">r</span> <span class="p">&gt;</span> <span style="color: #ffffff">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #467faf">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ffffff">theta</span><span class="p">,</span> <span style="color: #ffffff">phi</span> <span class="p">=</span> <span style="color: #ffffff">math</span><span class="p">.</span><span style="color: #ffffff">Acos</span><span class="p">(</span><span style="color: #ffffff">z</span><span class="p">.</span><span style="color: #ffffff">z</span><span style="color: #e4e400">/</span><span style="color: #ffffff">r</span><span class="p">)</span><span style="color: #e4e400">*</span><span style="color: #ffffff">power</span><span class="p">,</span> <span style="color: #ffffff">math</span><span class="p">.</span><span style="color: #ffffff">Atan2</span><span class="p">(</span><span style="color: #ffffff">z</span><span class="p">.</span><span style="color: #ffffff">y</span><span class="p">,</span> <span style="color: #ffffff">z</span><span class="p">.</span><span style="color: #ffffff">x</span><span class="p">)</span><span style="color: #e4e400">*</span><span style="color: #ffffff">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ffffff">r</span> <span class="p">=</span> <span style="color: #ffffff">math</span><span class="p">.</span><span style="color: #ffffff">Pow</span><span class="p">(</span><span style="color: #ffffff">r</span><span class="p">,</span> <span style="color: #ffffff">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ffffff">z</span><span class="p">.</span><span style="color: #ffffff">x</span><span class="p">,</span> <span style="color: #ffffff">z</span><span class="p">.</span><span style="color: #ffffff">y</span><span class="p">,</span> <span style="color: #ffffff">z</span><span class="p">.</span><span style="color: #ffffff">z</span> <span class="p">=</span> <span style="color: #ffffff">p</span><span class="p">.</span><span style="color: #ffffff">x</span><span style="color: #e4e400">+</span><span style="color: #ffffff">r</span><span style="color: #e4e400">*</span><span style="color: #ffffff">math</span><span class="p">.</span><span style="color: #ffffff">Sin</span><span class="p">(</span><span style="color: #ffffff">theta</span><span class="p">)</span><span style="color: #e4e400">*</span><span style="color: #ffffff">math</span><span class="p">.</span><span style="color: #ffffff">Cos</span><span class="p">(</span><span style="color: #ffffff">phi</span><span class="p">),</span> <span style="color: #ffffff">p</span><span class="p">.</span><span style="color: #ffffff">y</span><span style="color: #e4e400">+</span><span style="color: #ffffff">r</span><span style="color: #e4e400">*</span><span style="color: #ffffff">math</span><span class="p">.</span><span style="color: #ffffff">Sin</span><span class="p">(</span><span style="color: #ffffff">theta</span><span class="p">)</span><span style="color: #e4e400">*</span><span style="color: #ffffff">math</span><span class="p">.</span><span style="color: #ffffff">Sin</span><span class="p">(</span><span style="color: #ffffff">phi</span><span class="p">),</span> <span style="color: #ffffff">p</span><span class="p">.</span><span style="color: #ffffff">z</span><span style="color: #e4e400">+</span><span style="color: #ffffff">r</span><span style="color: #e4e400">*</span><span style="color: #ffffff">math</span><span class="p">.</span><span style="color: #ffffff">Cos</span><span class="p">(</span><span style="color: #ffffff">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #467faf">return</span> <span style="color: #ffffff">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #467faf">func</span> <span style="color: #ffffff">renderPixel</span><span class="p">(</span><span style="color: #ffffff">x</span><span class="p">,</span> <span style="color: #ffffff">y</span> <span style="color: #467faf">int</span><span class="p">)</span> <span style="color: #ffffff">color</span><span class="p">.</span><span style="color: #ffffff">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ffffff">px</span><span class="p">,</span> <span style="color: #ffffff">py</span> <span style="color: #e4e400">:=</span> <span class="p">(</span><span style="color: #ffffff">2</span><span style="color: #e4e400">*</span><span style="color: #ffffff">float64</span><span class="p">(</span><span style="color: #ffffff">x</span><span class="p">)</span><span style="color: #e4e400">/</span><span style="color: #ffffff">float64</span><span class="p">(</span><span style="color: #ffffff">ssWidth</span><span class="p">)</span><span style="color: #e4e400">-</span><span style="color: #ffffff">1</span><span class="p">)</span><span style="color: #e4e400">*</span><span style="color: #ffffff">aspectRatio</span><span style="color: #e4e400">*</span><span style="color: #ffffff">math</span><span class="p">.</span><span style="color: #ffffff">Tan</span><span class="p">(</span><span style="color: #ffffff">fov</span><span style="color: #e4e400">/</span><span style="color: #ffffff">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #ffffff">1</span><span style="color: #e4e400">-</span><span style="color: #ffffff">2</span><span style="color: #e4e400">*</span><span style="color: #ffffff">float64</span><span class="p">(</span><span style="color: #ffffff">y</span><span class="p">)</span><span style="color: #e4e400">/</span><span style="color: #ffffff">float64</span><span class="p">(</span><span style="color: #ffffff">ssHeight</span><span class="p">))</span><span style="color: #e4e400">*</span><span style="color: #ffffff">math</span><span class="p">.</span><span style="color: #ffffff">Tan</span><span class="p">(</span><span style="color: #ffffff">fov</span><span style="color: #e4e400">/</span><span style="color: #ffffff">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ffffff">direction</span> <span style="color: #e4e400">:=</span> <span style="color: #ffffff">vec3</span><span class="p">{</span><span style="color: #ffffff">px</span><span class="p">,</span> <span style="color: #ffffff">py</span><span class="p">,</span> <span style="color: #e4e400">-</span><span style="color: #ffffff">1</span><span class="p">}.</span><span style="color: #ffffff">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ffffff">t</span> <span style="color: #e4e400">:=</span> <span style="color: #ffffff">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #467faf">for</span> <span style="color: #ffffff">i</span> <span style="color: #e4e400">:=</span> <span style="color: #ffffff">0</span><span class="p">;</span> <span style="color: #ffffff">i</span> <span class="p">&lt;</span> <span style="color: #ffffff">maxIter</span><span class="p">;</span> <span style="color: #ffffff">i</span><span style="color: #e4e400">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ffffff">p</span> <span style="color: #e4e400">:=</span> <span style="color: #ffffff">direction</span><span class="p">.</span><span style="color: #ffffff">mul</span><span class="p">(</span><span style="color: #ffffff">t</span><span class="p">).</span><span style="color: #ffffff">add</span><span class="p">(</span><span style="color: #ffffff">vec3</span><span class="p">{</span><span style="color: #ffffff">0</span><span class="p">,</span> <span style="color: #ffffff">0</span><span class="p">,</span> <span style="color: #ffffff">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ffffff">d</span> <span style="color: #e4e400">:=</span> <span style="color: #ffffff">mandelbulb</span><span class="p">(</span><span style="color: #ffffff">p</span><span class="p">)</span> <span style="color: #e4e400">-</span> <span style="color: #ffffff">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #467faf">if</span> <span style="color: #ffffff">d</span> <span class="p">&lt;</span> <span style="color: #ffffff">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #467faf">return</span> <span style="color: #ffffff">color</span><span class="p">.</span><span style="color: #ffffff">Gray</span><span class="p">{</span><span style="color: #ffffff">uint8</span><span class="p">(</span><span style="color: #ffffff">255</span> <span style="color: #e4e400">-</span> <span style="color: #ffffff">t</span><span style="color: #e4e400">*</span><span style="color: #ffffff">255</span><span style="color: #e4e400">/</span><span style="color: #ffffff">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ffffff">t</span> <span style="color: #e4e400">+=</span> <span style="color: #ffffff">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #467faf">if</span> <span style="color: #ffffff">t</span> <span class="p">&gt;</span> <span style="color: #ffffff">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #467faf">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #467faf">return</span> <span style="color: #ffffff">color</span><span class="p">.</span><span style="color: #ffffff">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #467faf">func</span> <span style="color: #ffffff">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ffffff">ssImg</span> <span style="color: #e4e400">:=</span> <span style="color: #ffffff">image</span><span class="p">.</span><span style="color: #ffffff">NewRGBA</span><span class="p">(</span><span style="color: #ffffff">image</span><span class="p">.</span><span style="color: #ffffff">Rect</span><span class="p">(</span><span style="color: #ffffff">0</span><span class="p">,</span> <span style="color: #ffffff">0</span><span class="p">,</span> <span style="color: #ffffff">ssWidth</span><span class="p">,</span> <span style="color: #ffffff">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #467faf">for</span> <span style="color: #ffffff">y</span> <span style="color: #e4e400">:=</span> <span style="color: #ffffff">0</span><span class="p">;</span> <span style="color: #ffffff">y</span> <span class="p">&lt;</span> <span style="color: #ffffff">ssHeight</span><span class="p">;</span> <span style="color: #ffffff">y</span><span style="color: #e4e400">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ffffff">wg</span><span class="p">.</span><span style="color: #ffffff">Add</span><span class="p">(</span><span style="color: #ffffff">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #467faf">go</span> <span style="color: #467faf">func</span><span class="p">(</span><span style="color: #ffffff">y</span> <span style="color: #467faf">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #467faf">defer</span> <span style="color: #ffffff">wg</span><span class="p">.</span><span style="color: #ffffff">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #467faf">for</span> <span style="color: #ffffff">x</span> <span style="color: #e4e400">:=</span> <span style="color: #ffffff">0</span><span class="p">;</span> <span style="color: #ffffff">x</span> <span class="p">&lt;</span> <span style="color: #ffffff">ssWidth</span><span class="p">;</span> <span style="color: #ffffff">x</span><span style="color: #e4e400">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #ffffff">ssImg</span><span class="p">.</span><span style="color: #ffffff">Set</span><span class="p">(</span><span style="color: #ffffff">x</span><span class="p">,</span> <span style="color: #ffffff">y</span><span class="p">,</span> <span style="color: #ffffff">renderPixel</span><span class="p">(</span><span style="color: #ffffff">x</span><span class="p">,</span> <span style="color: #ffffff">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span style="color: #ffffff">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ffffff">wg</span><span class="p">.</span><span style="color: #ffffff">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ffffff">img</span> <span style="color: #e4e400">:=</span> <span style="color: #ffffff">image</span><span class="p">.</span><span style="color: #ffffff">NewRGBA</span><span class="p">(</span><span style="color: #ffffff">image</span><span class="p">.</span><span style="color: #ffffff">Rect</span><span class="p">(</span><span style="color: #ffffff">0</span><span class="p">,</span> <span style="color: #ffffff">0</span><span class="p">,</span> <span style="color: #ffffff">width</span><span class="p">,</span> <span style="color: #ffffff">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #467faf">for</span> <span style="color: #ffffff">y</span> <span style="color: #e4e400">:=</span> <span style="color: #ffffff">0</span><span class="p">;</span> <span style="color: #ffffff">y</span> <span class="p">&lt;</span> <span style="color: #ffffff">height</span><span class="p">;</span> <span style="color: #ffffff">y</span><span style="color: #e4e400">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #467faf">for</span> <span style="color: #ffffff">x</span> <span style="color: #e4e400">:=</span> <span style="color: #ffffff">0</span><span class="p">;</span> <span style="color: #ffffff">x</span> <span class="p">&lt;</span> <span style="color: #ffffff">width</span><span class="p">;</span> <span style="color: #ffffff">x</span><span style="color: #e4e400">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ffffff">r</span><span class="p">,</span> <span style="color: #ffffff">g</span><span class="p">,</span> <span style="color: #ffffff">b</span><span class="p">,</span> <span style="color: #ffffff">a</span> <span style="color: #e4e400">:=</span> <span style="color: #ffffff">0</span><span class="p">,</span> <span style="color: #ffffff">0</span><span class="p">,</span> <span style="color: #ffffff">0</span><span class="p">,</span> <span style="color: #ffffff">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #467faf">for</span> <span style="color: #ffffff">dy</span> <span style="color: #e4e400">:=</span> <span style="color: #ffffff">0</span><span class="p">;</span> <span style="color: #ffffff">dy</span> <span class="p">&lt;</span> <span style="color: #ffffff">supersamplingRatio</span><span class="p">;</span> <span style="color: #ffffff">dy</span><span style="color: #e4e400">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #467faf">for</span> <span style="color: #ffffff">dx</span> <span style="color: #e4e400">:=</span> <span style="color: #ffffff">0</span><span class="p">;</span> <span style="color: #ffffff">dx</span> <span class="p">&lt;</span> <span style="color: #ffffff">supersamplingRatio</span><span class="p">;</span> <span style="color: #ffffff">dx</span><span style="color: #e4e400">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #ffffff">c</span> <span style="color: #e4e400">:=</span> <span style="color: #ffffff">ssImg</span><span class="p">.</span><span style="color: #ffffff">RGBAAt</span><span class="p">(</span><span style="color: #ffffff">x</span><span style="color: #e4e400">*</span><span style="color: #ffffff">supersamplingRatio</span><span style="color: #e4e400">+</span><span style="color: #ffffff">dx</span><span class="p">,</span> <span style="color: #ffffff">y</span><span style="color: #e4e400">*</span><span style="color: #ffffff">supersamplingRatio</span><span style="color: #e4e400">+</span><span style="color: #ffffff">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #ffffff">r</span> <span style="color: #e4e400">+=</span> <span style="color: #ffffff">int</span><span class="p">(</span><span style="color: #ffffff">c</span><span class="p">.</span><span style="color: #ffffff">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #ffffff">g</span> <span style="color: #e4e400">+=</span> <span style="color: #ffffff">int</span><span class="p">(</span><span style="color: #ffffff">c</span><span class="p">.</span><span style="color: #ffffff">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #ffffff">b</span> <span style="color: #e4e400">+=</span> <span style="color: #ffffff">int</span><span class="p">(</span><span style="color: #ffffff">c</span><span class="p">.</span><span style="color: #ffffff">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #ffffff">a</span> <span style="color: #e4e400">+=</span> <span style="color: #ffffff">int</span><span class="p">(</span><span style="color: #ffffff">c</span><span class="p">.</span><span style="color: #ffffff">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ffffff">r</span> <span style="color: #e4e400">/=</span> <span style="color: #ffffff">supersamplingRatio</span> <span style="color: #e4e400">*</span> <span style="color: #ffffff">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ffffff">g</span> <span style="color: #e4e400">/=</span> <span style="color: #ffffff">supersamplingRatio</span> <span style="color: #e4e400">*</span> <span style="color: #ffffff">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ffffff">b</span> <span style="color: #e4e400">/=</span> <span style="color: #ffffff">supersamplingRatio</span> <span style="color: #e4e400">*</span> <span style="color: #ffffff">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ffffff">a</span> <span style="color: #e4e400">/=</span> <span style="color: #ffffff">supersamplingRatio</span> <span style="color: #e4e400">*</span> <span style="color: #ffffff">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ffffff">img</span><span class="p">.</span><span style="color: #ffffff">Set</span><span class="p">(</span><span style="color: #ffffff">x</span><span class="p">,</span> <span style="color: #ffffff">y</span><span class="p">,</span> <span style="color: #ffffff">color</span><span class="p">.</span><span style="color: #ffffff">RGBA</span><span class="p">{</span><span style="color: #ffffff">uint8</span><span class="p">(</span><span style="color: #ffffff">r</span><span class="p">),</span> <span style="color: #ffffff">uint8</span><span class="p">(</span><span style="color: #ffffff">g</span><span class="p">),</span> <span style="color: #ffffff">uint8</span><span class="p">(</span><span style="color: #ffffff">b</span><span class="p">),</span> <span style="color: #ffffff">uint8</span><span class="p">(</span><span style="color: #ffffff">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ffffff">file</span><span class="p">,</span> <span style="color: #ffffff">err</span> <span style="color: #e4e400">:=</span> <span style="color: #ffffff">os</span><span class="p">.</span><span style="color: #ffffff">Create</span><span class="p">(</span><span style="color: #a87662">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #467faf">if</span> <span style="color: #ffffff">err</span> <span style="color: #e4e400">!=</span> <span style="color: #467faf">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ffffff">fmt</span><span class="p">.</span><span style="color: #ffffff">Println</span><span class="p">(</span><span style="color: #a87662">&#34;Error creating file:&#34;</span><span class="p">,</span> <span style="color: #ffffff">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #467faf">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #467faf">defer</span> <span style="color: #ffffff">file</span><span class="p">.</span><span style="color: #ffffff">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ffffff">err</span> <span class="p">=</span> <span style="color: #ffffff">png</span><span class="p">.</span><span style="color: #ffffff">Encode</span><span class="p">(</span><span style="color: #ffffff">file</span><span class="p">,</span> <span style="color: #ffffff">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #467faf">if</span> <span style="color: #ffffff">err</span> <span style="color: #e4e400">!=</span> <span style="color: #467faf">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ffffff">fmt</span><span class="p">.</span><span style="color: #ffffff">Println</span><span class="p">(</span><span style="color: #a87662">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span style="color: #ffffff">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='hrdark'><h2><a id='stylelink' href='hrdark.html' alt='View only hrdark'>hrdark</a></h2></a><code><pre style="color: #1d2432;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #ff636f">package</span> <span style="color: #58a1dd">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #828b96; font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #828b96; font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #828b96; font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #828b96; font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff636f">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6be9d">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6be9d">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6be9d">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6be9d">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6be9d">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6be9d">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6be9d">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff636f">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #58a1dd">width</span><span class="p">,</span> <span style="color: #58a1dd">height</span>      <span class="p">=</span> <span style="color: #a6be9d">1920</span><span class="p">,</span> <span style="color: #a6be9d">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #58a1dd">ssWidth</span><span class="p">,</span> <span style="color: #58a1dd">ssHeight</span>  <span class="p">=</span> <span style="color: #a6be9d">3840</span><span class="p">,</span> <span style="color: #a6be9d">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #58a1dd">aspectRatio</span>        <span class="p">=</span> <span style="color: #58a1dd">float64</span><span class="p">(</span><span style="color: #58a1dd">ssWidth</span><span class="p">)</span> <span style="color: #ff636f">/</span> <span style="color: #58a1dd">float64</span><span class="p">(</span><span style="color: #58a1dd">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #58a1dd">fov</span>                <span class="p">=</span> <span style="color: #58a1dd">math</span><span class="p">.</span><span style="color: #58a1dd">Pi</span> <span style="color: #ff636f">/</span> <span style="color: #a6be9d">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #58a1dd">maxIter</span>            <span class="p">=</span> <span style="color: #a6be9d">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #58a1dd">power</span>              <span class="p">=</span> <span style="color: #a6be9d">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #58a1dd">escapeRadius</span>       <span class="p">=</span> <span style="color: #a6be9d">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #58a1dd">supersamplingRatio</span> <span class="p">=</span> <span style="color: #a6be9d">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff636f">var</span> <span style="color: #58a1dd">wg</span> <span style="color: #58a1dd">sync</span><span class="p">.</span><span style="color: #58a1dd">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff636f">type</span> <span style="color: #58a1dd">vec3</span> <span style="color: #ff636f">struct</span><span class="p">{</span> <span style="color: #58a1dd">x</span><span class="p">,</span> <span style="color: #58a1dd">y</span><span class="p">,</span> <span style="color: #58a1dd">z</span> <span style="color: #ff636f">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff636f">func</span> <span class="p">(</span><span style="color: #58a1dd">v</span> <span style="color: #58a1dd">vec3</span><span class="p">)</span> <span style="color: #58a1dd">add</span><span class="p">(</span><span style="color: #58a1dd">w</span> <span style="color: #58a1dd">vec3</span><span class="p">)</span> <span style="color: #58a1dd">vec3</span>    <span class="p">{</span> <span style="color: #ff636f">return</span> <span style="color: #58a1dd">vec3</span><span class="p">{</span><span style="color: #58a1dd">v</span><span class="p">.</span><span style="color: #58a1dd">x</span> <span style="color: #ff636f">+</span> <span style="color: #58a1dd">w</span><span class="p">.</span><span style="color: #58a1dd">x</span><span class="p">,</span> <span style="color: #58a1dd">v</span><span class="p">.</span><span style="color: #58a1dd">y</span> <span style="color: #ff636f">+</span> <span style="color: #58a1dd">w</span><span class="p">.</span><span style="color: #58a1dd">y</span><span class="p">,</span> <span style="color: #58a1dd">v</span><span class="p">.</span><span style="color: #58a1dd">z</span> <span style="color: #ff636f">+</span> <span style="color: #58a1dd">w</span><span class="p">.</span><span style="color: #58a1dd">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff636f">func</span> <span class="p">(</span><span style="color: #58a1dd">v</span> <span style="color: #58a1dd">vec3</span><span class="p">)</span> <span style="color: #58a1dd">mul</span><span class="p">(</span><span style="color: #58a1dd">s</span> <span style="color: #ff636f">float64</span><span class="p">)</span> <span style="color: #58a1dd">vec3</span> <span class="p">{</span> <span style="color: #ff636f">return</span> <span style="color: #58a1dd">vec3</span><span class="p">{</span><span style="color: #58a1dd">v</span><span class="p">.</span><span style="color: #58a1dd">x</span> <span style="color: #ff636f">*</span> <span style="color: #58a1dd">s</span><span class="p">,</span> <span style="color: #58a1dd">v</span><span class="p">.</span><span style="color: #58a1dd">y</span> <span style="color: #ff636f">*</span> <span style="color: #58a1dd">s</span><span class="p">,</span> <span style="color: #58a1dd">v</span><span class="p">.</span><span style="color: #58a1dd">z</span> <span style="color: #ff636f">*</span> <span style="color: #58a1dd">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff636f">func</span> <span class="p">(</span><span style="color: #58a1dd">v</span> <span style="color: #58a1dd">vec3</span><span class="p">)</span> <span style="color: #58a1dd">length</span><span class="p">()</span> <span style="color: #ff636f">float64</span>    <span class="p">{</span> <span style="color: #ff636f">return</span> <span style="color: #58a1dd">math</span><span class="p">.</span><span style="color: #58a1dd">Sqrt</span><span class="p">(</span><span style="color: #58a1dd">v</span><span class="p">.</span><span style="color: #58a1dd">x</span><span style="color: #ff636f">*</span><span style="color: #58a1dd">v</span><span class="p">.</span><span style="color: #58a1dd">x</span> <span style="color: #ff636f">+</span> <span style="color: #58a1dd">v</span><span class="p">.</span><span style="color: #58a1dd">y</span><span style="color: #ff636f">*</span><span style="color: #58a1dd">v</span><span class="p">.</span><span style="color: #58a1dd">y</span> <span style="color: #ff636f">+</span> <span style="color: #58a1dd">v</span><span class="p">.</span><span style="color: #58a1dd">z</span><span style="color: #ff636f">*</span><span style="color: #58a1dd">v</span><span class="p">.</span><span style="color: #58a1dd">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff636f">func</span> <span class="p">(</span><span style="color: #58a1dd">v</span> <span style="color: #58a1dd">vec3</span><span class="p">)</span> <span style="color: #58a1dd">normalize</span><span class="p">()</span> <span style="color: #58a1dd">vec3</span>    <span class="p">{</span> <span style="color: #ff636f">return</span> <span style="color: #58a1dd">v</span><span class="p">.</span><span style="color: #58a1dd">mul</span><span class="p">(</span><span style="color: #a6be9d">1</span> <span style="color: #ff636f">/</span> <span style="color: #58a1dd">v</span><span class="p">.</span><span style="color: #58a1dd">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff636f">func</span> <span style="color: #58a1dd">mandelbulb</span><span class="p">(</span><span style="color: #58a1dd">p</span> <span style="color: #58a1dd">vec3</span><span class="p">)</span> <span style="color: #ff636f">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #58a1dd">z</span><span class="p">,</span> <span style="color: #58a1dd">r</span><span class="p">,</span> <span style="color: #58a1dd">theta</span><span class="p">,</span> <span style="color: #58a1dd">phi</span> <span style="color: #ff636f">:=</span> <span style="color: #58a1dd">p</span><span class="p">,</span> <span style="color: #a6be9d">0.0</span><span class="p">,</span> <span style="color: #a6be9d">0.0</span><span class="p">,</span> <span style="color: #a6be9d">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff636f">for</span> <span style="color: #58a1dd">i</span> <span style="color: #ff636f">:=</span> <span style="color: #a6be9d">0</span><span class="p">;</span> <span style="color: #58a1dd">i</span> <span class="p">&lt;</span> <span style="color: #58a1dd">maxIter</span><span class="p">;</span> <span style="color: #58a1dd">i</span><span style="color: #ff636f">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #58a1dd">r</span> <span class="p">=</span> <span style="color: #58a1dd">z</span><span class="p">.</span><span style="color: #58a1dd">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff636f">if</span> <span style="color: #58a1dd">r</span> <span class="p">&gt;</span> <span style="color: #58a1dd">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff636f">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #58a1dd">theta</span><span class="p">,</span> <span style="color: #58a1dd">phi</span> <span class="p">=</span> <span style="color: #58a1dd">math</span><span class="p">.</span><span style="color: #58a1dd">Acos</span><span class="p">(</span><span style="color: #58a1dd">z</span><span class="p">.</span><span style="color: #58a1dd">z</span><span style="color: #ff636f">/</span><span style="color: #58a1dd">r</span><span class="p">)</span><span style="color: #ff636f">*</span><span style="color: #58a1dd">power</span><span class="p">,</span> <span style="color: #58a1dd">math</span><span class="p">.</span><span style="color: #58a1dd">Atan2</span><span class="p">(</span><span style="color: #58a1dd">z</span><span class="p">.</span><span style="color: #58a1dd">y</span><span class="p">,</span> <span style="color: #58a1dd">z</span><span class="p">.</span><span style="color: #58a1dd">x</span><span class="p">)</span><span style="color: #ff636f">*</span><span style="color: #58a1dd">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #58a1dd">r</span> <span class="p">=</span> <span style="color: #58a1dd">math</span><span class="p">.</span><span style="color: #58a1dd">Pow</span><span class="p">(</span><span style="color: #58a1dd">r</span><span class="p">,</span> <span style="color: #58a1dd">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #58a1dd">z</span><span class="p">.</span><span style="color: #58a1dd">x</span><span class="p">,</span> <span style="color: #58a1dd">z</span><span class="p">.</span><span style="color: #58a1dd">y</span><span class="p">,</span> <span style="color: #58a1dd">z</span><span class="p">.</span><span style="color: #58a1dd">z</span> <span class="p">=</span> <span style="color: #58a1dd">p</span><span class="p">.</span><span style="color: #58a1dd">x</span><span style="color: #ff636f">+</span><span style="color: #58a1dd">r</span><span style="color: #ff636f">*</span><span style="color: #58a1dd">math</span><span class="p">.</span><span style="color: #58a1dd">Sin</span><span class="p">(</span><span style="color: #58a1dd">theta</span><span class="p">)</span><span style="color: #ff636f">*</span><span style="color: #58a1dd">math</span><span class="p">.</span><span style="color: #58a1dd">Cos</span><span class="p">(</span><span style="color: #58a1dd">phi</span><span class="p">),</span> <span style="color: #58a1dd">p</span><span class="p">.</span><span style="color: #58a1dd">y</span><span style="color: #ff636f">+</span><span style="color: #58a1dd">r</span><span style="color: #ff636f">*</span><span style="color: #58a1dd">math</span><span class="p">.</span><span style="color: #58a1dd">Sin</span><span class="p">(</span><span style="color: #58a1dd">theta</span><span class="p">)</span><span style="color: #ff636f">*</span><span style="color: #58a1dd">math</span><span class="p">.</span><span style="color: #58a1dd">Sin</span><span class="p">(</span><span style="color: #58a1dd">phi</span><span class="p">),</span> <span style="color: #58a1dd">p</span><span class="p">.</span><span style="color: #58a1dd">z</span><span style="color: #ff636f">+</span><span style="color: #58a1dd">r</span><span style="color: #ff636f">*</span><span style="color: #58a1dd">math</span><span class="p">.</span><span style="color: #58a1dd">Cos</span><span class="p">(</span><span style="color: #58a1dd">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff636f">return</span> <span style="color: #58a1dd">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff636f">func</span> <span style="color: #58a1dd">renderPixel</span><span class="p">(</span><span style="color: #58a1dd">x</span><span class="p">,</span> <span style="color: #58a1dd">y</span> <span style="color: #ff636f">int</span><span class="p">)</span> <span style="color: #58a1dd">color</span><span class="p">.</span><span style="color: #58a1dd">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #58a1dd">px</span><span class="p">,</span> <span style="color: #58a1dd">py</span> <span style="color: #ff636f">:=</span> <span class="p">(</span><span style="color: #a6be9d">2</span><span style="color: #ff636f">*</span><span style="color: #58a1dd">float64</span><span class="p">(</span><span style="color: #58a1dd">x</span><span class="p">)</span><span style="color: #ff636f">/</span><span style="color: #58a1dd">float64</span><span class="p">(</span><span style="color: #58a1dd">ssWidth</span><span class="p">)</span><span style="color: #ff636f">-</span><span style="color: #a6be9d">1</span><span class="p">)</span><span style="color: #ff636f">*</span><span style="color: #58a1dd">aspectRatio</span><span style="color: #ff636f">*</span><span style="color: #58a1dd">math</span><span class="p">.</span><span style="color: #58a1dd">Tan</span><span class="p">(</span><span style="color: #58a1dd">fov</span><span style="color: #ff636f">/</span><span style="color: #a6be9d">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #a6be9d">1</span><span style="color: #ff636f">-</span><span style="color: #a6be9d">2</span><span style="color: #ff636f">*</span><span style="color: #58a1dd">float64</span><span class="p">(</span><span style="color: #58a1dd">y</span><span class="p">)</span><span style="color: #ff636f">/</span><span style="color: #58a1dd">float64</span><span class="p">(</span><span style="color: #58a1dd">ssHeight</span><span class="p">))</span><span style="color: #ff636f">*</span><span style="color: #58a1dd">math</span><span class="p">.</span><span style="color: #58a1dd">Tan</span><span class="p">(</span><span style="color: #58a1dd">fov</span><span style="color: #ff636f">/</span><span style="color: #a6be9d">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #58a1dd">direction</span> <span style="color: #ff636f">:=</span> <span style="color: #58a1dd">vec3</span><span class="p">{</span><span style="color: #58a1dd">px</span><span class="p">,</span> <span style="color: #58a1dd">py</span><span class="p">,</span> <span style="color: #ff636f">-</span><span style="color: #a6be9d">1</span><span class="p">}.</span><span style="color: #58a1dd">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #58a1dd">t</span> <span style="color: #ff636f">:=</span> <span style="color: #a6be9d">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff636f">for</span> <span style="color: #58a1dd">i</span> <span style="color: #ff636f">:=</span> <span style="color: #a6be9d">0</span><span class="p">;</span> <span style="color: #58a1dd">i</span> <span class="p">&lt;</span> <span style="color: #58a1dd">maxIter</span><span class="p">;</span> <span style="color: #58a1dd">i</span><span style="color: #ff636f">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #58a1dd">p</span> <span style="color: #ff636f">:=</span> <span style="color: #58a1dd">direction</span><span class="p">.</span><span style="color: #58a1dd">mul</span><span class="p">(</span><span style="color: #58a1dd">t</span><span class="p">).</span><span style="color: #58a1dd">add</span><span class="p">(</span><span style="color: #58a1dd">vec3</span><span class="p">{</span><span style="color: #a6be9d">0</span><span class="p">,</span> <span style="color: #a6be9d">0</span><span class="p">,</span> <span style="color: #a6be9d">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #58a1dd">d</span> <span style="color: #ff636f">:=</span> <span style="color: #58a1dd">mandelbulb</span><span class="p">(</span><span style="color: #58a1dd">p</span><span class="p">)</span> <span style="color: #ff636f">-</span> <span style="color: #a6be9d">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff636f">if</span> <span style="color: #58a1dd">d</span> <span class="p">&lt;</span> <span style="color: #a6be9d">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff636f">return</span> <span style="color: #58a1dd">color</span><span class="p">.</span><span style="color: #58a1dd">Gray</span><span class="p">{</span><span style="color: #58a1dd">uint8</span><span class="p">(</span><span style="color: #a6be9d">255</span> <span style="color: #ff636f">-</span> <span style="color: #58a1dd">t</span><span style="color: #ff636f">*</span><span style="color: #a6be9d">255</span><span style="color: #ff636f">/</span><span style="color: #a6be9d">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #58a1dd">t</span> <span style="color: #ff636f">+=</span> <span style="color: #58a1dd">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff636f">if</span> <span style="color: #58a1dd">t</span> <span class="p">&gt;</span> <span style="color: #a6be9d">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff636f">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff636f">return</span> <span style="color: #58a1dd">color</span><span class="p">.</span><span style="color: #58a1dd">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff636f">func</span> <span style="color: #58a1dd">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #58a1dd">ssImg</span> <span style="color: #ff636f">:=</span> <span style="color: #58a1dd">image</span><span class="p">.</span><span style="color: #58a1dd">NewRGBA</span><span class="p">(</span><span style="color: #58a1dd">image</span><span class="p">.</span><span style="color: #58a1dd">Rect</span><span class="p">(</span><span style="color: #a6be9d">0</span><span class="p">,</span> <span style="color: #a6be9d">0</span><span class="p">,</span> <span style="color: #58a1dd">ssWidth</span><span class="p">,</span> <span style="color: #58a1dd">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff636f">for</span> <span style="color: #58a1dd">y</span> <span style="color: #ff636f">:=</span> <span style="color: #a6be9d">0</span><span class="p">;</span> <span style="color: #58a1dd">y</span> <span class="p">&lt;</span> <span style="color: #58a1dd">ssHeight</span><span class="p">;</span> <span style="color: #58a1dd">y</span><span style="color: #ff636f">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #58a1dd">wg</span><span class="p">.</span><span style="color: #58a1dd">Add</span><span class="p">(</span><span style="color: #a6be9d">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff636f">go</span> <span style="color: #ff636f">func</span><span class="p">(</span><span style="color: #58a1dd">y</span> <span style="color: #ff636f">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff636f">defer</span> <span style="color: #58a1dd">wg</span><span class="p">.</span><span style="color: #58a1dd">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff636f">for</span> <span style="color: #58a1dd">x</span> <span style="color: #ff636f">:=</span> <span style="color: #a6be9d">0</span><span class="p">;</span> <span style="color: #58a1dd">x</span> <span class="p">&lt;</span> <span style="color: #58a1dd">ssWidth</span><span class="p">;</span> <span style="color: #58a1dd">x</span><span style="color: #ff636f">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #58a1dd">ssImg</span><span class="p">.</span><span style="color: #58a1dd">Set</span><span class="p">(</span><span style="color: #58a1dd">x</span><span class="p">,</span> <span style="color: #58a1dd">y</span><span class="p">,</span> <span style="color: #58a1dd">renderPixel</span><span class="p">(</span><span style="color: #58a1dd">x</span><span class="p">,</span> <span style="color: #58a1dd">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span style="color: #58a1dd">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #58a1dd">wg</span><span class="p">.</span><span style="color: #58a1dd">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #58a1dd">img</span> <span style="color: #ff636f">:=</span> <span style="color: #58a1dd">image</span><span class="p">.</span><span style="color: #58a1dd">NewRGBA</span><span class="p">(</span><span style="color: #58a1dd">image</span><span class="p">.</span><span style="color: #58a1dd">Rect</span><span class="p">(</span><span style="color: #a6be9d">0</span><span class="p">,</span> <span style="color: #a6be9d">0</span><span class="p">,</span> <span style="color: #58a1dd">width</span><span class="p">,</span> <span style="color: #58a1dd">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff636f">for</span> <span style="color: #58a1dd">y</span> <span style="color: #ff636f">:=</span> <span style="color: #a6be9d">0</span><span class="p">;</span> <span style="color: #58a1dd">y</span> <span class="p">&lt;</span> <span style="color: #58a1dd">height</span><span class="p">;</span> <span style="color: #58a1dd">y</span><span style="color: #ff636f">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff636f">for</span> <span style="color: #58a1dd">x</span> <span style="color: #ff636f">:=</span> <span style="color: #a6be9d">0</span><span class="p">;</span> <span style="color: #58a1dd">x</span> <span class="p">&lt;</span> <span style="color: #58a1dd">width</span><span class="p">;</span> <span style="color: #58a1dd">x</span><span style="color: #ff636f">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #58a1dd">r</span><span class="p">,</span> <span style="color: #58a1dd">g</span><span class="p">,</span> <span style="color: #58a1dd">b</span><span class="p">,</span> <span style="color: #58a1dd">a</span> <span style="color: #ff636f">:=</span> <span style="color: #a6be9d">0</span><span class="p">,</span> <span style="color: #a6be9d">0</span><span class="p">,</span> <span style="color: #a6be9d">0</span><span class="p">,</span> <span style="color: #a6be9d">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff636f">for</span> <span style="color: #58a1dd">dy</span> <span style="color: #ff636f">:=</span> <span style="color: #a6be9d">0</span><span class="p">;</span> <span style="color: #58a1dd">dy</span> <span class="p">&lt;</span> <span style="color: #58a1dd">supersamplingRatio</span><span class="p">;</span> <span style="color: #58a1dd">dy</span><span style="color: #ff636f">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #ff636f">for</span> <span style="color: #58a1dd">dx</span> <span style="color: #ff636f">:=</span> <span style="color: #a6be9d">0</span><span class="p">;</span> <span style="color: #58a1dd">dx</span> <span class="p">&lt;</span> <span style="color: #58a1dd">supersamplingRatio</span><span class="p">;</span> <span style="color: #58a1dd">dx</span><span style="color: #ff636f">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #58a1dd">c</span> <span style="color: #ff636f">:=</span> <span style="color: #58a1dd">ssImg</span><span class="p">.</span><span style="color: #58a1dd">RGBAAt</span><span class="p">(</span><span style="color: #58a1dd">x</span><span style="color: #ff636f">*</span><span style="color: #58a1dd">supersamplingRatio</span><span style="color: #ff636f">+</span><span style="color: #58a1dd">dx</span><span class="p">,</span> <span style="color: #58a1dd">y</span><span style="color: #ff636f">*</span><span style="color: #58a1dd">supersamplingRatio</span><span style="color: #ff636f">+</span><span style="color: #58a1dd">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #58a1dd">r</span> <span style="color: #ff636f">+=</span> <span style="color: #58a1dd">int</span><span class="p">(</span><span style="color: #58a1dd">c</span><span class="p">.</span><span style="color: #58a1dd">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #58a1dd">g</span> <span style="color: #ff636f">+=</span> <span style="color: #58a1dd">int</span><span class="p">(</span><span style="color: #58a1dd">c</span><span class="p">.</span><span style="color: #58a1dd">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #58a1dd">b</span> <span style="color: #ff636f">+=</span> <span style="color: #58a1dd">int</span><span class="p">(</span><span style="color: #58a1dd">c</span><span class="p">.</span><span style="color: #58a1dd">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #58a1dd">a</span> <span style="color: #ff636f">+=</span> <span style="color: #58a1dd">int</span><span class="p">(</span><span style="color: #58a1dd">c</span><span class="p">.</span><span style="color: #58a1dd">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #58a1dd">r</span> <span style="color: #ff636f">/=</span> <span style="color: #58a1dd">supersamplingRatio</span> <span style="color: #ff636f">*</span> <span style="color: #58a1dd">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #58a1dd">g</span> <span style="color: #ff636f">/=</span> <span style="color: #58a1dd">supersamplingRatio</span> <span style="color: #ff636f">*</span> <span style="color: #58a1dd">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #58a1dd">b</span> <span style="color: #ff636f">/=</span> <span style="color: #58a1dd">supersamplingRatio</span> <span style="color: #ff636f">*</span> <span style="color: #58a1dd">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #58a1dd">a</span> <span style="color: #ff636f">/=</span> <span style="color: #58a1dd">supersamplingRatio</span> <span style="color: #ff636f">*</span> <span style="color: #58a1dd">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #58a1dd">img</span><span class="p">.</span><span style="color: #58a1dd">Set</span><span class="p">(</span><span style="color: #58a1dd">x</span><span class="p">,</span> <span style="color: #58a1dd">y</span><span class="p">,</span> <span style="color: #58a1dd">color</span><span class="p">.</span><span style="color: #58a1dd">RGBA</span><span class="p">{</span><span style="color: #58a1dd">uint8</span><span class="p">(</span><span style="color: #58a1dd">r</span><span class="p">),</span> <span style="color: #58a1dd">uint8</span><span class="p">(</span><span style="color: #58a1dd">g</span><span class="p">),</span> <span style="color: #58a1dd">uint8</span><span class="p">(</span><span style="color: #58a1dd">b</span><span class="p">),</span> <span style="color: #58a1dd">uint8</span><span class="p">(</span><span style="color: #58a1dd">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #58a1dd">file</span><span class="p">,</span> <span style="color: #58a1dd">err</span> <span style="color: #ff636f">:=</span> <span style="color: #58a1dd">os</span><span class="p">.</span><span style="color: #58a1dd">Create</span><span class="p">(</span><span style="color: #a6be9d">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff636f">if</span> <span style="color: #58a1dd">err</span> <span style="color: #ff636f">!=</span> <span style="color: #ff636f">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #58a1dd">fmt</span><span class="p">.</span><span style="color: #58a1dd">Println</span><span class="p">(</span><span style="color: #a6be9d">&#34;Error creating file:&#34;</span><span class="p">,</span> <span style="color: #58a1dd">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff636f">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff636f">defer</span> <span style="color: #58a1dd">file</span><span class="p">.</span><span style="color: #58a1dd">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #58a1dd">err</span> <span class="p">=</span> <span style="color: #58a1dd">png</span><span class="p">.</span><span style="color: #58a1dd">Encode</span><span class="p">(</span><span style="color: #58a1dd">file</span><span class="p">,</span> <span style="color: #58a1dd">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff636f">if</span> <span style="color: #58a1dd">err</span> <span style="color: #ff636f">!=</span> <span style="color: #ff636f">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #58a1dd">fmt</span><span class="p">.</span><span style="color: #58a1dd">Println</span><span class="p">(</span><span style="color: #a6be9d">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span style="color: #58a1dd">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='igor'><h2><a id='stylelink' href='igor.html' alt='View only igor'>igor</a></h2></a><code><pre style="background-color: #ffffff;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #0000ff">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000; font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000; font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000; font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000; font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #009c00">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #009c00">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #009c00">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #009c00">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #009c00">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #009c00">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #009c00">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span class="mi">1920</span><span class="p">,</span> <span class="mi">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span class="mi">3840</span><span class="p">,</span> <span class="mi">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span class="nb">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span class="o">/</span> <span class="mi">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span class="mi">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span class="mi">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span class="mf">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span class="mi">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">type</span> <span class="nx">vec3</span> <span style="color: #0000ff">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #0000ff">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #c34e00">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #0000ff">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #c34e00">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #0000ff">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #0000ff">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #c34e00">length</span><span class="p">()</span> <span style="color: #0000ff">float64</span>    <span class="p">{</span> <span style="color: #0000ff">return</span> <span class="nx">math</span><span class="p">.</span><span style="color: #c34e00">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #c34e00">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #0000ff">return</span> <span class="nx">v</span><span class="p">.</span><span style="color: #c34e00">mul</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="nx">v</span><span class="p">.</span><span style="color: #c34e00">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">func</span> <span style="color: #c34e00">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #0000ff">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="o">:=</span> <span class="nx">p</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span style="color: #c34e00">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000ff">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #0000ff">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #c34e00">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span class="o">/</span><span class="nx">r</span><span class="p">)</span><span class="o">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span style="color: #c34e00">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="o">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #c34e00">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #c34e00">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #c34e00">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #c34e00">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #c34e00">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #c34e00">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">func</span> <span style="color: #c34e00">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #0000ff">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span class="o">:=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nb">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="o">/</span><span class="nb">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nx">aspectRatio</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #c34e00">Tan</span><span class="p">(</span><span class="nx">fov</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="nb">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span class="o">/</span><span class="nb">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #c34e00">Tan</span><span class="p">(</span><span class="nx">fov</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span class="o">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">}.</span><span style="color: #c34e00">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span class="o">:=</span> <span class="mf">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span class="o">:=</span> <span class="nx">direction</span><span class="p">.</span><span style="color: #c34e00">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span style="color: #c34e00">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span class="o">:=</span> <span style="color: #c34e00">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000ff">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span class="mf">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #0000ff">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span class="nb">uint8</span><span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">t</span><span class="o">*</span><span class="mi">255</span><span class="o">/</span><span class="mi">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span class="o">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000ff">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span class="mi">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #0000ff">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">func</span> <span style="color: #c34e00">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #c34e00">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #c34e00">Rect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">for</span> <span class="nx">y</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span style="color: #c34e00">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000ff">go</span> <span style="color: #0000ff">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #0000ff">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #0000ff">defer</span> <span class="nx">wg</span><span class="p">.</span><span style="color: #c34e00">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #0000ff">for</span> <span class="nx">x</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span style="color: #c34e00">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span style="color: #c34e00">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span style="color: #c34e00">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #c34e00">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #c34e00">Rect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">for</span> <span class="nx">y</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000ff">for</span> <span class="nx">x</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #0000ff">for</span> <span class="nx">dy</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #0000ff">for</span> <span class="nx">dx</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span class="o">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span style="color: #c34e00">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span class="o">*</span><span class="nx">supersamplingRatio</span><span class="o">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span class="o">*</span><span class="nx">supersamplingRatio</span><span class="o">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span style="color: #c34e00">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span class="nb">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span style="color: #c34e00">Create</span><span class="p">(</span><span style="color: #009c00">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">if</span> <span class="nx">err</span> <span class="o">!=</span> <span style="color: #0000ff">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #c34e00">Println</span><span class="p">(</span><span style="color: #009c00">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000ff">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">defer</span> <span class="nx">file</span><span class="p">.</span><span style="color: #c34e00">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span style="color: #c34e00">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">if</span> <span class="nx">err</span> <span class="o">!=</span> <span style="color: #0000ff">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #c34e00">Println</span><span class="p">(</span><span style="color: #009c00">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='lovelace'><h2><a id='stylelink' href='lovelace.html' alt='View only lovelace'>lovelace</a></h2></a><code><pre style="background-color: #ffffff;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #2838b0">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #888888; font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #888888; font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #888888; font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #888888; font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #2838b0">import</span> <span style="color: #888888">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #b83838">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #b83838">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #b83838">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #b83838">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #b83838">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #b83838">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #b83838">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #888888">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #2838b0; font-style: italic">const</span> <span style="color: #888888">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span style="color: #888888">,</span> <span class="nx">height</span>      <span style="color: #888888">=</span> <span style="color: #444444">1920</span><span style="color: #888888">,</span> <span style="color: #444444">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span style="color: #888888">,</span> <span class="nx">ssHeight</span>  <span style="color: #888888">=</span> <span style="color: #444444">3840</span><span style="color: #888888">,</span> <span style="color: #444444">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span style="color: #888888">=</span> <span style="color: #388038">float64</span><span style="color: #888888">(</span><span class="nx">ssWidth</span><span style="color: #888888">)</span> <span style="color: #666666">/</span> <span style="color: #388038">float64</span><span style="color: #888888">(</span><span class="nx">ssHeight</span><span style="color: #888888">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span style="color: #888888">=</span> <span class="nx">math</span><span style="color: #888888">.</span><span class="nx">Pi</span> <span style="color: #666666">/</span> <span style="color: #444444">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span style="color: #888888">=</span> <span style="color: #444444">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span style="color: #888888">=</span> <span style="color: #444444">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span style="color: #888888">=</span> <span style="color: #444444">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span style="color: #888888">=</span> <span style="color: #444444">2</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #888888">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #2838b0; font-style: italic">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span style="color: #888888">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #2838b0; font-style: italic">type</span> <span class="nx">vec3</span> <span style="color: #2838b0; font-style: italic">struct</span><span style="color: #888888">{</span> <span class="nx">x</span><span style="color: #888888">,</span> <span class="nx">y</span><span style="color: #888888">,</span> <span class="nx">z</span> <span style="color: #2838b0; font-style: italic">float64</span> <span style="color: #888888">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #2838b0; font-style: italic">func</span> <span style="color: #888888">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #888888">)</span> <span style="color: #785840">add</span><span style="color: #888888">(</span><span class="nx">w</span> <span class="nx">vec3</span><span style="color: #888888">)</span> <span class="nx">vec3</span>    <span style="color: #888888">{</span> <span style="color: #2838b0">return</span> <span class="nx">vec3</span><span style="color: #888888">{</span><span class="nx">v</span><span style="color: #888888">.</span><span class="nx">x</span> <span style="color: #666666">+</span> <span class="nx">w</span><span style="color: #888888">.</span><span class="nx">x</span><span style="color: #888888">,</span> <span class="nx">v</span><span style="color: #888888">.</span><span class="nx">y</span> <span style="color: #666666">+</span> <span class="nx">w</span><span style="color: #888888">.</span><span class="nx">y</span><span style="color: #888888">,</span> <span class="nx">v</span><span style="color: #888888">.</span><span class="nx">z</span> <span style="color: #666666">+</span> <span class="nx">w</span><span style="color: #888888">.</span><span class="nx">z</span><span style="color: #888888">}</span> <span style="color: #888888">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #2838b0; font-style: italic">func</span> <span style="color: #888888">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #888888">)</span> <span style="color: #785840">mul</span><span style="color: #888888">(</span><span class="nx">s</span> <span style="color: #2838b0; font-style: italic">float64</span><span style="color: #888888">)</span> <span class="nx">vec3</span> <span style="color: #888888">{</span> <span style="color: #2838b0">return</span> <span class="nx">vec3</span><span style="color: #888888">{</span><span class="nx">v</span><span style="color: #888888">.</span><span class="nx">x</span> <span style="color: #666666">*</span> <span class="nx">s</span><span style="color: #888888">,</span> <span class="nx">v</span><span style="color: #888888">.</span><span class="nx">y</span> <span style="color: #666666">*</span> <span class="nx">s</span><span style="color: #888888">,</span> <span class="nx">v</span><span style="color: #888888">.</span><span class="nx">z</span> <span style="color: #666666">*</span> <span class="nx">s</span><span style="color: #888888">}</span> <span style="color: #888888">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #2838b0; font-style: italic">func</span> <span style="color: #888888">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #888888">)</span> <span style="color: #785840">length</span><span style="color: #888888">()</span> <span style="color: #2838b0; font-style: italic">float64</span>    <span style="color: #888888">{</span> <span style="color: #2838b0">return</span> <span class="nx">math</span><span style="color: #888888">.</span><span style="color: #785840">Sqrt</span><span style="color: #888888">(</span><span class="nx">v</span><span style="color: #888888">.</span><span class="nx">x</span><span style="color: #666666">*</span><span class="nx">v</span><span style="color: #888888">.</span><span class="nx">x</span> <span style="color: #666666">+</span> <span class="nx">v</span><span style="color: #888888">.</span><span class="nx">y</span><span style="color: #666666">*</span><span class="nx">v</span><span style="color: #888888">.</span><span class="nx">y</span> <span style="color: #666666">+</span> <span class="nx">v</span><span style="color: #888888">.</span><span class="nx">z</span><span style="color: #666666">*</span><span class="nx">v</span><span style="color: #888888">.</span><span class="nx">z</span><span style="color: #888888">)</span> <span style="color: #888888">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #2838b0; font-style: italic">func</span> <span style="color: #888888">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #888888">)</span> <span style="color: #785840">normalize</span><span style="color: #888888">()</span> <span class="nx">vec3</span>    <span style="color: #888888">{</span> <span style="color: #2838b0">return</span> <span class="nx">v</span><span style="color: #888888">.</span><span style="color: #785840">mul</span><span style="color: #888888">(</span><span style="color: #444444">1</span> <span style="color: #666666">/</span> <span class="nx">v</span><span style="color: #888888">.</span><span style="color: #785840">length</span><span style="color: #888888">())</span> <span style="color: #888888">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #2838b0; font-style: italic">func</span> <span style="color: #785840">mandelbulb</span><span style="color: #888888">(</span><span class="nx">p</span> <span class="nx">vec3</span><span style="color: #888888">)</span> <span style="color: #2838b0; font-style: italic">float64</span> <span style="color: #888888">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span style="color: #888888">,</span> <span class="nx">r</span><span style="color: #888888">,</span> <span class="nx">theta</span><span style="color: #888888">,</span> <span class="nx">phi</span> <span style="color: #666666">:=</span> <span class="nx">p</span><span style="color: #888888">,</span> <span style="color: #444444">0.0</span><span style="color: #888888">,</span> <span style="color: #444444">0.0</span><span style="color: #888888">,</span> <span style="color: #444444">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2838b0">for</span> <span class="nx">i</span> <span style="color: #666666">:=</span> <span style="color: #444444">0</span><span style="color: #888888">;</span> <span class="nx">i</span> <span style="color: #888888">&lt;</span> <span class="nx">maxIter</span><span style="color: #888888">;</span> <span class="nx">i</span><span style="color: #666666">++</span> <span style="color: #888888">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span style="color: #888888">=</span> <span class="nx">z</span><span style="color: #888888">.</span><span style="color: #785840">length</span><span style="color: #888888">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #2838b0">if</span> <span class="nx">r</span> <span style="color: #888888">&gt;</span> <span class="nx">escapeRadius</span> <span style="color: #888888">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #2838b0">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #888888">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span style="color: #888888">,</span> <span class="nx">phi</span> <span style="color: #888888">=</span> <span class="nx">math</span><span style="color: #888888">.</span><span style="color: #785840">Acos</span><span style="color: #888888">(</span><span class="nx">z</span><span style="color: #888888">.</span><span class="nx">z</span><span style="color: #666666">/</span><span class="nx">r</span><span style="color: #888888">)</span><span style="color: #666666">*</span><span class="nx">power</span><span style="color: #888888">,</span> <span class="nx">math</span><span style="color: #888888">.</span><span style="color: #785840">Atan2</span><span style="color: #888888">(</span><span class="nx">z</span><span style="color: #888888">.</span><span class="nx">y</span><span style="color: #888888">,</span> <span class="nx">z</span><span style="color: #888888">.</span><span class="nx">x</span><span style="color: #888888">)</span><span style="color: #666666">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span style="color: #888888">=</span> <span class="nx">math</span><span style="color: #888888">.</span><span style="color: #785840">Pow</span><span style="color: #888888">(</span><span class="nx">r</span><span style="color: #888888">,</span> <span class="nx">power</span><span style="color: #888888">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span style="color: #888888">.</span><span class="nx">x</span><span style="color: #888888">,</span> <span class="nx">z</span><span style="color: #888888">.</span><span class="nx">y</span><span style="color: #888888">,</span> <span class="nx">z</span><span style="color: #888888">.</span><span class="nx">z</span> <span style="color: #888888">=</span> <span class="nx">p</span><span style="color: #888888">.</span><span class="nx">x</span><span style="color: #666666">+</span><span class="nx">r</span><span style="color: #666666">*</span><span class="nx">math</span><span style="color: #888888">.</span><span style="color: #785840">Sin</span><span style="color: #888888">(</span><span class="nx">theta</span><span style="color: #888888">)</span><span style="color: #666666">*</span><span class="nx">math</span><span style="color: #888888">.</span><span style="color: #785840">Cos</span><span style="color: #888888">(</span><span class="nx">phi</span><span style="color: #888888">),</span> <span class="nx">p</span><span style="color: #888888">.</span><span class="nx">y</span><span style="color: #666666">+</span><span class="nx">r</span><span style="color: #666666">*</span><span class="nx">math</span><span style="color: #888888">.</span><span style="color: #785840">Sin</span><span style="color: #888888">(</span><span class="nx">theta</span><span style="color: #888888">)</span><span style="color: #666666">*</span><span class="nx">math</span><span style="color: #888888">.</span><span style="color: #785840">Sin</span><span style="color: #888888">(</span><span class="nx">phi</span><span style="color: #888888">),</span> <span class="nx">p</span><span style="color: #888888">.</span><span class="nx">z</span><span style="color: #666666">+</span><span class="nx">r</span><span style="color: #666666">*</span><span class="nx">math</span><span style="color: #888888">.</span><span style="color: #785840">Cos</span><span style="color: #888888">(</span><span class="nx">theta</span><span style="color: #888888">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #888888">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2838b0">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #888888">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #2838b0; font-style: italic">func</span> <span style="color: #785840">renderPixel</span><span style="color: #888888">(</span><span class="nx">x</span><span style="color: #888888">,</span> <span class="nx">y</span> <span style="color: #2838b0; font-style: italic">int</span><span style="color: #888888">)</span> <span class="nx">color</span><span style="color: #888888">.</span><span class="nx">Color</span> <span style="color: #888888">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span style="color: #888888">,</span> <span class="nx">py</span> <span style="color: #666666">:=</span> <span style="color: #888888">(</span><span style="color: #444444">2</span><span style="color: #666666">*</span><span style="color: #388038">float64</span><span style="color: #888888">(</span><span class="nx">x</span><span style="color: #888888">)</span><span style="color: #666666">/</span><span style="color: #388038">float64</span><span style="color: #888888">(</span><span class="nx">ssWidth</span><span style="color: #888888">)</span><span style="color: #666666">-</span><span style="color: #444444">1</span><span style="color: #888888">)</span><span style="color: #666666">*</span><span class="nx">aspectRatio</span><span style="color: #666666">*</span><span class="nx">math</span><span style="color: #888888">.</span><span style="color: #785840">Tan</span><span style="color: #888888">(</span><span class="nx">fov</span><span style="color: #666666">/</span><span style="color: #444444">2</span><span style="color: #888888">),</span> <span style="color: #888888">(</span><span style="color: #444444">1</span><span style="color: #666666">-</span><span style="color: #444444">2</span><span style="color: #666666">*</span><span style="color: #388038">float64</span><span style="color: #888888">(</span><span class="nx">y</span><span style="color: #888888">)</span><span style="color: #666666">/</span><span style="color: #388038">float64</span><span style="color: #888888">(</span><span class="nx">ssHeight</span><span style="color: #888888">))</span><span style="color: #666666">*</span><span class="nx">math</span><span style="color: #888888">.</span><span style="color: #785840">Tan</span><span style="color: #888888">(</span><span class="nx">fov</span><span style="color: #666666">/</span><span style="color: #444444">2</span><span style="color: #888888">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span style="color: #666666">:=</span> <span class="nx">vec3</span><span style="color: #888888">{</span><span class="nx">px</span><span style="color: #888888">,</span> <span class="nx">py</span><span style="color: #888888">,</span> <span style="color: #666666">-</span><span style="color: #444444">1</span><span style="color: #888888">}.</span><span style="color: #785840">normalize</span><span style="color: #888888">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span style="color: #666666">:=</span> <span style="color: #444444">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2838b0">for</span> <span class="nx">i</span> <span style="color: #666666">:=</span> <span style="color: #444444">0</span><span style="color: #888888">;</span> <span class="nx">i</span> <span style="color: #888888">&lt;</span> <span class="nx">maxIter</span><span style="color: #888888">;</span> <span class="nx">i</span><span style="color: #666666">++</span> <span style="color: #888888">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span style="color: #666666">:=</span> <span class="nx">direction</span><span style="color: #888888">.</span><span style="color: #785840">mul</span><span style="color: #888888">(</span><span class="nx">t</span><span style="color: #888888">).</span><span style="color: #785840">add</span><span style="color: #888888">(</span><span class="nx">vec3</span><span style="color: #888888">{</span><span style="color: #444444">0</span><span style="color: #888888">,</span> <span style="color: #444444">0</span><span style="color: #888888">,</span> <span style="color: #444444">5</span><span style="color: #888888">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span style="color: #666666">:=</span> <span style="color: #785840">mandelbulb</span><span style="color: #888888">(</span><span class="nx">p</span><span style="color: #888888">)</span> <span style="color: #666666">-</span> <span style="color: #444444">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #2838b0">if</span> <span class="nx">d</span> <span style="color: #888888">&lt;</span> <span style="color: #444444">0.001</span> <span style="color: #888888">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #2838b0">return</span> <span class="nx">color</span><span style="color: #888888">.</span><span class="nx">Gray</span><span style="color: #888888">{</span><span style="color: #388038">uint8</span><span style="color: #888888">(</span><span style="color: #444444">255</span> <span style="color: #666666">-</span> <span class="nx">t</span><span style="color: #666666">*</span><span style="color: #444444">255</span><span style="color: #666666">/</span><span style="color: #444444">100</span><span style="color: #888888">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #888888">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span style="color: #666666">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #2838b0">if</span> <span class="nx">t</span> <span style="color: #888888">&gt;</span> <span style="color: #444444">100</span> <span style="color: #888888">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #2838b0">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #888888">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #888888">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2838b0">return</span> <span class="nx">color</span><span style="color: #888888">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #888888">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #2838b0; font-style: italic">func</span> <span style="color: #785840">main</span><span style="color: #888888">()</span> <span style="color: #888888">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span style="color: #666666">:=</span> <span class="nx">image</span><span style="color: #888888">.</span><span style="color: #785840">NewRGBA</span><span style="color: #888888">(</span><span class="nx">image</span><span style="color: #888888">.</span><span style="color: #785840">Rect</span><span style="color: #888888">(</span><span style="color: #444444">0</span><span style="color: #888888">,</span> <span style="color: #444444">0</span><span style="color: #888888">,</span> <span class="nx">ssWidth</span><span style="color: #888888">,</span> <span class="nx">ssHeight</span><span style="color: #888888">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2838b0">for</span> <span class="nx">y</span> <span style="color: #666666">:=</span> <span style="color: #444444">0</span><span style="color: #888888">;</span> <span class="nx">y</span> <span style="color: #888888">&lt;</span> <span class="nx">ssHeight</span><span style="color: #888888">;</span> <span class="nx">y</span><span style="color: #666666">++</span> <span style="color: #888888">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span style="color: #888888">.</span><span style="color: #785840">Add</span><span style="color: #888888">(</span><span style="color: #444444">1</span><span style="color: #888888">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #2838b0">go</span> <span style="color: #2838b0; font-style: italic">func</span><span style="color: #888888">(</span><span class="nx">y</span> <span style="color: #2838b0; font-style: italic">int</span><span style="color: #888888">)</span> <span style="color: #888888">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #2838b0">defer</span> <span class="nx">wg</span><span style="color: #888888">.</span><span style="color: #785840">Done</span><span style="color: #888888">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #2838b0">for</span> <span class="nx">x</span> <span style="color: #666666">:=</span> <span style="color: #444444">0</span><span style="color: #888888">;</span> <span class="nx">x</span> <span style="color: #888888">&lt;</span> <span class="nx">ssWidth</span><span style="color: #888888">;</span> <span class="nx">x</span><span style="color: #666666">++</span> <span style="color: #888888">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span style="color: #888888">.</span><span style="color: #785840">Set</span><span style="color: #888888">(</span><span class="nx">x</span><span style="color: #888888">,</span> <span class="nx">y</span><span style="color: #888888">,</span> <span style="color: #785840">renderPixel</span><span style="color: #888888">(</span><span class="nx">x</span><span style="color: #888888">,</span> <span class="nx">y</span><span style="color: #888888">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #888888">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #888888">}(</span><span class="nx">y</span><span style="color: #888888">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #888888">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span style="color: #888888">.</span><span style="color: #785840">Wait</span><span style="color: #888888">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span style="color: #666666">:=</span> <span class="nx">image</span><span style="color: #888888">.</span><span style="color: #785840">NewRGBA</span><span style="color: #888888">(</span><span class="nx">image</span><span style="color: #888888">.</span><span style="color: #785840">Rect</span><span style="color: #888888">(</span><span style="color: #444444">0</span><span style="color: #888888">,</span> <span style="color: #444444">0</span><span style="color: #888888">,</span> <span class="nx">width</span><span style="color: #888888">,</span> <span class="nx">height</span><span style="color: #888888">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2838b0">for</span> <span class="nx">y</span> <span style="color: #666666">:=</span> <span style="color: #444444">0</span><span style="color: #888888">;</span> <span class="nx">y</span> <span style="color: #888888">&lt;</span> <span class="nx">height</span><span style="color: #888888">;</span> <span class="nx">y</span><span style="color: #666666">++</span> <span style="color: #888888">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #2838b0">for</span> <span class="nx">x</span> <span style="color: #666666">:=</span> <span style="color: #444444">0</span><span style="color: #888888">;</span> <span class="nx">x</span> <span style="color: #888888">&lt;</span> <span class="nx">width</span><span style="color: #888888">;</span> <span class="nx">x</span><span style="color: #666666">++</span> <span style="color: #888888">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span style="color: #888888">,</span> <span class="nx">g</span><span style="color: #888888">,</span> <span class="nx">b</span><span style="color: #888888">,</span> <span class="nx">a</span> <span style="color: #666666">:=</span> <span style="color: #444444">0</span><span style="color: #888888">,</span> <span style="color: #444444">0</span><span style="color: #888888">,</span> <span style="color: #444444">0</span><span style="color: #888888">,</span> <span style="color: #444444">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #2838b0">for</span> <span class="nx">dy</span> <span style="color: #666666">:=</span> <span style="color: #444444">0</span><span style="color: #888888">;</span> <span class="nx">dy</span> <span style="color: #888888">&lt;</span> <span class="nx">supersamplingRatio</span><span style="color: #888888">;</span> <span class="nx">dy</span><span style="color: #666666">++</span> <span style="color: #888888">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #2838b0">for</span> <span class="nx">dx</span> <span style="color: #666666">:=</span> <span style="color: #444444">0</span><span style="color: #888888">;</span> <span class="nx">dx</span> <span style="color: #888888">&lt;</span> <span class="nx">supersamplingRatio</span><span style="color: #888888">;</span> <span class="nx">dx</span><span style="color: #666666">++</span> <span style="color: #888888">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span style="color: #666666">:=</span> <span class="nx">ssImg</span><span style="color: #888888">.</span><span style="color: #785840">RGBAAt</span><span style="color: #888888">(</span><span class="nx">x</span><span style="color: #666666">*</span><span class="nx">supersamplingRatio</span><span style="color: #666666">+</span><span class="nx">dx</span><span style="color: #888888">,</span> <span class="nx">y</span><span style="color: #666666">*</span><span class="nx">supersamplingRatio</span><span style="color: #666666">+</span><span class="nx">dy</span><span style="color: #888888">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span style="color: #666666">+=</span> <span style="color: #388038">int</span><span style="color: #888888">(</span><span class="nx">c</span><span style="color: #888888">.</span><span class="nx">R</span><span style="color: #888888">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span style="color: #666666">+=</span> <span style="color: #388038">int</span><span style="color: #888888">(</span><span class="nx">c</span><span style="color: #888888">.</span><span class="nx">G</span><span style="color: #888888">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span style="color: #666666">+=</span> <span style="color: #388038">int</span><span style="color: #888888">(</span><span class="nx">c</span><span style="color: #888888">.</span><span class="nx">B</span><span style="color: #888888">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span style="color: #666666">+=</span> <span style="color: #388038">int</span><span style="color: #888888">(</span><span class="nx">c</span><span style="color: #888888">.</span><span class="nx">A</span><span style="color: #888888">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #888888">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #888888">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span style="color: #666666">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #666666">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span style="color: #666666">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #666666">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span style="color: #666666">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #666666">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span style="color: #666666">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #666666">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span style="color: #888888">.</span><span style="color: #785840">Set</span><span style="color: #888888">(</span><span class="nx">x</span><span style="color: #888888">,</span> <span class="nx">y</span><span style="color: #888888">,</span> <span class="nx">color</span><span style="color: #888888">.</span><span class="nx">RGBA</span><span style="color: #888888">{</span><span style="color: #388038">uint8</span><span style="color: #888888">(</span><span class="nx">r</span><span style="color: #888888">),</span> <span style="color: #388038">uint8</span><span style="color: #888888">(</span><span class="nx">g</span><span style="color: #888888">),</span> <span style="color: #388038">uint8</span><span style="color: #888888">(</span><span class="nx">b</span><span style="color: #888888">),</span> <span style="color: #388038">uint8</span><span style="color: #888888">(</span><span class="nx">a</span><span style="color: #888888">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #888888">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #888888">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span style="color: #888888">,</span> <span class="nx">err</span> <span style="color: #666666">:=</span> <span class="nx">os</span><span style="color: #888888">.</span><span style="color: #785840">Create</span><span style="color: #888888">(</span><span style="color: #b83838">&#34;mandelbulb.png&#34;</span><span style="color: #888888">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2838b0">if</span> <span class="nx">err</span> <span style="color: #666666">!=</span> <span style="color: #444444; font-style: italic">nil</span> <span style="color: #888888">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span style="color: #888888">.</span><span style="color: #785840">Println</span><span style="color: #888888">(</span><span style="color: #b83838">&#34;Error creating file:&#34;</span><span style="color: #888888">,</span> <span class="nx">err</span><span style="color: #888888">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #2838b0">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #888888">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2838b0">defer</span> <span class="nx">file</span><span style="color: #888888">.</span><span style="color: #785840">Close</span><span style="color: #888888">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span style="color: #888888">=</span> <span class="nx">png</span><span style="color: #888888">.</span><span style="color: #785840">Encode</span><span style="color: #888888">(</span><span class="nx">file</span><span style="color: #888888">,</span> <span class="nx">img</span><span style="color: #888888">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2838b0">if</span> <span class="nx">err</span> <span style="color: #666666">!=</span> <span style="color: #444444; font-style: italic">nil</span> <span style="color: #888888">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span style="color: #888888">.</span><span style="color: #785840">Println</span><span style="color: #888888">(</span><span style="color: #b83838">&#34;Error encoding image:&#34;</span><span style="color: #888888">,</span> <span class="nx">err</span><span style="color: #888888">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #888888">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #888888">}</span></span></span></code></pre></code><a name='manni'><h2><a id='stylelink' href='manni.html' alt='View only manni'>manni</a></h2></a><code><pre style="background-color: #f0f3f3;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #006699; font-weight: bold">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0099ff; font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #0099ff; font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #0099ff; font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #0099ff; font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #006699; font-weight: bold">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cc3300">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cc3300">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cc3300">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cc3300">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cc3300">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cc3300">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cc3300">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #006699; font-weight: bold">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span style="color: #ff6600">1920</span><span class="p">,</span> <span style="color: #ff6600">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span style="color: #ff6600">3840</span><span class="p">,</span> <span style="color: #ff6600">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span style="color: #336666">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span style="color: #555555">/</span> <span style="color: #336666">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span style="color: #555555">/</span> <span style="color: #ff6600">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span style="color: #ff6600">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span style="color: #ff6600">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span style="color: #ff6600">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span style="color: #ff6600">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #006699; font-weight: bold">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #006699; font-weight: bold">type</span> <span class="nx">vec3</span> <span style="color: #006699; font-weight: bold">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #007788; font-weight: bold">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #006699; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #cc00ff">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #006699; font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #555555">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #555555">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #555555">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #006699; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #cc00ff">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #007788; font-weight: bold">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #006699; font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #555555">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #555555">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #555555">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #006699; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #cc00ff">length</span><span class="p">()</span> <span style="color: #007788; font-weight: bold">float64</span>    <span class="p">{</span> <span style="color: #006699; font-weight: bold">return</span> <span class="nx">math</span><span class="p">.</span><span style="color: #cc00ff">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span style="color: #555555">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #555555">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span style="color: #555555">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #555555">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span style="color: #555555">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #006699; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #cc00ff">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #006699; font-weight: bold">return</span> <span class="nx">v</span><span class="p">.</span><span style="color: #cc00ff">mul</span><span class="p">(</span><span style="color: #ff6600">1</span> <span style="color: #555555">/</span> <span class="nx">v</span><span class="p">.</span><span style="color: #cc00ff">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #006699; font-weight: bold">func</span> <span style="color: #cc00ff">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #007788; font-weight: bold">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span style="color: #555555">:=</span> <span class="nx">p</span><span class="p">,</span> <span style="color: #ff6600">0.0</span><span class="p">,</span> <span style="color: #ff6600">0.0</span><span class="p">,</span> <span style="color: #ff6600">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #006699; font-weight: bold">for</span> <span class="nx">i</span> <span style="color: #555555">:=</span> <span style="color: #ff6600">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #555555">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span style="color: #cc00ff">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #006699; font-weight: bold">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #006699; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #cc00ff">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span style="color: #555555">/</span><span class="nx">r</span><span class="p">)</span><span style="color: #555555">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span style="color: #cc00ff">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span style="color: #555555">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #cc00ff">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span style="color: #555555">+</span><span class="nx">r</span><span style="color: #555555">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #cc00ff">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #555555">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #cc00ff">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span style="color: #555555">+</span><span class="nx">r</span><span style="color: #555555">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #cc00ff">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #555555">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #cc00ff">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span style="color: #555555">+</span><span class="nx">r</span><span style="color: #555555">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #cc00ff">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #006699; font-weight: bold">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #006699; font-weight: bold">func</span> <span style="color: #cc00ff">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #007788; font-weight: bold">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span style="color: #555555">:=</span> <span class="p">(</span><span style="color: #ff6600">2</span><span style="color: #555555">*</span><span style="color: #336666">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span style="color: #555555">/</span><span style="color: #336666">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span style="color: #555555">-</span><span style="color: #ff6600">1</span><span class="p">)</span><span style="color: #555555">*</span><span class="nx">aspectRatio</span><span style="color: #555555">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #cc00ff">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #555555">/</span><span style="color: #ff6600">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #ff6600">1</span><span style="color: #555555">-</span><span style="color: #ff6600">2</span><span style="color: #555555">*</span><span style="color: #336666">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span style="color: #555555">/</span><span style="color: #336666">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span style="color: #555555">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #cc00ff">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #555555">/</span><span style="color: #ff6600">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span style="color: #555555">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span style="color: #555555">-</span><span style="color: #ff6600">1</span><span class="p">}.</span><span style="color: #cc00ff">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span style="color: #555555">:=</span> <span style="color: #ff6600">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #006699; font-weight: bold">for</span> <span class="nx">i</span> <span style="color: #555555">:=</span> <span style="color: #ff6600">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #555555">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span style="color: #555555">:=</span> <span class="nx">direction</span><span class="p">.</span><span style="color: #cc00ff">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span style="color: #cc00ff">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span style="color: #ff6600">0</span><span class="p">,</span> <span style="color: #ff6600">0</span><span class="p">,</span> <span style="color: #ff6600">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span style="color: #555555">:=</span> <span style="color: #cc00ff">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span style="color: #555555">-</span> <span style="color: #ff6600">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #006699; font-weight: bold">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span style="color: #ff6600">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #006699; font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span style="color: #336666">uint8</span><span class="p">(</span><span style="color: #ff6600">255</span> <span style="color: #555555">-</span> <span class="nx">t</span><span style="color: #555555">*</span><span style="color: #ff6600">255</span><span style="color: #555555">/</span><span style="color: #ff6600">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span style="color: #555555">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #006699; font-weight: bold">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span style="color: #ff6600">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #006699; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #006699; font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #006699; font-weight: bold">func</span> <span style="color: #cc00ff">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span style="color: #555555">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #cc00ff">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #cc00ff">Rect</span><span class="p">(</span><span style="color: #ff6600">0</span><span class="p">,</span> <span style="color: #ff6600">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #006699; font-weight: bold">for</span> <span class="nx">y</span> <span style="color: #555555">:=</span> <span style="color: #ff6600">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span style="color: #555555">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span style="color: #cc00ff">Add</span><span class="p">(</span><span style="color: #ff6600">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #006699; font-weight: bold">go</span> <span style="color: #006699; font-weight: bold">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #007788; font-weight: bold">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #006699; font-weight: bold">defer</span> <span class="nx">wg</span><span class="p">.</span><span style="color: #cc00ff">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #006699; font-weight: bold">for</span> <span class="nx">x</span> <span style="color: #555555">:=</span> <span style="color: #ff6600">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span style="color: #555555">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span style="color: #cc00ff">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span style="color: #cc00ff">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span style="color: #cc00ff">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span style="color: #555555">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #cc00ff">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #cc00ff">Rect</span><span class="p">(</span><span style="color: #ff6600">0</span><span class="p">,</span> <span style="color: #ff6600">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #006699; font-weight: bold">for</span> <span class="nx">y</span> <span style="color: #555555">:=</span> <span style="color: #ff6600">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span style="color: #555555">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #006699; font-weight: bold">for</span> <span class="nx">x</span> <span style="color: #555555">:=</span> <span style="color: #ff6600">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span style="color: #555555">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span style="color: #555555">:=</span> <span style="color: #ff6600">0</span><span class="p">,</span> <span style="color: #ff6600">0</span><span class="p">,</span> <span style="color: #ff6600">0</span><span class="p">,</span> <span style="color: #ff6600">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #006699; font-weight: bold">for</span> <span class="nx">dy</span> <span style="color: #555555">:=</span> <span style="color: #ff6600">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span style="color: #555555">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #006699; font-weight: bold">for</span> <span class="nx">dx</span> <span style="color: #555555">:=</span> <span style="color: #ff6600">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span style="color: #555555">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span style="color: #555555">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span style="color: #cc00ff">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span style="color: #555555">*</span><span class="nx">supersamplingRatio</span><span style="color: #555555">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span style="color: #555555">*</span><span class="nx">supersamplingRatio</span><span style="color: #555555">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span style="color: #555555">+=</span> <span style="color: #336666">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span style="color: #555555">+=</span> <span style="color: #336666">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span style="color: #555555">+=</span> <span style="color: #336666">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span style="color: #555555">+=</span> <span style="color: #336666">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span style="color: #555555">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #555555">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span style="color: #555555">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #555555">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span style="color: #555555">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #555555">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span style="color: #555555">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #555555">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span style="color: #cc00ff">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span style="color: #336666">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span style="color: #336666">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span style="color: #336666">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span style="color: #336666">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span style="color: #555555">:=</span> <span class="nx">os</span><span class="p">.</span><span style="color: #cc00ff">Create</span><span class="p">(</span><span style="color: #cc3300">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #006699; font-weight: bold">if</span> <span class="nx">err</span> <span style="color: #555555">!=</span> <span style="color: #006699; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #cc00ff">Println</span><span class="p">(</span><span style="color: #cc3300">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #006699; font-weight: bold">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #006699; font-weight: bold">defer</span> <span class="nx">file</span><span class="p">.</span><span style="color: #cc00ff">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span style="color: #cc00ff">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #006699; font-weight: bold">if</span> <span class="nx">err</span> <span style="color: #555555">!=</span> <span style="color: #006699; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #cc00ff">Println</span><span class="p">(</span><span style="color: #cc3300">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='modus-operandi'><h2><a id='stylelink' href='modus-operandi.html' alt='View only modus-operandi'>modus-operandi</a></h2></a><code><pre style="color: #000000; background-color: #ffffff;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #5317ac">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #505050">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #505050"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #505050"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #505050"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #5317ac">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2544bb">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2544bb">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2544bb">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2544bb">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2544bb">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2544bb">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2544bb">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #5317ac">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span style="color: #0000c0">1920</span><span class="p">,</span> <span style="color: #0000c0">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span style="color: #0000c0">3840</span><span class="p">,</span> <span style="color: #0000c0">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span style="color: #8f0075">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span style="color: #00538b">/</span> <span style="color: #8f0075">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span style="color: #00538b">/</span> <span style="color: #0000c0">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span style="color: #0000c0">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span style="color: #0000c0">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span style="color: #0000c0">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span style="color: #0000c0">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #5317ac">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #5317ac">type</span> <span class="nx">vec3</span> <span style="color: #5317ac">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #005a5f">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #5317ac">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #721045">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #5317ac">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #00538b">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #00538b">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #00538b">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #5317ac">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #721045">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #005a5f">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #5317ac">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #00538b">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #00538b">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #00538b">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #5317ac">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #721045">length</span><span class="p">()</span> <span style="color: #005a5f">float64</span>    <span class="p">{</span> <span style="color: #5317ac">return</span> <span class="nx">math</span><span class="p">.</span><span style="color: #721045">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span style="color: #00538b">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #00538b">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span style="color: #00538b">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #00538b">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span style="color: #00538b">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #5317ac">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #721045">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #5317ac">return</span> <span class="nx">v</span><span class="p">.</span><span style="color: #721045">mul</span><span class="p">(</span><span style="color: #0000c0">1</span> <span style="color: #00538b">/</span> <span class="nx">v</span><span class="p">.</span><span style="color: #721045">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #5317ac">func</span> <span style="color: #721045">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #005a5f">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span style="color: #00538b">:=</span> <span class="nx">p</span><span class="p">,</span> <span style="color: #0000c0">0.0</span><span class="p">,</span> <span style="color: #0000c0">0.0</span><span class="p">,</span> <span style="color: #0000c0">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #5317ac">for</span> <span class="nx">i</span> <span style="color: #00538b">:=</span> <span style="color: #0000c0">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #00538b">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span style="color: #721045">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #5317ac">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #5317ac">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #721045">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span style="color: #00538b">/</span><span class="nx">r</span><span class="p">)</span><span style="color: #00538b">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span style="color: #721045">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span style="color: #00538b">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #721045">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span style="color: #00538b">+</span><span class="nx">r</span><span style="color: #00538b">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #721045">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #00538b">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #721045">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span style="color: #00538b">+</span><span class="nx">r</span><span style="color: #00538b">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #721045">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #00538b">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #721045">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span style="color: #00538b">+</span><span class="nx">r</span><span style="color: #00538b">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #721045">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #5317ac">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #5317ac">func</span> <span style="color: #721045">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #005a5f">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span style="color: #00538b">:=</span> <span class="p">(</span><span style="color: #0000c0">2</span><span style="color: #00538b">*</span><span style="color: #8f0075">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span style="color: #00538b">/</span><span style="color: #8f0075">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span style="color: #00538b">-</span><span style="color: #0000c0">1</span><span class="p">)</span><span style="color: #00538b">*</span><span class="nx">aspectRatio</span><span style="color: #00538b">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #721045">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #00538b">/</span><span style="color: #0000c0">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #0000c0">1</span><span style="color: #00538b">-</span><span style="color: #0000c0">2</span><span style="color: #00538b">*</span><span style="color: #8f0075">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span style="color: #00538b">/</span><span style="color: #8f0075">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span style="color: #00538b">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #721045">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #00538b">/</span><span style="color: #0000c0">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span style="color: #00538b">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span style="color: #00538b">-</span><span style="color: #0000c0">1</span><span class="p">}.</span><span style="color: #721045">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span style="color: #00538b">:=</span> <span style="color: #0000c0">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #5317ac">for</span> <span class="nx">i</span> <span style="color: #00538b">:=</span> <span style="color: #0000c0">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #00538b">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span style="color: #00538b">:=</span> <span class="nx">direction</span><span class="p">.</span><span style="color: #721045">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span style="color: #721045">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span style="color: #0000c0">0</span><span class="p">,</span> <span style="color: #0000c0">0</span><span class="p">,</span> <span style="color: #0000c0">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span style="color: #00538b">:=</span> <span style="color: #721045">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span style="color: #00538b">-</span> <span style="color: #0000c0">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #5317ac">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span style="color: #0000c0">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #5317ac">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span style="color: #8f0075">uint8</span><span class="p">(</span><span style="color: #0000c0">255</span> <span style="color: #00538b">-</span> <span class="nx">t</span><span style="color: #00538b">*</span><span style="color: #0000c0">255</span><span style="color: #00538b">/</span><span style="color: #0000c0">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span style="color: #00538b">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #5317ac">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span style="color: #0000c0">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #5317ac">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #5317ac">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #5317ac">func</span> <span style="color: #721045">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span style="color: #00538b">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #721045">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #721045">Rect</span><span class="p">(</span><span style="color: #0000c0">0</span><span class="p">,</span> <span style="color: #0000c0">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #5317ac">for</span> <span class="nx">y</span> <span style="color: #00538b">:=</span> <span style="color: #0000c0">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span style="color: #00538b">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span style="color: #721045">Add</span><span class="p">(</span><span style="color: #0000c0">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #5317ac">go</span> <span style="color: #5317ac">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #005a5f">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #5317ac">defer</span> <span class="nx">wg</span><span class="p">.</span><span style="color: #721045">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #5317ac">for</span> <span class="nx">x</span> <span style="color: #00538b">:=</span> <span style="color: #0000c0">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span style="color: #00538b">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span style="color: #721045">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span style="color: #721045">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span style="color: #721045">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span style="color: #00538b">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #721045">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #721045">Rect</span><span class="p">(</span><span style="color: #0000c0">0</span><span class="p">,</span> <span style="color: #0000c0">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #5317ac">for</span> <span class="nx">y</span> <span style="color: #00538b">:=</span> <span style="color: #0000c0">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span style="color: #00538b">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #5317ac">for</span> <span class="nx">x</span> <span style="color: #00538b">:=</span> <span style="color: #0000c0">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span style="color: #00538b">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span style="color: #00538b">:=</span> <span style="color: #0000c0">0</span><span class="p">,</span> <span style="color: #0000c0">0</span><span class="p">,</span> <span style="color: #0000c0">0</span><span class="p">,</span> <span style="color: #0000c0">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #5317ac">for</span> <span class="nx">dy</span> <span style="color: #00538b">:=</span> <span style="color: #0000c0">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span style="color: #00538b">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #5317ac">for</span> <span class="nx">dx</span> <span style="color: #00538b">:=</span> <span style="color: #0000c0">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span style="color: #00538b">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span style="color: #00538b">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span style="color: #721045">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span style="color: #00538b">*</span><span class="nx">supersamplingRatio</span><span style="color: #00538b">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span style="color: #00538b">*</span><span class="nx">supersamplingRatio</span><span style="color: #00538b">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span style="color: #00538b">+=</span> <span style="color: #8f0075">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span style="color: #00538b">+=</span> <span style="color: #8f0075">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span style="color: #00538b">+=</span> <span style="color: #8f0075">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span style="color: #00538b">+=</span> <span style="color: #8f0075">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span style="color: #00538b">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #00538b">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span style="color: #00538b">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #00538b">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span style="color: #00538b">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #00538b">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span style="color: #00538b">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #00538b">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span style="color: #721045">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span style="color: #8f0075">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span style="color: #8f0075">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span style="color: #8f0075">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span style="color: #8f0075">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span style="color: #00538b">:=</span> <span class="nx">os</span><span class="p">.</span><span style="color: #721045">Create</span><span class="p">(</span><span style="color: #2544bb">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #5317ac">if</span> <span class="nx">err</span> <span style="color: #00538b">!=</span> <span style="color: #0000c0">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #721045">Println</span><span class="p">(</span><span style="color: #2544bb">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #5317ac">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #5317ac">defer</span> <span class="nx">file</span><span class="p">.</span><span style="color: #721045">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span style="color: #721045">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #5317ac">if</span> <span class="nx">err</span> <span style="color: #00538b">!=</span> <span style="color: #0000c0">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #721045">Println</span><span class="p">(</span><span style="color: #2544bb">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='modus-vivendi'><h2><a id='stylelink' href='modus-vivendi.html' alt='View only modus-vivendi'>modus-vivendi</a></h2></a><code><pre style="color: #ffffff; background-color: #000000;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #b6a0ff">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #a8a8a8">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #a8a8a8"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #a8a8a8"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #a8a8a8"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #b6a0ff">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #79a8ff">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #79a8ff">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #79a8ff">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #79a8ff">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #79a8ff">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #79a8ff">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #79a8ff">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #b6a0ff">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span style="color: #00bcff">1920</span><span class="p">,</span> <span style="color: #00bcff">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span style="color: #00bcff">3840</span><span class="p">,</span> <span style="color: #00bcff">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span style="color: #f78fe7">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span style="color: #00d3d0">/</span> <span style="color: #f78fe7">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span style="color: #00d3d0">/</span> <span style="color: #00bcff">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span style="color: #00bcff">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span style="color: #00bcff">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span style="color: #00bcff">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span style="color: #00bcff">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #b6a0ff">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #b6a0ff">type</span> <span class="nx">vec3</span> <span style="color: #b6a0ff">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #6ae4b9">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #b6a0ff">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #feacd0">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #b6a0ff">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #00d3d0">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #00d3d0">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #00d3d0">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #b6a0ff">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #feacd0">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #6ae4b9">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #b6a0ff">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #00d3d0">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #00d3d0">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #00d3d0">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #b6a0ff">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #feacd0">length</span><span class="p">()</span> <span style="color: #6ae4b9">float64</span>    <span class="p">{</span> <span style="color: #b6a0ff">return</span> <span class="nx">math</span><span class="p">.</span><span style="color: #feacd0">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span style="color: #00d3d0">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #00d3d0">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span style="color: #00d3d0">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #00d3d0">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span style="color: #00d3d0">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #b6a0ff">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #feacd0">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #b6a0ff">return</span> <span class="nx">v</span><span class="p">.</span><span style="color: #feacd0">mul</span><span class="p">(</span><span style="color: #00bcff">1</span> <span style="color: #00d3d0">/</span> <span class="nx">v</span><span class="p">.</span><span style="color: #feacd0">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #b6a0ff">func</span> <span style="color: #feacd0">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #6ae4b9">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span style="color: #00d3d0">:=</span> <span class="nx">p</span><span class="p">,</span> <span style="color: #00bcff">0.0</span><span class="p">,</span> <span style="color: #00bcff">0.0</span><span class="p">,</span> <span style="color: #00bcff">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #b6a0ff">for</span> <span class="nx">i</span> <span style="color: #00d3d0">:=</span> <span style="color: #00bcff">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #00d3d0">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span style="color: #feacd0">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #b6a0ff">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #b6a0ff">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #feacd0">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span style="color: #00d3d0">/</span><span class="nx">r</span><span class="p">)</span><span style="color: #00d3d0">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span style="color: #feacd0">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span style="color: #00d3d0">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #feacd0">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span style="color: #00d3d0">+</span><span class="nx">r</span><span style="color: #00d3d0">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #feacd0">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #00d3d0">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #feacd0">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span style="color: #00d3d0">+</span><span class="nx">r</span><span style="color: #00d3d0">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #feacd0">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #00d3d0">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #feacd0">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span style="color: #00d3d0">+</span><span class="nx">r</span><span style="color: #00d3d0">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #feacd0">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #b6a0ff">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #b6a0ff">func</span> <span style="color: #feacd0">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #6ae4b9">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span style="color: #00d3d0">:=</span> <span class="p">(</span><span style="color: #00bcff">2</span><span style="color: #00d3d0">*</span><span style="color: #f78fe7">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span style="color: #00d3d0">/</span><span style="color: #f78fe7">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span style="color: #00d3d0">-</span><span style="color: #00bcff">1</span><span class="p">)</span><span style="color: #00d3d0">*</span><span class="nx">aspectRatio</span><span style="color: #00d3d0">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #feacd0">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #00d3d0">/</span><span style="color: #00bcff">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #00bcff">1</span><span style="color: #00d3d0">-</span><span style="color: #00bcff">2</span><span style="color: #00d3d0">*</span><span style="color: #f78fe7">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span style="color: #00d3d0">/</span><span style="color: #f78fe7">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span style="color: #00d3d0">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #feacd0">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #00d3d0">/</span><span style="color: #00bcff">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span style="color: #00d3d0">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span style="color: #00d3d0">-</span><span style="color: #00bcff">1</span><span class="p">}.</span><span style="color: #feacd0">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span style="color: #00d3d0">:=</span> <span style="color: #00bcff">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #b6a0ff">for</span> <span class="nx">i</span> <span style="color: #00d3d0">:=</span> <span style="color: #00bcff">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #00d3d0">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span style="color: #00d3d0">:=</span> <span class="nx">direction</span><span class="p">.</span><span style="color: #feacd0">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span style="color: #feacd0">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span style="color: #00bcff">0</span><span class="p">,</span> <span style="color: #00bcff">0</span><span class="p">,</span> <span style="color: #00bcff">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span style="color: #00d3d0">:=</span> <span style="color: #feacd0">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span style="color: #00d3d0">-</span> <span style="color: #00bcff">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #b6a0ff">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span style="color: #00bcff">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #b6a0ff">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span style="color: #f78fe7">uint8</span><span class="p">(</span><span style="color: #00bcff">255</span> <span style="color: #00d3d0">-</span> <span class="nx">t</span><span style="color: #00d3d0">*</span><span style="color: #00bcff">255</span><span style="color: #00d3d0">/</span><span style="color: #00bcff">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span style="color: #00d3d0">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #b6a0ff">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span style="color: #00bcff">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #b6a0ff">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #b6a0ff">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #b6a0ff">func</span> <span style="color: #feacd0">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span style="color: #00d3d0">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #feacd0">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #feacd0">Rect</span><span class="p">(</span><span style="color: #00bcff">0</span><span class="p">,</span> <span style="color: #00bcff">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #b6a0ff">for</span> <span class="nx">y</span> <span style="color: #00d3d0">:=</span> <span style="color: #00bcff">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span style="color: #00d3d0">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span style="color: #feacd0">Add</span><span class="p">(</span><span style="color: #00bcff">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #b6a0ff">go</span> <span style="color: #b6a0ff">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #6ae4b9">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #b6a0ff">defer</span> <span class="nx">wg</span><span class="p">.</span><span style="color: #feacd0">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #b6a0ff">for</span> <span class="nx">x</span> <span style="color: #00d3d0">:=</span> <span style="color: #00bcff">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span style="color: #00d3d0">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span style="color: #feacd0">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span style="color: #feacd0">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span style="color: #feacd0">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span style="color: #00d3d0">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #feacd0">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #feacd0">Rect</span><span class="p">(</span><span style="color: #00bcff">0</span><span class="p">,</span> <span style="color: #00bcff">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #b6a0ff">for</span> <span class="nx">y</span> <span style="color: #00d3d0">:=</span> <span style="color: #00bcff">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span style="color: #00d3d0">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #b6a0ff">for</span> <span class="nx">x</span> <span style="color: #00d3d0">:=</span> <span style="color: #00bcff">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span style="color: #00d3d0">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span style="color: #00d3d0">:=</span> <span style="color: #00bcff">0</span><span class="p">,</span> <span style="color: #00bcff">0</span><span class="p">,</span> <span style="color: #00bcff">0</span><span class="p">,</span> <span style="color: #00bcff">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #b6a0ff">for</span> <span class="nx">dy</span> <span style="color: #00d3d0">:=</span> <span style="color: #00bcff">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span style="color: #00d3d0">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #b6a0ff">for</span> <span class="nx">dx</span> <span style="color: #00d3d0">:=</span> <span style="color: #00bcff">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span style="color: #00d3d0">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span style="color: #00d3d0">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span style="color: #feacd0">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span style="color: #00d3d0">*</span><span class="nx">supersamplingRatio</span><span style="color: #00d3d0">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span style="color: #00d3d0">*</span><span class="nx">supersamplingRatio</span><span style="color: #00d3d0">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span style="color: #00d3d0">+=</span> <span style="color: #f78fe7">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span style="color: #00d3d0">+=</span> <span style="color: #f78fe7">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span style="color: #00d3d0">+=</span> <span style="color: #f78fe7">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span style="color: #00d3d0">+=</span> <span style="color: #f78fe7">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span style="color: #00d3d0">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #00d3d0">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span style="color: #00d3d0">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #00d3d0">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span style="color: #00d3d0">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #00d3d0">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span style="color: #00d3d0">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #00d3d0">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span style="color: #feacd0">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span style="color: #f78fe7">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span style="color: #f78fe7">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span style="color: #f78fe7">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span style="color: #f78fe7">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span style="color: #00d3d0">:=</span> <span class="nx">os</span><span class="p">.</span><span style="color: #feacd0">Create</span><span class="p">(</span><span style="color: #79a8ff">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #b6a0ff">if</span> <span class="nx">err</span> <span style="color: #00d3d0">!=</span> <span style="color: #00bcff">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #feacd0">Println</span><span class="p">(</span><span style="color: #79a8ff">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #b6a0ff">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #b6a0ff">defer</span> <span class="nx">file</span><span class="p">.</span><span style="color: #feacd0">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span style="color: #feacd0">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #b6a0ff">if</span> <span class="nx">err</span> <span style="color: #00d3d0">!=</span> <span style="color: #00bcff">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #feacd0">Println</span><span class="p">(</span><span style="color: #79a8ff">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='monokai'><h2><a id='stylelink' href='monokai.html' alt='View only monokai'>monokai</a></h2></a><code><pre style="color: #f8f8f2; background-color: #272822;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #f92672">package</span> <span style="color: #a6e22e">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #75715e">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #75715e"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #75715e"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #75715e"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #f92672">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #e6db74">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #e6db74">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #e6db74">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #e6db74">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #e6db74">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #e6db74">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #e6db74">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #66d9ef">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6e22e">width</span><span class="p">,</span> <span style="color: #a6e22e">height</span>      <span class="p">=</span> <span style="color: #ae81ff">1920</span><span class="p">,</span> <span style="color: #ae81ff">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6e22e">ssWidth</span><span class="p">,</span> <span style="color: #a6e22e">ssHeight</span>  <span class="p">=</span> <span style="color: #ae81ff">3840</span><span class="p">,</span> <span style="color: #ae81ff">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6e22e">aspectRatio</span>        <span class="p">=</span> <span class="nb">float64</span><span class="p">(</span><span style="color: #a6e22e">ssWidth</span><span class="p">)</span> <span style="color: #f92672">/</span> <span class="nb">float64</span><span class="p">(</span><span style="color: #a6e22e">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6e22e">fov</span>                <span class="p">=</span> <span style="color: #a6e22e">math</span><span class="p">.</span><span style="color: #a6e22e">Pi</span> <span style="color: #f92672">/</span> <span style="color: #ae81ff">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6e22e">maxIter</span>            <span class="p">=</span> <span style="color: #ae81ff">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6e22e">power</span>              <span class="p">=</span> <span style="color: #ae81ff">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6e22e">escapeRadius</span>       <span class="p">=</span> <span style="color: #ae81ff">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6e22e">supersamplingRatio</span> <span class="p">=</span> <span style="color: #ae81ff">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #66d9ef">var</span> <span style="color: #a6e22e">wg</span> <span style="color: #a6e22e">sync</span><span class="p">.</span><span style="color: #a6e22e">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #66d9ef">type</span> <span style="color: #a6e22e">vec3</span> <span style="color: #66d9ef">struct</span><span class="p">{</span> <span style="color: #a6e22e">x</span><span class="p">,</span> <span style="color: #a6e22e">y</span><span class="p">,</span> <span style="color: #a6e22e">z</span> <span style="color: #66d9ef">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #66d9ef">func</span> <span class="p">(</span><span style="color: #a6e22e">v</span> <span style="color: #a6e22e">vec3</span><span class="p">)</span> <span style="color: #a6e22e">add</span><span class="p">(</span><span style="color: #a6e22e">w</span> <span style="color: #a6e22e">vec3</span><span class="p">)</span> <span style="color: #a6e22e">vec3</span>    <span class="p">{</span> <span style="color: #66d9ef">return</span> <span style="color: #a6e22e">vec3</span><span class="p">{</span><span style="color: #a6e22e">v</span><span class="p">.</span><span style="color: #a6e22e">x</span> <span style="color: #f92672">+</span> <span style="color: #a6e22e">w</span><span class="p">.</span><span style="color: #a6e22e">x</span><span class="p">,</span> <span style="color: #a6e22e">v</span><span class="p">.</span><span style="color: #a6e22e">y</span> <span style="color: #f92672">+</span> <span style="color: #a6e22e">w</span><span class="p">.</span><span style="color: #a6e22e">y</span><span class="p">,</span> <span style="color: #a6e22e">v</span><span class="p">.</span><span style="color: #a6e22e">z</span> <span style="color: #f92672">+</span> <span style="color: #a6e22e">w</span><span class="p">.</span><span style="color: #a6e22e">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #66d9ef">func</span> <span class="p">(</span><span style="color: #a6e22e">v</span> <span style="color: #a6e22e">vec3</span><span class="p">)</span> <span style="color: #a6e22e">mul</span><span class="p">(</span><span style="color: #a6e22e">s</span> <span style="color: #66d9ef">float64</span><span class="p">)</span> <span style="color: #a6e22e">vec3</span> <span class="p">{</span> <span style="color: #66d9ef">return</span> <span style="color: #a6e22e">vec3</span><span class="p">{</span><span style="color: #a6e22e">v</span><span class="p">.</span><span style="color: #a6e22e">x</span> <span style="color: #f92672">*</span> <span style="color: #a6e22e">s</span><span class="p">,</span> <span style="color: #a6e22e">v</span><span class="p">.</span><span style="color: #a6e22e">y</span> <span style="color: #f92672">*</span> <span style="color: #a6e22e">s</span><span class="p">,</span> <span style="color: #a6e22e">v</span><span class="p">.</span><span style="color: #a6e22e">z</span> <span style="color: #f92672">*</span> <span style="color: #a6e22e">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #66d9ef">func</span> <span class="p">(</span><span style="color: #a6e22e">v</span> <span style="color: #a6e22e">vec3</span><span class="p">)</span> <span style="color: #a6e22e">length</span><span class="p">()</span> <span style="color: #66d9ef">float64</span>    <span class="p">{</span> <span style="color: #66d9ef">return</span> <span style="color: #a6e22e">math</span><span class="p">.</span><span style="color: #a6e22e">Sqrt</span><span class="p">(</span><span style="color: #a6e22e">v</span><span class="p">.</span><span style="color: #a6e22e">x</span><span style="color: #f92672">*</span><span style="color: #a6e22e">v</span><span class="p">.</span><span style="color: #a6e22e">x</span> <span style="color: #f92672">+</span> <span style="color: #a6e22e">v</span><span class="p">.</span><span style="color: #a6e22e">y</span><span style="color: #f92672">*</span><span style="color: #a6e22e">v</span><span class="p">.</span><span style="color: #a6e22e">y</span> <span style="color: #f92672">+</span> <span style="color: #a6e22e">v</span><span class="p">.</span><span style="color: #a6e22e">z</span><span style="color: #f92672">*</span><span style="color: #a6e22e">v</span><span class="p">.</span><span style="color: #a6e22e">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #66d9ef">func</span> <span class="p">(</span><span style="color: #a6e22e">v</span> <span style="color: #a6e22e">vec3</span><span class="p">)</span> <span style="color: #a6e22e">normalize</span><span class="p">()</span> <span style="color: #a6e22e">vec3</span>    <span class="p">{</span> <span style="color: #66d9ef">return</span> <span style="color: #a6e22e">v</span><span class="p">.</span><span style="color: #a6e22e">mul</span><span class="p">(</span><span style="color: #ae81ff">1</span> <span style="color: #f92672">/</span> <span style="color: #a6e22e">v</span><span class="p">.</span><span style="color: #a6e22e">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #66d9ef">func</span> <span style="color: #a6e22e">mandelbulb</span><span class="p">(</span><span style="color: #a6e22e">p</span> <span style="color: #a6e22e">vec3</span><span class="p">)</span> <span style="color: #66d9ef">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6e22e">z</span><span class="p">,</span> <span style="color: #a6e22e">r</span><span class="p">,</span> <span style="color: #a6e22e">theta</span><span class="p">,</span> <span style="color: #a6e22e">phi</span> <span style="color: #f92672">:=</span> <span style="color: #a6e22e">p</span><span class="p">,</span> <span style="color: #ae81ff">0.0</span><span class="p">,</span> <span style="color: #ae81ff">0.0</span><span class="p">,</span> <span style="color: #ae81ff">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #66d9ef">for</span> <span style="color: #a6e22e">i</span> <span style="color: #f92672">:=</span> <span style="color: #ae81ff">0</span><span class="p">;</span> <span style="color: #a6e22e">i</span> <span class="p">&lt;</span> <span style="color: #a6e22e">maxIter</span><span class="p">;</span> <span style="color: #a6e22e">i</span><span style="color: #f92672">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #a6e22e">r</span> <span class="p">=</span> <span style="color: #a6e22e">z</span><span class="p">.</span><span style="color: #a6e22e">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #66d9ef">if</span> <span style="color: #a6e22e">r</span> <span class="p">&gt;</span> <span style="color: #a6e22e">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #66d9ef">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #a6e22e">theta</span><span class="p">,</span> <span style="color: #a6e22e">phi</span> <span class="p">=</span> <span style="color: #a6e22e">math</span><span class="p">.</span><span style="color: #a6e22e">Acos</span><span class="p">(</span><span style="color: #a6e22e">z</span><span class="p">.</span><span style="color: #a6e22e">z</span><span style="color: #f92672">/</span><span style="color: #a6e22e">r</span><span class="p">)</span><span style="color: #f92672">*</span><span style="color: #a6e22e">power</span><span class="p">,</span> <span style="color: #a6e22e">math</span><span class="p">.</span><span style="color: #a6e22e">Atan2</span><span class="p">(</span><span style="color: #a6e22e">z</span><span class="p">.</span><span style="color: #a6e22e">y</span><span class="p">,</span> <span style="color: #a6e22e">z</span><span class="p">.</span><span style="color: #a6e22e">x</span><span class="p">)</span><span style="color: #f92672">*</span><span style="color: #a6e22e">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #a6e22e">r</span> <span class="p">=</span> <span style="color: #a6e22e">math</span><span class="p">.</span><span style="color: #a6e22e">Pow</span><span class="p">(</span><span style="color: #a6e22e">r</span><span class="p">,</span> <span style="color: #a6e22e">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #a6e22e">z</span><span class="p">.</span><span style="color: #a6e22e">x</span><span class="p">,</span> <span style="color: #a6e22e">z</span><span class="p">.</span><span style="color: #a6e22e">y</span><span class="p">,</span> <span style="color: #a6e22e">z</span><span class="p">.</span><span style="color: #a6e22e">z</span> <span class="p">=</span> <span style="color: #a6e22e">p</span><span class="p">.</span><span style="color: #a6e22e">x</span><span style="color: #f92672">+</span><span style="color: #a6e22e">r</span><span style="color: #f92672">*</span><span style="color: #a6e22e">math</span><span class="p">.</span><span style="color: #a6e22e">Sin</span><span class="p">(</span><span style="color: #a6e22e">theta</span><span class="p">)</span><span style="color: #f92672">*</span><span style="color: #a6e22e">math</span><span class="p">.</span><span style="color: #a6e22e">Cos</span><span class="p">(</span><span style="color: #a6e22e">phi</span><span class="p">),</span> <span style="color: #a6e22e">p</span><span class="p">.</span><span style="color: #a6e22e">y</span><span style="color: #f92672">+</span><span style="color: #a6e22e">r</span><span style="color: #f92672">*</span><span style="color: #a6e22e">math</span><span class="p">.</span><span style="color: #a6e22e">Sin</span><span class="p">(</span><span style="color: #a6e22e">theta</span><span class="p">)</span><span style="color: #f92672">*</span><span style="color: #a6e22e">math</span><span class="p">.</span><span style="color: #a6e22e">Sin</span><span class="p">(</span><span style="color: #a6e22e">phi</span><span class="p">),</span> <span style="color: #a6e22e">p</span><span class="p">.</span><span style="color: #a6e22e">z</span><span style="color: #f92672">+</span><span style="color: #a6e22e">r</span><span style="color: #f92672">*</span><span style="color: #a6e22e">math</span><span class="p">.</span><span style="color: #a6e22e">Cos</span><span class="p">(</span><span style="color: #a6e22e">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #66d9ef">return</span> <span style="color: #a6e22e">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #66d9ef">func</span> <span style="color: #a6e22e">renderPixel</span><span class="p">(</span><span style="color: #a6e22e">x</span><span class="p">,</span> <span style="color: #a6e22e">y</span> <span style="color: #66d9ef">int</span><span class="p">)</span> <span style="color: #a6e22e">color</span><span class="p">.</span><span style="color: #a6e22e">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6e22e">px</span><span class="p">,</span> <span style="color: #a6e22e">py</span> <span style="color: #f92672">:=</span> <span class="p">(</span><span style="color: #ae81ff">2</span><span style="color: #f92672">*</span><span class="nb">float64</span><span class="p">(</span><span style="color: #a6e22e">x</span><span class="p">)</span><span style="color: #f92672">/</span><span class="nb">float64</span><span class="p">(</span><span style="color: #a6e22e">ssWidth</span><span class="p">)</span><span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span class="p">)</span><span style="color: #f92672">*</span><span style="color: #a6e22e">aspectRatio</span><span style="color: #f92672">*</span><span style="color: #a6e22e">math</span><span class="p">.</span><span style="color: #a6e22e">Tan</span><span class="p">(</span><span style="color: #a6e22e">fov</span><span style="color: #f92672">/</span><span style="color: #ae81ff">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #ae81ff">1</span><span style="color: #f92672">-</span><span style="color: #ae81ff">2</span><span style="color: #f92672">*</span><span class="nb">float64</span><span class="p">(</span><span style="color: #a6e22e">y</span><span class="p">)</span><span style="color: #f92672">/</span><span class="nb">float64</span><span class="p">(</span><span style="color: #a6e22e">ssHeight</span><span class="p">))</span><span style="color: #f92672">*</span><span style="color: #a6e22e">math</span><span class="p">.</span><span style="color: #a6e22e">Tan</span><span class="p">(</span><span style="color: #a6e22e">fov</span><span style="color: #f92672">/</span><span style="color: #ae81ff">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6e22e">direction</span> <span style="color: #f92672">:=</span> <span style="color: #a6e22e">vec3</span><span class="p">{</span><span style="color: #a6e22e">px</span><span class="p">,</span> <span style="color: #a6e22e">py</span><span class="p">,</span> <span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span class="p">}.</span><span style="color: #a6e22e">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6e22e">t</span> <span style="color: #f92672">:=</span> <span style="color: #ae81ff">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #66d9ef">for</span> <span style="color: #a6e22e">i</span> <span style="color: #f92672">:=</span> <span style="color: #ae81ff">0</span><span class="p">;</span> <span style="color: #a6e22e">i</span> <span class="p">&lt;</span> <span style="color: #a6e22e">maxIter</span><span class="p">;</span> <span style="color: #a6e22e">i</span><span style="color: #f92672">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #a6e22e">p</span> <span style="color: #f92672">:=</span> <span style="color: #a6e22e">direction</span><span class="p">.</span><span style="color: #a6e22e">mul</span><span class="p">(</span><span style="color: #a6e22e">t</span><span class="p">).</span><span style="color: #a6e22e">add</span><span class="p">(</span><span style="color: #a6e22e">vec3</span><span class="p">{</span><span style="color: #ae81ff">0</span><span class="p">,</span> <span style="color: #ae81ff">0</span><span class="p">,</span> <span style="color: #ae81ff">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #a6e22e">d</span> <span style="color: #f92672">:=</span> <span style="color: #a6e22e">mandelbulb</span><span class="p">(</span><span style="color: #a6e22e">p</span><span class="p">)</span> <span style="color: #f92672">-</span> <span style="color: #ae81ff">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #66d9ef">if</span> <span style="color: #a6e22e">d</span> <span class="p">&lt;</span> <span style="color: #ae81ff">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #66d9ef">return</span> <span style="color: #a6e22e">color</span><span class="p">.</span><span style="color: #a6e22e">Gray</span><span class="p">{</span><span class="nb">uint8</span><span class="p">(</span><span style="color: #ae81ff">255</span> <span style="color: #f92672">-</span> <span style="color: #a6e22e">t</span><span style="color: #f92672">*</span><span style="color: #ae81ff">255</span><span style="color: #f92672">/</span><span style="color: #ae81ff">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #a6e22e">t</span> <span style="color: #f92672">+=</span> <span style="color: #a6e22e">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #66d9ef">if</span> <span style="color: #a6e22e">t</span> <span class="p">&gt;</span> <span style="color: #ae81ff">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #66d9ef">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #66d9ef">return</span> <span style="color: #a6e22e">color</span><span class="p">.</span><span style="color: #a6e22e">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #66d9ef">func</span> <span style="color: #a6e22e">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6e22e">ssImg</span> <span style="color: #f92672">:=</span> <span style="color: #a6e22e">image</span><span class="p">.</span><span style="color: #a6e22e">NewRGBA</span><span class="p">(</span><span style="color: #a6e22e">image</span><span class="p">.</span><span style="color: #a6e22e">Rect</span><span class="p">(</span><span style="color: #ae81ff">0</span><span class="p">,</span> <span style="color: #ae81ff">0</span><span class="p">,</span> <span style="color: #a6e22e">ssWidth</span><span class="p">,</span> <span style="color: #a6e22e">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #66d9ef">for</span> <span style="color: #a6e22e">y</span> <span style="color: #f92672">:=</span> <span style="color: #ae81ff">0</span><span class="p">;</span> <span style="color: #a6e22e">y</span> <span class="p">&lt;</span> <span style="color: #a6e22e">ssHeight</span><span class="p">;</span> <span style="color: #a6e22e">y</span><span style="color: #f92672">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #a6e22e">wg</span><span class="p">.</span><span style="color: #a6e22e">Add</span><span class="p">(</span><span style="color: #ae81ff">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #66d9ef">go</span> <span style="color: #66d9ef">func</span><span class="p">(</span><span style="color: #a6e22e">y</span> <span style="color: #66d9ef">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #66d9ef">defer</span> <span style="color: #a6e22e">wg</span><span class="p">.</span><span style="color: #a6e22e">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #66d9ef">for</span> <span style="color: #a6e22e">x</span> <span style="color: #f92672">:=</span> <span style="color: #ae81ff">0</span><span class="p">;</span> <span style="color: #a6e22e">x</span> <span class="p">&lt;</span> <span style="color: #a6e22e">ssWidth</span><span class="p">;</span> <span style="color: #a6e22e">x</span><span style="color: #f92672">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #a6e22e">ssImg</span><span class="p">.</span><span style="color: #a6e22e">Set</span><span class="p">(</span><span style="color: #a6e22e">x</span><span class="p">,</span> <span style="color: #a6e22e">y</span><span class="p">,</span> <span style="color: #a6e22e">renderPixel</span><span class="p">(</span><span style="color: #a6e22e">x</span><span class="p">,</span> <span style="color: #a6e22e">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span style="color: #a6e22e">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6e22e">wg</span><span class="p">.</span><span style="color: #a6e22e">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6e22e">img</span> <span style="color: #f92672">:=</span> <span style="color: #a6e22e">image</span><span class="p">.</span><span style="color: #a6e22e">NewRGBA</span><span class="p">(</span><span style="color: #a6e22e">image</span><span class="p">.</span><span style="color: #a6e22e">Rect</span><span class="p">(</span><span style="color: #ae81ff">0</span><span class="p">,</span> <span style="color: #ae81ff">0</span><span class="p">,</span> <span style="color: #a6e22e">width</span><span class="p">,</span> <span style="color: #a6e22e">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #66d9ef">for</span> <span style="color: #a6e22e">y</span> <span style="color: #f92672">:=</span> <span style="color: #ae81ff">0</span><span class="p">;</span> <span style="color: #a6e22e">y</span> <span class="p">&lt;</span> <span style="color: #a6e22e">height</span><span class="p">;</span> <span style="color: #a6e22e">y</span><span style="color: #f92672">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #66d9ef">for</span> <span style="color: #a6e22e">x</span> <span style="color: #f92672">:=</span> <span style="color: #ae81ff">0</span><span class="p">;</span> <span style="color: #a6e22e">x</span> <span class="p">&lt;</span> <span style="color: #a6e22e">width</span><span class="p">;</span> <span style="color: #a6e22e">x</span><span style="color: #f92672">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #a6e22e">r</span><span class="p">,</span> <span style="color: #a6e22e">g</span><span class="p">,</span> <span style="color: #a6e22e">b</span><span class="p">,</span> <span style="color: #a6e22e">a</span> <span style="color: #f92672">:=</span> <span style="color: #ae81ff">0</span><span class="p">,</span> <span style="color: #ae81ff">0</span><span class="p">,</span> <span style="color: #ae81ff">0</span><span class="p">,</span> <span style="color: #ae81ff">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #66d9ef">for</span> <span style="color: #a6e22e">dy</span> <span style="color: #f92672">:=</span> <span style="color: #ae81ff">0</span><span class="p">;</span> <span style="color: #a6e22e">dy</span> <span class="p">&lt;</span> <span style="color: #a6e22e">supersamplingRatio</span><span class="p">;</span> <span style="color: #a6e22e">dy</span><span style="color: #f92672">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #66d9ef">for</span> <span style="color: #a6e22e">dx</span> <span style="color: #f92672">:=</span> <span style="color: #ae81ff">0</span><span class="p">;</span> <span style="color: #a6e22e">dx</span> <span class="p">&lt;</span> <span style="color: #a6e22e">supersamplingRatio</span><span class="p">;</span> <span style="color: #a6e22e">dx</span><span style="color: #f92672">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #a6e22e">c</span> <span style="color: #f92672">:=</span> <span style="color: #a6e22e">ssImg</span><span class="p">.</span><span style="color: #a6e22e">RGBAAt</span><span class="p">(</span><span style="color: #a6e22e">x</span><span style="color: #f92672">*</span><span style="color: #a6e22e">supersamplingRatio</span><span style="color: #f92672">+</span><span style="color: #a6e22e">dx</span><span class="p">,</span> <span style="color: #a6e22e">y</span><span style="color: #f92672">*</span><span style="color: #a6e22e">supersamplingRatio</span><span style="color: #f92672">+</span><span style="color: #a6e22e">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #a6e22e">r</span> <span style="color: #f92672">+=</span> <span class="nb">int</span><span class="p">(</span><span style="color: #a6e22e">c</span><span class="p">.</span><span style="color: #a6e22e">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #a6e22e">g</span> <span style="color: #f92672">+=</span> <span class="nb">int</span><span class="p">(</span><span style="color: #a6e22e">c</span><span class="p">.</span><span style="color: #a6e22e">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #a6e22e">b</span> <span style="color: #f92672">+=</span> <span class="nb">int</span><span class="p">(</span><span style="color: #a6e22e">c</span><span class="p">.</span><span style="color: #a6e22e">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #a6e22e">a</span> <span style="color: #f92672">+=</span> <span class="nb">int</span><span class="p">(</span><span style="color: #a6e22e">c</span><span class="p">.</span><span style="color: #a6e22e">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #a6e22e">r</span> <span style="color: #f92672">/=</span> <span style="color: #a6e22e">supersamplingRatio</span> <span style="color: #f92672">*</span> <span style="color: #a6e22e">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #a6e22e">g</span> <span style="color: #f92672">/=</span> <span style="color: #a6e22e">supersamplingRatio</span> <span style="color: #f92672">*</span> <span style="color: #a6e22e">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #a6e22e">b</span> <span style="color: #f92672">/=</span> <span style="color: #a6e22e">supersamplingRatio</span> <span style="color: #f92672">*</span> <span style="color: #a6e22e">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #a6e22e">a</span> <span style="color: #f92672">/=</span> <span style="color: #a6e22e">supersamplingRatio</span> <span style="color: #f92672">*</span> <span style="color: #a6e22e">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #a6e22e">img</span><span class="p">.</span><span style="color: #a6e22e">Set</span><span class="p">(</span><span style="color: #a6e22e">x</span><span class="p">,</span> <span style="color: #a6e22e">y</span><span class="p">,</span> <span style="color: #a6e22e">color</span><span class="p">.</span><span style="color: #a6e22e">RGBA</span><span class="p">{</span><span class="nb">uint8</span><span class="p">(</span><span style="color: #a6e22e">r</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span style="color: #a6e22e">g</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span style="color: #a6e22e">b</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span style="color: #a6e22e">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6e22e">file</span><span class="p">,</span> <span style="color: #a6e22e">err</span> <span style="color: #f92672">:=</span> <span style="color: #a6e22e">os</span><span class="p">.</span><span style="color: #a6e22e">Create</span><span class="p">(</span><span style="color: #e6db74">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #66d9ef">if</span> <span style="color: #a6e22e">err</span> <span style="color: #f92672">!=</span> <span style="color: #66d9ef">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #a6e22e">fmt</span><span class="p">.</span><span style="color: #a6e22e">Println</span><span class="p">(</span><span style="color: #e6db74">&#34;Error creating file:&#34;</span><span class="p">,</span> <span style="color: #a6e22e">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #66d9ef">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #66d9ef">defer</span> <span style="color: #a6e22e">file</span><span class="p">.</span><span style="color: #a6e22e">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a6e22e">err</span> <span class="p">=</span> <span style="color: #a6e22e">png</span><span class="p">.</span><span style="color: #a6e22e">Encode</span><span class="p">(</span><span style="color: #a6e22e">file</span><span class="p">,</span> <span style="color: #a6e22e">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #66d9ef">if</span> <span style="color: #a6e22e">err</span> <span style="color: #f92672">!=</span> <span style="color: #66d9ef">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #a6e22e">fmt</span><span class="p">.</span><span style="color: #a6e22e">Println</span><span class="p">(</span><span style="color: #e6db74">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span style="color: #a6e22e">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='monokailight'><h2><a id='stylelink' href='monokailight.html' alt='View only monokailight'>monokailight</a></h2></a><code><pre style="color: #272822; background-color: #fafafa;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #f92672">package</span> <span style="color: #75af00">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #75715e">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #75715e"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #75715e"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #75715e"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #f92672">import</span> <span style="color: #111111">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #d88200">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #d88200">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #d88200">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #d88200">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #d88200">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #d88200">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #d88200">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #111111">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #00a8c8">const</span> <span style="color: #111111">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #75af00">width</span><span style="color: #111111">,</span> <span style="color: #75af00">height</span>      <span style="color: #111111">=</span> <span style="color: #ae81ff">1920</span><span style="color: #111111">,</span> <span style="color: #ae81ff">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #75af00">ssWidth</span><span style="color: #111111">,</span> <span style="color: #75af00">ssHeight</span>  <span style="color: #111111">=</span> <span style="color: #ae81ff">3840</span><span style="color: #111111">,</span> <span style="color: #ae81ff">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #75af00">aspectRatio</span>        <span style="color: #111111">=</span> <span style="color: #111111">float64</span><span style="color: #111111">(</span><span style="color: #75af00">ssWidth</span><span style="color: #111111">)</span> <span style="color: #f92672">/</span> <span style="color: #111111">float64</span><span style="color: #111111">(</span><span style="color: #75af00">ssHeight</span><span style="color: #111111">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #75af00">fov</span>                <span style="color: #111111">=</span> <span style="color: #75af00">math</span><span style="color: #111111">.</span><span style="color: #75af00">Pi</span> <span style="color: #f92672">/</span> <span style="color: #ae81ff">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #75af00">maxIter</span>            <span style="color: #111111">=</span> <span style="color: #ae81ff">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #75af00">power</span>              <span style="color: #111111">=</span> <span style="color: #ae81ff">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #75af00">escapeRadius</span>       <span style="color: #111111">=</span> <span style="color: #ae81ff">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #75af00">supersamplingRatio</span> <span style="color: #111111">=</span> <span style="color: #ae81ff">2</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #111111">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #00a8c8">var</span> <span style="color: #75af00">wg</span> <span style="color: #75af00">sync</span><span style="color: #111111">.</span><span style="color: #75af00">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #00a8c8">type</span> <span style="color: #75af00">vec3</span> <span style="color: #00a8c8">struct</span><span style="color: #111111">{</span> <span style="color: #75af00">x</span><span style="color: #111111">,</span> <span style="color: #75af00">y</span><span style="color: #111111">,</span> <span style="color: #75af00">z</span> <span style="color: #00a8c8">float64</span> <span style="color: #111111">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #00a8c8">func</span> <span style="color: #111111">(</span><span style="color: #75af00">v</span> <span style="color: #75af00">vec3</span><span style="color: #111111">)</span> <span style="color: #75af00">add</span><span style="color: #111111">(</span><span style="color: #75af00">w</span> <span style="color: #75af00">vec3</span><span style="color: #111111">)</span> <span style="color: #75af00">vec3</span>    <span style="color: #111111">{</span> <span style="color: #00a8c8">return</span> <span style="color: #75af00">vec3</span><span style="color: #111111">{</span><span style="color: #75af00">v</span><span style="color: #111111">.</span><span style="color: #75af00">x</span> <span style="color: #f92672">+</span> <span style="color: #75af00">w</span><span style="color: #111111">.</span><span style="color: #75af00">x</span><span style="color: #111111">,</span> <span style="color: #75af00">v</span><span style="color: #111111">.</span><span style="color: #75af00">y</span> <span style="color: #f92672">+</span> <span style="color: #75af00">w</span><span style="color: #111111">.</span><span style="color: #75af00">y</span><span style="color: #111111">,</span> <span style="color: #75af00">v</span><span style="color: #111111">.</span><span style="color: #75af00">z</span> <span style="color: #f92672">+</span> <span style="color: #75af00">w</span><span style="color: #111111">.</span><span style="color: #75af00">z</span><span style="color: #111111">}</span> <span style="color: #111111">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #00a8c8">func</span> <span style="color: #111111">(</span><span style="color: #75af00">v</span> <span style="color: #75af00">vec3</span><span style="color: #111111">)</span> <span style="color: #75af00">mul</span><span style="color: #111111">(</span><span style="color: #75af00">s</span> <span style="color: #00a8c8">float64</span><span style="color: #111111">)</span> <span style="color: #75af00">vec3</span> <span style="color: #111111">{</span> <span style="color: #00a8c8">return</span> <span style="color: #75af00">vec3</span><span style="color: #111111">{</span><span style="color: #75af00">v</span><span style="color: #111111">.</span><span style="color: #75af00">x</span> <span style="color: #f92672">*</span> <span style="color: #75af00">s</span><span style="color: #111111">,</span> <span style="color: #75af00">v</span><span style="color: #111111">.</span><span style="color: #75af00">y</span> <span style="color: #f92672">*</span> <span style="color: #75af00">s</span><span style="color: #111111">,</span> <span style="color: #75af00">v</span><span style="color: #111111">.</span><span style="color: #75af00">z</span> <span style="color: #f92672">*</span> <span style="color: #75af00">s</span><span style="color: #111111">}</span> <span style="color: #111111">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #00a8c8">func</span> <span style="color: #111111">(</span><span style="color: #75af00">v</span> <span style="color: #75af00">vec3</span><span style="color: #111111">)</span> <span style="color: #75af00">length</span><span style="color: #111111">()</span> <span style="color: #00a8c8">float64</span>    <span style="color: #111111">{</span> <span style="color: #00a8c8">return</span> <span style="color: #75af00">math</span><span style="color: #111111">.</span><span style="color: #75af00">Sqrt</span><span style="color: #111111">(</span><span style="color: #75af00">v</span><span style="color: #111111">.</span><span style="color: #75af00">x</span><span style="color: #f92672">*</span><span style="color: #75af00">v</span><span style="color: #111111">.</span><span style="color: #75af00">x</span> <span style="color: #f92672">+</span> <span style="color: #75af00">v</span><span style="color: #111111">.</span><span style="color: #75af00">y</span><span style="color: #f92672">*</span><span style="color: #75af00">v</span><span style="color: #111111">.</span><span style="color: #75af00">y</span> <span style="color: #f92672">+</span> <span style="color: #75af00">v</span><span style="color: #111111">.</span><span style="color: #75af00">z</span><span style="color: #f92672">*</span><span style="color: #75af00">v</span><span style="color: #111111">.</span><span style="color: #75af00">z</span><span style="color: #111111">)</span> <span style="color: #111111">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #00a8c8">func</span> <span style="color: #111111">(</span><span style="color: #75af00">v</span> <span style="color: #75af00">vec3</span><span style="color: #111111">)</span> <span style="color: #75af00">normalize</span><span style="color: #111111">()</span> <span style="color: #75af00">vec3</span>    <span style="color: #111111">{</span> <span style="color: #00a8c8">return</span> <span style="color: #75af00">v</span><span style="color: #111111">.</span><span style="color: #75af00">mul</span><span style="color: #111111">(</span><span style="color: #ae81ff">1</span> <span style="color: #f92672">/</span> <span style="color: #75af00">v</span><span style="color: #111111">.</span><span style="color: #75af00">length</span><span style="color: #111111">())</span> <span style="color: #111111">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #00a8c8">func</span> <span style="color: #75af00">mandelbulb</span><span style="color: #111111">(</span><span style="color: #75af00">p</span> <span style="color: #75af00">vec3</span><span style="color: #111111">)</span> <span style="color: #00a8c8">float64</span> <span style="color: #111111">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #75af00">z</span><span style="color: #111111">,</span> <span style="color: #75af00">r</span><span style="color: #111111">,</span> <span style="color: #75af00">theta</span><span style="color: #111111">,</span> <span style="color: #75af00">phi</span> <span style="color: #f92672">:=</span> <span style="color: #75af00">p</span><span style="color: #111111">,</span> <span style="color: #ae81ff">0.0</span><span style="color: #111111">,</span> <span style="color: #ae81ff">0.0</span><span style="color: #111111">,</span> <span style="color: #ae81ff">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #00a8c8">for</span> <span style="color: #75af00">i</span> <span style="color: #f92672">:=</span> <span style="color: #ae81ff">0</span><span style="color: #111111">;</span> <span style="color: #75af00">i</span> <span style="color: #111111">&lt;</span> <span style="color: #75af00">maxIter</span><span style="color: #111111">;</span> <span style="color: #75af00">i</span><span style="color: #f92672">++</span> <span style="color: #111111">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #75af00">r</span> <span style="color: #111111">=</span> <span style="color: #75af00">z</span><span style="color: #111111">.</span><span style="color: #75af00">length</span><span style="color: #111111">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #00a8c8">if</span> <span style="color: #75af00">r</span> <span style="color: #111111">&gt;</span> <span style="color: #75af00">escapeRadius</span> <span style="color: #111111">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #00a8c8">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #111111">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #75af00">theta</span><span style="color: #111111">,</span> <span style="color: #75af00">phi</span> <span style="color: #111111">=</span> <span style="color: #75af00">math</span><span style="color: #111111">.</span><span style="color: #75af00">Acos</span><span style="color: #111111">(</span><span style="color: #75af00">z</span><span style="color: #111111">.</span><span style="color: #75af00">z</span><span style="color: #f92672">/</span><span style="color: #75af00">r</span><span style="color: #111111">)</span><span style="color: #f92672">*</span><span style="color: #75af00">power</span><span style="color: #111111">,</span> <span style="color: #75af00">math</span><span style="color: #111111">.</span><span style="color: #75af00">Atan2</span><span style="color: #111111">(</span><span style="color: #75af00">z</span><span style="color: #111111">.</span><span style="color: #75af00">y</span><span style="color: #111111">,</span> <span style="color: #75af00">z</span><span style="color: #111111">.</span><span style="color: #75af00">x</span><span style="color: #111111">)</span><span style="color: #f92672">*</span><span style="color: #75af00">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #75af00">r</span> <span style="color: #111111">=</span> <span style="color: #75af00">math</span><span style="color: #111111">.</span><span style="color: #75af00">Pow</span><span style="color: #111111">(</span><span style="color: #75af00">r</span><span style="color: #111111">,</span> <span style="color: #75af00">power</span><span style="color: #111111">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #75af00">z</span><span style="color: #111111">.</span><span style="color: #75af00">x</span><span style="color: #111111">,</span> <span style="color: #75af00">z</span><span style="color: #111111">.</span><span style="color: #75af00">y</span><span style="color: #111111">,</span> <span style="color: #75af00">z</span><span style="color: #111111">.</span><span style="color: #75af00">z</span> <span style="color: #111111">=</span> <span style="color: #75af00">p</span><span style="color: #111111">.</span><span style="color: #75af00">x</span><span style="color: #f92672">+</span><span style="color: #75af00">r</span><span style="color: #f92672">*</span><span style="color: #75af00">math</span><span style="color: #111111">.</span><span style="color: #75af00">Sin</span><span style="color: #111111">(</span><span style="color: #75af00">theta</span><span style="color: #111111">)</span><span style="color: #f92672">*</span><span style="color: #75af00">math</span><span style="color: #111111">.</span><span style="color: #75af00">Cos</span><span style="color: #111111">(</span><span style="color: #75af00">phi</span><span style="color: #111111">),</span> <span style="color: #75af00">p</span><span style="color: #111111">.</span><span style="color: #75af00">y</span><span style="color: #f92672">+</span><span style="color: #75af00">r</span><span style="color: #f92672">*</span><span style="color: #75af00">math</span><span style="color: #111111">.</span><span style="color: #75af00">Sin</span><span style="color: #111111">(</span><span style="color: #75af00">theta</span><span style="color: #111111">)</span><span style="color: #f92672">*</span><span style="color: #75af00">math</span><span style="color: #111111">.</span><span style="color: #75af00">Sin</span><span style="color: #111111">(</span><span style="color: #75af00">phi</span><span style="color: #111111">),</span> <span style="color: #75af00">p</span><span style="color: #111111">.</span><span style="color: #75af00">z</span><span style="color: #f92672">+</span><span style="color: #75af00">r</span><span style="color: #f92672">*</span><span style="color: #75af00">math</span><span style="color: #111111">.</span><span style="color: #75af00">Cos</span><span style="color: #111111">(</span><span style="color: #75af00">theta</span><span style="color: #111111">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #111111">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #00a8c8">return</span> <span style="color: #75af00">r</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #111111">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #00a8c8">func</span> <span style="color: #75af00">renderPixel</span><span style="color: #111111">(</span><span style="color: #75af00">x</span><span style="color: #111111">,</span> <span style="color: #75af00">y</span> <span style="color: #00a8c8">int</span><span style="color: #111111">)</span> <span style="color: #75af00">color</span><span style="color: #111111">.</span><span style="color: #75af00">Color</span> <span style="color: #111111">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #75af00">px</span><span style="color: #111111">,</span> <span style="color: #75af00">py</span> <span style="color: #f92672">:=</span> <span style="color: #111111">(</span><span style="color: #ae81ff">2</span><span style="color: #f92672">*</span><span style="color: #111111">float64</span><span style="color: #111111">(</span><span style="color: #75af00">x</span><span style="color: #111111">)</span><span style="color: #f92672">/</span><span style="color: #111111">float64</span><span style="color: #111111">(</span><span style="color: #75af00">ssWidth</span><span style="color: #111111">)</span><span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #111111">)</span><span style="color: #f92672">*</span><span style="color: #75af00">aspectRatio</span><span style="color: #f92672">*</span><span style="color: #75af00">math</span><span style="color: #111111">.</span><span style="color: #75af00">Tan</span><span style="color: #111111">(</span><span style="color: #75af00">fov</span><span style="color: #f92672">/</span><span style="color: #ae81ff">2</span><span style="color: #111111">),</span> <span style="color: #111111">(</span><span style="color: #ae81ff">1</span><span style="color: #f92672">-</span><span style="color: #ae81ff">2</span><span style="color: #f92672">*</span><span style="color: #111111">float64</span><span style="color: #111111">(</span><span style="color: #75af00">y</span><span style="color: #111111">)</span><span style="color: #f92672">/</span><span style="color: #111111">float64</span><span style="color: #111111">(</span><span style="color: #75af00">ssHeight</span><span style="color: #111111">))</span><span style="color: #f92672">*</span><span style="color: #75af00">math</span><span style="color: #111111">.</span><span style="color: #75af00">Tan</span><span style="color: #111111">(</span><span style="color: #75af00">fov</span><span style="color: #f92672">/</span><span style="color: #ae81ff">2</span><span style="color: #111111">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #75af00">direction</span> <span style="color: #f92672">:=</span> <span style="color: #75af00">vec3</span><span style="color: #111111">{</span><span style="color: #75af00">px</span><span style="color: #111111">,</span> <span style="color: #75af00">py</span><span style="color: #111111">,</span> <span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #111111">}.</span><span style="color: #75af00">normalize</span><span style="color: #111111">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #75af00">t</span> <span style="color: #f92672">:=</span> <span style="color: #ae81ff">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #00a8c8">for</span> <span style="color: #75af00">i</span> <span style="color: #f92672">:=</span> <span style="color: #ae81ff">0</span><span style="color: #111111">;</span> <span style="color: #75af00">i</span> <span style="color: #111111">&lt;</span> <span style="color: #75af00">maxIter</span><span style="color: #111111">;</span> <span style="color: #75af00">i</span><span style="color: #f92672">++</span> <span style="color: #111111">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #75af00">p</span> <span style="color: #f92672">:=</span> <span style="color: #75af00">direction</span><span style="color: #111111">.</span><span style="color: #75af00">mul</span><span style="color: #111111">(</span><span style="color: #75af00">t</span><span style="color: #111111">).</span><span style="color: #75af00">add</span><span style="color: #111111">(</span><span style="color: #75af00">vec3</span><span style="color: #111111">{</span><span style="color: #ae81ff">0</span><span style="color: #111111">,</span> <span style="color: #ae81ff">0</span><span style="color: #111111">,</span> <span style="color: #ae81ff">5</span><span style="color: #111111">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #75af00">d</span> <span style="color: #f92672">:=</span> <span style="color: #75af00">mandelbulb</span><span style="color: #111111">(</span><span style="color: #75af00">p</span><span style="color: #111111">)</span> <span style="color: #f92672">-</span> <span style="color: #ae81ff">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #00a8c8">if</span> <span style="color: #75af00">d</span> <span style="color: #111111">&lt;</span> <span style="color: #ae81ff">0.001</span> <span style="color: #111111">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #00a8c8">return</span> <span style="color: #75af00">color</span><span style="color: #111111">.</span><span style="color: #75af00">Gray</span><span style="color: #111111">{</span><span style="color: #111111">uint8</span><span style="color: #111111">(</span><span style="color: #ae81ff">255</span> <span style="color: #f92672">-</span> <span style="color: #75af00">t</span><span style="color: #f92672">*</span><span style="color: #ae81ff">255</span><span style="color: #f92672">/</span><span style="color: #ae81ff">100</span><span style="color: #111111">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #111111">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #75af00">t</span> <span style="color: #f92672">+=</span> <span style="color: #75af00">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #00a8c8">if</span> <span style="color: #75af00">t</span> <span style="color: #111111">&gt;</span> <span style="color: #ae81ff">100</span> <span style="color: #111111">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #00a8c8">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #111111">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #111111">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #00a8c8">return</span> <span style="color: #75af00">color</span><span style="color: #111111">.</span><span style="color: #75af00">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #111111">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #00a8c8">func</span> <span style="color: #75af00">main</span><span style="color: #111111">()</span> <span style="color: #111111">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #75af00">ssImg</span> <span style="color: #f92672">:=</span> <span style="color: #75af00">image</span><span style="color: #111111">.</span><span style="color: #75af00">NewRGBA</span><span style="color: #111111">(</span><span style="color: #75af00">image</span><span style="color: #111111">.</span><span style="color: #75af00">Rect</span><span style="color: #111111">(</span><span style="color: #ae81ff">0</span><span style="color: #111111">,</span> <span style="color: #ae81ff">0</span><span style="color: #111111">,</span> <span style="color: #75af00">ssWidth</span><span style="color: #111111">,</span> <span style="color: #75af00">ssHeight</span><span style="color: #111111">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #00a8c8">for</span> <span style="color: #75af00">y</span> <span style="color: #f92672">:=</span> <span style="color: #ae81ff">0</span><span style="color: #111111">;</span> <span style="color: #75af00">y</span> <span style="color: #111111">&lt;</span> <span style="color: #75af00">ssHeight</span><span style="color: #111111">;</span> <span style="color: #75af00">y</span><span style="color: #f92672">++</span> <span style="color: #111111">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #75af00">wg</span><span style="color: #111111">.</span><span style="color: #75af00">Add</span><span style="color: #111111">(</span><span style="color: #ae81ff">1</span><span style="color: #111111">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #00a8c8">go</span> <span style="color: #00a8c8">func</span><span style="color: #111111">(</span><span style="color: #75af00">y</span> <span style="color: #00a8c8">int</span><span style="color: #111111">)</span> <span style="color: #111111">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #00a8c8">defer</span> <span style="color: #75af00">wg</span><span style="color: #111111">.</span><span style="color: #75af00">Done</span><span style="color: #111111">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #00a8c8">for</span> <span style="color: #75af00">x</span> <span style="color: #f92672">:=</span> <span style="color: #ae81ff">0</span><span style="color: #111111">;</span> <span style="color: #75af00">x</span> <span style="color: #111111">&lt;</span> <span style="color: #75af00">ssWidth</span><span style="color: #111111">;</span> <span style="color: #75af00">x</span><span style="color: #f92672">++</span> <span style="color: #111111">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #75af00">ssImg</span><span style="color: #111111">.</span><span style="color: #75af00">Set</span><span style="color: #111111">(</span><span style="color: #75af00">x</span><span style="color: #111111">,</span> <span style="color: #75af00">y</span><span style="color: #111111">,</span> <span style="color: #75af00">renderPixel</span><span style="color: #111111">(</span><span style="color: #75af00">x</span><span style="color: #111111">,</span> <span style="color: #75af00">y</span><span style="color: #111111">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #111111">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #111111">}(</span><span style="color: #75af00">y</span><span style="color: #111111">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #111111">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #75af00">wg</span><span style="color: #111111">.</span><span style="color: #75af00">Wait</span><span style="color: #111111">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #75af00">img</span> <span style="color: #f92672">:=</span> <span style="color: #75af00">image</span><span style="color: #111111">.</span><span style="color: #75af00">NewRGBA</span><span style="color: #111111">(</span><span style="color: #75af00">image</span><span style="color: #111111">.</span><span style="color: #75af00">Rect</span><span style="color: #111111">(</span><span style="color: #ae81ff">0</span><span style="color: #111111">,</span> <span style="color: #ae81ff">0</span><span style="color: #111111">,</span> <span style="color: #75af00">width</span><span style="color: #111111">,</span> <span style="color: #75af00">height</span><span style="color: #111111">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #00a8c8">for</span> <span style="color: #75af00">y</span> <span style="color: #f92672">:=</span> <span style="color: #ae81ff">0</span><span style="color: #111111">;</span> <span style="color: #75af00">y</span> <span style="color: #111111">&lt;</span> <span style="color: #75af00">height</span><span style="color: #111111">;</span> <span style="color: #75af00">y</span><span style="color: #f92672">++</span> <span style="color: #111111">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #00a8c8">for</span> <span style="color: #75af00">x</span> <span style="color: #f92672">:=</span> <span style="color: #ae81ff">0</span><span style="color: #111111">;</span> <span style="color: #75af00">x</span> <span style="color: #111111">&lt;</span> <span style="color: #75af00">width</span><span style="color: #111111">;</span> <span style="color: #75af00">x</span><span style="color: #f92672">++</span> <span style="color: #111111">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #75af00">r</span><span style="color: #111111">,</span> <span style="color: #75af00">g</span><span style="color: #111111">,</span> <span style="color: #75af00">b</span><span style="color: #111111">,</span> <span style="color: #75af00">a</span> <span style="color: #f92672">:=</span> <span style="color: #ae81ff">0</span><span style="color: #111111">,</span> <span style="color: #ae81ff">0</span><span style="color: #111111">,</span> <span style="color: #ae81ff">0</span><span style="color: #111111">,</span> <span style="color: #ae81ff">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #00a8c8">for</span> <span style="color: #75af00">dy</span> <span style="color: #f92672">:=</span> <span style="color: #ae81ff">0</span><span style="color: #111111">;</span> <span style="color: #75af00">dy</span> <span style="color: #111111">&lt;</span> <span style="color: #75af00">supersamplingRatio</span><span style="color: #111111">;</span> <span style="color: #75af00">dy</span><span style="color: #f92672">++</span> <span style="color: #111111">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #00a8c8">for</span> <span style="color: #75af00">dx</span> <span style="color: #f92672">:=</span> <span style="color: #ae81ff">0</span><span style="color: #111111">;</span> <span style="color: #75af00">dx</span> <span style="color: #111111">&lt;</span> <span style="color: #75af00">supersamplingRatio</span><span style="color: #111111">;</span> <span style="color: #75af00">dx</span><span style="color: #f92672">++</span> <span style="color: #111111">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #75af00">c</span> <span style="color: #f92672">:=</span> <span style="color: #75af00">ssImg</span><span style="color: #111111">.</span><span style="color: #75af00">RGBAAt</span><span style="color: #111111">(</span><span style="color: #75af00">x</span><span style="color: #f92672">*</span><span style="color: #75af00">supersamplingRatio</span><span style="color: #f92672">+</span><span style="color: #75af00">dx</span><span style="color: #111111">,</span> <span style="color: #75af00">y</span><span style="color: #f92672">*</span><span style="color: #75af00">supersamplingRatio</span><span style="color: #f92672">+</span><span style="color: #75af00">dy</span><span style="color: #111111">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #75af00">r</span> <span style="color: #f92672">+=</span> <span style="color: #111111">int</span><span style="color: #111111">(</span><span style="color: #75af00">c</span><span style="color: #111111">.</span><span style="color: #75af00">R</span><span style="color: #111111">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #75af00">g</span> <span style="color: #f92672">+=</span> <span style="color: #111111">int</span><span style="color: #111111">(</span><span style="color: #75af00">c</span><span style="color: #111111">.</span><span style="color: #75af00">G</span><span style="color: #111111">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #75af00">b</span> <span style="color: #f92672">+=</span> <span style="color: #111111">int</span><span style="color: #111111">(</span><span style="color: #75af00">c</span><span style="color: #111111">.</span><span style="color: #75af00">B</span><span style="color: #111111">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #75af00">a</span> <span style="color: #f92672">+=</span> <span style="color: #111111">int</span><span style="color: #111111">(</span><span style="color: #75af00">c</span><span style="color: #111111">.</span><span style="color: #75af00">A</span><span style="color: #111111">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #111111">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #111111">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #75af00">r</span> <span style="color: #f92672">/=</span> <span style="color: #75af00">supersamplingRatio</span> <span style="color: #f92672">*</span> <span style="color: #75af00">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #75af00">g</span> <span style="color: #f92672">/=</span> <span style="color: #75af00">supersamplingRatio</span> <span style="color: #f92672">*</span> <span style="color: #75af00">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #75af00">b</span> <span style="color: #f92672">/=</span> <span style="color: #75af00">supersamplingRatio</span> <span style="color: #f92672">*</span> <span style="color: #75af00">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #75af00">a</span> <span style="color: #f92672">/=</span> <span style="color: #75af00">supersamplingRatio</span> <span style="color: #f92672">*</span> <span style="color: #75af00">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #75af00">img</span><span style="color: #111111">.</span><span style="color: #75af00">Set</span><span style="color: #111111">(</span><span style="color: #75af00">x</span><span style="color: #111111">,</span> <span style="color: #75af00">y</span><span style="color: #111111">,</span> <span style="color: #75af00">color</span><span style="color: #111111">.</span><span style="color: #75af00">RGBA</span><span style="color: #111111">{</span><span style="color: #111111">uint8</span><span style="color: #111111">(</span><span style="color: #75af00">r</span><span style="color: #111111">),</span> <span style="color: #111111">uint8</span><span style="color: #111111">(</span><span style="color: #75af00">g</span><span style="color: #111111">),</span> <span style="color: #111111">uint8</span><span style="color: #111111">(</span><span style="color: #75af00">b</span><span style="color: #111111">),</span> <span style="color: #111111">uint8</span><span style="color: #111111">(</span><span style="color: #75af00">a</span><span style="color: #111111">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #111111">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #111111">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #75af00">file</span><span style="color: #111111">,</span> <span style="color: #75af00">err</span> <span style="color: #f92672">:=</span> <span style="color: #75af00">os</span><span style="color: #111111">.</span><span style="color: #75af00">Create</span><span style="color: #111111">(</span><span style="color: #d88200">&#34;mandelbulb.png&#34;</span><span style="color: #111111">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #00a8c8">if</span> <span style="color: #75af00">err</span> <span style="color: #f92672">!=</span> <span style="color: #00a8c8">nil</span> <span style="color: #111111">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #75af00">fmt</span><span style="color: #111111">.</span><span style="color: #75af00">Println</span><span style="color: #111111">(</span><span style="color: #d88200">&#34;Error creating file:&#34;</span><span style="color: #111111">,</span> <span style="color: #75af00">err</span><span style="color: #111111">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #00a8c8">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #111111">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #00a8c8">defer</span> <span style="color: #75af00">file</span><span style="color: #111111">.</span><span style="color: #75af00">Close</span><span style="color: #111111">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #75af00">err</span> <span style="color: #111111">=</span> <span style="color: #75af00">png</span><span style="color: #111111">.</span><span style="color: #75af00">Encode</span><span style="color: #111111">(</span><span style="color: #75af00">file</span><span style="color: #111111">,</span> <span style="color: #75af00">img</span><span style="color: #111111">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #00a8c8">if</span> <span style="color: #75af00">err</span> <span style="color: #f92672">!=</span> <span style="color: #00a8c8">nil</span> <span style="color: #111111">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #75af00">fmt</span><span style="color: #111111">.</span><span style="color: #75af00">Println</span><span style="color: #111111">(</span><span style="color: #d88200">&#34;Error encoding image:&#34;</span><span style="color: #111111">,</span> <span style="color: #75af00">err</span><span style="color: #111111">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #111111">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #111111">}</span></span></span></code></pre></code><a name='murphy'><h2><a id='stylelink' href='murphy.html' alt='View only murphy'>murphy</a></h2></a><code><pre style="background-color: #ffffff;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #228899; font-weight: bold">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #666666; font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #666666; font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #666666; font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #666666; font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #228899; font-weight: bold">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="background-color: #e0e0ff">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="background-color: #e0e0ff">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="background-color: #e0e0ff">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="background-color: #e0e0ff">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="background-color: #e0e0ff">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="background-color: #e0e0ff">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="background-color: #e0e0ff">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #228899; font-weight: bold">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span style="color: #6666ff; font-weight: bold">1920</span><span class="p">,</span> <span style="color: #6666ff; font-weight: bold">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span style="color: #6666ff; font-weight: bold">3840</span><span class="p">,</span> <span style="color: #6666ff; font-weight: bold">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span style="color: #007722">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span style="color: #333333">/</span> <span style="color: #007722">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span style="color: #333333">/</span> <span style="color: #6666ff; font-weight: bold">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span style="color: #6666ff; font-weight: bold">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span style="color: #6666ff; font-weight: bold">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span style="color: #6600ee; font-weight: bold">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span style="color: #6666ff; font-weight: bold">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #228899; font-weight: bold">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #228899; font-weight: bold">type</span> <span class="nx">vec3</span> <span style="color: #228899; font-weight: bold">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #6666ff; font-weight: bold">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #228899; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #55eedd; font-weight: bold">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #228899; font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #333333">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #333333">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #333333">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #228899; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #55eedd; font-weight: bold">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #6666ff; font-weight: bold">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #228899; font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #333333">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #333333">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #333333">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #228899; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #55eedd; font-weight: bold">length</span><span class="p">()</span> <span style="color: #6666ff; font-weight: bold">float64</span>    <span class="p">{</span> <span style="color: #228899; font-weight: bold">return</span> <span class="nx">math</span><span class="p">.</span><span style="color: #55eedd; font-weight: bold">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span style="color: #333333">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #333333">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span style="color: #333333">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #333333">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span style="color: #333333">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #228899; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #55eedd; font-weight: bold">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #228899; font-weight: bold">return</span> <span class="nx">v</span><span class="p">.</span><span style="color: #55eedd; font-weight: bold">mul</span><span class="p">(</span><span style="color: #6666ff; font-weight: bold">1</span> <span style="color: #333333">/</span> <span class="nx">v</span><span class="p">.</span><span style="color: #55eedd; font-weight: bold">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #228899; font-weight: bold">func</span> <span style="color: #55eedd; font-weight: bold">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #6666ff; font-weight: bold">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span style="color: #333333">:=</span> <span class="nx">p</span><span class="p">,</span> <span style="color: #6600ee; font-weight: bold">0.0</span><span class="p">,</span> <span style="color: #6600ee; font-weight: bold">0.0</span><span class="p">,</span> <span style="color: #6600ee; font-weight: bold">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #228899; font-weight: bold">for</span> <span class="nx">i</span> <span style="color: #333333">:=</span> <span style="color: #6666ff; font-weight: bold">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #333333">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span style="color: #55eedd; font-weight: bold">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #228899; font-weight: bold">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #228899; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #55eedd; font-weight: bold">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span style="color: #333333">/</span><span class="nx">r</span><span class="p">)</span><span style="color: #333333">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span style="color: #55eedd; font-weight: bold">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span style="color: #333333">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #55eedd; font-weight: bold">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span style="color: #333333">+</span><span class="nx">r</span><span style="color: #333333">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #55eedd; font-weight: bold">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #333333">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #55eedd; font-weight: bold">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span style="color: #333333">+</span><span class="nx">r</span><span style="color: #333333">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #55eedd; font-weight: bold">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #333333">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #55eedd; font-weight: bold">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span style="color: #333333">+</span><span class="nx">r</span><span style="color: #333333">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #55eedd; font-weight: bold">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #228899; font-weight: bold">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #228899; font-weight: bold">func</span> <span style="color: #55eedd; font-weight: bold">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #6666ff; font-weight: bold">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span style="color: #333333">:=</span> <span class="p">(</span><span style="color: #6666ff; font-weight: bold">2</span><span style="color: #333333">*</span><span style="color: #007722">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span style="color: #333333">/</span><span style="color: #007722">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span style="color: #333333">-</span><span style="color: #6666ff; font-weight: bold">1</span><span class="p">)</span><span style="color: #333333">*</span><span class="nx">aspectRatio</span><span style="color: #333333">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #55eedd; font-weight: bold">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #333333">/</span><span style="color: #6666ff; font-weight: bold">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #6666ff; font-weight: bold">1</span><span style="color: #333333">-</span><span style="color: #6666ff; font-weight: bold">2</span><span style="color: #333333">*</span><span style="color: #007722">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span style="color: #333333">/</span><span style="color: #007722">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span style="color: #333333">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #55eedd; font-weight: bold">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #333333">/</span><span style="color: #6666ff; font-weight: bold">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span style="color: #333333">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span style="color: #333333">-</span><span style="color: #6666ff; font-weight: bold">1</span><span class="p">}.</span><span style="color: #55eedd; font-weight: bold">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span style="color: #333333">:=</span> <span style="color: #6600ee; font-weight: bold">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #228899; font-weight: bold">for</span> <span class="nx">i</span> <span style="color: #333333">:=</span> <span style="color: #6666ff; font-weight: bold">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #333333">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span style="color: #333333">:=</span> <span class="nx">direction</span><span class="p">.</span><span style="color: #55eedd; font-weight: bold">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span style="color: #55eedd; font-weight: bold">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span style="color: #6666ff; font-weight: bold">0</span><span class="p">,</span> <span style="color: #6666ff; font-weight: bold">0</span><span class="p">,</span> <span style="color: #6666ff; font-weight: bold">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span style="color: #333333">:=</span> <span style="color: #55eedd; font-weight: bold">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span style="color: #333333">-</span> <span style="color: #6666ff; font-weight: bold">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #228899; font-weight: bold">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span style="color: #6600ee; font-weight: bold">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #228899; font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span style="color: #007722">uint8</span><span class="p">(</span><span style="color: #6666ff; font-weight: bold">255</span> <span style="color: #333333">-</span> <span class="nx">t</span><span style="color: #333333">*</span><span style="color: #6666ff; font-weight: bold">255</span><span style="color: #333333">/</span><span style="color: #6666ff; font-weight: bold">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span style="color: #333333">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #228899; font-weight: bold">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span style="color: #6666ff; font-weight: bold">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #228899; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #228899; font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #228899; font-weight: bold">func</span> <span style="color: #55eedd; font-weight: bold">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span style="color: #333333">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #55eedd; font-weight: bold">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #55eedd; font-weight: bold">Rect</span><span class="p">(</span><span style="color: #6666ff; font-weight: bold">0</span><span class="p">,</span> <span style="color: #6666ff; font-weight: bold">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #228899; font-weight: bold">for</span> <span class="nx">y</span> <span style="color: #333333">:=</span> <span style="color: #6666ff; font-weight: bold">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span style="color: #333333">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span style="color: #55eedd; font-weight: bold">Add</span><span class="p">(</span><span style="color: #6666ff; font-weight: bold">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #228899; font-weight: bold">go</span> <span style="color: #228899; font-weight: bold">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #6666ff; font-weight: bold">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #228899; font-weight: bold">defer</span> <span class="nx">wg</span><span class="p">.</span><span style="color: #55eedd; font-weight: bold">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #228899; font-weight: bold">for</span> <span class="nx">x</span> <span style="color: #333333">:=</span> <span style="color: #6666ff; font-weight: bold">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span style="color: #333333">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span style="color: #55eedd; font-weight: bold">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span style="color: #55eedd; font-weight: bold">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span style="color: #55eedd; font-weight: bold">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span style="color: #333333">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #55eedd; font-weight: bold">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #55eedd; font-weight: bold">Rect</span><span class="p">(</span><span style="color: #6666ff; font-weight: bold">0</span><span class="p">,</span> <span style="color: #6666ff; font-weight: bold">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #228899; font-weight: bold">for</span> <span class="nx">y</span> <span style="color: #333333">:=</span> <span style="color: #6666ff; font-weight: bold">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span style="color: #333333">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #228899; font-weight: bold">for</span> <span class="nx">x</span> <span style="color: #333333">:=</span> <span style="color: #6666ff; font-weight: bold">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span style="color: #333333">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span style="color: #333333">:=</span> <span style="color: #6666ff; font-weight: bold">0</span><span class="p">,</span> <span style="color: #6666ff; font-weight: bold">0</span><span class="p">,</span> <span style="color: #6666ff; font-weight: bold">0</span><span class="p">,</span> <span style="color: #6666ff; font-weight: bold">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #228899; font-weight: bold">for</span> <span class="nx">dy</span> <span style="color: #333333">:=</span> <span style="color: #6666ff; font-weight: bold">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span style="color: #333333">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #228899; font-weight: bold">for</span> <span class="nx">dx</span> <span style="color: #333333">:=</span> <span style="color: #6666ff; font-weight: bold">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span style="color: #333333">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span style="color: #333333">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span style="color: #55eedd; font-weight: bold">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span style="color: #333333">*</span><span class="nx">supersamplingRatio</span><span style="color: #333333">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span style="color: #333333">*</span><span class="nx">supersamplingRatio</span><span style="color: #333333">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span style="color: #333333">+=</span> <span style="color: #007722">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span style="color: #333333">+=</span> <span style="color: #007722">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span style="color: #333333">+=</span> <span style="color: #007722">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span style="color: #333333">+=</span> <span style="color: #007722">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span style="color: #333333">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #333333">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span style="color: #333333">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #333333">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span style="color: #333333">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #333333">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span style="color: #333333">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #333333">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span style="color: #55eedd; font-weight: bold">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span style="color: #007722">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span style="color: #007722">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span style="color: #007722">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span style="color: #007722">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span style="color: #333333">:=</span> <span class="nx">os</span><span class="p">.</span><span style="color: #55eedd; font-weight: bold">Create</span><span class="p">(</span><span style="background-color: #e0e0ff">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #228899; font-weight: bold">if</span> <span class="nx">err</span> <span style="color: #333333">!=</span> <span style="color: #228899; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #55eedd; font-weight: bold">Println</span><span class="p">(</span><span style="background-color: #e0e0ff">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #228899; font-weight: bold">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #228899; font-weight: bold">defer</span> <span class="nx">file</span><span class="p">.</span><span style="color: #55eedd; font-weight: bold">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span style="color: #55eedd; font-weight: bold">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #228899; font-weight: bold">if</span> <span class="nx">err</span> <span style="color: #333333">!=</span> <span style="color: #228899; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #55eedd; font-weight: bold">Println</span><span class="p">(</span><span style="background-color: #e0e0ff">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='native'><h2><a id='stylelink' href='native.html' alt='View only native'>native</a></h2></a><code><pre style="color: #d0d0d0; background-color: #202020;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #6ab825; font-weight: bold">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #999999; font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #999999; font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #999999; font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #999999; font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #6ab825; font-weight: bold">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ed9d13">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ed9d13">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ed9d13">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ed9d13">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ed9d13">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ed9d13">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ed9d13">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #6ab825; font-weight: bold">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span style="color: #3677a9">1920</span><span class="p">,</span> <span style="color: #3677a9">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span style="color: #3677a9">3840</span><span class="p">,</span> <span style="color: #3677a9">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span style="color: #24909d">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span class="o">/</span> <span style="color: #24909d">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span class="o">/</span> <span style="color: #3677a9">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span style="color: #3677a9">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span style="color: #3677a9">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span style="color: #3677a9">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span style="color: #3677a9">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #6ab825; font-weight: bold">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #6ab825; font-weight: bold">type</span> <span class="nx">vec3</span> <span style="color: #6ab825; font-weight: bold">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #6ab825; font-weight: bold">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #6ab825; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #447fcf">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #6ab825; font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #6ab825; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #447fcf">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #6ab825; font-weight: bold">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #6ab825; font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #6ab825; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #447fcf">length</span><span class="p">()</span> <span style="color: #6ab825; font-weight: bold">float64</span>    <span class="p">{</span> <span style="color: #6ab825; font-weight: bold">return</span> <span class="nx">math</span><span class="p">.</span><span style="color: #447fcf">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #6ab825; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #447fcf">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #6ab825; font-weight: bold">return</span> <span class="nx">v</span><span class="p">.</span><span style="color: #447fcf">mul</span><span class="p">(</span><span style="color: #3677a9">1</span> <span class="o">/</span> <span class="nx">v</span><span class="p">.</span><span style="color: #447fcf">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #6ab825; font-weight: bold">func</span> <span style="color: #447fcf">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #6ab825; font-weight: bold">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="o">:=</span> <span class="nx">p</span><span class="p">,</span> <span style="color: #3677a9">0.0</span><span class="p">,</span> <span style="color: #3677a9">0.0</span><span class="p">,</span> <span style="color: #3677a9">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #6ab825; font-weight: bold">for</span> <span class="nx">i</span> <span class="o">:=</span> <span style="color: #3677a9">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span style="color: #447fcf">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #6ab825; font-weight: bold">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #6ab825; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #447fcf">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span class="o">/</span><span class="nx">r</span><span class="p">)</span><span class="o">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span style="color: #447fcf">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="o">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #447fcf">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #447fcf">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #447fcf">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #447fcf">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #447fcf">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #447fcf">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #6ab825; font-weight: bold">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #6ab825; font-weight: bold">func</span> <span style="color: #447fcf">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #6ab825; font-weight: bold">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span class="o">:=</span> <span class="p">(</span><span style="color: #3677a9">2</span><span class="o">*</span><span style="color: #24909d">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="o">/</span><span style="color: #24909d">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span class="o">-</span><span style="color: #3677a9">1</span><span class="p">)</span><span class="o">*</span><span class="nx">aspectRatio</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #447fcf">Tan</span><span class="p">(</span><span class="nx">fov</span><span class="o">/</span><span style="color: #3677a9">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #3677a9">1</span><span class="o">-</span><span style="color: #3677a9">2</span><span class="o">*</span><span style="color: #24909d">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span class="o">/</span><span style="color: #24909d">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #447fcf">Tan</span><span class="p">(</span><span class="nx">fov</span><span class="o">/</span><span style="color: #3677a9">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span class="o">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span class="o">-</span><span style="color: #3677a9">1</span><span class="p">}.</span><span style="color: #447fcf">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span class="o">:=</span> <span style="color: #3677a9">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #6ab825; font-weight: bold">for</span> <span class="nx">i</span> <span class="o">:=</span> <span style="color: #3677a9">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span class="o">:=</span> <span class="nx">direction</span><span class="p">.</span><span style="color: #447fcf">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span style="color: #447fcf">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span style="color: #3677a9">0</span><span class="p">,</span> <span style="color: #3677a9">0</span><span class="p">,</span> <span style="color: #3677a9">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span class="o">:=</span> <span style="color: #447fcf">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="o">-</span> <span style="color: #3677a9">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #6ab825; font-weight: bold">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span style="color: #3677a9">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #6ab825; font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span style="color: #24909d">uint8</span><span class="p">(</span><span style="color: #3677a9">255</span> <span class="o">-</span> <span class="nx">t</span><span class="o">*</span><span style="color: #3677a9">255</span><span class="o">/</span><span style="color: #3677a9">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span class="o">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #6ab825; font-weight: bold">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span style="color: #3677a9">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #6ab825; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #6ab825; font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #6ab825; font-weight: bold">func</span> <span style="color: #447fcf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #447fcf">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #447fcf">Rect</span><span class="p">(</span><span style="color: #3677a9">0</span><span class="p">,</span> <span style="color: #3677a9">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #6ab825; font-weight: bold">for</span> <span class="nx">y</span> <span class="o">:=</span> <span style="color: #3677a9">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span style="color: #447fcf">Add</span><span class="p">(</span><span style="color: #3677a9">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #6ab825; font-weight: bold">go</span> <span style="color: #6ab825; font-weight: bold">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #6ab825; font-weight: bold">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #6ab825; font-weight: bold">defer</span> <span class="nx">wg</span><span class="p">.</span><span style="color: #447fcf">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #6ab825; font-weight: bold">for</span> <span class="nx">x</span> <span class="o">:=</span> <span style="color: #3677a9">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span style="color: #447fcf">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span style="color: #447fcf">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span style="color: #447fcf">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #447fcf">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #447fcf">Rect</span><span class="p">(</span><span style="color: #3677a9">0</span><span class="p">,</span> <span style="color: #3677a9">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #6ab825; font-weight: bold">for</span> <span class="nx">y</span> <span class="o">:=</span> <span style="color: #3677a9">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #6ab825; font-weight: bold">for</span> <span class="nx">x</span> <span class="o">:=</span> <span style="color: #3677a9">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span class="o">:=</span> <span style="color: #3677a9">0</span><span class="p">,</span> <span style="color: #3677a9">0</span><span class="p">,</span> <span style="color: #3677a9">0</span><span class="p">,</span> <span style="color: #3677a9">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #6ab825; font-weight: bold">for</span> <span class="nx">dy</span> <span class="o">:=</span> <span style="color: #3677a9">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #6ab825; font-weight: bold">for</span> <span class="nx">dx</span> <span class="o">:=</span> <span style="color: #3677a9">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span class="o">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span style="color: #447fcf">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span class="o">*</span><span class="nx">supersamplingRatio</span><span class="o">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span class="o">*</span><span class="nx">supersamplingRatio</span><span class="o">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span class="o">+=</span> <span style="color: #24909d">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span class="o">+=</span> <span style="color: #24909d">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span class="o">+=</span> <span style="color: #24909d">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span class="o">+=</span> <span style="color: #24909d">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span style="color: #447fcf">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span style="color: #24909d">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span style="color: #24909d">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span style="color: #24909d">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span style="color: #24909d">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span style="color: #447fcf">Create</span><span class="p">(</span><span style="color: #ed9d13">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #6ab825; font-weight: bold">if</span> <span class="nx">err</span> <span class="o">!=</span> <span style="color: #6ab825; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #447fcf">Println</span><span class="p">(</span><span style="color: #ed9d13">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #6ab825; font-weight: bold">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #6ab825; font-weight: bold">defer</span> <span class="nx">file</span><span class="p">.</span><span style="color: #447fcf">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span style="color: #447fcf">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #6ab825; font-weight: bold">if</span> <span class="nx">err</span> <span class="o">!=</span> <span style="color: #6ab825; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #447fcf">Println</span><span class="p">(</span><span style="color: #ed9d13">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='nord'><h2><a id='stylelink' href='nord.html' alt='View only nord'>nord</a></h2></a><code><pre style="color: #d8dee9; background-color: #2e3440;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #81a1c1; font-weight: bold">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #616e87; font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #616e87; font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #616e87; font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #616e87; font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #81a1c1; font-weight: bold">import</span> <span style="color: #eceff4">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a3be8c">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a3be8c">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a3be8c">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a3be8c">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a3be8c">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a3be8c">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a3be8c">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #eceff4">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #81a1c1; font-weight: bold">const</span> <span style="color: #eceff4">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span style="color: #eceff4">,</span> <span class="nx">height</span>      <span style="color: #eceff4">=</span> <span style="color: #b48ead">1920</span><span style="color: #eceff4">,</span> <span style="color: #b48ead">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span style="color: #eceff4">,</span> <span class="nx">ssHeight</span>  <span style="color: #eceff4">=</span> <span style="color: #b48ead">3840</span><span style="color: #eceff4">,</span> <span style="color: #b48ead">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span style="color: #eceff4">=</span> <span style="color: #81a1c1">float64</span><span style="color: #eceff4">(</span><span class="nx">ssWidth</span><span style="color: #eceff4">)</span> <span style="color: #81a1c1">/</span> <span style="color: #81a1c1">float64</span><span style="color: #eceff4">(</span><span class="nx">ssHeight</span><span style="color: #eceff4">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span style="color: #eceff4">=</span> <span class="nx">math</span><span style="color: #eceff4">.</span><span class="nx">Pi</span> <span style="color: #81a1c1">/</span> <span style="color: #b48ead">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span style="color: #eceff4">=</span> <span style="color: #b48ead">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span style="color: #eceff4">=</span> <span style="color: #b48ead">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span style="color: #eceff4">=</span> <span style="color: #b48ead">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span style="color: #eceff4">=</span> <span style="color: #b48ead">2</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #eceff4">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #81a1c1; font-weight: bold">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span style="color: #eceff4">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #81a1c1; font-weight: bold">type</span> <span class="nx">vec3</span> <span style="color: #81a1c1; font-weight: bold">struct</span><span style="color: #eceff4">{</span> <span class="nx">x</span><span style="color: #eceff4">,</span> <span class="nx">y</span><span style="color: #eceff4">,</span> <span class="nx">z</span> <span style="color: #81a1c1">float64</span> <span style="color: #eceff4">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #81a1c1; font-weight: bold">func</span> <span style="color: #eceff4">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #eceff4">)</span> <span style="color: #88c0d0">add</span><span style="color: #eceff4">(</span><span class="nx">w</span> <span class="nx">vec3</span><span style="color: #eceff4">)</span> <span class="nx">vec3</span>    <span style="color: #eceff4">{</span> <span style="color: #81a1c1; font-weight: bold">return</span> <span class="nx">vec3</span><span style="color: #eceff4">{</span><span class="nx">v</span><span style="color: #eceff4">.</span><span class="nx">x</span> <span style="color: #81a1c1">+</span> <span class="nx">w</span><span style="color: #eceff4">.</span><span class="nx">x</span><span style="color: #eceff4">,</span> <span class="nx">v</span><span style="color: #eceff4">.</span><span class="nx">y</span> <span style="color: #81a1c1">+</span> <span class="nx">w</span><span style="color: #eceff4">.</span><span class="nx">y</span><span style="color: #eceff4">,</span> <span class="nx">v</span><span style="color: #eceff4">.</span><span class="nx">z</span> <span style="color: #81a1c1">+</span> <span class="nx">w</span><span style="color: #eceff4">.</span><span class="nx">z</span><span style="color: #eceff4">}</span> <span style="color: #eceff4">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #81a1c1; font-weight: bold">func</span> <span style="color: #eceff4">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #eceff4">)</span> <span style="color: #88c0d0">mul</span><span style="color: #eceff4">(</span><span class="nx">s</span> <span style="color: #81a1c1">float64</span><span style="color: #eceff4">)</span> <span class="nx">vec3</span> <span style="color: #eceff4">{</span> <span style="color: #81a1c1; font-weight: bold">return</span> <span class="nx">vec3</span><span style="color: #eceff4">{</span><span class="nx">v</span><span style="color: #eceff4">.</span><span class="nx">x</span> <span style="color: #81a1c1">*</span> <span class="nx">s</span><span style="color: #eceff4">,</span> <span class="nx">v</span><span style="color: #eceff4">.</span><span class="nx">y</span> <span style="color: #81a1c1">*</span> <span class="nx">s</span><span style="color: #eceff4">,</span> <span class="nx">v</span><span style="color: #eceff4">.</span><span class="nx">z</span> <span style="color: #81a1c1">*</span> <span class="nx">s</span><span style="color: #eceff4">}</span> <span style="color: #eceff4">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #81a1c1; font-weight: bold">func</span> <span style="color: #eceff4">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #eceff4">)</span> <span style="color: #88c0d0">length</span><span style="color: #eceff4">()</span> <span style="color: #81a1c1">float64</span>    <span style="color: #eceff4">{</span> <span style="color: #81a1c1; font-weight: bold">return</span> <span class="nx">math</span><span style="color: #eceff4">.</span><span style="color: #88c0d0">Sqrt</span><span style="color: #eceff4">(</span><span class="nx">v</span><span style="color: #eceff4">.</span><span class="nx">x</span><span style="color: #81a1c1">*</span><span class="nx">v</span><span style="color: #eceff4">.</span><span class="nx">x</span> <span style="color: #81a1c1">+</span> <span class="nx">v</span><span style="color: #eceff4">.</span><span class="nx">y</span><span style="color: #81a1c1">*</span><span class="nx">v</span><span style="color: #eceff4">.</span><span class="nx">y</span> <span style="color: #81a1c1">+</span> <span class="nx">v</span><span style="color: #eceff4">.</span><span class="nx">z</span><span style="color: #81a1c1">*</span><span class="nx">v</span><span style="color: #eceff4">.</span><span class="nx">z</span><span style="color: #eceff4">)</span> <span style="color: #eceff4">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #81a1c1; font-weight: bold">func</span> <span style="color: #eceff4">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #eceff4">)</span> <span style="color: #88c0d0">normalize</span><span style="color: #eceff4">()</span> <span class="nx">vec3</span>    <span style="color: #eceff4">{</span> <span style="color: #81a1c1; font-weight: bold">return</span> <span class="nx">v</span><span style="color: #eceff4">.</span><span style="color: #88c0d0">mul</span><span style="color: #eceff4">(</span><span style="color: #b48ead">1</span> <span style="color: #81a1c1">/</span> <span class="nx">v</span><span style="color: #eceff4">.</span><span style="color: #88c0d0">length</span><span style="color: #eceff4">())</span> <span style="color: #eceff4">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #81a1c1; font-weight: bold">func</span> <span style="color: #88c0d0">mandelbulb</span><span style="color: #eceff4">(</span><span class="nx">p</span> <span class="nx">vec3</span><span style="color: #eceff4">)</span> <span style="color: #81a1c1">float64</span> <span style="color: #eceff4">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span style="color: #eceff4">,</span> <span class="nx">r</span><span style="color: #eceff4">,</span> <span class="nx">theta</span><span style="color: #eceff4">,</span> <span class="nx">phi</span> <span style="color: #81a1c1">:=</span> <span class="nx">p</span><span style="color: #eceff4">,</span> <span style="color: #b48ead">0.0</span><span style="color: #eceff4">,</span> <span style="color: #b48ead">0.0</span><span style="color: #eceff4">,</span> <span style="color: #b48ead">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #81a1c1; font-weight: bold">for</span> <span class="nx">i</span> <span style="color: #81a1c1">:=</span> <span style="color: #b48ead">0</span><span style="color: #eceff4">;</span> <span class="nx">i</span> <span style="color: #eceff4">&lt;</span> <span class="nx">maxIter</span><span style="color: #eceff4">;</span> <span class="nx">i</span><span style="color: #81a1c1">++</span> <span style="color: #eceff4">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span style="color: #eceff4">=</span> <span class="nx">z</span><span style="color: #eceff4">.</span><span style="color: #88c0d0">length</span><span style="color: #eceff4">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #81a1c1; font-weight: bold">if</span> <span class="nx">r</span> <span style="color: #eceff4">&gt;</span> <span class="nx">escapeRadius</span> <span style="color: #eceff4">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #81a1c1; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #eceff4">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span style="color: #eceff4">,</span> <span class="nx">phi</span> <span style="color: #eceff4">=</span> <span class="nx">math</span><span style="color: #eceff4">.</span><span style="color: #88c0d0">Acos</span><span style="color: #eceff4">(</span><span class="nx">z</span><span style="color: #eceff4">.</span><span class="nx">z</span><span style="color: #81a1c1">/</span><span class="nx">r</span><span style="color: #eceff4">)</span><span style="color: #81a1c1">*</span><span class="nx">power</span><span style="color: #eceff4">,</span> <span class="nx">math</span><span style="color: #eceff4">.</span><span style="color: #88c0d0">Atan2</span><span style="color: #eceff4">(</span><span class="nx">z</span><span style="color: #eceff4">.</span><span class="nx">y</span><span style="color: #eceff4">,</span> <span class="nx">z</span><span style="color: #eceff4">.</span><span class="nx">x</span><span style="color: #eceff4">)</span><span style="color: #81a1c1">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span style="color: #eceff4">=</span> <span class="nx">math</span><span style="color: #eceff4">.</span><span style="color: #88c0d0">Pow</span><span style="color: #eceff4">(</span><span class="nx">r</span><span style="color: #eceff4">,</span> <span class="nx">power</span><span style="color: #eceff4">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span style="color: #eceff4">.</span><span class="nx">x</span><span style="color: #eceff4">,</span> <span class="nx">z</span><span style="color: #eceff4">.</span><span class="nx">y</span><span style="color: #eceff4">,</span> <span class="nx">z</span><span style="color: #eceff4">.</span><span class="nx">z</span> <span style="color: #eceff4">=</span> <span class="nx">p</span><span style="color: #eceff4">.</span><span class="nx">x</span><span style="color: #81a1c1">+</span><span class="nx">r</span><span style="color: #81a1c1">*</span><span class="nx">math</span><span style="color: #eceff4">.</span><span style="color: #88c0d0">Sin</span><span style="color: #eceff4">(</span><span class="nx">theta</span><span style="color: #eceff4">)</span><span style="color: #81a1c1">*</span><span class="nx">math</span><span style="color: #eceff4">.</span><span style="color: #88c0d0">Cos</span><span style="color: #eceff4">(</span><span class="nx">phi</span><span style="color: #eceff4">),</span> <span class="nx">p</span><span style="color: #eceff4">.</span><span class="nx">y</span><span style="color: #81a1c1">+</span><span class="nx">r</span><span style="color: #81a1c1">*</span><span class="nx">math</span><span style="color: #eceff4">.</span><span style="color: #88c0d0">Sin</span><span style="color: #eceff4">(</span><span class="nx">theta</span><span style="color: #eceff4">)</span><span style="color: #81a1c1">*</span><span class="nx">math</span><span style="color: #eceff4">.</span><span style="color: #88c0d0">Sin</span><span style="color: #eceff4">(</span><span class="nx">phi</span><span style="color: #eceff4">),</span> <span class="nx">p</span><span style="color: #eceff4">.</span><span class="nx">z</span><span style="color: #81a1c1">+</span><span class="nx">r</span><span style="color: #81a1c1">*</span><span class="nx">math</span><span style="color: #eceff4">.</span><span style="color: #88c0d0">Cos</span><span style="color: #eceff4">(</span><span class="nx">theta</span><span style="color: #eceff4">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #eceff4">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #81a1c1; font-weight: bold">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #eceff4">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #81a1c1; font-weight: bold">func</span> <span style="color: #88c0d0">renderPixel</span><span style="color: #eceff4">(</span><span class="nx">x</span><span style="color: #eceff4">,</span> <span class="nx">y</span> <span style="color: #81a1c1">int</span><span style="color: #eceff4">)</span> <span class="nx">color</span><span style="color: #eceff4">.</span><span class="nx">Color</span> <span style="color: #eceff4">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span style="color: #eceff4">,</span> <span class="nx">py</span> <span style="color: #81a1c1">:=</span> <span style="color: #eceff4">(</span><span style="color: #b48ead">2</span><span style="color: #81a1c1">*</span><span style="color: #81a1c1">float64</span><span style="color: #eceff4">(</span><span class="nx">x</span><span style="color: #eceff4">)</span><span style="color: #81a1c1">/</span><span style="color: #81a1c1">float64</span><span style="color: #eceff4">(</span><span class="nx">ssWidth</span><span style="color: #eceff4">)</span><span style="color: #81a1c1">-</span><span style="color: #b48ead">1</span><span style="color: #eceff4">)</span><span style="color: #81a1c1">*</span><span class="nx">aspectRatio</span><span style="color: #81a1c1">*</span><span class="nx">math</span><span style="color: #eceff4">.</span><span style="color: #88c0d0">Tan</span><span style="color: #eceff4">(</span><span class="nx">fov</span><span style="color: #81a1c1">/</span><span style="color: #b48ead">2</span><span style="color: #eceff4">),</span> <span style="color: #eceff4">(</span><span style="color: #b48ead">1</span><span style="color: #81a1c1">-</span><span style="color: #b48ead">2</span><span style="color: #81a1c1">*</span><span style="color: #81a1c1">float64</span><span style="color: #eceff4">(</span><span class="nx">y</span><span style="color: #eceff4">)</span><span style="color: #81a1c1">/</span><span style="color: #81a1c1">float64</span><span style="color: #eceff4">(</span><span class="nx">ssHeight</span><span style="color: #eceff4">))</span><span style="color: #81a1c1">*</span><span class="nx">math</span><span style="color: #eceff4">.</span><span style="color: #88c0d0">Tan</span><span style="color: #eceff4">(</span><span class="nx">fov</span><span style="color: #81a1c1">/</span><span style="color: #b48ead">2</span><span style="color: #eceff4">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span style="color: #81a1c1">:=</span> <span class="nx">vec3</span><span style="color: #eceff4">{</span><span class="nx">px</span><span style="color: #eceff4">,</span> <span class="nx">py</span><span style="color: #eceff4">,</span> <span style="color: #81a1c1">-</span><span style="color: #b48ead">1</span><span style="color: #eceff4">}.</span><span style="color: #88c0d0">normalize</span><span style="color: #eceff4">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span style="color: #81a1c1">:=</span> <span style="color: #b48ead">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #81a1c1; font-weight: bold">for</span> <span class="nx">i</span> <span style="color: #81a1c1">:=</span> <span style="color: #b48ead">0</span><span style="color: #eceff4">;</span> <span class="nx">i</span> <span style="color: #eceff4">&lt;</span> <span class="nx">maxIter</span><span style="color: #eceff4">;</span> <span class="nx">i</span><span style="color: #81a1c1">++</span> <span style="color: #eceff4">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span style="color: #81a1c1">:=</span> <span class="nx">direction</span><span style="color: #eceff4">.</span><span style="color: #88c0d0">mul</span><span style="color: #eceff4">(</span><span class="nx">t</span><span style="color: #eceff4">).</span><span style="color: #88c0d0">add</span><span style="color: #eceff4">(</span><span class="nx">vec3</span><span style="color: #eceff4">{</span><span style="color: #b48ead">0</span><span style="color: #eceff4">,</span> <span style="color: #b48ead">0</span><span style="color: #eceff4">,</span> <span style="color: #b48ead">5</span><span style="color: #eceff4">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span style="color: #81a1c1">:=</span> <span style="color: #88c0d0">mandelbulb</span><span style="color: #eceff4">(</span><span class="nx">p</span><span style="color: #eceff4">)</span> <span style="color: #81a1c1">-</span> <span style="color: #b48ead">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #81a1c1; font-weight: bold">if</span> <span class="nx">d</span> <span style="color: #eceff4">&lt;</span> <span style="color: #b48ead">0.001</span> <span style="color: #eceff4">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #81a1c1; font-weight: bold">return</span> <span class="nx">color</span><span style="color: #eceff4">.</span><span class="nx">Gray</span><span style="color: #eceff4">{</span><span style="color: #81a1c1">uint8</span><span style="color: #eceff4">(</span><span style="color: #b48ead">255</span> <span style="color: #81a1c1">-</span> <span class="nx">t</span><span style="color: #81a1c1">*</span><span style="color: #b48ead">255</span><span style="color: #81a1c1">/</span><span style="color: #b48ead">100</span><span style="color: #eceff4">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #eceff4">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span style="color: #81a1c1">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #81a1c1; font-weight: bold">if</span> <span class="nx">t</span> <span style="color: #eceff4">&gt;</span> <span style="color: #b48ead">100</span> <span style="color: #eceff4">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #81a1c1; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #eceff4">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #eceff4">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #81a1c1; font-weight: bold">return</span> <span class="nx">color</span><span style="color: #eceff4">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #eceff4">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #81a1c1; font-weight: bold">func</span> <span style="color: #88c0d0">main</span><span style="color: #eceff4">()</span> <span style="color: #eceff4">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span style="color: #81a1c1">:=</span> <span class="nx">image</span><span style="color: #eceff4">.</span><span style="color: #88c0d0">NewRGBA</span><span style="color: #eceff4">(</span><span class="nx">image</span><span style="color: #eceff4">.</span><span style="color: #88c0d0">Rect</span><span style="color: #eceff4">(</span><span style="color: #b48ead">0</span><span style="color: #eceff4">,</span> <span style="color: #b48ead">0</span><span style="color: #eceff4">,</span> <span class="nx">ssWidth</span><span style="color: #eceff4">,</span> <span class="nx">ssHeight</span><span style="color: #eceff4">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #81a1c1; font-weight: bold">for</span> <span class="nx">y</span> <span style="color: #81a1c1">:=</span> <span style="color: #b48ead">0</span><span style="color: #eceff4">;</span> <span class="nx">y</span> <span style="color: #eceff4">&lt;</span> <span class="nx">ssHeight</span><span style="color: #eceff4">;</span> <span class="nx">y</span><span style="color: #81a1c1">++</span> <span style="color: #eceff4">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span style="color: #eceff4">.</span><span style="color: #88c0d0">Add</span><span style="color: #eceff4">(</span><span style="color: #b48ead">1</span><span style="color: #eceff4">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #81a1c1; font-weight: bold">go</span> <span style="color: #81a1c1; font-weight: bold">func</span><span style="color: #eceff4">(</span><span class="nx">y</span> <span style="color: #81a1c1">int</span><span style="color: #eceff4">)</span> <span style="color: #eceff4">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #81a1c1; font-weight: bold">defer</span> <span class="nx">wg</span><span style="color: #eceff4">.</span><span style="color: #88c0d0">Done</span><span style="color: #eceff4">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #81a1c1; font-weight: bold">for</span> <span class="nx">x</span> <span style="color: #81a1c1">:=</span> <span style="color: #b48ead">0</span><span style="color: #eceff4">;</span> <span class="nx">x</span> <span style="color: #eceff4">&lt;</span> <span class="nx">ssWidth</span><span style="color: #eceff4">;</span> <span class="nx">x</span><span style="color: #81a1c1">++</span> <span style="color: #eceff4">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span style="color: #eceff4">.</span><span style="color: #88c0d0">Set</span><span style="color: #eceff4">(</span><span class="nx">x</span><span style="color: #eceff4">,</span> <span class="nx">y</span><span style="color: #eceff4">,</span> <span style="color: #88c0d0">renderPixel</span><span style="color: #eceff4">(</span><span class="nx">x</span><span style="color: #eceff4">,</span> <span class="nx">y</span><span style="color: #eceff4">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #eceff4">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #eceff4">}(</span><span class="nx">y</span><span style="color: #eceff4">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #eceff4">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span style="color: #eceff4">.</span><span style="color: #88c0d0">Wait</span><span style="color: #eceff4">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span style="color: #81a1c1">:=</span> <span class="nx">image</span><span style="color: #eceff4">.</span><span style="color: #88c0d0">NewRGBA</span><span style="color: #eceff4">(</span><span class="nx">image</span><span style="color: #eceff4">.</span><span style="color: #88c0d0">Rect</span><span style="color: #eceff4">(</span><span style="color: #b48ead">0</span><span style="color: #eceff4">,</span> <span style="color: #b48ead">0</span><span style="color: #eceff4">,</span> <span class="nx">width</span><span style="color: #eceff4">,</span> <span class="nx">height</span><span style="color: #eceff4">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #81a1c1; font-weight: bold">for</span> <span class="nx">y</span> <span style="color: #81a1c1">:=</span> <span style="color: #b48ead">0</span><span style="color: #eceff4">;</span> <span class="nx">y</span> <span style="color: #eceff4">&lt;</span> <span class="nx">height</span><span style="color: #eceff4">;</span> <span class="nx">y</span><span style="color: #81a1c1">++</span> <span style="color: #eceff4">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #81a1c1; font-weight: bold">for</span> <span class="nx">x</span> <span style="color: #81a1c1">:=</span> <span style="color: #b48ead">0</span><span style="color: #eceff4">;</span> <span class="nx">x</span> <span style="color: #eceff4">&lt;</span> <span class="nx">width</span><span style="color: #eceff4">;</span> <span class="nx">x</span><span style="color: #81a1c1">++</span> <span style="color: #eceff4">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span style="color: #eceff4">,</span> <span class="nx">g</span><span style="color: #eceff4">,</span> <span class="nx">b</span><span style="color: #eceff4">,</span> <span class="nx">a</span> <span style="color: #81a1c1">:=</span> <span style="color: #b48ead">0</span><span style="color: #eceff4">,</span> <span style="color: #b48ead">0</span><span style="color: #eceff4">,</span> <span style="color: #b48ead">0</span><span style="color: #eceff4">,</span> <span style="color: #b48ead">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #81a1c1; font-weight: bold">for</span> <span class="nx">dy</span> <span style="color: #81a1c1">:=</span> <span style="color: #b48ead">0</span><span style="color: #eceff4">;</span> <span class="nx">dy</span> <span style="color: #eceff4">&lt;</span> <span class="nx">supersamplingRatio</span><span style="color: #eceff4">;</span> <span class="nx">dy</span><span style="color: #81a1c1">++</span> <span style="color: #eceff4">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #81a1c1; font-weight: bold">for</span> <span class="nx">dx</span> <span style="color: #81a1c1">:=</span> <span style="color: #b48ead">0</span><span style="color: #eceff4">;</span> <span class="nx">dx</span> <span style="color: #eceff4">&lt;</span> <span class="nx">supersamplingRatio</span><span style="color: #eceff4">;</span> <span class="nx">dx</span><span style="color: #81a1c1">++</span> <span style="color: #eceff4">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span style="color: #81a1c1">:=</span> <span class="nx">ssImg</span><span style="color: #eceff4">.</span><span style="color: #88c0d0">RGBAAt</span><span style="color: #eceff4">(</span><span class="nx">x</span><span style="color: #81a1c1">*</span><span class="nx">supersamplingRatio</span><span style="color: #81a1c1">+</span><span class="nx">dx</span><span style="color: #eceff4">,</span> <span class="nx">y</span><span style="color: #81a1c1">*</span><span class="nx">supersamplingRatio</span><span style="color: #81a1c1">+</span><span class="nx">dy</span><span style="color: #eceff4">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span style="color: #81a1c1">+=</span> <span style="color: #81a1c1">int</span><span style="color: #eceff4">(</span><span class="nx">c</span><span style="color: #eceff4">.</span><span class="nx">R</span><span style="color: #eceff4">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span style="color: #81a1c1">+=</span> <span style="color: #81a1c1">int</span><span style="color: #eceff4">(</span><span class="nx">c</span><span style="color: #eceff4">.</span><span class="nx">G</span><span style="color: #eceff4">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span style="color: #81a1c1">+=</span> <span style="color: #81a1c1">int</span><span style="color: #eceff4">(</span><span class="nx">c</span><span style="color: #eceff4">.</span><span class="nx">B</span><span style="color: #eceff4">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span style="color: #81a1c1">+=</span> <span style="color: #81a1c1">int</span><span style="color: #eceff4">(</span><span class="nx">c</span><span style="color: #eceff4">.</span><span class="nx">A</span><span style="color: #eceff4">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #eceff4">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #eceff4">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span style="color: #81a1c1">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #81a1c1">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span style="color: #81a1c1">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #81a1c1">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span style="color: #81a1c1">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #81a1c1">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span style="color: #81a1c1">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #81a1c1">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span style="color: #eceff4">.</span><span style="color: #88c0d0">Set</span><span style="color: #eceff4">(</span><span class="nx">x</span><span style="color: #eceff4">,</span> <span class="nx">y</span><span style="color: #eceff4">,</span> <span class="nx">color</span><span style="color: #eceff4">.</span><span class="nx">RGBA</span><span style="color: #eceff4">{</span><span style="color: #81a1c1">uint8</span><span style="color: #eceff4">(</span><span class="nx">r</span><span style="color: #eceff4">),</span> <span style="color: #81a1c1">uint8</span><span style="color: #eceff4">(</span><span class="nx">g</span><span style="color: #eceff4">),</span> <span style="color: #81a1c1">uint8</span><span style="color: #eceff4">(</span><span class="nx">b</span><span style="color: #eceff4">),</span> <span style="color: #81a1c1">uint8</span><span style="color: #eceff4">(</span><span class="nx">a</span><span style="color: #eceff4">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #eceff4">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #eceff4">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span style="color: #eceff4">,</span> <span class="nx">err</span> <span style="color: #81a1c1">:=</span> <span class="nx">os</span><span style="color: #eceff4">.</span><span style="color: #88c0d0">Create</span><span style="color: #eceff4">(</span><span style="color: #a3be8c">&#34;mandelbulb.png&#34;</span><span style="color: #eceff4">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #81a1c1; font-weight: bold">if</span> <span class="nx">err</span> <span style="color: #81a1c1">!=</span> <span style="color: #81a1c1; font-weight: bold">nil</span> <span style="color: #eceff4">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span style="color: #eceff4">.</span><span style="color: #88c0d0">Println</span><span style="color: #eceff4">(</span><span style="color: #a3be8c">&#34;Error creating file:&#34;</span><span style="color: #eceff4">,</span> <span class="nx">err</span><span style="color: #eceff4">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #81a1c1; font-weight: bold">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #eceff4">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #81a1c1; font-weight: bold">defer</span> <span class="nx">file</span><span style="color: #eceff4">.</span><span style="color: #88c0d0">Close</span><span style="color: #eceff4">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span style="color: #eceff4">=</span> <span class="nx">png</span><span style="color: #eceff4">.</span><span style="color: #88c0d0">Encode</span><span style="color: #eceff4">(</span><span class="nx">file</span><span style="color: #eceff4">,</span> <span class="nx">img</span><span style="color: #eceff4">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #81a1c1; font-weight: bold">if</span> <span class="nx">err</span> <span style="color: #81a1c1">!=</span> <span style="color: #81a1c1; font-weight: bold">nil</span> <span style="color: #eceff4">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span style="color: #eceff4">.</span><span style="color: #88c0d0">Println</span><span style="color: #eceff4">(</span><span style="color: #a3be8c">&#34;Error encoding image:&#34;</span><span style="color: #eceff4">,</span> <span class="nx">err</span><span style="color: #eceff4">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #eceff4">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #eceff4">}</span></span></span></code></pre></code><a name='onedark'><h2><a id='stylelink' href='onedark.html' alt='View only onedark'>onedark</a></h2></a><code><pre style="color: #abb2bf; background-color: #282c34;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #c678dd">package</span> <span style="color: #e06c75">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #7f848e">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #7f848e"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #7f848e"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #7f848e"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c678dd">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #98c379">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #98c379">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #98c379">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #98c379">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #98c379">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #98c379">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #98c379">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c678dd">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #e06c75">width</span><span class="p">,</span> <span style="color: #e06c75">height</span>      <span class="p">=</span> <span style="color: #d19a66">1920</span><span class="p">,</span> <span style="color: #d19a66">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #e06c75">ssWidth</span><span class="p">,</span> <span style="color: #e06c75">ssHeight</span>  <span class="p">=</span> <span style="color: #d19a66">3840</span><span class="p">,</span> <span style="color: #d19a66">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #e06c75">aspectRatio</span>        <span class="p">=</span> <span style="color: #e5c07b">float64</span><span class="p">(</span><span style="color: #e06c75">ssWidth</span><span class="p">)</span> <span style="color: #56b6c2">/</span> <span style="color: #e5c07b">float64</span><span class="p">(</span><span style="color: #e06c75">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #e06c75">fov</span>                <span class="p">=</span> <span style="color: #e06c75">math</span><span class="p">.</span><span style="color: #e06c75">Pi</span> <span style="color: #56b6c2">/</span> <span style="color: #d19a66">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #e06c75">maxIter</span>            <span class="p">=</span> <span style="color: #d19a66">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #e06c75">power</span>              <span class="p">=</span> <span style="color: #d19a66">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #e06c75">escapeRadius</span>       <span class="p">=</span> <span style="color: #d19a66">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #e06c75">supersamplingRatio</span> <span class="p">=</span> <span style="color: #d19a66">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c678dd">var</span> <span style="color: #e06c75">wg</span> <span style="color: #e06c75">sync</span><span class="p">.</span><span style="color: #e06c75">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c678dd">type</span> <span style="color: #e06c75">vec3</span> <span style="color: #c678dd">struct</span><span class="p">{</span> <span style="color: #e06c75">x</span><span class="p">,</span> <span style="color: #e06c75">y</span><span class="p">,</span> <span style="color: #e06c75">z</span> <span style="color: #e5c07b">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c678dd">func</span> <span class="p">(</span><span style="color: #e06c75">v</span> <span style="color: #e06c75">vec3</span><span class="p">)</span> <span style="color: #61afef; font-weight: bold">add</span><span class="p">(</span><span style="color: #e06c75">w</span> <span style="color: #e06c75">vec3</span><span class="p">)</span> <span style="color: #e06c75">vec3</span>    <span class="p">{</span> <span style="color: #c678dd">return</span> <span style="color: #e06c75">vec3</span><span class="p">{</span><span style="color: #e06c75">v</span><span class="p">.</span><span style="color: #e06c75">x</span> <span style="color: #56b6c2">+</span> <span style="color: #e06c75">w</span><span class="p">.</span><span style="color: #e06c75">x</span><span class="p">,</span> <span style="color: #e06c75">v</span><span class="p">.</span><span style="color: #e06c75">y</span> <span style="color: #56b6c2">+</span> <span style="color: #e06c75">w</span><span class="p">.</span><span style="color: #e06c75">y</span><span class="p">,</span> <span style="color: #e06c75">v</span><span class="p">.</span><span style="color: #e06c75">z</span> <span style="color: #56b6c2">+</span> <span style="color: #e06c75">w</span><span class="p">.</span><span style="color: #e06c75">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c678dd">func</span> <span class="p">(</span><span style="color: #e06c75">v</span> <span style="color: #e06c75">vec3</span><span class="p">)</span> <span style="color: #61afef; font-weight: bold">mul</span><span class="p">(</span><span style="color: #e06c75">s</span> <span style="color: #e5c07b">float64</span><span class="p">)</span> <span style="color: #e06c75">vec3</span> <span class="p">{</span> <span style="color: #c678dd">return</span> <span style="color: #e06c75">vec3</span><span class="p">{</span><span style="color: #e06c75">v</span><span class="p">.</span><span style="color: #e06c75">x</span> <span style="color: #56b6c2">*</span> <span style="color: #e06c75">s</span><span class="p">,</span> <span style="color: #e06c75">v</span><span class="p">.</span><span style="color: #e06c75">y</span> <span style="color: #56b6c2">*</span> <span style="color: #e06c75">s</span><span class="p">,</span> <span style="color: #e06c75">v</span><span class="p">.</span><span style="color: #e06c75">z</span> <span style="color: #56b6c2">*</span> <span style="color: #e06c75">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c678dd">func</span> <span class="p">(</span><span style="color: #e06c75">v</span> <span style="color: #e06c75">vec3</span><span class="p">)</span> <span style="color: #61afef; font-weight: bold">length</span><span class="p">()</span> <span style="color: #e5c07b">float64</span>    <span class="p">{</span> <span style="color: #c678dd">return</span> <span style="color: #e06c75">math</span><span class="p">.</span><span style="color: #61afef; font-weight: bold">Sqrt</span><span class="p">(</span><span style="color: #e06c75">v</span><span class="p">.</span><span style="color: #e06c75">x</span><span style="color: #56b6c2">*</span><span style="color: #e06c75">v</span><span class="p">.</span><span style="color: #e06c75">x</span> <span style="color: #56b6c2">+</span> <span style="color: #e06c75">v</span><span class="p">.</span><span style="color: #e06c75">y</span><span style="color: #56b6c2">*</span><span style="color: #e06c75">v</span><span class="p">.</span><span style="color: #e06c75">y</span> <span style="color: #56b6c2">+</span> <span style="color: #e06c75">v</span><span class="p">.</span><span style="color: #e06c75">z</span><span style="color: #56b6c2">*</span><span style="color: #e06c75">v</span><span class="p">.</span><span style="color: #e06c75">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c678dd">func</span> <span class="p">(</span><span style="color: #e06c75">v</span> <span style="color: #e06c75">vec3</span><span class="p">)</span> <span style="color: #61afef; font-weight: bold">normalize</span><span class="p">()</span> <span style="color: #e06c75">vec3</span>    <span class="p">{</span> <span style="color: #c678dd">return</span> <span style="color: #e06c75">v</span><span class="p">.</span><span style="color: #61afef; font-weight: bold">mul</span><span class="p">(</span><span style="color: #d19a66">1</span> <span style="color: #56b6c2">/</span> <span style="color: #e06c75">v</span><span class="p">.</span><span style="color: #61afef; font-weight: bold">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c678dd">func</span> <span style="color: #61afef; font-weight: bold">mandelbulb</span><span class="p">(</span><span style="color: #e06c75">p</span> <span style="color: #e06c75">vec3</span><span class="p">)</span> <span style="color: #e5c07b">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #e06c75">z</span><span class="p">,</span> <span style="color: #e06c75">r</span><span class="p">,</span> <span style="color: #e06c75">theta</span><span class="p">,</span> <span style="color: #e06c75">phi</span> <span style="color: #56b6c2">:=</span> <span style="color: #e06c75">p</span><span class="p">,</span> <span style="color: #d19a66">0.0</span><span class="p">,</span> <span style="color: #d19a66">0.0</span><span class="p">,</span> <span style="color: #d19a66">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c678dd">for</span> <span style="color: #e06c75">i</span> <span style="color: #56b6c2">:=</span> <span style="color: #d19a66">0</span><span class="p">;</span> <span style="color: #e06c75">i</span> <span class="p">&lt;</span> <span style="color: #e06c75">maxIter</span><span class="p">;</span> <span style="color: #e06c75">i</span><span style="color: #56b6c2">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #e06c75">r</span> <span class="p">=</span> <span style="color: #e06c75">z</span><span class="p">.</span><span style="color: #61afef; font-weight: bold">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c678dd">if</span> <span style="color: #e06c75">r</span> <span class="p">&gt;</span> <span style="color: #e06c75">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c678dd">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #e06c75">theta</span><span class="p">,</span> <span style="color: #e06c75">phi</span> <span class="p">=</span> <span style="color: #e06c75">math</span><span class="p">.</span><span style="color: #61afef; font-weight: bold">Acos</span><span class="p">(</span><span style="color: #e06c75">z</span><span class="p">.</span><span style="color: #e06c75">z</span><span style="color: #56b6c2">/</span><span style="color: #e06c75">r</span><span class="p">)</span><span style="color: #56b6c2">*</span><span style="color: #e06c75">power</span><span class="p">,</span> <span style="color: #e06c75">math</span><span class="p">.</span><span style="color: #61afef; font-weight: bold">Atan2</span><span class="p">(</span><span style="color: #e06c75">z</span><span class="p">.</span><span style="color: #e06c75">y</span><span class="p">,</span> <span style="color: #e06c75">z</span><span class="p">.</span><span style="color: #e06c75">x</span><span class="p">)</span><span style="color: #56b6c2">*</span><span style="color: #e06c75">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #e06c75">r</span> <span class="p">=</span> <span style="color: #e06c75">math</span><span class="p">.</span><span style="color: #61afef; font-weight: bold">Pow</span><span class="p">(</span><span style="color: #e06c75">r</span><span class="p">,</span> <span style="color: #e06c75">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #e06c75">z</span><span class="p">.</span><span style="color: #e06c75">x</span><span class="p">,</span> <span style="color: #e06c75">z</span><span class="p">.</span><span style="color: #e06c75">y</span><span class="p">,</span> <span style="color: #e06c75">z</span><span class="p">.</span><span style="color: #e06c75">z</span> <span class="p">=</span> <span style="color: #e06c75">p</span><span class="p">.</span><span style="color: #e06c75">x</span><span style="color: #56b6c2">+</span><span style="color: #e06c75">r</span><span style="color: #56b6c2">*</span><span style="color: #e06c75">math</span><span class="p">.</span><span style="color: #61afef; font-weight: bold">Sin</span><span class="p">(</span><span style="color: #e06c75">theta</span><span class="p">)</span><span style="color: #56b6c2">*</span><span style="color: #e06c75">math</span><span class="p">.</span><span style="color: #61afef; font-weight: bold">Cos</span><span class="p">(</span><span style="color: #e06c75">phi</span><span class="p">),</span> <span style="color: #e06c75">p</span><span class="p">.</span><span style="color: #e06c75">y</span><span style="color: #56b6c2">+</span><span style="color: #e06c75">r</span><span style="color: #56b6c2">*</span><span style="color: #e06c75">math</span><span class="p">.</span><span style="color: #61afef; font-weight: bold">Sin</span><span class="p">(</span><span style="color: #e06c75">theta</span><span class="p">)</span><span style="color: #56b6c2">*</span><span style="color: #e06c75">math</span><span class="p">.</span><span style="color: #61afef; font-weight: bold">Sin</span><span class="p">(</span><span style="color: #e06c75">phi</span><span class="p">),</span> <span style="color: #e06c75">p</span><span class="p">.</span><span style="color: #e06c75">z</span><span style="color: #56b6c2">+</span><span style="color: #e06c75">r</span><span style="color: #56b6c2">*</span><span style="color: #e06c75">math</span><span class="p">.</span><span style="color: #61afef; font-weight: bold">Cos</span><span class="p">(</span><span style="color: #e06c75">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c678dd">return</span> <span style="color: #e06c75">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c678dd">func</span> <span style="color: #61afef; font-weight: bold">renderPixel</span><span class="p">(</span><span style="color: #e06c75">x</span><span class="p">,</span> <span style="color: #e06c75">y</span> <span style="color: #e5c07b">int</span><span class="p">)</span> <span style="color: #e06c75">color</span><span class="p">.</span><span style="color: #e06c75">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #e06c75">px</span><span class="p">,</span> <span style="color: #e06c75">py</span> <span style="color: #56b6c2">:=</span> <span class="p">(</span><span style="color: #d19a66">2</span><span style="color: #56b6c2">*</span><span style="color: #e5c07b">float64</span><span class="p">(</span><span style="color: #e06c75">x</span><span class="p">)</span><span style="color: #56b6c2">/</span><span style="color: #e5c07b">float64</span><span class="p">(</span><span style="color: #e06c75">ssWidth</span><span class="p">)</span><span style="color: #56b6c2">-</span><span style="color: #d19a66">1</span><span class="p">)</span><span style="color: #56b6c2">*</span><span style="color: #e06c75">aspectRatio</span><span style="color: #56b6c2">*</span><span style="color: #e06c75">math</span><span class="p">.</span><span style="color: #61afef; font-weight: bold">Tan</span><span class="p">(</span><span style="color: #e06c75">fov</span><span style="color: #56b6c2">/</span><span style="color: #d19a66">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #d19a66">1</span><span style="color: #56b6c2">-</span><span style="color: #d19a66">2</span><span style="color: #56b6c2">*</span><span style="color: #e5c07b">float64</span><span class="p">(</span><span style="color: #e06c75">y</span><span class="p">)</span><span style="color: #56b6c2">/</span><span style="color: #e5c07b">float64</span><span class="p">(</span><span style="color: #e06c75">ssHeight</span><span class="p">))</span><span style="color: #56b6c2">*</span><span style="color: #e06c75">math</span><span class="p">.</span><span style="color: #61afef; font-weight: bold">Tan</span><span class="p">(</span><span style="color: #e06c75">fov</span><span style="color: #56b6c2">/</span><span style="color: #d19a66">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #e06c75">direction</span> <span style="color: #56b6c2">:=</span> <span style="color: #e06c75">vec3</span><span class="p">{</span><span style="color: #e06c75">px</span><span class="p">,</span> <span style="color: #e06c75">py</span><span class="p">,</span> <span style="color: #56b6c2">-</span><span style="color: #d19a66">1</span><span class="p">}.</span><span style="color: #61afef; font-weight: bold">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #e06c75">t</span> <span style="color: #56b6c2">:=</span> <span style="color: #d19a66">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c678dd">for</span> <span style="color: #e06c75">i</span> <span style="color: #56b6c2">:=</span> <span style="color: #d19a66">0</span><span class="p">;</span> <span style="color: #e06c75">i</span> <span class="p">&lt;</span> <span style="color: #e06c75">maxIter</span><span class="p">;</span> <span style="color: #e06c75">i</span><span style="color: #56b6c2">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #e06c75">p</span> <span style="color: #56b6c2">:=</span> <span style="color: #e06c75">direction</span><span class="p">.</span><span style="color: #61afef; font-weight: bold">mul</span><span class="p">(</span><span style="color: #e06c75">t</span><span class="p">).</span><span style="color: #61afef; font-weight: bold">add</span><span class="p">(</span><span style="color: #e06c75">vec3</span><span class="p">{</span><span style="color: #d19a66">0</span><span class="p">,</span> <span style="color: #d19a66">0</span><span class="p">,</span> <span style="color: #d19a66">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #e06c75">d</span> <span style="color: #56b6c2">:=</span> <span style="color: #61afef; font-weight: bold">mandelbulb</span><span class="p">(</span><span style="color: #e06c75">p</span><span class="p">)</span> <span style="color: #56b6c2">-</span> <span style="color: #d19a66">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c678dd">if</span> <span style="color: #e06c75">d</span> <span class="p">&lt;</span> <span style="color: #d19a66">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c678dd">return</span> <span style="color: #e06c75">color</span><span class="p">.</span><span style="color: #e06c75">Gray</span><span class="p">{</span><span style="color: #e5c07b">uint8</span><span class="p">(</span><span style="color: #d19a66">255</span> <span style="color: #56b6c2">-</span> <span style="color: #e06c75">t</span><span style="color: #56b6c2">*</span><span style="color: #d19a66">255</span><span style="color: #56b6c2">/</span><span style="color: #d19a66">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #e06c75">t</span> <span style="color: #56b6c2">+=</span> <span style="color: #e06c75">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c678dd">if</span> <span style="color: #e06c75">t</span> <span class="p">&gt;</span> <span style="color: #d19a66">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c678dd">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c678dd">return</span> <span style="color: #e06c75">color</span><span class="p">.</span><span style="color: #e06c75">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c678dd">func</span> <span style="color: #61afef; font-weight: bold">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #e06c75">ssImg</span> <span style="color: #56b6c2">:=</span> <span style="color: #e06c75">image</span><span class="p">.</span><span style="color: #61afef; font-weight: bold">NewRGBA</span><span class="p">(</span><span style="color: #e06c75">image</span><span class="p">.</span><span style="color: #61afef; font-weight: bold">Rect</span><span class="p">(</span><span style="color: #d19a66">0</span><span class="p">,</span> <span style="color: #d19a66">0</span><span class="p">,</span> <span style="color: #e06c75">ssWidth</span><span class="p">,</span> <span style="color: #e06c75">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c678dd">for</span> <span style="color: #e06c75">y</span> <span style="color: #56b6c2">:=</span> <span style="color: #d19a66">0</span><span class="p">;</span> <span style="color: #e06c75">y</span> <span class="p">&lt;</span> <span style="color: #e06c75">ssHeight</span><span class="p">;</span> <span style="color: #e06c75">y</span><span style="color: #56b6c2">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #e06c75">wg</span><span class="p">.</span><span style="color: #61afef; font-weight: bold">Add</span><span class="p">(</span><span style="color: #d19a66">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c678dd">go</span> <span style="color: #c678dd">func</span><span class="p">(</span><span style="color: #e06c75">y</span> <span style="color: #e5c07b">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c678dd">defer</span> <span style="color: #e06c75">wg</span><span class="p">.</span><span style="color: #61afef; font-weight: bold">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c678dd">for</span> <span style="color: #e06c75">x</span> <span style="color: #56b6c2">:=</span> <span style="color: #d19a66">0</span><span class="p">;</span> <span style="color: #e06c75">x</span> <span class="p">&lt;</span> <span style="color: #e06c75">ssWidth</span><span class="p">;</span> <span style="color: #e06c75">x</span><span style="color: #56b6c2">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #e06c75">ssImg</span><span class="p">.</span><span style="color: #61afef; font-weight: bold">Set</span><span class="p">(</span><span style="color: #e06c75">x</span><span class="p">,</span> <span style="color: #e06c75">y</span><span class="p">,</span> <span style="color: #61afef; font-weight: bold">renderPixel</span><span class="p">(</span><span style="color: #e06c75">x</span><span class="p">,</span> <span style="color: #e06c75">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span style="color: #e06c75">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #e06c75">wg</span><span class="p">.</span><span style="color: #61afef; font-weight: bold">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #e06c75">img</span> <span style="color: #56b6c2">:=</span> <span style="color: #e06c75">image</span><span class="p">.</span><span style="color: #61afef; font-weight: bold">NewRGBA</span><span class="p">(</span><span style="color: #e06c75">image</span><span class="p">.</span><span style="color: #61afef; font-weight: bold">Rect</span><span class="p">(</span><span style="color: #d19a66">0</span><span class="p">,</span> <span style="color: #d19a66">0</span><span class="p">,</span> <span style="color: #e06c75">width</span><span class="p">,</span> <span style="color: #e06c75">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c678dd">for</span> <span style="color: #e06c75">y</span> <span style="color: #56b6c2">:=</span> <span style="color: #d19a66">0</span><span class="p">;</span> <span style="color: #e06c75">y</span> <span class="p">&lt;</span> <span style="color: #e06c75">height</span><span class="p">;</span> <span style="color: #e06c75">y</span><span style="color: #56b6c2">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c678dd">for</span> <span style="color: #e06c75">x</span> <span style="color: #56b6c2">:=</span> <span style="color: #d19a66">0</span><span class="p">;</span> <span style="color: #e06c75">x</span> <span class="p">&lt;</span> <span style="color: #e06c75">width</span><span class="p">;</span> <span style="color: #e06c75">x</span><span style="color: #56b6c2">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #e06c75">r</span><span class="p">,</span> <span style="color: #e06c75">g</span><span class="p">,</span> <span style="color: #e06c75">b</span><span class="p">,</span> <span style="color: #e06c75">a</span> <span style="color: #56b6c2">:=</span> <span style="color: #d19a66">0</span><span class="p">,</span> <span style="color: #d19a66">0</span><span class="p">,</span> <span style="color: #d19a66">0</span><span class="p">,</span> <span style="color: #d19a66">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c678dd">for</span> <span style="color: #e06c75">dy</span> <span style="color: #56b6c2">:=</span> <span style="color: #d19a66">0</span><span class="p">;</span> <span style="color: #e06c75">dy</span> <span class="p">&lt;</span> <span style="color: #e06c75">supersamplingRatio</span><span class="p">;</span> <span style="color: #e06c75">dy</span><span style="color: #56b6c2">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #c678dd">for</span> <span style="color: #e06c75">dx</span> <span style="color: #56b6c2">:=</span> <span style="color: #d19a66">0</span><span class="p">;</span> <span style="color: #e06c75">dx</span> <span class="p">&lt;</span> <span style="color: #e06c75">supersamplingRatio</span><span class="p">;</span> <span style="color: #e06c75">dx</span><span style="color: #56b6c2">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #e06c75">c</span> <span style="color: #56b6c2">:=</span> <span style="color: #e06c75">ssImg</span><span class="p">.</span><span style="color: #61afef; font-weight: bold">RGBAAt</span><span class="p">(</span><span style="color: #e06c75">x</span><span style="color: #56b6c2">*</span><span style="color: #e06c75">supersamplingRatio</span><span style="color: #56b6c2">+</span><span style="color: #e06c75">dx</span><span class="p">,</span> <span style="color: #e06c75">y</span><span style="color: #56b6c2">*</span><span style="color: #e06c75">supersamplingRatio</span><span style="color: #56b6c2">+</span><span style="color: #e06c75">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #e06c75">r</span> <span style="color: #56b6c2">+=</span> <span style="color: #e5c07b">int</span><span class="p">(</span><span style="color: #e06c75">c</span><span class="p">.</span><span style="color: #e06c75">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #e06c75">g</span> <span style="color: #56b6c2">+=</span> <span style="color: #e5c07b">int</span><span class="p">(</span><span style="color: #e06c75">c</span><span class="p">.</span><span style="color: #e06c75">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #e06c75">b</span> <span style="color: #56b6c2">+=</span> <span style="color: #e5c07b">int</span><span class="p">(</span><span style="color: #e06c75">c</span><span class="p">.</span><span style="color: #e06c75">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #e06c75">a</span> <span style="color: #56b6c2">+=</span> <span style="color: #e5c07b">int</span><span class="p">(</span><span style="color: #e06c75">c</span><span class="p">.</span><span style="color: #e06c75">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #e06c75">r</span> <span style="color: #56b6c2">/=</span> <span style="color: #e06c75">supersamplingRatio</span> <span style="color: #56b6c2">*</span> <span style="color: #e06c75">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #e06c75">g</span> <span style="color: #56b6c2">/=</span> <span style="color: #e06c75">supersamplingRatio</span> <span style="color: #56b6c2">*</span> <span style="color: #e06c75">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #e06c75">b</span> <span style="color: #56b6c2">/=</span> <span style="color: #e06c75">supersamplingRatio</span> <span style="color: #56b6c2">*</span> <span style="color: #e06c75">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #e06c75">a</span> <span style="color: #56b6c2">/=</span> <span style="color: #e06c75">supersamplingRatio</span> <span style="color: #56b6c2">*</span> <span style="color: #e06c75">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #e06c75">img</span><span class="p">.</span><span style="color: #61afef; font-weight: bold">Set</span><span class="p">(</span><span style="color: #e06c75">x</span><span class="p">,</span> <span style="color: #e06c75">y</span><span class="p">,</span> <span style="color: #e06c75">color</span><span class="p">.</span><span style="color: #e06c75">RGBA</span><span class="p">{</span><span style="color: #e5c07b">uint8</span><span class="p">(</span><span style="color: #e06c75">r</span><span class="p">),</span> <span style="color: #e5c07b">uint8</span><span class="p">(</span><span style="color: #e06c75">g</span><span class="p">),</span> <span style="color: #e5c07b">uint8</span><span class="p">(</span><span style="color: #e06c75">b</span><span class="p">),</span> <span style="color: #e5c07b">uint8</span><span class="p">(</span><span style="color: #e06c75">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #e06c75">file</span><span class="p">,</span> <span style="color: #e06c75">err</span> <span style="color: #56b6c2">:=</span> <span style="color: #e06c75">os</span><span class="p">.</span><span style="color: #61afef; font-weight: bold">Create</span><span class="p">(</span><span style="color: #98c379">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c678dd">if</span> <span style="color: #e06c75">err</span> <span style="color: #56b6c2">!=</span> <span style="color: #e5c07b">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #e06c75">fmt</span><span class="p">.</span><span style="color: #61afef; font-weight: bold">Println</span><span class="p">(</span><span style="color: #98c379">&#34;Error creating file:&#34;</span><span class="p">,</span> <span style="color: #e06c75">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c678dd">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c678dd">defer</span> <span style="color: #e06c75">file</span><span class="p">.</span><span style="color: #61afef; font-weight: bold">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #e06c75">err</span> <span class="p">=</span> <span style="color: #e06c75">png</span><span class="p">.</span><span style="color: #61afef; font-weight: bold">Encode</span><span class="p">(</span><span style="color: #e06c75">file</span><span class="p">,</span> <span style="color: #e06c75">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c678dd">if</span> <span style="color: #e06c75">err</span> <span style="color: #56b6c2">!=</span> <span style="color: #e5c07b">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #e06c75">fmt</span><span class="p">.</span><span style="color: #61afef; font-weight: bold">Println</span><span class="p">(</span><span style="color: #98c379">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span style="color: #e06c75">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='onesenterprise'><h2><a id='stylelink' href='onesenterprise.html' alt='View only onesenterprise'>onesenterprise</a></h2></a><code><pre style="color: #000000;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #ff0000">package</span> <span style="color: #0000ff">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008000">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #008000"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #008000"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #008000"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000">import</span> <span style="color: #ff0000">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="s">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="s">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="s">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="s">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="s">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="s">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000">const</span> <span style="color: #ff0000">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">width</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">height</span>      <span style="color: #ff0000">=</span> <span class="mi">1920</span><span style="color: #ff0000">,</span> <span class="mi">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">ssWidth</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">ssHeight</span>  <span style="color: #ff0000">=</span> <span class="mi">3840</span><span style="color: #ff0000">,</span> <span class="mi">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">aspectRatio</span>        <span style="color: #ff0000">=</span> <span style="color: #0000ff">float64</span><span style="color: #ff0000">(</span><span style="color: #0000ff">ssWidth</span><span style="color: #ff0000">)</span> <span style="color: #ff0000">/</span> <span style="color: #0000ff">float64</span><span style="color: #ff0000">(</span><span style="color: #0000ff">ssHeight</span><span style="color: #ff0000">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">fov</span>                <span style="color: #ff0000">=</span> <span style="color: #0000ff">math</span><span style="color: #ff0000">.</span><span style="color: #0000ff">Pi</span> <span style="color: #ff0000">/</span> <span class="mi">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">maxIter</span>            <span style="color: #ff0000">=</span> <span class="mi">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">power</span>              <span style="color: #ff0000">=</span> <span class="mi">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">escapeRadius</span>       <span style="color: #ff0000">=</span> <span class="mf">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">supersamplingRatio</span> <span style="color: #ff0000">=</span> <span class="mi">2</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000">var</span> <span style="color: #0000ff">wg</span> <span style="color: #0000ff">sync</span><span style="color: #ff0000">.</span><span style="color: #0000ff">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000">type</span> <span style="color: #0000ff">vec3</span> <span style="color: #ff0000">struct</span><span style="color: #ff0000">{</span> <span style="color: #0000ff">x</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">y</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">z</span> <span style="color: #ff0000">float64</span> <span style="color: #ff0000">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000">func</span> <span style="color: #ff0000">(</span><span style="color: #0000ff">v</span> <span style="color: #0000ff">vec3</span><span style="color: #ff0000">)</span> <span style="color: #0000ff">add</span><span style="color: #ff0000">(</span><span style="color: #0000ff">w</span> <span style="color: #0000ff">vec3</span><span style="color: #ff0000">)</span> <span style="color: #0000ff">vec3</span>    <span style="color: #ff0000">{</span> <span style="color: #ff0000">return</span> <span style="color: #0000ff">vec3</span><span style="color: #ff0000">{</span><span style="color: #0000ff">v</span><span style="color: #ff0000">.</span><span style="color: #0000ff">x</span> <span style="color: #ff0000">+</span> <span style="color: #0000ff">w</span><span style="color: #ff0000">.</span><span style="color: #0000ff">x</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">v</span><span style="color: #ff0000">.</span><span style="color: #0000ff">y</span> <span style="color: #ff0000">+</span> <span style="color: #0000ff">w</span><span style="color: #ff0000">.</span><span style="color: #0000ff">y</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">v</span><span style="color: #ff0000">.</span><span style="color: #0000ff">z</span> <span style="color: #ff0000">+</span> <span style="color: #0000ff">w</span><span style="color: #ff0000">.</span><span style="color: #0000ff">z</span><span style="color: #ff0000">}</span> <span style="color: #ff0000">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000">func</span> <span style="color: #ff0000">(</span><span style="color: #0000ff">v</span> <span style="color: #0000ff">vec3</span><span style="color: #ff0000">)</span> <span style="color: #0000ff">mul</span><span style="color: #ff0000">(</span><span style="color: #0000ff">s</span> <span style="color: #ff0000">float64</span><span style="color: #ff0000">)</span> <span style="color: #0000ff">vec3</span> <span style="color: #ff0000">{</span> <span style="color: #ff0000">return</span> <span style="color: #0000ff">vec3</span><span style="color: #ff0000">{</span><span style="color: #0000ff">v</span><span style="color: #ff0000">.</span><span style="color: #0000ff">x</span> <span style="color: #ff0000">*</span> <span style="color: #0000ff">s</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">v</span><span style="color: #ff0000">.</span><span style="color: #0000ff">y</span> <span style="color: #ff0000">*</span> <span style="color: #0000ff">s</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">v</span><span style="color: #ff0000">.</span><span style="color: #0000ff">z</span> <span style="color: #ff0000">*</span> <span style="color: #0000ff">s</span><span style="color: #ff0000">}</span> <span style="color: #ff0000">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000">func</span> <span style="color: #ff0000">(</span><span style="color: #0000ff">v</span> <span style="color: #0000ff">vec3</span><span style="color: #ff0000">)</span> <span style="color: #0000ff">length</span><span style="color: #ff0000">()</span> <span style="color: #ff0000">float64</span>    <span style="color: #ff0000">{</span> <span style="color: #ff0000">return</span> <span style="color: #0000ff">math</span><span style="color: #ff0000">.</span><span style="color: #0000ff">Sqrt</span><span style="color: #ff0000">(</span><span style="color: #0000ff">v</span><span style="color: #ff0000">.</span><span style="color: #0000ff">x</span><span style="color: #ff0000">*</span><span style="color: #0000ff">v</span><span style="color: #ff0000">.</span><span style="color: #0000ff">x</span> <span style="color: #ff0000">+</span> <span style="color: #0000ff">v</span><span style="color: #ff0000">.</span><span style="color: #0000ff">y</span><span style="color: #ff0000">*</span><span style="color: #0000ff">v</span><span style="color: #ff0000">.</span><span style="color: #0000ff">y</span> <span style="color: #ff0000">+</span> <span style="color: #0000ff">v</span><span style="color: #ff0000">.</span><span style="color: #0000ff">z</span><span style="color: #ff0000">*</span><span style="color: #0000ff">v</span><span style="color: #ff0000">.</span><span style="color: #0000ff">z</span><span style="color: #ff0000">)</span> <span style="color: #ff0000">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000">func</span> <span style="color: #ff0000">(</span><span style="color: #0000ff">v</span> <span style="color: #0000ff">vec3</span><span style="color: #ff0000">)</span> <span style="color: #0000ff">normalize</span><span style="color: #ff0000">()</span> <span style="color: #0000ff">vec3</span>    <span style="color: #ff0000">{</span> <span style="color: #ff0000">return</span> <span style="color: #0000ff">v</span><span style="color: #ff0000">.</span><span style="color: #0000ff">mul</span><span style="color: #ff0000">(</span><span class="mi">1</span> <span style="color: #ff0000">/</span> <span style="color: #0000ff">v</span><span style="color: #ff0000">.</span><span style="color: #0000ff">length</span><span style="color: #ff0000">())</span> <span style="color: #ff0000">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000">func</span> <span style="color: #0000ff">mandelbulb</span><span style="color: #ff0000">(</span><span style="color: #0000ff">p</span> <span style="color: #0000ff">vec3</span><span style="color: #ff0000">)</span> <span style="color: #ff0000">float64</span> <span style="color: #ff0000">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">z</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">r</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">theta</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">phi</span> <span style="color: #ff0000">:=</span> <span style="color: #0000ff">p</span><span style="color: #ff0000">,</span> <span class="mf">0.0</span><span style="color: #ff0000">,</span> <span class="mf">0.0</span><span style="color: #ff0000">,</span> <span class="mf">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff0000">for</span> <span style="color: #0000ff">i</span> <span style="color: #ff0000">:=</span> <span class="mi">0</span><span style="color: #ff0000">;</span> <span style="color: #0000ff">i</span> <span style="color: #ff0000">&lt;</span> <span style="color: #0000ff">maxIter</span><span style="color: #ff0000">;</span> <span style="color: #0000ff">i</span><span style="color: #ff0000">++</span> <span style="color: #ff0000">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000ff">r</span> <span style="color: #ff0000">=</span> <span style="color: #0000ff">z</span><span style="color: #ff0000">.</span><span style="color: #0000ff">length</span><span style="color: #ff0000">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff0000">if</span> <span style="color: #0000ff">r</span> <span style="color: #ff0000">&gt;</span> <span style="color: #0000ff">escapeRadius</span> <span style="color: #ff0000">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff0000">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff0000">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000ff">theta</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">phi</span> <span style="color: #ff0000">=</span> <span style="color: #0000ff">math</span><span style="color: #ff0000">.</span><span style="color: #0000ff">Acos</span><span style="color: #ff0000">(</span><span style="color: #0000ff">z</span><span style="color: #ff0000">.</span><span style="color: #0000ff">z</span><span style="color: #ff0000">/</span><span style="color: #0000ff">r</span><span style="color: #ff0000">)</span><span style="color: #ff0000">*</span><span style="color: #0000ff">power</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">math</span><span style="color: #ff0000">.</span><span style="color: #0000ff">Atan2</span><span style="color: #ff0000">(</span><span style="color: #0000ff">z</span><span style="color: #ff0000">.</span><span style="color: #0000ff">y</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">z</span><span style="color: #ff0000">.</span><span style="color: #0000ff">x</span><span style="color: #ff0000">)</span><span style="color: #ff0000">*</span><span style="color: #0000ff">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000ff">r</span> <span style="color: #ff0000">=</span> <span style="color: #0000ff">math</span><span style="color: #ff0000">.</span><span style="color: #0000ff">Pow</span><span style="color: #ff0000">(</span><span style="color: #0000ff">r</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">power</span><span style="color: #ff0000">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000ff">z</span><span style="color: #ff0000">.</span><span style="color: #0000ff">x</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">z</span><span style="color: #ff0000">.</span><span style="color: #0000ff">y</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">z</span><span style="color: #ff0000">.</span><span style="color: #0000ff">z</span> <span style="color: #ff0000">=</span> <span style="color: #0000ff">p</span><span style="color: #ff0000">.</span><span style="color: #0000ff">x</span><span style="color: #ff0000">+</span><span style="color: #0000ff">r</span><span style="color: #ff0000">*</span><span style="color: #0000ff">math</span><span style="color: #ff0000">.</span><span style="color: #0000ff">Sin</span><span style="color: #ff0000">(</span><span style="color: #0000ff">theta</span><span style="color: #ff0000">)</span><span style="color: #ff0000">*</span><span style="color: #0000ff">math</span><span style="color: #ff0000">.</span><span style="color: #0000ff">Cos</span><span style="color: #ff0000">(</span><span style="color: #0000ff">phi</span><span style="color: #ff0000">),</span> <span style="color: #0000ff">p</span><span style="color: #ff0000">.</span><span style="color: #0000ff">y</span><span style="color: #ff0000">+</span><span style="color: #0000ff">r</span><span style="color: #ff0000">*</span><span style="color: #0000ff">math</span><span style="color: #ff0000">.</span><span style="color: #0000ff">Sin</span><span style="color: #ff0000">(</span><span style="color: #0000ff">theta</span><span style="color: #ff0000">)</span><span style="color: #ff0000">*</span><span style="color: #0000ff">math</span><span style="color: #ff0000">.</span><span style="color: #0000ff">Sin</span><span style="color: #ff0000">(</span><span style="color: #0000ff">phi</span><span style="color: #ff0000">),</span> <span style="color: #0000ff">p</span><span style="color: #ff0000">.</span><span style="color: #0000ff">z</span><span style="color: #ff0000">+</span><span style="color: #0000ff">r</span><span style="color: #ff0000">*</span><span style="color: #0000ff">math</span><span style="color: #ff0000">.</span><span style="color: #0000ff">Cos</span><span style="color: #ff0000">(</span><span style="color: #0000ff">theta</span><span style="color: #ff0000">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff0000">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff0000">return</span> <span style="color: #0000ff">r</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000">func</span> <span style="color: #0000ff">renderPixel</span><span style="color: #ff0000">(</span><span style="color: #0000ff">x</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">y</span> <span style="color: #ff0000">int</span><span style="color: #ff0000">)</span> <span style="color: #0000ff">color</span><span style="color: #ff0000">.</span><span style="color: #0000ff">Color</span> <span style="color: #ff0000">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">px</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">py</span> <span style="color: #ff0000">:=</span> <span style="color: #ff0000">(</span><span class="mi">2</span><span style="color: #ff0000">*</span><span style="color: #0000ff">float64</span><span style="color: #ff0000">(</span><span style="color: #0000ff">x</span><span style="color: #ff0000">)</span><span style="color: #ff0000">/</span><span style="color: #0000ff">float64</span><span style="color: #ff0000">(</span><span style="color: #0000ff">ssWidth</span><span style="color: #ff0000">)</span><span style="color: #ff0000">-</span><span class="mi">1</span><span style="color: #ff0000">)</span><span style="color: #ff0000">*</span><span style="color: #0000ff">aspectRatio</span><span style="color: #ff0000">*</span><span style="color: #0000ff">math</span><span style="color: #ff0000">.</span><span style="color: #0000ff">Tan</span><span style="color: #ff0000">(</span><span style="color: #0000ff">fov</span><span style="color: #ff0000">/</span><span class="mi">2</span><span style="color: #ff0000">),</span> <span style="color: #ff0000">(</span><span class="mi">1</span><span style="color: #ff0000">-</span><span class="mi">2</span><span style="color: #ff0000">*</span><span style="color: #0000ff">float64</span><span style="color: #ff0000">(</span><span style="color: #0000ff">y</span><span style="color: #ff0000">)</span><span style="color: #ff0000">/</span><span style="color: #0000ff">float64</span><span style="color: #ff0000">(</span><span style="color: #0000ff">ssHeight</span><span style="color: #ff0000">))</span><span style="color: #ff0000">*</span><span style="color: #0000ff">math</span><span style="color: #ff0000">.</span><span style="color: #0000ff">Tan</span><span style="color: #ff0000">(</span><span style="color: #0000ff">fov</span><span style="color: #ff0000">/</span><span class="mi">2</span><span style="color: #ff0000">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">direction</span> <span style="color: #ff0000">:=</span> <span style="color: #0000ff">vec3</span><span style="color: #ff0000">{</span><span style="color: #0000ff">px</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">py</span><span style="color: #ff0000">,</span> <span style="color: #ff0000">-</span><span class="mi">1</span><span style="color: #ff0000">}.</span><span style="color: #0000ff">normalize</span><span style="color: #ff0000">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">t</span> <span style="color: #ff0000">:=</span> <span class="mf">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff0000">for</span> <span style="color: #0000ff">i</span> <span style="color: #ff0000">:=</span> <span class="mi">0</span><span style="color: #ff0000">;</span> <span style="color: #0000ff">i</span> <span style="color: #ff0000">&lt;</span> <span style="color: #0000ff">maxIter</span><span style="color: #ff0000">;</span> <span style="color: #0000ff">i</span><span style="color: #ff0000">++</span> <span style="color: #ff0000">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000ff">p</span> <span style="color: #ff0000">:=</span> <span style="color: #0000ff">direction</span><span style="color: #ff0000">.</span><span style="color: #0000ff">mul</span><span style="color: #ff0000">(</span><span style="color: #0000ff">t</span><span style="color: #ff0000">).</span><span style="color: #0000ff">add</span><span style="color: #ff0000">(</span><span style="color: #0000ff">vec3</span><span style="color: #ff0000">{</span><span class="mi">0</span><span style="color: #ff0000">,</span> <span class="mi">0</span><span style="color: #ff0000">,</span> <span class="mi">5</span><span style="color: #ff0000">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000ff">d</span> <span style="color: #ff0000">:=</span> <span style="color: #0000ff">mandelbulb</span><span style="color: #ff0000">(</span><span style="color: #0000ff">p</span><span style="color: #ff0000">)</span> <span style="color: #ff0000">-</span> <span class="mi">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff0000">if</span> <span style="color: #0000ff">d</span> <span style="color: #ff0000">&lt;</span> <span class="mf">0.001</span> <span style="color: #ff0000">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff0000">return</span> <span style="color: #0000ff">color</span><span style="color: #ff0000">.</span><span style="color: #0000ff">Gray</span><span style="color: #ff0000">{</span><span style="color: #0000ff">uint8</span><span style="color: #ff0000">(</span><span class="mi">255</span> <span style="color: #ff0000">-</span> <span style="color: #0000ff">t</span><span style="color: #ff0000">*</span><span class="mi">255</span><span style="color: #ff0000">/</span><span class="mi">100</span><span style="color: #ff0000">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff0000">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000ff">t</span> <span style="color: #ff0000">+=</span> <span style="color: #0000ff">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff0000">if</span> <span style="color: #0000ff">t</span> <span style="color: #ff0000">&gt;</span> <span class="mi">100</span> <span style="color: #ff0000">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff0000">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff0000">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff0000">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff0000">return</span> <span style="color: #0000ff">color</span><span style="color: #ff0000">.</span><span style="color: #0000ff">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000">func</span> <span style="color: #0000ff">main</span><span style="color: #ff0000">()</span> <span style="color: #ff0000">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">ssImg</span> <span style="color: #ff0000">:=</span> <span style="color: #0000ff">image</span><span style="color: #ff0000">.</span><span style="color: #0000ff">NewRGBA</span><span style="color: #ff0000">(</span><span style="color: #0000ff">image</span><span style="color: #ff0000">.</span><span style="color: #0000ff">Rect</span><span style="color: #ff0000">(</span><span class="mi">0</span><span style="color: #ff0000">,</span> <span class="mi">0</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">ssWidth</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">ssHeight</span><span style="color: #ff0000">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff0000">for</span> <span style="color: #0000ff">y</span> <span style="color: #ff0000">:=</span> <span class="mi">0</span><span style="color: #ff0000">;</span> <span style="color: #0000ff">y</span> <span style="color: #ff0000">&lt;</span> <span style="color: #0000ff">ssHeight</span><span style="color: #ff0000">;</span> <span style="color: #0000ff">y</span><span style="color: #ff0000">++</span> <span style="color: #ff0000">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000ff">wg</span><span style="color: #ff0000">.</span><span style="color: #0000ff">Add</span><span style="color: #ff0000">(</span><span class="mi">1</span><span style="color: #ff0000">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff0000">go</span> <span style="color: #ff0000">func</span><span style="color: #ff0000">(</span><span style="color: #0000ff">y</span> <span style="color: #ff0000">int</span><span style="color: #ff0000">)</span> <span style="color: #ff0000">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff0000">defer</span> <span style="color: #0000ff">wg</span><span style="color: #ff0000">.</span><span style="color: #0000ff">Done</span><span style="color: #ff0000">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff0000">for</span> <span style="color: #0000ff">x</span> <span style="color: #ff0000">:=</span> <span class="mi">0</span><span style="color: #ff0000">;</span> <span style="color: #0000ff">x</span> <span style="color: #ff0000">&lt;</span> <span style="color: #0000ff">ssWidth</span><span style="color: #ff0000">;</span> <span style="color: #0000ff">x</span><span style="color: #ff0000">++</span> <span style="color: #ff0000">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #0000ff">ssImg</span><span style="color: #ff0000">.</span><span style="color: #0000ff">Set</span><span style="color: #ff0000">(</span><span style="color: #0000ff">x</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">y</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">renderPixel</span><span style="color: #ff0000">(</span><span style="color: #0000ff">x</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">y</span><span style="color: #ff0000">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff0000">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff0000">}(</span><span style="color: #0000ff">y</span><span style="color: #ff0000">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff0000">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">wg</span><span style="color: #ff0000">.</span><span style="color: #0000ff">Wait</span><span style="color: #ff0000">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">img</span> <span style="color: #ff0000">:=</span> <span style="color: #0000ff">image</span><span style="color: #ff0000">.</span><span style="color: #0000ff">NewRGBA</span><span style="color: #ff0000">(</span><span style="color: #0000ff">image</span><span style="color: #ff0000">.</span><span style="color: #0000ff">Rect</span><span style="color: #ff0000">(</span><span class="mi">0</span><span style="color: #ff0000">,</span> <span class="mi">0</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">width</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">height</span><span style="color: #ff0000">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff0000">for</span> <span style="color: #0000ff">y</span> <span style="color: #ff0000">:=</span> <span class="mi">0</span><span style="color: #ff0000">;</span> <span style="color: #0000ff">y</span> <span style="color: #ff0000">&lt;</span> <span style="color: #0000ff">height</span><span style="color: #ff0000">;</span> <span style="color: #0000ff">y</span><span style="color: #ff0000">++</span> <span style="color: #ff0000">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff0000">for</span> <span style="color: #0000ff">x</span> <span style="color: #ff0000">:=</span> <span class="mi">0</span><span style="color: #ff0000">;</span> <span style="color: #0000ff">x</span> <span style="color: #ff0000">&lt;</span> <span style="color: #0000ff">width</span><span style="color: #ff0000">;</span> <span style="color: #0000ff">x</span><span style="color: #ff0000">++</span> <span style="color: #ff0000">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #0000ff">r</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">g</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">b</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">a</span> <span style="color: #ff0000">:=</span> <span class="mi">0</span><span style="color: #ff0000">,</span> <span class="mi">0</span><span style="color: #ff0000">,</span> <span class="mi">0</span><span style="color: #ff0000">,</span> <span class="mi">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff0000">for</span> <span style="color: #0000ff">dy</span> <span style="color: #ff0000">:=</span> <span class="mi">0</span><span style="color: #ff0000">;</span> <span style="color: #0000ff">dy</span> <span style="color: #ff0000">&lt;</span> <span style="color: #0000ff">supersamplingRatio</span><span style="color: #ff0000">;</span> <span style="color: #0000ff">dy</span><span style="color: #ff0000">++</span> <span style="color: #ff0000">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #ff0000">for</span> <span style="color: #0000ff">dx</span> <span style="color: #ff0000">:=</span> <span class="mi">0</span><span style="color: #ff0000">;</span> <span style="color: #0000ff">dx</span> <span style="color: #ff0000">&lt;</span> <span style="color: #0000ff">supersamplingRatio</span><span style="color: #ff0000">;</span> <span style="color: #0000ff">dx</span><span style="color: #ff0000">++</span> <span style="color: #ff0000">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #0000ff">c</span> <span style="color: #ff0000">:=</span> <span style="color: #0000ff">ssImg</span><span style="color: #ff0000">.</span><span style="color: #0000ff">RGBAAt</span><span style="color: #ff0000">(</span><span style="color: #0000ff">x</span><span style="color: #ff0000">*</span><span style="color: #0000ff">supersamplingRatio</span><span style="color: #ff0000">+</span><span style="color: #0000ff">dx</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">y</span><span style="color: #ff0000">*</span><span style="color: #0000ff">supersamplingRatio</span><span style="color: #ff0000">+</span><span style="color: #0000ff">dy</span><span style="color: #ff0000">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #0000ff">r</span> <span style="color: #ff0000">+=</span> <span style="color: #0000ff">int</span><span style="color: #ff0000">(</span><span style="color: #0000ff">c</span><span style="color: #ff0000">.</span><span style="color: #0000ff">R</span><span style="color: #ff0000">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #0000ff">g</span> <span style="color: #ff0000">+=</span> <span style="color: #0000ff">int</span><span style="color: #ff0000">(</span><span style="color: #0000ff">c</span><span style="color: #ff0000">.</span><span style="color: #0000ff">G</span><span style="color: #ff0000">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #0000ff">b</span> <span style="color: #ff0000">+=</span> <span style="color: #0000ff">int</span><span style="color: #ff0000">(</span><span style="color: #0000ff">c</span><span style="color: #ff0000">.</span><span style="color: #0000ff">B</span><span style="color: #ff0000">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #0000ff">a</span> <span style="color: #ff0000">+=</span> <span style="color: #0000ff">int</span><span style="color: #ff0000">(</span><span style="color: #0000ff">c</span><span style="color: #ff0000">.</span><span style="color: #0000ff">A</span><span style="color: #ff0000">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #ff0000">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff0000">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #0000ff">r</span> <span style="color: #ff0000">/=</span> <span style="color: #0000ff">supersamplingRatio</span> <span style="color: #ff0000">*</span> <span style="color: #0000ff">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #0000ff">g</span> <span style="color: #ff0000">/=</span> <span style="color: #0000ff">supersamplingRatio</span> <span style="color: #ff0000">*</span> <span style="color: #0000ff">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #0000ff">b</span> <span style="color: #ff0000">/=</span> <span style="color: #0000ff">supersamplingRatio</span> <span style="color: #ff0000">*</span> <span style="color: #0000ff">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #0000ff">a</span> <span style="color: #ff0000">/=</span> <span style="color: #0000ff">supersamplingRatio</span> <span style="color: #ff0000">*</span> <span style="color: #0000ff">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #0000ff">img</span><span style="color: #ff0000">.</span><span style="color: #0000ff">Set</span><span style="color: #ff0000">(</span><span style="color: #0000ff">x</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">y</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">color</span><span style="color: #ff0000">.</span><span style="color: #0000ff">RGBA</span><span style="color: #ff0000">{</span><span style="color: #0000ff">uint8</span><span style="color: #ff0000">(</span><span style="color: #0000ff">r</span><span style="color: #ff0000">),</span> <span style="color: #0000ff">uint8</span><span style="color: #ff0000">(</span><span style="color: #0000ff">g</span><span style="color: #ff0000">),</span> <span style="color: #0000ff">uint8</span><span style="color: #ff0000">(</span><span style="color: #0000ff">b</span><span style="color: #ff0000">),</span> <span style="color: #0000ff">uint8</span><span style="color: #ff0000">(</span><span style="color: #0000ff">a</span><span style="color: #ff0000">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff0000">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff0000">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">file</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">err</span> <span style="color: #ff0000">:=</span> <span style="color: #0000ff">os</span><span style="color: #ff0000">.</span><span style="color: #0000ff">Create</span><span style="color: #ff0000">(</span><span class="s">&#34;mandelbulb.png&#34;</span><span style="color: #ff0000">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff0000">if</span> <span style="color: #0000ff">err</span> <span style="color: #ff0000">!=</span> <span style="color: #ff0000">nil</span> <span style="color: #ff0000">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000ff">fmt</span><span style="color: #ff0000">.</span><span style="color: #0000ff">Println</span><span style="color: #ff0000">(</span><span class="s">&#34;Error creating file:&#34;</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">err</span><span style="color: #ff0000">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff0000">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff0000">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff0000">defer</span> <span style="color: #0000ff">file</span><span style="color: #ff0000">.</span><span style="color: #0000ff">Close</span><span style="color: #ff0000">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">err</span> <span style="color: #ff0000">=</span> <span style="color: #0000ff">png</span><span style="color: #ff0000">.</span><span style="color: #0000ff">Encode</span><span style="color: #ff0000">(</span><span style="color: #0000ff">file</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">img</span><span style="color: #ff0000">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff0000">if</span> <span style="color: #0000ff">err</span> <span style="color: #ff0000">!=</span> <span style="color: #ff0000">nil</span> <span style="color: #ff0000">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000ff">fmt</span><span style="color: #ff0000">.</span><span style="color: #0000ff">Println</span><span style="color: #ff0000">(</span><span class="s">&#34;Error encoding image:&#34;</span><span style="color: #ff0000">,</span> <span style="color: #0000ff">err</span><span style="color: #ff0000">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff0000">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000">}</span></span></span></code></pre></code><a name='paraiso-dark'><h2><a id='stylelink' href='paraiso-dark.html' alt='View only paraiso-dark'>paraiso-dark</a></h2></a><code><pre style="color: #e7e9db; background-color: #2f1e2e;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #5bc4bf">package</span> <span style="color: #06b6ef">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #776e71">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #776e71"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #776e71"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #776e71"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #5bc4bf">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #48b685">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #48b685">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #48b685">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #48b685">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #48b685">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #48b685">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #48b685">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #815ba4">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">width</span><span class="p">,</span> <span style="color: #06b6ef">height</span>      <span class="p">=</span> <span style="color: #f99b15">1920</span><span class="p">,</span> <span style="color: #f99b15">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">ssWidth</span><span class="p">,</span> <span style="color: #06b6ef">ssHeight</span>  <span class="p">=</span> <span style="color: #f99b15">3840</span><span class="p">,</span> <span style="color: #f99b15">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">aspectRatio</span>        <span class="p">=</span> <span class="nb">float64</span><span class="p">(</span><span style="color: #06b6ef">ssWidth</span><span class="p">)</span> <span style="color: #5bc4bf">/</span> <span class="nb">float64</span><span class="p">(</span><span style="color: #06b6ef">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">fov</span>                <span class="p">=</span> <span style="color: #06b6ef">math</span><span class="p">.</span><span style="color: #06b6ef">Pi</span> <span style="color: #5bc4bf">/</span> <span style="color: #f99b15">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">maxIter</span>            <span class="p">=</span> <span style="color: #f99b15">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">power</span>              <span class="p">=</span> <span style="color: #f99b15">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">escapeRadius</span>       <span class="p">=</span> <span style="color: #f99b15">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">supersamplingRatio</span> <span class="p">=</span> <span style="color: #f99b15">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #815ba4">var</span> <span style="color: #06b6ef">wg</span> <span style="color: #06b6ef">sync</span><span class="p">.</span><span style="color: #06b6ef">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #815ba4">type</span> <span style="color: #06b6ef">vec3</span> <span style="color: #815ba4">struct</span><span class="p">{</span> <span style="color: #06b6ef">x</span><span class="p">,</span> <span style="color: #06b6ef">y</span><span class="p">,</span> <span style="color: #06b6ef">z</span> <span style="color: #fec418">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #815ba4">func</span> <span class="p">(</span><span style="color: #06b6ef">v</span> <span style="color: #06b6ef">vec3</span><span class="p">)</span> <span style="color: #06b6ef">add</span><span class="p">(</span><span style="color: #06b6ef">w</span> <span style="color: #06b6ef">vec3</span><span class="p">)</span> <span style="color: #06b6ef">vec3</span>    <span class="p">{</span> <span style="color: #815ba4">return</span> <span style="color: #06b6ef">vec3</span><span class="p">{</span><span style="color: #06b6ef">v</span><span class="p">.</span><span style="color: #06b6ef">x</span> <span style="color: #5bc4bf">+</span> <span style="color: #06b6ef">w</span><span class="p">.</span><span style="color: #06b6ef">x</span><span class="p">,</span> <span style="color: #06b6ef">v</span><span class="p">.</span><span style="color: #06b6ef">y</span> <span style="color: #5bc4bf">+</span> <span style="color: #06b6ef">w</span><span class="p">.</span><span style="color: #06b6ef">y</span><span class="p">,</span> <span style="color: #06b6ef">v</span><span class="p">.</span><span style="color: #06b6ef">z</span> <span style="color: #5bc4bf">+</span> <span style="color: #06b6ef">w</span><span class="p">.</span><span style="color: #06b6ef">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #815ba4">func</span> <span class="p">(</span><span style="color: #06b6ef">v</span> <span style="color: #06b6ef">vec3</span><span class="p">)</span> <span style="color: #06b6ef">mul</span><span class="p">(</span><span style="color: #06b6ef">s</span> <span style="color: #fec418">float64</span><span class="p">)</span> <span style="color: #06b6ef">vec3</span> <span class="p">{</span> <span style="color: #815ba4">return</span> <span style="color: #06b6ef">vec3</span><span class="p">{</span><span style="color: #06b6ef">v</span><span class="p">.</span><span style="color: #06b6ef">x</span> <span style="color: #5bc4bf">*</span> <span style="color: #06b6ef">s</span><span class="p">,</span> <span style="color: #06b6ef">v</span><span class="p">.</span><span style="color: #06b6ef">y</span> <span style="color: #5bc4bf">*</span> <span style="color: #06b6ef">s</span><span class="p">,</span> <span style="color: #06b6ef">v</span><span class="p">.</span><span style="color: #06b6ef">z</span> <span style="color: #5bc4bf">*</span> <span style="color: #06b6ef">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #815ba4">func</span> <span class="p">(</span><span style="color: #06b6ef">v</span> <span style="color: #06b6ef">vec3</span><span class="p">)</span> <span style="color: #06b6ef">length</span><span class="p">()</span> <span style="color: #fec418">float64</span>    <span class="p">{</span> <span style="color: #815ba4">return</span> <span style="color: #06b6ef">math</span><span class="p">.</span><span style="color: #06b6ef">Sqrt</span><span class="p">(</span><span style="color: #06b6ef">v</span><span class="p">.</span><span style="color: #06b6ef">x</span><span style="color: #5bc4bf">*</span><span style="color: #06b6ef">v</span><span class="p">.</span><span style="color: #06b6ef">x</span> <span style="color: #5bc4bf">+</span> <span style="color: #06b6ef">v</span><span class="p">.</span><span style="color: #06b6ef">y</span><span style="color: #5bc4bf">*</span><span style="color: #06b6ef">v</span><span class="p">.</span><span style="color: #06b6ef">y</span> <span style="color: #5bc4bf">+</span> <span style="color: #06b6ef">v</span><span class="p">.</span><span style="color: #06b6ef">z</span><span style="color: #5bc4bf">*</span><span style="color: #06b6ef">v</span><span class="p">.</span><span style="color: #06b6ef">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #815ba4">func</span> <span class="p">(</span><span style="color: #06b6ef">v</span> <span style="color: #06b6ef">vec3</span><span class="p">)</span> <span style="color: #06b6ef">normalize</span><span class="p">()</span> <span style="color: #06b6ef">vec3</span>    <span class="p">{</span> <span style="color: #815ba4">return</span> <span style="color: #06b6ef">v</span><span class="p">.</span><span style="color: #06b6ef">mul</span><span class="p">(</span><span style="color: #f99b15">1</span> <span style="color: #5bc4bf">/</span> <span style="color: #06b6ef">v</span><span class="p">.</span><span style="color: #06b6ef">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #815ba4">func</span> <span style="color: #06b6ef">mandelbulb</span><span class="p">(</span><span style="color: #06b6ef">p</span> <span style="color: #06b6ef">vec3</span><span class="p">)</span> <span style="color: #fec418">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">z</span><span class="p">,</span> <span style="color: #06b6ef">r</span><span class="p">,</span> <span style="color: #06b6ef">theta</span><span class="p">,</span> <span style="color: #06b6ef">phi</span> <span style="color: #5bc4bf">:=</span> <span style="color: #06b6ef">p</span><span class="p">,</span> <span style="color: #f99b15">0.0</span><span class="p">,</span> <span style="color: #f99b15">0.0</span><span class="p">,</span> <span style="color: #f99b15">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #815ba4">for</span> <span style="color: #06b6ef">i</span> <span style="color: #5bc4bf">:=</span> <span style="color: #f99b15">0</span><span class="p">;</span> <span style="color: #06b6ef">i</span> <span class="p">&lt;</span> <span style="color: #06b6ef">maxIter</span><span class="p">;</span> <span style="color: #06b6ef">i</span><span style="color: #5bc4bf">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #06b6ef">r</span> <span class="p">=</span> <span style="color: #06b6ef">z</span><span class="p">.</span><span style="color: #06b6ef">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #815ba4">if</span> <span style="color: #06b6ef">r</span> <span class="p">&gt;</span> <span style="color: #06b6ef">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #815ba4">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #06b6ef">theta</span><span class="p">,</span> <span style="color: #06b6ef">phi</span> <span class="p">=</span> <span style="color: #06b6ef">math</span><span class="p">.</span><span style="color: #06b6ef">Acos</span><span class="p">(</span><span style="color: #06b6ef">z</span><span class="p">.</span><span style="color: #06b6ef">z</span><span style="color: #5bc4bf">/</span><span style="color: #06b6ef">r</span><span class="p">)</span><span style="color: #5bc4bf">*</span><span style="color: #06b6ef">power</span><span class="p">,</span> <span style="color: #06b6ef">math</span><span class="p">.</span><span style="color: #06b6ef">Atan2</span><span class="p">(</span><span style="color: #06b6ef">z</span><span class="p">.</span><span style="color: #06b6ef">y</span><span class="p">,</span> <span style="color: #06b6ef">z</span><span class="p">.</span><span style="color: #06b6ef">x</span><span class="p">)</span><span style="color: #5bc4bf">*</span><span style="color: #06b6ef">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #06b6ef">r</span> <span class="p">=</span> <span style="color: #06b6ef">math</span><span class="p">.</span><span style="color: #06b6ef">Pow</span><span class="p">(</span><span style="color: #06b6ef">r</span><span class="p">,</span> <span style="color: #06b6ef">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #06b6ef">z</span><span class="p">.</span><span style="color: #06b6ef">x</span><span class="p">,</span> <span style="color: #06b6ef">z</span><span class="p">.</span><span style="color: #06b6ef">y</span><span class="p">,</span> <span style="color: #06b6ef">z</span><span class="p">.</span><span style="color: #06b6ef">z</span> <span class="p">=</span> <span style="color: #06b6ef">p</span><span class="p">.</span><span style="color: #06b6ef">x</span><span style="color: #5bc4bf">+</span><span style="color: #06b6ef">r</span><span style="color: #5bc4bf">*</span><span style="color: #06b6ef">math</span><span class="p">.</span><span style="color: #06b6ef">Sin</span><span class="p">(</span><span style="color: #06b6ef">theta</span><span class="p">)</span><span style="color: #5bc4bf">*</span><span style="color: #06b6ef">math</span><span class="p">.</span><span style="color: #06b6ef">Cos</span><span class="p">(</span><span style="color: #06b6ef">phi</span><span class="p">),</span> <span style="color: #06b6ef">p</span><span class="p">.</span><span style="color: #06b6ef">y</span><span style="color: #5bc4bf">+</span><span style="color: #06b6ef">r</span><span style="color: #5bc4bf">*</span><span style="color: #06b6ef">math</span><span class="p">.</span><span style="color: #06b6ef">Sin</span><span class="p">(</span><span style="color: #06b6ef">theta</span><span class="p">)</span><span style="color: #5bc4bf">*</span><span style="color: #06b6ef">math</span><span class="p">.</span><span style="color: #06b6ef">Sin</span><span class="p">(</span><span style="color: #06b6ef">phi</span><span class="p">),</span> <span style="color: #06b6ef">p</span><span class="p">.</span><span style="color: #06b6ef">z</span><span style="color: #5bc4bf">+</span><span style="color: #06b6ef">r</span><span style="color: #5bc4bf">*</span><span style="color: #06b6ef">math</span><span class="p">.</span><span style="color: #06b6ef">Cos</span><span class="p">(</span><span style="color: #06b6ef">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #815ba4">return</span> <span style="color: #06b6ef">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #815ba4">func</span> <span style="color: #06b6ef">renderPixel</span><span class="p">(</span><span style="color: #06b6ef">x</span><span class="p">,</span> <span style="color: #06b6ef">y</span> <span style="color: #fec418">int</span><span class="p">)</span> <span style="color: #06b6ef">color</span><span class="p">.</span><span style="color: #06b6ef">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">px</span><span class="p">,</span> <span style="color: #06b6ef">py</span> <span style="color: #5bc4bf">:=</span> <span class="p">(</span><span style="color: #f99b15">2</span><span style="color: #5bc4bf">*</span><span class="nb">float64</span><span class="p">(</span><span style="color: #06b6ef">x</span><span class="p">)</span><span style="color: #5bc4bf">/</span><span class="nb">float64</span><span class="p">(</span><span style="color: #06b6ef">ssWidth</span><span class="p">)</span><span style="color: #5bc4bf">-</span><span style="color: #f99b15">1</span><span class="p">)</span><span style="color: #5bc4bf">*</span><span style="color: #06b6ef">aspectRatio</span><span style="color: #5bc4bf">*</span><span style="color: #06b6ef">math</span><span class="p">.</span><span style="color: #06b6ef">Tan</span><span class="p">(</span><span style="color: #06b6ef">fov</span><span style="color: #5bc4bf">/</span><span style="color: #f99b15">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #f99b15">1</span><span style="color: #5bc4bf">-</span><span style="color: #f99b15">2</span><span style="color: #5bc4bf">*</span><span class="nb">float64</span><span class="p">(</span><span style="color: #06b6ef">y</span><span class="p">)</span><span style="color: #5bc4bf">/</span><span class="nb">float64</span><span class="p">(</span><span style="color: #06b6ef">ssHeight</span><span class="p">))</span><span style="color: #5bc4bf">*</span><span style="color: #06b6ef">math</span><span class="p">.</span><span style="color: #06b6ef">Tan</span><span class="p">(</span><span style="color: #06b6ef">fov</span><span style="color: #5bc4bf">/</span><span style="color: #f99b15">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">direction</span> <span style="color: #5bc4bf">:=</span> <span style="color: #06b6ef">vec3</span><span class="p">{</span><span style="color: #06b6ef">px</span><span class="p">,</span> <span style="color: #06b6ef">py</span><span class="p">,</span> <span style="color: #5bc4bf">-</span><span style="color: #f99b15">1</span><span class="p">}.</span><span style="color: #06b6ef">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">t</span> <span style="color: #5bc4bf">:=</span> <span style="color: #f99b15">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #815ba4">for</span> <span style="color: #06b6ef">i</span> <span style="color: #5bc4bf">:=</span> <span style="color: #f99b15">0</span><span class="p">;</span> <span style="color: #06b6ef">i</span> <span class="p">&lt;</span> <span style="color: #06b6ef">maxIter</span><span class="p">;</span> <span style="color: #06b6ef">i</span><span style="color: #5bc4bf">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #06b6ef">p</span> <span style="color: #5bc4bf">:=</span> <span style="color: #06b6ef">direction</span><span class="p">.</span><span style="color: #06b6ef">mul</span><span class="p">(</span><span style="color: #06b6ef">t</span><span class="p">).</span><span style="color: #06b6ef">add</span><span class="p">(</span><span style="color: #06b6ef">vec3</span><span class="p">{</span><span style="color: #f99b15">0</span><span class="p">,</span> <span style="color: #f99b15">0</span><span class="p">,</span> <span style="color: #f99b15">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #06b6ef">d</span> <span style="color: #5bc4bf">:=</span> <span style="color: #06b6ef">mandelbulb</span><span class="p">(</span><span style="color: #06b6ef">p</span><span class="p">)</span> <span style="color: #5bc4bf">-</span> <span style="color: #f99b15">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #815ba4">if</span> <span style="color: #06b6ef">d</span> <span class="p">&lt;</span> <span style="color: #f99b15">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #815ba4">return</span> <span style="color: #06b6ef">color</span><span class="p">.</span><span style="color: #06b6ef">Gray</span><span class="p">{</span><span class="nb">uint8</span><span class="p">(</span><span style="color: #f99b15">255</span> <span style="color: #5bc4bf">-</span> <span style="color: #06b6ef">t</span><span style="color: #5bc4bf">*</span><span style="color: #f99b15">255</span><span style="color: #5bc4bf">/</span><span style="color: #f99b15">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #06b6ef">t</span> <span style="color: #5bc4bf">+=</span> <span style="color: #06b6ef">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #815ba4">if</span> <span style="color: #06b6ef">t</span> <span class="p">&gt;</span> <span style="color: #f99b15">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #815ba4">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #815ba4">return</span> <span style="color: #06b6ef">color</span><span class="p">.</span><span style="color: #06b6ef">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #815ba4">func</span> <span style="color: #06b6ef">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">ssImg</span> <span style="color: #5bc4bf">:=</span> <span style="color: #06b6ef">image</span><span class="p">.</span><span style="color: #06b6ef">NewRGBA</span><span class="p">(</span><span style="color: #06b6ef">image</span><span class="p">.</span><span style="color: #06b6ef">Rect</span><span class="p">(</span><span style="color: #f99b15">0</span><span class="p">,</span> <span style="color: #f99b15">0</span><span class="p">,</span> <span style="color: #06b6ef">ssWidth</span><span class="p">,</span> <span style="color: #06b6ef">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #815ba4">for</span> <span style="color: #06b6ef">y</span> <span style="color: #5bc4bf">:=</span> <span style="color: #f99b15">0</span><span class="p">;</span> <span style="color: #06b6ef">y</span> <span class="p">&lt;</span> <span style="color: #06b6ef">ssHeight</span><span class="p">;</span> <span style="color: #06b6ef">y</span><span style="color: #5bc4bf">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #06b6ef">wg</span><span class="p">.</span><span style="color: #06b6ef">Add</span><span class="p">(</span><span style="color: #f99b15">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #815ba4">go</span> <span style="color: #815ba4">func</span><span class="p">(</span><span style="color: #06b6ef">y</span> <span style="color: #fec418">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #815ba4">defer</span> <span style="color: #06b6ef">wg</span><span class="p">.</span><span style="color: #06b6ef">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #815ba4">for</span> <span style="color: #06b6ef">x</span> <span style="color: #5bc4bf">:=</span> <span style="color: #f99b15">0</span><span class="p">;</span> <span style="color: #06b6ef">x</span> <span class="p">&lt;</span> <span style="color: #06b6ef">ssWidth</span><span class="p">;</span> <span style="color: #06b6ef">x</span><span style="color: #5bc4bf">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #06b6ef">ssImg</span><span class="p">.</span><span style="color: #06b6ef">Set</span><span class="p">(</span><span style="color: #06b6ef">x</span><span class="p">,</span> <span style="color: #06b6ef">y</span><span class="p">,</span> <span style="color: #06b6ef">renderPixel</span><span class="p">(</span><span style="color: #06b6ef">x</span><span class="p">,</span> <span style="color: #06b6ef">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span style="color: #06b6ef">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">wg</span><span class="p">.</span><span style="color: #06b6ef">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">img</span> <span style="color: #5bc4bf">:=</span> <span style="color: #06b6ef">image</span><span class="p">.</span><span style="color: #06b6ef">NewRGBA</span><span class="p">(</span><span style="color: #06b6ef">image</span><span class="p">.</span><span style="color: #06b6ef">Rect</span><span class="p">(</span><span style="color: #f99b15">0</span><span class="p">,</span> <span style="color: #f99b15">0</span><span class="p">,</span> <span style="color: #06b6ef">width</span><span class="p">,</span> <span style="color: #06b6ef">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #815ba4">for</span> <span style="color: #06b6ef">y</span> <span style="color: #5bc4bf">:=</span> <span style="color: #f99b15">0</span><span class="p">;</span> <span style="color: #06b6ef">y</span> <span class="p">&lt;</span> <span style="color: #06b6ef">height</span><span class="p">;</span> <span style="color: #06b6ef">y</span><span style="color: #5bc4bf">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #815ba4">for</span> <span style="color: #06b6ef">x</span> <span style="color: #5bc4bf">:=</span> <span style="color: #f99b15">0</span><span class="p">;</span> <span style="color: #06b6ef">x</span> <span class="p">&lt;</span> <span style="color: #06b6ef">width</span><span class="p">;</span> <span style="color: #06b6ef">x</span><span style="color: #5bc4bf">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #06b6ef">r</span><span class="p">,</span> <span style="color: #06b6ef">g</span><span class="p">,</span> <span style="color: #06b6ef">b</span><span class="p">,</span> <span style="color: #06b6ef">a</span> <span style="color: #5bc4bf">:=</span> <span style="color: #f99b15">0</span><span class="p">,</span> <span style="color: #f99b15">0</span><span class="p">,</span> <span style="color: #f99b15">0</span><span class="p">,</span> <span style="color: #f99b15">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #815ba4">for</span> <span style="color: #06b6ef">dy</span> <span style="color: #5bc4bf">:=</span> <span style="color: #f99b15">0</span><span class="p">;</span> <span style="color: #06b6ef">dy</span> <span class="p">&lt;</span> <span style="color: #06b6ef">supersamplingRatio</span><span class="p">;</span> <span style="color: #06b6ef">dy</span><span style="color: #5bc4bf">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #815ba4">for</span> <span style="color: #06b6ef">dx</span> <span style="color: #5bc4bf">:=</span> <span style="color: #f99b15">0</span><span class="p">;</span> <span style="color: #06b6ef">dx</span> <span class="p">&lt;</span> <span style="color: #06b6ef">supersamplingRatio</span><span class="p">;</span> <span style="color: #06b6ef">dx</span><span style="color: #5bc4bf">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #06b6ef">c</span> <span style="color: #5bc4bf">:=</span> <span style="color: #06b6ef">ssImg</span><span class="p">.</span><span style="color: #06b6ef">RGBAAt</span><span class="p">(</span><span style="color: #06b6ef">x</span><span style="color: #5bc4bf">*</span><span style="color: #06b6ef">supersamplingRatio</span><span style="color: #5bc4bf">+</span><span style="color: #06b6ef">dx</span><span class="p">,</span> <span style="color: #06b6ef">y</span><span style="color: #5bc4bf">*</span><span style="color: #06b6ef">supersamplingRatio</span><span style="color: #5bc4bf">+</span><span style="color: #06b6ef">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #06b6ef">r</span> <span style="color: #5bc4bf">+=</span> <span class="nb">int</span><span class="p">(</span><span style="color: #06b6ef">c</span><span class="p">.</span><span style="color: #06b6ef">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #06b6ef">g</span> <span style="color: #5bc4bf">+=</span> <span class="nb">int</span><span class="p">(</span><span style="color: #06b6ef">c</span><span class="p">.</span><span style="color: #06b6ef">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #06b6ef">b</span> <span style="color: #5bc4bf">+=</span> <span class="nb">int</span><span class="p">(</span><span style="color: #06b6ef">c</span><span class="p">.</span><span style="color: #06b6ef">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #06b6ef">a</span> <span style="color: #5bc4bf">+=</span> <span class="nb">int</span><span class="p">(</span><span style="color: #06b6ef">c</span><span class="p">.</span><span style="color: #06b6ef">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #06b6ef">r</span> <span style="color: #5bc4bf">/=</span> <span style="color: #06b6ef">supersamplingRatio</span> <span style="color: #5bc4bf">*</span> <span style="color: #06b6ef">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #06b6ef">g</span> <span style="color: #5bc4bf">/=</span> <span style="color: #06b6ef">supersamplingRatio</span> <span style="color: #5bc4bf">*</span> <span style="color: #06b6ef">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #06b6ef">b</span> <span style="color: #5bc4bf">/=</span> <span style="color: #06b6ef">supersamplingRatio</span> <span style="color: #5bc4bf">*</span> <span style="color: #06b6ef">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #06b6ef">a</span> <span style="color: #5bc4bf">/=</span> <span style="color: #06b6ef">supersamplingRatio</span> <span style="color: #5bc4bf">*</span> <span style="color: #06b6ef">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #06b6ef">img</span><span class="p">.</span><span style="color: #06b6ef">Set</span><span class="p">(</span><span style="color: #06b6ef">x</span><span class="p">,</span> <span style="color: #06b6ef">y</span><span class="p">,</span> <span style="color: #06b6ef">color</span><span class="p">.</span><span style="color: #06b6ef">RGBA</span><span class="p">{</span><span class="nb">uint8</span><span class="p">(</span><span style="color: #06b6ef">r</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span style="color: #06b6ef">g</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span style="color: #06b6ef">b</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span style="color: #06b6ef">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">file</span><span class="p">,</span> <span style="color: #06b6ef">err</span> <span style="color: #5bc4bf">:=</span> <span style="color: #06b6ef">os</span><span class="p">.</span><span style="color: #06b6ef">Create</span><span class="p">(</span><span style="color: #48b685">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #815ba4">if</span> <span style="color: #06b6ef">err</span> <span style="color: #5bc4bf">!=</span> <span style="color: #815ba4">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #06b6ef">fmt</span><span class="p">.</span><span style="color: #06b6ef">Println</span><span class="p">(</span><span style="color: #48b685">&#34;Error creating file:&#34;</span><span class="p">,</span> <span style="color: #06b6ef">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #815ba4">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #815ba4">defer</span> <span style="color: #06b6ef">file</span><span class="p">.</span><span style="color: #06b6ef">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">err</span> <span class="p">=</span> <span style="color: #06b6ef">png</span><span class="p">.</span><span style="color: #06b6ef">Encode</span><span class="p">(</span><span style="color: #06b6ef">file</span><span class="p">,</span> <span style="color: #06b6ef">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #815ba4">if</span> <span style="color: #06b6ef">err</span> <span style="color: #5bc4bf">!=</span> <span style="color: #815ba4">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #06b6ef">fmt</span><span class="p">.</span><span style="color: #06b6ef">Println</span><span class="p">(</span><span style="color: #48b685">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span style="color: #06b6ef">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='paraiso-light'><h2><a id='stylelink' href='paraiso-light.html' alt='View only paraiso-light'>paraiso-light</a></h2></a><code><pre style="color: #2f1e2e; background-color: #e7e9db;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #5bc4bf">package</span> <span style="color: #06b6ef">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8d8687">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #8d8687"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #8d8687"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #8d8687"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #5bc4bf">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #48b685">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #48b685">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #48b685">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #48b685">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #48b685">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #48b685">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #48b685">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #815ba4">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">width</span><span class="p">,</span> <span style="color: #06b6ef">height</span>      <span class="p">=</span> <span style="color: #f99b15">1920</span><span class="p">,</span> <span style="color: #f99b15">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">ssWidth</span><span class="p">,</span> <span style="color: #06b6ef">ssHeight</span>  <span class="p">=</span> <span style="color: #f99b15">3840</span><span class="p">,</span> <span style="color: #f99b15">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">aspectRatio</span>        <span class="p">=</span> <span class="nb">float64</span><span class="p">(</span><span style="color: #06b6ef">ssWidth</span><span class="p">)</span> <span style="color: #5bc4bf">/</span> <span class="nb">float64</span><span class="p">(</span><span style="color: #06b6ef">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">fov</span>                <span class="p">=</span> <span style="color: #06b6ef">math</span><span class="p">.</span><span style="color: #06b6ef">Pi</span> <span style="color: #5bc4bf">/</span> <span style="color: #f99b15">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">maxIter</span>            <span class="p">=</span> <span style="color: #f99b15">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">power</span>              <span class="p">=</span> <span style="color: #f99b15">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">escapeRadius</span>       <span class="p">=</span> <span style="color: #f99b15">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">supersamplingRatio</span> <span class="p">=</span> <span style="color: #f99b15">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #815ba4">var</span> <span style="color: #06b6ef">wg</span> <span style="color: #06b6ef">sync</span><span class="p">.</span><span style="color: #06b6ef">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #815ba4">type</span> <span style="color: #06b6ef">vec3</span> <span style="color: #815ba4">struct</span><span class="p">{</span> <span style="color: #06b6ef">x</span><span class="p">,</span> <span style="color: #06b6ef">y</span><span class="p">,</span> <span style="color: #06b6ef">z</span> <span style="color: #fec418">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #815ba4">func</span> <span class="p">(</span><span style="color: #06b6ef">v</span> <span style="color: #06b6ef">vec3</span><span class="p">)</span> <span style="color: #06b6ef">add</span><span class="p">(</span><span style="color: #06b6ef">w</span> <span style="color: #06b6ef">vec3</span><span class="p">)</span> <span style="color: #06b6ef">vec3</span>    <span class="p">{</span> <span style="color: #815ba4">return</span> <span style="color: #06b6ef">vec3</span><span class="p">{</span><span style="color: #06b6ef">v</span><span class="p">.</span><span style="color: #06b6ef">x</span> <span style="color: #5bc4bf">+</span> <span style="color: #06b6ef">w</span><span class="p">.</span><span style="color: #06b6ef">x</span><span class="p">,</span> <span style="color: #06b6ef">v</span><span class="p">.</span><span style="color: #06b6ef">y</span> <span style="color: #5bc4bf">+</span> <span style="color: #06b6ef">w</span><span class="p">.</span><span style="color: #06b6ef">y</span><span class="p">,</span> <span style="color: #06b6ef">v</span><span class="p">.</span><span style="color: #06b6ef">z</span> <span style="color: #5bc4bf">+</span> <span style="color: #06b6ef">w</span><span class="p">.</span><span style="color: #06b6ef">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #815ba4">func</span> <span class="p">(</span><span style="color: #06b6ef">v</span> <span style="color: #06b6ef">vec3</span><span class="p">)</span> <span style="color: #06b6ef">mul</span><span class="p">(</span><span style="color: #06b6ef">s</span> <span style="color: #fec418">float64</span><span class="p">)</span> <span style="color: #06b6ef">vec3</span> <span class="p">{</span> <span style="color: #815ba4">return</span> <span style="color: #06b6ef">vec3</span><span class="p">{</span><span style="color: #06b6ef">v</span><span class="p">.</span><span style="color: #06b6ef">x</span> <span style="color: #5bc4bf">*</span> <span style="color: #06b6ef">s</span><span class="p">,</span> <span style="color: #06b6ef">v</span><span class="p">.</span><span style="color: #06b6ef">y</span> <span style="color: #5bc4bf">*</span> <span style="color: #06b6ef">s</span><span class="p">,</span> <span style="color: #06b6ef">v</span><span class="p">.</span><span style="color: #06b6ef">z</span> <span style="color: #5bc4bf">*</span> <span style="color: #06b6ef">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #815ba4">func</span> <span class="p">(</span><span style="color: #06b6ef">v</span> <span style="color: #06b6ef">vec3</span><span class="p">)</span> <span style="color: #06b6ef">length</span><span class="p">()</span> <span style="color: #fec418">float64</span>    <span class="p">{</span> <span style="color: #815ba4">return</span> <span style="color: #06b6ef">math</span><span class="p">.</span><span style="color: #06b6ef">Sqrt</span><span class="p">(</span><span style="color: #06b6ef">v</span><span class="p">.</span><span style="color: #06b6ef">x</span><span style="color: #5bc4bf">*</span><span style="color: #06b6ef">v</span><span class="p">.</span><span style="color: #06b6ef">x</span> <span style="color: #5bc4bf">+</span> <span style="color: #06b6ef">v</span><span class="p">.</span><span style="color: #06b6ef">y</span><span style="color: #5bc4bf">*</span><span style="color: #06b6ef">v</span><span class="p">.</span><span style="color: #06b6ef">y</span> <span style="color: #5bc4bf">+</span> <span style="color: #06b6ef">v</span><span class="p">.</span><span style="color: #06b6ef">z</span><span style="color: #5bc4bf">*</span><span style="color: #06b6ef">v</span><span class="p">.</span><span style="color: #06b6ef">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #815ba4">func</span> <span class="p">(</span><span style="color: #06b6ef">v</span> <span style="color: #06b6ef">vec3</span><span class="p">)</span> <span style="color: #06b6ef">normalize</span><span class="p">()</span> <span style="color: #06b6ef">vec3</span>    <span class="p">{</span> <span style="color: #815ba4">return</span> <span style="color: #06b6ef">v</span><span class="p">.</span><span style="color: #06b6ef">mul</span><span class="p">(</span><span style="color: #f99b15">1</span> <span style="color: #5bc4bf">/</span> <span style="color: #06b6ef">v</span><span class="p">.</span><span style="color: #06b6ef">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #815ba4">func</span> <span style="color: #06b6ef">mandelbulb</span><span class="p">(</span><span style="color: #06b6ef">p</span> <span style="color: #06b6ef">vec3</span><span class="p">)</span> <span style="color: #fec418">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">z</span><span class="p">,</span> <span style="color: #06b6ef">r</span><span class="p">,</span> <span style="color: #06b6ef">theta</span><span class="p">,</span> <span style="color: #06b6ef">phi</span> <span style="color: #5bc4bf">:=</span> <span style="color: #06b6ef">p</span><span class="p">,</span> <span style="color: #f99b15">0.0</span><span class="p">,</span> <span style="color: #f99b15">0.0</span><span class="p">,</span> <span style="color: #f99b15">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #815ba4">for</span> <span style="color: #06b6ef">i</span> <span style="color: #5bc4bf">:=</span> <span style="color: #f99b15">0</span><span class="p">;</span> <span style="color: #06b6ef">i</span> <span class="p">&lt;</span> <span style="color: #06b6ef">maxIter</span><span class="p">;</span> <span style="color: #06b6ef">i</span><span style="color: #5bc4bf">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #06b6ef">r</span> <span class="p">=</span> <span style="color: #06b6ef">z</span><span class="p">.</span><span style="color: #06b6ef">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #815ba4">if</span> <span style="color: #06b6ef">r</span> <span class="p">&gt;</span> <span style="color: #06b6ef">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #815ba4">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #06b6ef">theta</span><span class="p">,</span> <span style="color: #06b6ef">phi</span> <span class="p">=</span> <span style="color: #06b6ef">math</span><span class="p">.</span><span style="color: #06b6ef">Acos</span><span class="p">(</span><span style="color: #06b6ef">z</span><span class="p">.</span><span style="color: #06b6ef">z</span><span style="color: #5bc4bf">/</span><span style="color: #06b6ef">r</span><span class="p">)</span><span style="color: #5bc4bf">*</span><span style="color: #06b6ef">power</span><span class="p">,</span> <span style="color: #06b6ef">math</span><span class="p">.</span><span style="color: #06b6ef">Atan2</span><span class="p">(</span><span style="color: #06b6ef">z</span><span class="p">.</span><span style="color: #06b6ef">y</span><span class="p">,</span> <span style="color: #06b6ef">z</span><span class="p">.</span><span style="color: #06b6ef">x</span><span class="p">)</span><span style="color: #5bc4bf">*</span><span style="color: #06b6ef">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #06b6ef">r</span> <span class="p">=</span> <span style="color: #06b6ef">math</span><span class="p">.</span><span style="color: #06b6ef">Pow</span><span class="p">(</span><span style="color: #06b6ef">r</span><span class="p">,</span> <span style="color: #06b6ef">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #06b6ef">z</span><span class="p">.</span><span style="color: #06b6ef">x</span><span class="p">,</span> <span style="color: #06b6ef">z</span><span class="p">.</span><span style="color: #06b6ef">y</span><span class="p">,</span> <span style="color: #06b6ef">z</span><span class="p">.</span><span style="color: #06b6ef">z</span> <span class="p">=</span> <span style="color: #06b6ef">p</span><span class="p">.</span><span style="color: #06b6ef">x</span><span style="color: #5bc4bf">+</span><span style="color: #06b6ef">r</span><span style="color: #5bc4bf">*</span><span style="color: #06b6ef">math</span><span class="p">.</span><span style="color: #06b6ef">Sin</span><span class="p">(</span><span style="color: #06b6ef">theta</span><span class="p">)</span><span style="color: #5bc4bf">*</span><span style="color: #06b6ef">math</span><span class="p">.</span><span style="color: #06b6ef">Cos</span><span class="p">(</span><span style="color: #06b6ef">phi</span><span class="p">),</span> <span style="color: #06b6ef">p</span><span class="p">.</span><span style="color: #06b6ef">y</span><span style="color: #5bc4bf">+</span><span style="color: #06b6ef">r</span><span style="color: #5bc4bf">*</span><span style="color: #06b6ef">math</span><span class="p">.</span><span style="color: #06b6ef">Sin</span><span class="p">(</span><span style="color: #06b6ef">theta</span><span class="p">)</span><span style="color: #5bc4bf">*</span><span style="color: #06b6ef">math</span><span class="p">.</span><span style="color: #06b6ef">Sin</span><span class="p">(</span><span style="color: #06b6ef">phi</span><span class="p">),</span> <span style="color: #06b6ef">p</span><span class="p">.</span><span style="color: #06b6ef">z</span><span style="color: #5bc4bf">+</span><span style="color: #06b6ef">r</span><span style="color: #5bc4bf">*</span><span style="color: #06b6ef">math</span><span class="p">.</span><span style="color: #06b6ef">Cos</span><span class="p">(</span><span style="color: #06b6ef">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #815ba4">return</span> <span style="color: #06b6ef">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #815ba4">func</span> <span style="color: #06b6ef">renderPixel</span><span class="p">(</span><span style="color: #06b6ef">x</span><span class="p">,</span> <span style="color: #06b6ef">y</span> <span style="color: #fec418">int</span><span class="p">)</span> <span style="color: #06b6ef">color</span><span class="p">.</span><span style="color: #06b6ef">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">px</span><span class="p">,</span> <span style="color: #06b6ef">py</span> <span style="color: #5bc4bf">:=</span> <span class="p">(</span><span style="color: #f99b15">2</span><span style="color: #5bc4bf">*</span><span class="nb">float64</span><span class="p">(</span><span style="color: #06b6ef">x</span><span class="p">)</span><span style="color: #5bc4bf">/</span><span class="nb">float64</span><span class="p">(</span><span style="color: #06b6ef">ssWidth</span><span class="p">)</span><span style="color: #5bc4bf">-</span><span style="color: #f99b15">1</span><span class="p">)</span><span style="color: #5bc4bf">*</span><span style="color: #06b6ef">aspectRatio</span><span style="color: #5bc4bf">*</span><span style="color: #06b6ef">math</span><span class="p">.</span><span style="color: #06b6ef">Tan</span><span class="p">(</span><span style="color: #06b6ef">fov</span><span style="color: #5bc4bf">/</span><span style="color: #f99b15">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #f99b15">1</span><span style="color: #5bc4bf">-</span><span style="color: #f99b15">2</span><span style="color: #5bc4bf">*</span><span class="nb">float64</span><span class="p">(</span><span style="color: #06b6ef">y</span><span class="p">)</span><span style="color: #5bc4bf">/</span><span class="nb">float64</span><span class="p">(</span><span style="color: #06b6ef">ssHeight</span><span class="p">))</span><span style="color: #5bc4bf">*</span><span style="color: #06b6ef">math</span><span class="p">.</span><span style="color: #06b6ef">Tan</span><span class="p">(</span><span style="color: #06b6ef">fov</span><span style="color: #5bc4bf">/</span><span style="color: #f99b15">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">direction</span> <span style="color: #5bc4bf">:=</span> <span style="color: #06b6ef">vec3</span><span class="p">{</span><span style="color: #06b6ef">px</span><span class="p">,</span> <span style="color: #06b6ef">py</span><span class="p">,</span> <span style="color: #5bc4bf">-</span><span style="color: #f99b15">1</span><span class="p">}.</span><span style="color: #06b6ef">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">t</span> <span style="color: #5bc4bf">:=</span> <span style="color: #f99b15">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #815ba4">for</span> <span style="color: #06b6ef">i</span> <span style="color: #5bc4bf">:=</span> <span style="color: #f99b15">0</span><span class="p">;</span> <span style="color: #06b6ef">i</span> <span class="p">&lt;</span> <span style="color: #06b6ef">maxIter</span><span class="p">;</span> <span style="color: #06b6ef">i</span><span style="color: #5bc4bf">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #06b6ef">p</span> <span style="color: #5bc4bf">:=</span> <span style="color: #06b6ef">direction</span><span class="p">.</span><span style="color: #06b6ef">mul</span><span class="p">(</span><span style="color: #06b6ef">t</span><span class="p">).</span><span style="color: #06b6ef">add</span><span class="p">(</span><span style="color: #06b6ef">vec3</span><span class="p">{</span><span style="color: #f99b15">0</span><span class="p">,</span> <span style="color: #f99b15">0</span><span class="p">,</span> <span style="color: #f99b15">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #06b6ef">d</span> <span style="color: #5bc4bf">:=</span> <span style="color: #06b6ef">mandelbulb</span><span class="p">(</span><span style="color: #06b6ef">p</span><span class="p">)</span> <span style="color: #5bc4bf">-</span> <span style="color: #f99b15">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #815ba4">if</span> <span style="color: #06b6ef">d</span> <span class="p">&lt;</span> <span style="color: #f99b15">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #815ba4">return</span> <span style="color: #06b6ef">color</span><span class="p">.</span><span style="color: #06b6ef">Gray</span><span class="p">{</span><span class="nb">uint8</span><span class="p">(</span><span style="color: #f99b15">255</span> <span style="color: #5bc4bf">-</span> <span style="color: #06b6ef">t</span><span style="color: #5bc4bf">*</span><span style="color: #f99b15">255</span><span style="color: #5bc4bf">/</span><span style="color: #f99b15">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #06b6ef">t</span> <span style="color: #5bc4bf">+=</span> <span style="color: #06b6ef">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #815ba4">if</span> <span style="color: #06b6ef">t</span> <span class="p">&gt;</span> <span style="color: #f99b15">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #815ba4">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #815ba4">return</span> <span style="color: #06b6ef">color</span><span class="p">.</span><span style="color: #06b6ef">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #815ba4">func</span> <span style="color: #06b6ef">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">ssImg</span> <span style="color: #5bc4bf">:=</span> <span style="color: #06b6ef">image</span><span class="p">.</span><span style="color: #06b6ef">NewRGBA</span><span class="p">(</span><span style="color: #06b6ef">image</span><span class="p">.</span><span style="color: #06b6ef">Rect</span><span class="p">(</span><span style="color: #f99b15">0</span><span class="p">,</span> <span style="color: #f99b15">0</span><span class="p">,</span> <span style="color: #06b6ef">ssWidth</span><span class="p">,</span> <span style="color: #06b6ef">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #815ba4">for</span> <span style="color: #06b6ef">y</span> <span style="color: #5bc4bf">:=</span> <span style="color: #f99b15">0</span><span class="p">;</span> <span style="color: #06b6ef">y</span> <span class="p">&lt;</span> <span style="color: #06b6ef">ssHeight</span><span class="p">;</span> <span style="color: #06b6ef">y</span><span style="color: #5bc4bf">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #06b6ef">wg</span><span class="p">.</span><span style="color: #06b6ef">Add</span><span class="p">(</span><span style="color: #f99b15">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #815ba4">go</span> <span style="color: #815ba4">func</span><span class="p">(</span><span style="color: #06b6ef">y</span> <span style="color: #fec418">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #815ba4">defer</span> <span style="color: #06b6ef">wg</span><span class="p">.</span><span style="color: #06b6ef">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #815ba4">for</span> <span style="color: #06b6ef">x</span> <span style="color: #5bc4bf">:=</span> <span style="color: #f99b15">0</span><span class="p">;</span> <span style="color: #06b6ef">x</span> <span class="p">&lt;</span> <span style="color: #06b6ef">ssWidth</span><span class="p">;</span> <span style="color: #06b6ef">x</span><span style="color: #5bc4bf">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #06b6ef">ssImg</span><span class="p">.</span><span style="color: #06b6ef">Set</span><span class="p">(</span><span style="color: #06b6ef">x</span><span class="p">,</span> <span style="color: #06b6ef">y</span><span class="p">,</span> <span style="color: #06b6ef">renderPixel</span><span class="p">(</span><span style="color: #06b6ef">x</span><span class="p">,</span> <span style="color: #06b6ef">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span style="color: #06b6ef">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">wg</span><span class="p">.</span><span style="color: #06b6ef">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">img</span> <span style="color: #5bc4bf">:=</span> <span style="color: #06b6ef">image</span><span class="p">.</span><span style="color: #06b6ef">NewRGBA</span><span class="p">(</span><span style="color: #06b6ef">image</span><span class="p">.</span><span style="color: #06b6ef">Rect</span><span class="p">(</span><span style="color: #f99b15">0</span><span class="p">,</span> <span style="color: #f99b15">0</span><span class="p">,</span> <span style="color: #06b6ef">width</span><span class="p">,</span> <span style="color: #06b6ef">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #815ba4">for</span> <span style="color: #06b6ef">y</span> <span style="color: #5bc4bf">:=</span> <span style="color: #f99b15">0</span><span class="p">;</span> <span style="color: #06b6ef">y</span> <span class="p">&lt;</span> <span style="color: #06b6ef">height</span><span class="p">;</span> <span style="color: #06b6ef">y</span><span style="color: #5bc4bf">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #815ba4">for</span> <span style="color: #06b6ef">x</span> <span style="color: #5bc4bf">:=</span> <span style="color: #f99b15">0</span><span class="p">;</span> <span style="color: #06b6ef">x</span> <span class="p">&lt;</span> <span style="color: #06b6ef">width</span><span class="p">;</span> <span style="color: #06b6ef">x</span><span style="color: #5bc4bf">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #06b6ef">r</span><span class="p">,</span> <span style="color: #06b6ef">g</span><span class="p">,</span> <span style="color: #06b6ef">b</span><span class="p">,</span> <span style="color: #06b6ef">a</span> <span style="color: #5bc4bf">:=</span> <span style="color: #f99b15">0</span><span class="p">,</span> <span style="color: #f99b15">0</span><span class="p">,</span> <span style="color: #f99b15">0</span><span class="p">,</span> <span style="color: #f99b15">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #815ba4">for</span> <span style="color: #06b6ef">dy</span> <span style="color: #5bc4bf">:=</span> <span style="color: #f99b15">0</span><span class="p">;</span> <span style="color: #06b6ef">dy</span> <span class="p">&lt;</span> <span style="color: #06b6ef">supersamplingRatio</span><span class="p">;</span> <span style="color: #06b6ef">dy</span><span style="color: #5bc4bf">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #815ba4">for</span> <span style="color: #06b6ef">dx</span> <span style="color: #5bc4bf">:=</span> <span style="color: #f99b15">0</span><span class="p">;</span> <span style="color: #06b6ef">dx</span> <span class="p">&lt;</span> <span style="color: #06b6ef">supersamplingRatio</span><span class="p">;</span> <span style="color: #06b6ef">dx</span><span style="color: #5bc4bf">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #06b6ef">c</span> <span style="color: #5bc4bf">:=</span> <span style="color: #06b6ef">ssImg</span><span class="p">.</span><span style="color: #06b6ef">RGBAAt</span><span class="p">(</span><span style="color: #06b6ef">x</span><span style="color: #5bc4bf">*</span><span style="color: #06b6ef">supersamplingRatio</span><span style="color: #5bc4bf">+</span><span style="color: #06b6ef">dx</span><span class="p">,</span> <span style="color: #06b6ef">y</span><span style="color: #5bc4bf">*</span><span style="color: #06b6ef">supersamplingRatio</span><span style="color: #5bc4bf">+</span><span style="color: #06b6ef">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #06b6ef">r</span> <span style="color: #5bc4bf">+=</span> <span class="nb">int</span><span class="p">(</span><span style="color: #06b6ef">c</span><span class="p">.</span><span style="color: #06b6ef">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #06b6ef">g</span> <span style="color: #5bc4bf">+=</span> <span class="nb">int</span><span class="p">(</span><span style="color: #06b6ef">c</span><span class="p">.</span><span style="color: #06b6ef">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #06b6ef">b</span> <span style="color: #5bc4bf">+=</span> <span class="nb">int</span><span class="p">(</span><span style="color: #06b6ef">c</span><span class="p">.</span><span style="color: #06b6ef">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #06b6ef">a</span> <span style="color: #5bc4bf">+=</span> <span class="nb">int</span><span class="p">(</span><span style="color: #06b6ef">c</span><span class="p">.</span><span style="color: #06b6ef">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #06b6ef">r</span> <span style="color: #5bc4bf">/=</span> <span style="color: #06b6ef">supersamplingRatio</span> <span style="color: #5bc4bf">*</span> <span style="color: #06b6ef">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #06b6ef">g</span> <span style="color: #5bc4bf">/=</span> <span style="color: #06b6ef">supersamplingRatio</span> <span style="color: #5bc4bf">*</span> <span style="color: #06b6ef">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #06b6ef">b</span> <span style="color: #5bc4bf">/=</span> <span style="color: #06b6ef">supersamplingRatio</span> <span style="color: #5bc4bf">*</span> <span style="color: #06b6ef">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #06b6ef">a</span> <span style="color: #5bc4bf">/=</span> <span style="color: #06b6ef">supersamplingRatio</span> <span style="color: #5bc4bf">*</span> <span style="color: #06b6ef">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #06b6ef">img</span><span class="p">.</span><span style="color: #06b6ef">Set</span><span class="p">(</span><span style="color: #06b6ef">x</span><span class="p">,</span> <span style="color: #06b6ef">y</span><span class="p">,</span> <span style="color: #06b6ef">color</span><span class="p">.</span><span style="color: #06b6ef">RGBA</span><span class="p">{</span><span class="nb">uint8</span><span class="p">(</span><span style="color: #06b6ef">r</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span style="color: #06b6ef">g</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span style="color: #06b6ef">b</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span style="color: #06b6ef">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">file</span><span class="p">,</span> <span style="color: #06b6ef">err</span> <span style="color: #5bc4bf">:=</span> <span style="color: #06b6ef">os</span><span class="p">.</span><span style="color: #06b6ef">Create</span><span class="p">(</span><span style="color: #48b685">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #815ba4">if</span> <span style="color: #06b6ef">err</span> <span style="color: #5bc4bf">!=</span> <span style="color: #815ba4">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #06b6ef">fmt</span><span class="p">.</span><span style="color: #06b6ef">Println</span><span class="p">(</span><span style="color: #48b685">&#34;Error creating file:&#34;</span><span class="p">,</span> <span style="color: #06b6ef">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #815ba4">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #815ba4">defer</span> <span style="color: #06b6ef">file</span><span class="p">.</span><span style="color: #06b6ef">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #06b6ef">err</span> <span class="p">=</span> <span style="color: #06b6ef">png</span><span class="p">.</span><span style="color: #06b6ef">Encode</span><span class="p">(</span><span style="color: #06b6ef">file</span><span class="p">,</span> <span style="color: #06b6ef">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #815ba4">if</span> <span style="color: #06b6ef">err</span> <span style="color: #5bc4bf">!=</span> <span style="color: #815ba4">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #06b6ef">fmt</span><span class="p">.</span><span style="color: #06b6ef">Println</span><span class="p">(</span><span style="color: #48b685">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span style="color: #06b6ef">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='pastie'><h2><a id='stylelink' href='pastie.html' alt='View only pastie'>pastie</a></h2></a><code><pre style="background-color: #ffffff;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #008800; font-weight: bold">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #888888">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #888888"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #888888"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #888888"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; font-weight: bold">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #dd2200; background-color: #fff0f0">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #dd2200; background-color: #fff0f0">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #dd2200; background-color: #fff0f0">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #dd2200; background-color: #fff0f0">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #dd2200; background-color: #fff0f0">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #dd2200; background-color: #fff0f0">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #dd2200; background-color: #fff0f0">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; font-weight: bold">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span style="color: #0000dd; font-weight: bold">1920</span><span class="p">,</span> <span style="color: #0000dd; font-weight: bold">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span style="color: #0000dd; font-weight: bold">3840</span><span class="p">,</span> <span style="color: #0000dd; font-weight: bold">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span style="color: #003388">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span class="o">/</span> <span style="color: #003388">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span class="o">/</span> <span style="color: #0000dd; font-weight: bold">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span style="color: #0000dd; font-weight: bold">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span style="color: #0000dd; font-weight: bold">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span style="color: #0000dd; font-weight: bold">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span style="color: #0000dd; font-weight: bold">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; font-weight: bold">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; font-weight: bold">type</span> <span class="nx">vec3</span> <span style="color: #008800; font-weight: bold">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #888888; font-weight: bold">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #0066bb; font-weight: bold">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #008800; font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #0066bb; font-weight: bold">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #888888; font-weight: bold">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #008800; font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #0066bb; font-weight: bold">length</span><span class="p">()</span> <span style="color: #888888; font-weight: bold">float64</span>    <span class="p">{</span> <span style="color: #008800; font-weight: bold">return</span> <span class="nx">math</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #0066bb; font-weight: bold">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #008800; font-weight: bold">return</span> <span class="nx">v</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">mul</span><span class="p">(</span><span style="color: #0000dd; font-weight: bold">1</span> <span class="o">/</span> <span class="nx">v</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; font-weight: bold">func</span> <span style="color: #0066bb; font-weight: bold">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #888888; font-weight: bold">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="o">:=</span> <span class="nx">p</span><span class="p">,</span> <span style="color: #0000dd; font-weight: bold">0.0</span><span class="p">,</span> <span style="color: #0000dd; font-weight: bold">0.0</span><span class="p">,</span> <span style="color: #0000dd; font-weight: bold">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008800; font-weight: bold">for</span> <span class="nx">i</span> <span class="o">:=</span> <span style="color: #0000dd; font-weight: bold">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #008800; font-weight: bold">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #008800; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span class="o">/</span><span class="nx">r</span><span class="p">)</span><span class="o">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="o">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008800; font-weight: bold">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; font-weight: bold">func</span> <span style="color: #0066bb; font-weight: bold">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #888888; font-weight: bold">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span class="o">:=</span> <span class="p">(</span><span style="color: #0000dd; font-weight: bold">2</span><span class="o">*</span><span style="color: #003388">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="o">/</span><span style="color: #003388">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span class="o">-</span><span style="color: #0000dd; font-weight: bold">1</span><span class="p">)</span><span class="o">*</span><span class="nx">aspectRatio</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Tan</span><span class="p">(</span><span class="nx">fov</span><span class="o">/</span><span style="color: #0000dd; font-weight: bold">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #0000dd; font-weight: bold">1</span><span class="o">-</span><span style="color: #0000dd; font-weight: bold">2</span><span class="o">*</span><span style="color: #003388">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span class="o">/</span><span style="color: #003388">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Tan</span><span class="p">(</span><span class="nx">fov</span><span class="o">/</span><span style="color: #0000dd; font-weight: bold">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span class="o">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span class="o">-</span><span style="color: #0000dd; font-weight: bold">1</span><span class="p">}.</span><span style="color: #0066bb; font-weight: bold">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span class="o">:=</span> <span style="color: #0000dd; font-weight: bold">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008800; font-weight: bold">for</span> <span class="nx">i</span> <span class="o">:=</span> <span style="color: #0000dd; font-weight: bold">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span class="o">:=</span> <span class="nx">direction</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span style="color: #0066bb; font-weight: bold">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span style="color: #0000dd; font-weight: bold">0</span><span class="p">,</span> <span style="color: #0000dd; font-weight: bold">0</span><span class="p">,</span> <span style="color: #0000dd; font-weight: bold">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span class="o">:=</span> <span style="color: #0066bb; font-weight: bold">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="o">-</span> <span style="color: #0000dd; font-weight: bold">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #008800; font-weight: bold">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span style="color: #0000dd; font-weight: bold">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #008800; font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span style="color: #003388">uint8</span><span class="p">(</span><span style="color: #0000dd; font-weight: bold">255</span> <span class="o">-</span> <span class="nx">t</span><span class="o">*</span><span style="color: #0000dd; font-weight: bold">255</span><span class="o">/</span><span style="color: #0000dd; font-weight: bold">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span class="o">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #008800; font-weight: bold">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span style="color: #0000dd; font-weight: bold">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #008800; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008800; font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008800; font-weight: bold">func</span> <span style="color: #0066bb; font-weight: bold">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Rect</span><span class="p">(</span><span style="color: #0000dd; font-weight: bold">0</span><span class="p">,</span> <span style="color: #0000dd; font-weight: bold">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008800; font-weight: bold">for</span> <span class="nx">y</span> <span class="o">:=</span> <span style="color: #0000dd; font-weight: bold">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Add</span><span class="p">(</span><span style="color: #0000dd; font-weight: bold">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #008800; font-weight: bold">go</span> <span style="color: #008800; font-weight: bold">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #888888; font-weight: bold">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #008800; font-weight: bold">defer</span> <span class="nx">wg</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #008800; font-weight: bold">for</span> <span class="nx">x</span> <span class="o">:=</span> <span style="color: #0000dd; font-weight: bold">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span style="color: #0066bb; font-weight: bold">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Rect</span><span class="p">(</span><span style="color: #0000dd; font-weight: bold">0</span><span class="p">,</span> <span style="color: #0000dd; font-weight: bold">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008800; font-weight: bold">for</span> <span class="nx">y</span> <span class="o">:=</span> <span style="color: #0000dd; font-weight: bold">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #008800; font-weight: bold">for</span> <span class="nx">x</span> <span class="o">:=</span> <span style="color: #0000dd; font-weight: bold">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span class="o">:=</span> <span style="color: #0000dd; font-weight: bold">0</span><span class="p">,</span> <span style="color: #0000dd; font-weight: bold">0</span><span class="p">,</span> <span style="color: #0000dd; font-weight: bold">0</span><span class="p">,</span> <span style="color: #0000dd; font-weight: bold">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #008800; font-weight: bold">for</span> <span class="nx">dy</span> <span class="o">:=</span> <span style="color: #0000dd; font-weight: bold">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #008800; font-weight: bold">for</span> <span class="nx">dx</span> <span class="o">:=</span> <span style="color: #0000dd; font-weight: bold">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span class="o">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span class="o">*</span><span class="nx">supersamplingRatio</span><span class="o">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span class="o">*</span><span class="nx">supersamplingRatio</span><span class="o">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span class="o">+=</span> <span style="color: #003388">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span class="o">+=</span> <span style="color: #003388">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span class="o">+=</span> <span style="color: #003388">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span class="o">+=</span> <span style="color: #003388">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span style="color: #003388">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span style="color: #003388">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span style="color: #003388">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span style="color: #003388">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Create</span><span class="p">(</span><span style="color: #dd2200; background-color: #fff0f0">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008800; font-weight: bold">if</span> <span class="nx">err</span> <span class="o">!=</span> <span style="color: #008800; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Println</span><span class="p">(</span><span style="color: #dd2200; background-color: #fff0f0">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #008800; font-weight: bold">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008800; font-weight: bold">defer</span> <span class="nx">file</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008800; font-weight: bold">if</span> <span class="nx">err</span> <span class="o">!=</span> <span style="color: #008800; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #0066bb; font-weight: bold">Println</span><span class="p">(</span><span style="color: #dd2200; background-color: #fff0f0">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='perldoc'><h2><a id='stylelink' href='perldoc.html' alt='View only perldoc'>perldoc</a></h2></a><code><pre style="background-color: #eeeedd;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #8b008b; font-weight: bold">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #228b22">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #228b22"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #228b22"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #228b22"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8b008b; font-weight: bold">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cd5555">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cd5555">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cd5555">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cd5555">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cd5555">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cd5555">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cd5555">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8b008b; font-weight: bold">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span style="color: #b452cd">1920</span><span class="p">,</span> <span style="color: #b452cd">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span style="color: #b452cd">3840</span><span class="p">,</span> <span style="color: #b452cd">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span style="color: #658b00">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span class="o">/</span> <span style="color: #658b00">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span class="o">/</span> <span style="color: #b452cd">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span style="color: #b452cd">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span style="color: #b452cd">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span style="color: #b452cd">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span style="color: #b452cd">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8b008b; font-weight: bold">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8b008b; font-weight: bold">type</span> <span class="nx">vec3</span> <span style="color: #8b008b; font-weight: bold">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #00688b; font-weight: bold">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8b008b; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #008b45">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #8b008b; font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8b008b; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #008b45">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #00688b; font-weight: bold">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #8b008b; font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8b008b; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #008b45">length</span><span class="p">()</span> <span style="color: #00688b; font-weight: bold">float64</span>    <span class="p">{</span> <span style="color: #8b008b; font-weight: bold">return</span> <span class="nx">math</span><span class="p">.</span><span style="color: #008b45">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8b008b; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #008b45">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #8b008b; font-weight: bold">return</span> <span class="nx">v</span><span class="p">.</span><span style="color: #008b45">mul</span><span class="p">(</span><span style="color: #b452cd">1</span> <span class="o">/</span> <span class="nx">v</span><span class="p">.</span><span style="color: #008b45">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8b008b; font-weight: bold">func</span> <span style="color: #008b45">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #00688b; font-weight: bold">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="o">:=</span> <span class="nx">p</span><span class="p">,</span> <span style="color: #b452cd">0.0</span><span class="p">,</span> <span style="color: #b452cd">0.0</span><span class="p">,</span> <span style="color: #b452cd">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #8b008b; font-weight: bold">for</span> <span class="nx">i</span> <span class="o">:=</span> <span style="color: #b452cd">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span style="color: #008b45">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #8b008b; font-weight: bold">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #8b008b; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #008b45">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span class="o">/</span><span class="nx">r</span><span class="p">)</span><span class="o">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span style="color: #008b45">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="o">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #008b45">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #008b45">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #008b45">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #008b45">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #008b45">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #008b45">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #8b008b; font-weight: bold">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8b008b; font-weight: bold">func</span> <span style="color: #008b45">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #00688b; font-weight: bold">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span class="o">:=</span> <span class="p">(</span><span style="color: #b452cd">2</span><span class="o">*</span><span style="color: #658b00">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="o">/</span><span style="color: #658b00">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span class="o">-</span><span style="color: #b452cd">1</span><span class="p">)</span><span class="o">*</span><span class="nx">aspectRatio</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #008b45">Tan</span><span class="p">(</span><span class="nx">fov</span><span class="o">/</span><span style="color: #b452cd">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #b452cd">1</span><span class="o">-</span><span style="color: #b452cd">2</span><span class="o">*</span><span style="color: #658b00">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span class="o">/</span><span style="color: #658b00">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #008b45">Tan</span><span class="p">(</span><span class="nx">fov</span><span class="o">/</span><span style="color: #b452cd">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span class="o">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span class="o">-</span><span style="color: #b452cd">1</span><span class="p">}.</span><span style="color: #008b45">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span class="o">:=</span> <span style="color: #b452cd">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #8b008b; font-weight: bold">for</span> <span class="nx">i</span> <span class="o">:=</span> <span style="color: #b452cd">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span class="o">:=</span> <span class="nx">direction</span><span class="p">.</span><span style="color: #008b45">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span style="color: #008b45">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span style="color: #b452cd">0</span><span class="p">,</span> <span style="color: #b452cd">0</span><span class="p">,</span> <span style="color: #b452cd">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span class="o">:=</span> <span style="color: #008b45">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="o">-</span> <span style="color: #b452cd">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #8b008b; font-weight: bold">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span style="color: #b452cd">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #8b008b; font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span style="color: #658b00">uint8</span><span class="p">(</span><span style="color: #b452cd">255</span> <span class="o">-</span> <span class="nx">t</span><span class="o">*</span><span style="color: #b452cd">255</span><span class="o">/</span><span style="color: #b452cd">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span class="o">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #8b008b; font-weight: bold">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span style="color: #b452cd">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #8b008b; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #8b008b; font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8b008b; font-weight: bold">func</span> <span style="color: #008b45">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #008b45">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #008b45">Rect</span><span class="p">(</span><span style="color: #b452cd">0</span><span class="p">,</span> <span style="color: #b452cd">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #8b008b; font-weight: bold">for</span> <span class="nx">y</span> <span class="o">:=</span> <span style="color: #b452cd">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span style="color: #008b45">Add</span><span class="p">(</span><span style="color: #b452cd">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #8b008b; font-weight: bold">go</span> <span style="color: #8b008b; font-weight: bold">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #00688b; font-weight: bold">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #8b008b; font-weight: bold">defer</span> <span class="nx">wg</span><span class="p">.</span><span style="color: #008b45">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #8b008b; font-weight: bold">for</span> <span class="nx">x</span> <span class="o">:=</span> <span style="color: #b452cd">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span style="color: #008b45">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span style="color: #008b45">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span style="color: #008b45">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #008b45">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #008b45">Rect</span><span class="p">(</span><span style="color: #b452cd">0</span><span class="p">,</span> <span style="color: #b452cd">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #8b008b; font-weight: bold">for</span> <span class="nx">y</span> <span class="o">:=</span> <span style="color: #b452cd">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #8b008b; font-weight: bold">for</span> <span class="nx">x</span> <span class="o">:=</span> <span style="color: #b452cd">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span class="o">:=</span> <span style="color: #b452cd">0</span><span class="p">,</span> <span style="color: #b452cd">0</span><span class="p">,</span> <span style="color: #b452cd">0</span><span class="p">,</span> <span style="color: #b452cd">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #8b008b; font-weight: bold">for</span> <span class="nx">dy</span> <span class="o">:=</span> <span style="color: #b452cd">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #8b008b; font-weight: bold">for</span> <span class="nx">dx</span> <span class="o">:=</span> <span style="color: #b452cd">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span class="o">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span style="color: #008b45">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span class="o">*</span><span class="nx">supersamplingRatio</span><span class="o">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span class="o">*</span><span class="nx">supersamplingRatio</span><span class="o">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span class="o">+=</span> <span style="color: #658b00">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span class="o">+=</span> <span style="color: #658b00">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span class="o">+=</span> <span style="color: #658b00">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span class="o">+=</span> <span style="color: #658b00">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span style="color: #008b45">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span style="color: #658b00">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span style="color: #658b00">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span style="color: #658b00">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span style="color: #658b00">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span style="color: #008b45">Create</span><span class="p">(</span><span style="color: #cd5555">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #8b008b; font-weight: bold">if</span> <span class="nx">err</span> <span class="o">!=</span> <span style="color: #8b008b; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #008b45">Println</span><span class="p">(</span><span style="color: #cd5555">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #8b008b; font-weight: bold">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #8b008b; font-weight: bold">defer</span> <span class="nx">file</span><span class="p">.</span><span style="color: #008b45">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span style="color: #008b45">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #8b008b; font-weight: bold">if</span> <span class="nx">err</span> <span class="o">!=</span> <span style="color: #8b008b; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #008b45">Println</span><span class="p">(</span><span style="color: #cd5555">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='pygments'><h2><a id='stylelink' href='pygments.html' alt='View only pygments'>pygments</a></h2></a><code><pre style=";" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #008000; font-weight: bold">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #408080; font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #408080; font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #408080; font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #408080; font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008000; font-weight: bold">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ba2121">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ba2121">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ba2121">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ba2121">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ba2121">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ba2121">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ba2121">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008000; font-weight: bold">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span style="color: #666666">1920</span><span class="p">,</span> <span style="color: #666666">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span style="color: #666666">3840</span><span class="p">,</span> <span style="color: #666666">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span style="color: #008000">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span style="color: #666666">/</span> <span style="color: #008000">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span style="color: #666666">/</span> <span style="color: #666666">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span style="color: #666666">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span style="color: #666666">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span style="color: #666666">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span style="color: #666666">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008000; font-weight: bold">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008000; font-weight: bold">type</span> <span class="nx">vec3</span> <span style="color: #008000; font-weight: bold">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #b00040">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008000; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #0000ff">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #008000; font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #666666">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #666666">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #666666">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008000; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #0000ff">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #b00040">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #008000; font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #666666">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #666666">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #666666">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008000; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #0000ff">length</span><span class="p">()</span> <span style="color: #b00040">float64</span>    <span class="p">{</span> <span style="color: #008000; font-weight: bold">return</span> <span class="nx">math</span><span class="p">.</span><span style="color: #0000ff">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span style="color: #666666">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #666666">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span style="color: #666666">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #666666">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span style="color: #666666">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008000; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #0000ff">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #008000; font-weight: bold">return</span> <span class="nx">v</span><span class="p">.</span><span style="color: #0000ff">mul</span><span class="p">(</span><span style="color: #666666">1</span> <span style="color: #666666">/</span> <span class="nx">v</span><span class="p">.</span><span style="color: #0000ff">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008000; font-weight: bold">func</span> <span style="color: #0000ff">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #b00040">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span style="color: #666666">:=</span> <span class="nx">p</span><span class="p">,</span> <span style="color: #666666">0.0</span><span class="p">,</span> <span style="color: #666666">0.0</span><span class="p">,</span> <span style="color: #666666">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008000; font-weight: bold">for</span> <span class="nx">i</span> <span style="color: #666666">:=</span> <span style="color: #666666">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #666666">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span style="color: #0000ff">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #008000; font-weight: bold">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #008000; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #0000ff">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span style="color: #666666">/</span><span class="nx">r</span><span class="p">)</span><span style="color: #666666">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span style="color: #0000ff">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span style="color: #666666">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #0000ff">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span style="color: #666666">+</span><span class="nx">r</span><span style="color: #666666">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #0000ff">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #666666">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #0000ff">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span style="color: #666666">+</span><span class="nx">r</span><span style="color: #666666">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #0000ff">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #666666">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #0000ff">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span style="color: #666666">+</span><span class="nx">r</span><span style="color: #666666">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #0000ff">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008000; font-weight: bold">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008000; font-weight: bold">func</span> <span style="color: #0000ff">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #b00040">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span style="color: #666666">:=</span> <span class="p">(</span><span style="color: #666666">2</span><span style="color: #666666">*</span><span style="color: #008000">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span style="color: #666666">/</span><span style="color: #008000">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span style="color: #666666">-</span><span style="color: #666666">1</span><span class="p">)</span><span style="color: #666666">*</span><span class="nx">aspectRatio</span><span style="color: #666666">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #0000ff">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #666666">/</span><span style="color: #666666">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #666666">1</span><span style="color: #666666">-</span><span style="color: #666666">2</span><span style="color: #666666">*</span><span style="color: #008000">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span style="color: #666666">/</span><span style="color: #008000">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span style="color: #666666">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #0000ff">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #666666">/</span><span style="color: #666666">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span style="color: #666666">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span style="color: #666666">-</span><span style="color: #666666">1</span><span class="p">}.</span><span style="color: #0000ff">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span style="color: #666666">:=</span> <span style="color: #666666">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008000; font-weight: bold">for</span> <span class="nx">i</span> <span style="color: #666666">:=</span> <span style="color: #666666">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #666666">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span style="color: #666666">:=</span> <span class="nx">direction</span><span class="p">.</span><span style="color: #0000ff">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span style="color: #0000ff">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span style="color: #666666">0</span><span class="p">,</span> <span style="color: #666666">0</span><span class="p">,</span> <span style="color: #666666">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span style="color: #666666">:=</span> <span style="color: #0000ff">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span style="color: #666666">-</span> <span style="color: #666666">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #008000; font-weight: bold">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span style="color: #666666">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #008000; font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span style="color: #008000">uint8</span><span class="p">(</span><span style="color: #666666">255</span> <span style="color: #666666">-</span> <span class="nx">t</span><span style="color: #666666">*</span><span style="color: #666666">255</span><span style="color: #666666">/</span><span style="color: #666666">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span style="color: #666666">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #008000; font-weight: bold">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span style="color: #666666">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #008000; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008000; font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008000; font-weight: bold">func</span> <span style="color: #0000ff">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span style="color: #666666">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #0000ff">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #0000ff">Rect</span><span class="p">(</span><span style="color: #666666">0</span><span class="p">,</span> <span style="color: #666666">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008000; font-weight: bold">for</span> <span class="nx">y</span> <span style="color: #666666">:=</span> <span style="color: #666666">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span style="color: #666666">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span style="color: #0000ff">Add</span><span class="p">(</span><span style="color: #666666">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #008000; font-weight: bold">go</span> <span style="color: #008000; font-weight: bold">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #b00040">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #008000; font-weight: bold">defer</span> <span class="nx">wg</span><span class="p">.</span><span style="color: #0000ff">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #008000; font-weight: bold">for</span> <span class="nx">x</span> <span style="color: #666666">:=</span> <span style="color: #666666">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span style="color: #666666">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span style="color: #0000ff">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span style="color: #0000ff">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span style="color: #0000ff">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span style="color: #666666">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #0000ff">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #0000ff">Rect</span><span class="p">(</span><span style="color: #666666">0</span><span class="p">,</span> <span style="color: #666666">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008000; font-weight: bold">for</span> <span class="nx">y</span> <span style="color: #666666">:=</span> <span style="color: #666666">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span style="color: #666666">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #008000; font-weight: bold">for</span> <span class="nx">x</span> <span style="color: #666666">:=</span> <span style="color: #666666">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span style="color: #666666">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span style="color: #666666">:=</span> <span style="color: #666666">0</span><span class="p">,</span> <span style="color: #666666">0</span><span class="p">,</span> <span style="color: #666666">0</span><span class="p">,</span> <span style="color: #666666">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #008000; font-weight: bold">for</span> <span class="nx">dy</span> <span style="color: #666666">:=</span> <span style="color: #666666">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span style="color: #666666">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #008000; font-weight: bold">for</span> <span class="nx">dx</span> <span style="color: #666666">:=</span> <span style="color: #666666">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span style="color: #666666">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span style="color: #666666">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span style="color: #0000ff">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span style="color: #666666">*</span><span class="nx">supersamplingRatio</span><span style="color: #666666">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span style="color: #666666">*</span><span class="nx">supersamplingRatio</span><span style="color: #666666">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span style="color: #666666">+=</span> <span style="color: #008000">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span style="color: #666666">+=</span> <span style="color: #008000">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span style="color: #666666">+=</span> <span style="color: #008000">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span style="color: #666666">+=</span> <span style="color: #008000">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span style="color: #666666">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #666666">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span style="color: #666666">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #666666">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span style="color: #666666">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #666666">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span style="color: #666666">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #666666">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span style="color: #0000ff">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span style="color: #008000">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span style="color: #008000">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span style="color: #008000">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span style="color: #008000">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span style="color: #666666">:=</span> <span class="nx">os</span><span class="p">.</span><span style="color: #0000ff">Create</span><span class="p">(</span><span style="color: #ba2121">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008000; font-weight: bold">if</span> <span class="nx">err</span> <span style="color: #666666">!=</span> <span style="color: #008000; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #0000ff">Println</span><span class="p">(</span><span style="color: #ba2121">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #008000; font-weight: bold">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008000; font-weight: bold">defer</span> <span class="nx">file</span><span class="p">.</span><span style="color: #0000ff">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span style="color: #0000ff">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #008000; font-weight: bold">if</span> <span class="nx">err</span> <span style="color: #666666">!=</span> <span style="color: #008000; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #0000ff">Println</span><span class="p">(</span><span style="color: #ba2121">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='rainbow_dash'><h2><a id='stylelink' href='rainbow_dash.html' alt='View only rainbow_dash'>rainbow_dash</a></h2></a><code><pre style="color: #4d4d4d; background-color: #ffffff;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #2c5dcd; font-weight: bold">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0080ff; font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #0080ff; font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #0080ff; font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #0080ff; font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #2c5dcd; font-weight: bold">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #00cc66">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #00cc66">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #00cc66">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #00cc66">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #00cc66">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #00cc66">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #00cc66">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #2c5dcd; font-weight: bold">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span style="color: #5918bb; font-weight: bold">1920</span><span class="p">,</span> <span style="color: #5918bb; font-weight: bold">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span style="color: #5918bb; font-weight: bold">3840</span><span class="p">,</span> <span style="color: #5918bb; font-weight: bold">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span style="color: #5918bb; font-weight: bold">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span style="color: #2c5dcd">/</span> <span style="color: #5918bb; font-weight: bold">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span style="color: #2c5dcd">/</span> <span style="color: #5918bb; font-weight: bold">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span style="color: #5918bb; font-weight: bold">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span style="color: #5918bb; font-weight: bold">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span style="color: #5918bb; font-weight: bold">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span style="color: #5918bb; font-weight: bold">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #2c5dcd; font-weight: bold">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #2c5dcd; font-weight: bold">type</span> <span class="nx">vec3</span> <span style="color: #2c5dcd; font-weight: bold">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #5918bb; font-weight: bold">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #2c5dcd; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #ff8000; font-weight: bold">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #2c5dcd; font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #2c5dcd">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #2c5dcd">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #2c5dcd">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #2c5dcd; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #ff8000; font-weight: bold">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #5918bb; font-weight: bold">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #2c5dcd; font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #2c5dcd">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #2c5dcd">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #2c5dcd">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #2c5dcd; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #ff8000; font-weight: bold">length</span><span class="p">()</span> <span style="color: #5918bb; font-weight: bold">float64</span>    <span class="p">{</span> <span style="color: #2c5dcd; font-weight: bold">return</span> <span class="nx">math</span><span class="p">.</span><span style="color: #ff8000; font-weight: bold">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span style="color: #2c5dcd">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #2c5dcd">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span style="color: #2c5dcd">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #2c5dcd">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span style="color: #2c5dcd">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #2c5dcd; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #ff8000; font-weight: bold">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #2c5dcd; font-weight: bold">return</span> <span class="nx">v</span><span class="p">.</span><span style="color: #ff8000; font-weight: bold">mul</span><span class="p">(</span><span style="color: #5918bb; font-weight: bold">1</span> <span style="color: #2c5dcd">/</span> <span class="nx">v</span><span class="p">.</span><span style="color: #ff8000; font-weight: bold">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #2c5dcd; font-weight: bold">func</span> <span style="color: #ff8000; font-weight: bold">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #5918bb; font-weight: bold">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span style="color: #2c5dcd">:=</span> <span class="nx">p</span><span class="p">,</span> <span style="color: #5918bb; font-weight: bold">0.0</span><span class="p">,</span> <span style="color: #5918bb; font-weight: bold">0.0</span><span class="p">,</span> <span style="color: #5918bb; font-weight: bold">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2c5dcd; font-weight: bold">for</span> <span class="nx">i</span> <span style="color: #2c5dcd">:=</span> <span style="color: #5918bb; font-weight: bold">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #2c5dcd">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span style="color: #ff8000; font-weight: bold">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #2c5dcd; font-weight: bold">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #2c5dcd; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #ff8000; font-weight: bold">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span style="color: #2c5dcd">/</span><span class="nx">r</span><span class="p">)</span><span style="color: #2c5dcd">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span style="color: #ff8000; font-weight: bold">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span style="color: #2c5dcd">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #ff8000; font-weight: bold">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span style="color: #2c5dcd">+</span><span class="nx">r</span><span style="color: #2c5dcd">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #ff8000; font-weight: bold">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #2c5dcd">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #ff8000; font-weight: bold">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span style="color: #2c5dcd">+</span><span class="nx">r</span><span style="color: #2c5dcd">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #ff8000; font-weight: bold">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #2c5dcd">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #ff8000; font-weight: bold">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span style="color: #2c5dcd">+</span><span class="nx">r</span><span style="color: #2c5dcd">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #ff8000; font-weight: bold">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2c5dcd; font-weight: bold">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #2c5dcd; font-weight: bold">func</span> <span style="color: #ff8000; font-weight: bold">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #5918bb; font-weight: bold">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span style="color: #2c5dcd">:=</span> <span class="p">(</span><span style="color: #5918bb; font-weight: bold">2</span><span style="color: #2c5dcd">*</span><span style="color: #5918bb; font-weight: bold">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span style="color: #2c5dcd">/</span><span style="color: #5918bb; font-weight: bold">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span style="color: #2c5dcd">-</span><span style="color: #5918bb; font-weight: bold">1</span><span class="p">)</span><span style="color: #2c5dcd">*</span><span class="nx">aspectRatio</span><span style="color: #2c5dcd">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #ff8000; font-weight: bold">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #2c5dcd">/</span><span style="color: #5918bb; font-weight: bold">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #5918bb; font-weight: bold">1</span><span style="color: #2c5dcd">-</span><span style="color: #5918bb; font-weight: bold">2</span><span style="color: #2c5dcd">*</span><span style="color: #5918bb; font-weight: bold">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span style="color: #2c5dcd">/</span><span style="color: #5918bb; font-weight: bold">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span style="color: #2c5dcd">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #ff8000; font-weight: bold">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #2c5dcd">/</span><span style="color: #5918bb; font-weight: bold">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span style="color: #2c5dcd">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span style="color: #2c5dcd">-</span><span style="color: #5918bb; font-weight: bold">1</span><span class="p">}.</span><span style="color: #ff8000; font-weight: bold">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span style="color: #2c5dcd">:=</span> <span style="color: #5918bb; font-weight: bold">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2c5dcd; font-weight: bold">for</span> <span class="nx">i</span> <span style="color: #2c5dcd">:=</span> <span style="color: #5918bb; font-weight: bold">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #2c5dcd">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span style="color: #2c5dcd">:=</span> <span class="nx">direction</span><span class="p">.</span><span style="color: #ff8000; font-weight: bold">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span style="color: #ff8000; font-weight: bold">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span style="color: #5918bb; font-weight: bold">0</span><span class="p">,</span> <span style="color: #5918bb; font-weight: bold">0</span><span class="p">,</span> <span style="color: #5918bb; font-weight: bold">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span style="color: #2c5dcd">:=</span> <span style="color: #ff8000; font-weight: bold">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span style="color: #2c5dcd">-</span> <span style="color: #5918bb; font-weight: bold">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #2c5dcd; font-weight: bold">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span style="color: #5918bb; font-weight: bold">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #2c5dcd; font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span style="color: #5918bb; font-weight: bold">uint8</span><span class="p">(</span><span style="color: #5918bb; font-weight: bold">255</span> <span style="color: #2c5dcd">-</span> <span class="nx">t</span><span style="color: #2c5dcd">*</span><span style="color: #5918bb; font-weight: bold">255</span><span style="color: #2c5dcd">/</span><span style="color: #5918bb; font-weight: bold">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span style="color: #2c5dcd">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #2c5dcd; font-weight: bold">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span style="color: #5918bb; font-weight: bold">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #2c5dcd; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2c5dcd; font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #2c5dcd; font-weight: bold">func</span> <span style="color: #ff8000; font-weight: bold">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span style="color: #2c5dcd">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #ff8000; font-weight: bold">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #ff8000; font-weight: bold">Rect</span><span class="p">(</span><span style="color: #5918bb; font-weight: bold">0</span><span class="p">,</span> <span style="color: #5918bb; font-weight: bold">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2c5dcd; font-weight: bold">for</span> <span class="nx">y</span> <span style="color: #2c5dcd">:=</span> <span style="color: #5918bb; font-weight: bold">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span style="color: #2c5dcd">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span style="color: #ff8000; font-weight: bold">Add</span><span class="p">(</span><span style="color: #5918bb; font-weight: bold">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #2c5dcd; font-weight: bold">go</span> <span style="color: #2c5dcd; font-weight: bold">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #5918bb; font-weight: bold">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #2c5dcd; font-weight: bold">defer</span> <span class="nx">wg</span><span class="p">.</span><span style="color: #ff8000; font-weight: bold">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #2c5dcd; font-weight: bold">for</span> <span class="nx">x</span> <span style="color: #2c5dcd">:=</span> <span style="color: #5918bb; font-weight: bold">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span style="color: #2c5dcd">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span style="color: #ff8000; font-weight: bold">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span style="color: #ff8000; font-weight: bold">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span style="color: #ff8000; font-weight: bold">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span style="color: #2c5dcd">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #ff8000; font-weight: bold">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #ff8000; font-weight: bold">Rect</span><span class="p">(</span><span style="color: #5918bb; font-weight: bold">0</span><span class="p">,</span> <span style="color: #5918bb; font-weight: bold">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2c5dcd; font-weight: bold">for</span> <span class="nx">y</span> <span style="color: #2c5dcd">:=</span> <span style="color: #5918bb; font-weight: bold">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span style="color: #2c5dcd">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #2c5dcd; font-weight: bold">for</span> <span class="nx">x</span> <span style="color: #2c5dcd">:=</span> <span style="color: #5918bb; font-weight: bold">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span style="color: #2c5dcd">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span style="color: #2c5dcd">:=</span> <span style="color: #5918bb; font-weight: bold">0</span><span class="p">,</span> <span style="color: #5918bb; font-weight: bold">0</span><span class="p">,</span> <span style="color: #5918bb; font-weight: bold">0</span><span class="p">,</span> <span style="color: #5918bb; font-weight: bold">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #2c5dcd; font-weight: bold">for</span> <span class="nx">dy</span> <span style="color: #2c5dcd">:=</span> <span style="color: #5918bb; font-weight: bold">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span style="color: #2c5dcd">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #2c5dcd; font-weight: bold">for</span> <span class="nx">dx</span> <span style="color: #2c5dcd">:=</span> <span style="color: #5918bb; font-weight: bold">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span style="color: #2c5dcd">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span style="color: #2c5dcd">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span style="color: #ff8000; font-weight: bold">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span style="color: #2c5dcd">*</span><span class="nx">supersamplingRatio</span><span style="color: #2c5dcd">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span style="color: #2c5dcd">*</span><span class="nx">supersamplingRatio</span><span style="color: #2c5dcd">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span style="color: #2c5dcd">+=</span> <span style="color: #5918bb; font-weight: bold">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span style="color: #2c5dcd">+=</span> <span style="color: #5918bb; font-weight: bold">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span style="color: #2c5dcd">+=</span> <span style="color: #5918bb; font-weight: bold">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span style="color: #2c5dcd">+=</span> <span style="color: #5918bb; font-weight: bold">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span style="color: #2c5dcd">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #2c5dcd">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span style="color: #2c5dcd">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #2c5dcd">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span style="color: #2c5dcd">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #2c5dcd">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span style="color: #2c5dcd">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #2c5dcd">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span style="color: #ff8000; font-weight: bold">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span style="color: #5918bb; font-weight: bold">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span style="color: #5918bb; font-weight: bold">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span style="color: #5918bb; font-weight: bold">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span style="color: #5918bb; font-weight: bold">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span style="color: #2c5dcd">:=</span> <span class="nx">os</span><span class="p">.</span><span style="color: #ff8000; font-weight: bold">Create</span><span class="p">(</span><span style="color: #00cc66">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2c5dcd; font-weight: bold">if</span> <span class="nx">err</span> <span style="color: #2c5dcd">!=</span> <span style="color: #2c5dcd; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #ff8000; font-weight: bold">Println</span><span class="p">(</span><span style="color: #00cc66">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #2c5dcd; font-weight: bold">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2c5dcd; font-weight: bold">defer</span> <span class="nx">file</span><span class="p">.</span><span style="color: #ff8000; font-weight: bold">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span style="color: #ff8000; font-weight: bold">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2c5dcd; font-weight: bold">if</span> <span class="nx">err</span> <span style="color: #2c5dcd">!=</span> <span style="color: #2c5dcd; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #ff8000; font-weight: bold">Println</span><span class="p">(</span><span style="color: #00cc66">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='rose-pine-dawn'><h2><a id='stylelink' href='rose-pine-dawn.html' alt='View only rose-pine-dawn'>rose-pine-dawn</a></h2></a><code><pre style="color: #575279; background-color: #faf4ed;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #907aa9">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #9893a5">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #9893a5"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #9893a5"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #9893a5"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #907aa9">import</span> <span style="color: #797593">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ea9d34">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ea9d34">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ea9d34">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ea9d34">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ea9d34">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ea9d34">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ea9d34">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #797593">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #286983">const</span> <span style="color: #797593">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span style="color: #797593">,</span> <span class="nx">height</span>      <span style="color: #797593">=</span> <span style="color: #ea9d34">1920</span><span style="color: #797593">,</span> <span style="color: #ea9d34">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span style="color: #797593">,</span> <span class="nx">ssHeight</span>  <span style="color: #797593">=</span> <span style="color: #ea9d34">3840</span><span style="color: #797593">,</span> <span style="color: #ea9d34">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span style="color: #797593">=</span> <span style="color: #d7827e">float64</span><span style="color: #797593">(</span><span class="nx">ssWidth</span><span style="color: #797593">)</span> <span style="color: #797593">/</span> <span style="color: #d7827e">float64</span><span style="color: #797593">(</span><span class="nx">ssHeight</span><span style="color: #797593">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span style="color: #797593">=</span> <span class="nx">math</span><span style="color: #797593">.</span><span class="nx">Pi</span> <span style="color: #797593">/</span> <span style="color: #ea9d34">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span style="color: #797593">=</span> <span style="color: #ea9d34">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span style="color: #797593">=</span> <span style="color: #ea9d34">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span style="color: #797593">=</span> <span style="color: #ea9d34">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span style="color: #797593">=</span> <span style="color: #ea9d34">2</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #797593">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #286983">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span style="color: #797593">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #286983">type</span> <span class="nx">vec3</span> <span style="color: #286983">struct</span><span style="color: #797593">{</span> <span class="nx">x</span><span style="color: #797593">,</span> <span class="nx">y</span><span style="color: #797593">,</span> <span class="nx">z</span> <span style="color: #286983">float64</span> <span style="color: #797593">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #286983">func</span> <span style="color: #797593">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #797593">)</span> <span style="color: #d7827e">add</span><span style="color: #797593">(</span><span class="nx">w</span> <span class="nx">vec3</span><span style="color: #797593">)</span> <span class="nx">vec3</span>    <span style="color: #797593">{</span> <span style="color: #286983">return</span> <span class="nx">vec3</span><span style="color: #797593">{</span><span class="nx">v</span><span style="color: #797593">.</span><span class="nx">x</span> <span style="color: #797593">+</span> <span class="nx">w</span><span style="color: #797593">.</span><span class="nx">x</span><span style="color: #797593">,</span> <span class="nx">v</span><span style="color: #797593">.</span><span class="nx">y</span> <span style="color: #797593">+</span> <span class="nx">w</span><span style="color: #797593">.</span><span class="nx">y</span><span style="color: #797593">,</span> <span class="nx">v</span><span style="color: #797593">.</span><span class="nx">z</span> <span style="color: #797593">+</span> <span class="nx">w</span><span style="color: #797593">.</span><span class="nx">z</span><span style="color: #797593">}</span> <span style="color: #797593">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #286983">func</span> <span style="color: #797593">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #797593">)</span> <span style="color: #d7827e">mul</span><span style="color: #797593">(</span><span class="nx">s</span> <span style="color: #286983">float64</span><span style="color: #797593">)</span> <span class="nx">vec3</span> <span style="color: #797593">{</span> <span style="color: #286983">return</span> <span class="nx">vec3</span><span style="color: #797593">{</span><span class="nx">v</span><span style="color: #797593">.</span><span class="nx">x</span> <span style="color: #797593">*</span> <span class="nx">s</span><span style="color: #797593">,</span> <span class="nx">v</span><span style="color: #797593">.</span><span class="nx">y</span> <span style="color: #797593">*</span> <span class="nx">s</span><span style="color: #797593">,</span> <span class="nx">v</span><span style="color: #797593">.</span><span class="nx">z</span> <span style="color: #797593">*</span> <span class="nx">s</span><span style="color: #797593">}</span> <span style="color: #797593">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #286983">func</span> <span style="color: #797593">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #797593">)</span> <span style="color: #d7827e">length</span><span style="color: #797593">()</span> <span style="color: #286983">float64</span>    <span style="color: #797593">{</span> <span style="color: #286983">return</span> <span class="nx">math</span><span style="color: #797593">.</span><span style="color: #d7827e">Sqrt</span><span style="color: #797593">(</span><span class="nx">v</span><span style="color: #797593">.</span><span class="nx">x</span><span style="color: #797593">*</span><span class="nx">v</span><span style="color: #797593">.</span><span class="nx">x</span> <span style="color: #797593">+</span> <span class="nx">v</span><span style="color: #797593">.</span><span class="nx">y</span><span style="color: #797593">*</span><span class="nx">v</span><span style="color: #797593">.</span><span class="nx">y</span> <span style="color: #797593">+</span> <span class="nx">v</span><span style="color: #797593">.</span><span class="nx">z</span><span style="color: #797593">*</span><span class="nx">v</span><span style="color: #797593">.</span><span class="nx">z</span><span style="color: #797593">)</span> <span style="color: #797593">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #286983">func</span> <span style="color: #797593">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #797593">)</span> <span style="color: #d7827e">normalize</span><span style="color: #797593">()</span> <span class="nx">vec3</span>    <span style="color: #797593">{</span> <span style="color: #286983">return</span> <span class="nx">v</span><span style="color: #797593">.</span><span style="color: #d7827e">mul</span><span style="color: #797593">(</span><span style="color: #ea9d34">1</span> <span style="color: #797593">/</span> <span class="nx">v</span><span style="color: #797593">.</span><span style="color: #d7827e">length</span><span style="color: #797593">())</span> <span style="color: #797593">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #286983">func</span> <span style="color: #d7827e">mandelbulb</span><span style="color: #797593">(</span><span class="nx">p</span> <span class="nx">vec3</span><span style="color: #797593">)</span> <span style="color: #286983">float64</span> <span style="color: #797593">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span style="color: #797593">,</span> <span class="nx">r</span><span style="color: #797593">,</span> <span class="nx">theta</span><span style="color: #797593">,</span> <span class="nx">phi</span> <span style="color: #797593">:=</span> <span class="nx">p</span><span style="color: #797593">,</span> <span style="color: #ea9d34">0.0</span><span style="color: #797593">,</span> <span style="color: #ea9d34">0.0</span><span style="color: #797593">,</span> <span style="color: #ea9d34">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #286983">for</span> <span class="nx">i</span> <span style="color: #797593">:=</span> <span style="color: #ea9d34">0</span><span style="color: #797593">;</span> <span class="nx">i</span> <span style="color: #797593">&lt;</span> <span class="nx">maxIter</span><span style="color: #797593">;</span> <span class="nx">i</span><span style="color: #797593">++</span> <span style="color: #797593">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span style="color: #797593">=</span> <span class="nx">z</span><span style="color: #797593">.</span><span style="color: #d7827e">length</span><span style="color: #797593">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #286983">if</span> <span class="nx">r</span> <span style="color: #797593">&gt;</span> <span class="nx">escapeRadius</span> <span style="color: #797593">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #286983">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #797593">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span style="color: #797593">,</span> <span class="nx">phi</span> <span style="color: #797593">=</span> <span class="nx">math</span><span style="color: #797593">.</span><span style="color: #d7827e">Acos</span><span style="color: #797593">(</span><span class="nx">z</span><span style="color: #797593">.</span><span class="nx">z</span><span style="color: #797593">/</span><span class="nx">r</span><span style="color: #797593">)</span><span style="color: #797593">*</span><span class="nx">power</span><span style="color: #797593">,</span> <span class="nx">math</span><span style="color: #797593">.</span><span style="color: #d7827e">Atan2</span><span style="color: #797593">(</span><span class="nx">z</span><span style="color: #797593">.</span><span class="nx">y</span><span style="color: #797593">,</span> <span class="nx">z</span><span style="color: #797593">.</span><span class="nx">x</span><span style="color: #797593">)</span><span style="color: #797593">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span style="color: #797593">=</span> <span class="nx">math</span><span style="color: #797593">.</span><span style="color: #d7827e">Pow</span><span style="color: #797593">(</span><span class="nx">r</span><span style="color: #797593">,</span> <span class="nx">power</span><span style="color: #797593">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span style="color: #797593">.</span><span class="nx">x</span><span style="color: #797593">,</span> <span class="nx">z</span><span style="color: #797593">.</span><span class="nx">y</span><span style="color: #797593">,</span> <span class="nx">z</span><span style="color: #797593">.</span><span class="nx">z</span> <span style="color: #797593">=</span> <span class="nx">p</span><span style="color: #797593">.</span><span class="nx">x</span><span style="color: #797593">+</span><span class="nx">r</span><span style="color: #797593">*</span><span class="nx">math</span><span style="color: #797593">.</span><span style="color: #d7827e">Sin</span><span style="color: #797593">(</span><span class="nx">theta</span><span style="color: #797593">)</span><span style="color: #797593">*</span><span class="nx">math</span><span style="color: #797593">.</span><span style="color: #d7827e">Cos</span><span style="color: #797593">(</span><span class="nx">phi</span><span style="color: #797593">),</span> <span class="nx">p</span><span style="color: #797593">.</span><span class="nx">y</span><span style="color: #797593">+</span><span class="nx">r</span><span style="color: #797593">*</span><span class="nx">math</span><span style="color: #797593">.</span><span style="color: #d7827e">Sin</span><span style="color: #797593">(</span><span class="nx">theta</span><span style="color: #797593">)</span><span style="color: #797593">*</span><span class="nx">math</span><span style="color: #797593">.</span><span style="color: #d7827e">Sin</span><span style="color: #797593">(</span><span class="nx">phi</span><span style="color: #797593">),</span> <span class="nx">p</span><span style="color: #797593">.</span><span class="nx">z</span><span style="color: #797593">+</span><span class="nx">r</span><span style="color: #797593">*</span><span class="nx">math</span><span style="color: #797593">.</span><span style="color: #d7827e">Cos</span><span style="color: #797593">(</span><span class="nx">theta</span><span style="color: #797593">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #797593">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #286983">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #797593">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #286983">func</span> <span style="color: #d7827e">renderPixel</span><span style="color: #797593">(</span><span class="nx">x</span><span style="color: #797593">,</span> <span class="nx">y</span> <span style="color: #286983">int</span><span style="color: #797593">)</span> <span class="nx">color</span><span style="color: #797593">.</span><span class="nx">Color</span> <span style="color: #797593">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span style="color: #797593">,</span> <span class="nx">py</span> <span style="color: #797593">:=</span> <span style="color: #797593">(</span><span style="color: #ea9d34">2</span><span style="color: #797593">*</span><span style="color: #d7827e">float64</span><span style="color: #797593">(</span><span class="nx">x</span><span style="color: #797593">)</span><span style="color: #797593">/</span><span style="color: #d7827e">float64</span><span style="color: #797593">(</span><span class="nx">ssWidth</span><span style="color: #797593">)</span><span style="color: #797593">-</span><span style="color: #ea9d34">1</span><span style="color: #797593">)</span><span style="color: #797593">*</span><span class="nx">aspectRatio</span><span style="color: #797593">*</span><span class="nx">math</span><span style="color: #797593">.</span><span style="color: #d7827e">Tan</span><span style="color: #797593">(</span><span class="nx">fov</span><span style="color: #797593">/</span><span style="color: #ea9d34">2</span><span style="color: #797593">),</span> <span style="color: #797593">(</span><span style="color: #ea9d34">1</span><span style="color: #797593">-</span><span style="color: #ea9d34">2</span><span style="color: #797593">*</span><span style="color: #d7827e">float64</span><span style="color: #797593">(</span><span class="nx">y</span><span style="color: #797593">)</span><span style="color: #797593">/</span><span style="color: #d7827e">float64</span><span style="color: #797593">(</span><span class="nx">ssHeight</span><span style="color: #797593">))</span><span style="color: #797593">*</span><span class="nx">math</span><span style="color: #797593">.</span><span style="color: #d7827e">Tan</span><span style="color: #797593">(</span><span class="nx">fov</span><span style="color: #797593">/</span><span style="color: #ea9d34">2</span><span style="color: #797593">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span style="color: #797593">:=</span> <span class="nx">vec3</span><span style="color: #797593">{</span><span class="nx">px</span><span style="color: #797593">,</span> <span class="nx">py</span><span style="color: #797593">,</span> <span style="color: #797593">-</span><span style="color: #ea9d34">1</span><span style="color: #797593">}.</span><span style="color: #d7827e">normalize</span><span style="color: #797593">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span style="color: #797593">:=</span> <span style="color: #ea9d34">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #286983">for</span> <span class="nx">i</span> <span style="color: #797593">:=</span> <span style="color: #ea9d34">0</span><span style="color: #797593">;</span> <span class="nx">i</span> <span style="color: #797593">&lt;</span> <span class="nx">maxIter</span><span style="color: #797593">;</span> <span class="nx">i</span><span style="color: #797593">++</span> <span style="color: #797593">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span style="color: #797593">:=</span> <span class="nx">direction</span><span style="color: #797593">.</span><span style="color: #d7827e">mul</span><span style="color: #797593">(</span><span class="nx">t</span><span style="color: #797593">).</span><span style="color: #d7827e">add</span><span style="color: #797593">(</span><span class="nx">vec3</span><span style="color: #797593">{</span><span style="color: #ea9d34">0</span><span style="color: #797593">,</span> <span style="color: #ea9d34">0</span><span style="color: #797593">,</span> <span style="color: #ea9d34">5</span><span style="color: #797593">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span style="color: #797593">:=</span> <span style="color: #d7827e">mandelbulb</span><span style="color: #797593">(</span><span class="nx">p</span><span style="color: #797593">)</span> <span style="color: #797593">-</span> <span style="color: #ea9d34">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #286983">if</span> <span class="nx">d</span> <span style="color: #797593">&lt;</span> <span style="color: #ea9d34">0.001</span> <span style="color: #797593">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #286983">return</span> <span class="nx">color</span><span style="color: #797593">.</span><span class="nx">Gray</span><span style="color: #797593">{</span><span style="color: #d7827e">uint8</span><span style="color: #797593">(</span><span style="color: #ea9d34">255</span> <span style="color: #797593">-</span> <span class="nx">t</span><span style="color: #797593">*</span><span style="color: #ea9d34">255</span><span style="color: #797593">/</span><span style="color: #ea9d34">100</span><span style="color: #797593">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #797593">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span style="color: #797593">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #286983">if</span> <span class="nx">t</span> <span style="color: #797593">&gt;</span> <span style="color: #ea9d34">100</span> <span style="color: #797593">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #286983">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #797593">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #797593">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #286983">return</span> <span class="nx">color</span><span style="color: #797593">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #797593">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #286983">func</span> <span style="color: #d7827e">main</span><span style="color: #797593">()</span> <span style="color: #797593">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span style="color: #797593">:=</span> <span class="nx">image</span><span style="color: #797593">.</span><span style="color: #d7827e">NewRGBA</span><span style="color: #797593">(</span><span class="nx">image</span><span style="color: #797593">.</span><span style="color: #d7827e">Rect</span><span style="color: #797593">(</span><span style="color: #ea9d34">0</span><span style="color: #797593">,</span> <span style="color: #ea9d34">0</span><span style="color: #797593">,</span> <span class="nx">ssWidth</span><span style="color: #797593">,</span> <span class="nx">ssHeight</span><span style="color: #797593">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #286983">for</span> <span class="nx">y</span> <span style="color: #797593">:=</span> <span style="color: #ea9d34">0</span><span style="color: #797593">;</span> <span class="nx">y</span> <span style="color: #797593">&lt;</span> <span class="nx">ssHeight</span><span style="color: #797593">;</span> <span class="nx">y</span><span style="color: #797593">++</span> <span style="color: #797593">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span style="color: #797593">.</span><span style="color: #d7827e">Add</span><span style="color: #797593">(</span><span style="color: #ea9d34">1</span><span style="color: #797593">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #286983">go</span> <span style="color: #286983">func</span><span style="color: #797593">(</span><span class="nx">y</span> <span style="color: #286983">int</span><span style="color: #797593">)</span> <span style="color: #797593">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #286983">defer</span> <span class="nx">wg</span><span style="color: #797593">.</span><span style="color: #d7827e">Done</span><span style="color: #797593">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #286983">for</span> <span class="nx">x</span> <span style="color: #797593">:=</span> <span style="color: #ea9d34">0</span><span style="color: #797593">;</span> <span class="nx">x</span> <span style="color: #797593">&lt;</span> <span class="nx">ssWidth</span><span style="color: #797593">;</span> <span class="nx">x</span><span style="color: #797593">++</span> <span style="color: #797593">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span style="color: #797593">.</span><span style="color: #d7827e">Set</span><span style="color: #797593">(</span><span class="nx">x</span><span style="color: #797593">,</span> <span class="nx">y</span><span style="color: #797593">,</span> <span style="color: #d7827e">renderPixel</span><span style="color: #797593">(</span><span class="nx">x</span><span style="color: #797593">,</span> <span class="nx">y</span><span style="color: #797593">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #797593">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #797593">}(</span><span class="nx">y</span><span style="color: #797593">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #797593">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span style="color: #797593">.</span><span style="color: #d7827e">Wait</span><span style="color: #797593">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span style="color: #797593">:=</span> <span class="nx">image</span><span style="color: #797593">.</span><span style="color: #d7827e">NewRGBA</span><span style="color: #797593">(</span><span class="nx">image</span><span style="color: #797593">.</span><span style="color: #d7827e">Rect</span><span style="color: #797593">(</span><span style="color: #ea9d34">0</span><span style="color: #797593">,</span> <span style="color: #ea9d34">0</span><span style="color: #797593">,</span> <span class="nx">width</span><span style="color: #797593">,</span> <span class="nx">height</span><span style="color: #797593">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #286983">for</span> <span class="nx">y</span> <span style="color: #797593">:=</span> <span style="color: #ea9d34">0</span><span style="color: #797593">;</span> <span class="nx">y</span> <span style="color: #797593">&lt;</span> <span class="nx">height</span><span style="color: #797593">;</span> <span class="nx">y</span><span style="color: #797593">++</span> <span style="color: #797593">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #286983">for</span> <span class="nx">x</span> <span style="color: #797593">:=</span> <span style="color: #ea9d34">0</span><span style="color: #797593">;</span> <span class="nx">x</span> <span style="color: #797593">&lt;</span> <span class="nx">width</span><span style="color: #797593">;</span> <span class="nx">x</span><span style="color: #797593">++</span> <span style="color: #797593">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span style="color: #797593">,</span> <span class="nx">g</span><span style="color: #797593">,</span> <span class="nx">b</span><span style="color: #797593">,</span> <span class="nx">a</span> <span style="color: #797593">:=</span> <span style="color: #ea9d34">0</span><span style="color: #797593">,</span> <span style="color: #ea9d34">0</span><span style="color: #797593">,</span> <span style="color: #ea9d34">0</span><span style="color: #797593">,</span> <span style="color: #ea9d34">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #286983">for</span> <span class="nx">dy</span> <span style="color: #797593">:=</span> <span style="color: #ea9d34">0</span><span style="color: #797593">;</span> <span class="nx">dy</span> <span style="color: #797593">&lt;</span> <span class="nx">supersamplingRatio</span><span style="color: #797593">;</span> <span class="nx">dy</span><span style="color: #797593">++</span> <span style="color: #797593">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #286983">for</span> <span class="nx">dx</span> <span style="color: #797593">:=</span> <span style="color: #ea9d34">0</span><span style="color: #797593">;</span> <span class="nx">dx</span> <span style="color: #797593">&lt;</span> <span class="nx">supersamplingRatio</span><span style="color: #797593">;</span> <span class="nx">dx</span><span style="color: #797593">++</span> <span style="color: #797593">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span style="color: #797593">:=</span> <span class="nx">ssImg</span><span style="color: #797593">.</span><span style="color: #d7827e">RGBAAt</span><span style="color: #797593">(</span><span class="nx">x</span><span style="color: #797593">*</span><span class="nx">supersamplingRatio</span><span style="color: #797593">+</span><span class="nx">dx</span><span style="color: #797593">,</span> <span class="nx">y</span><span style="color: #797593">*</span><span class="nx">supersamplingRatio</span><span style="color: #797593">+</span><span class="nx">dy</span><span style="color: #797593">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span style="color: #797593">+=</span> <span style="color: #d7827e">int</span><span style="color: #797593">(</span><span class="nx">c</span><span style="color: #797593">.</span><span class="nx">R</span><span style="color: #797593">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span style="color: #797593">+=</span> <span style="color: #d7827e">int</span><span style="color: #797593">(</span><span class="nx">c</span><span style="color: #797593">.</span><span class="nx">G</span><span style="color: #797593">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span style="color: #797593">+=</span> <span style="color: #d7827e">int</span><span style="color: #797593">(</span><span class="nx">c</span><span style="color: #797593">.</span><span class="nx">B</span><span style="color: #797593">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span style="color: #797593">+=</span> <span style="color: #d7827e">int</span><span style="color: #797593">(</span><span class="nx">c</span><span style="color: #797593">.</span><span class="nx">A</span><span style="color: #797593">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #797593">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #797593">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span style="color: #797593">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #797593">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span style="color: #797593">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #797593">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span style="color: #797593">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #797593">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span style="color: #797593">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #797593">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span style="color: #797593">.</span><span style="color: #d7827e">Set</span><span style="color: #797593">(</span><span class="nx">x</span><span style="color: #797593">,</span> <span class="nx">y</span><span style="color: #797593">,</span> <span class="nx">color</span><span style="color: #797593">.</span><span class="nx">RGBA</span><span style="color: #797593">{</span><span style="color: #d7827e">uint8</span><span style="color: #797593">(</span><span class="nx">r</span><span style="color: #797593">),</span> <span style="color: #d7827e">uint8</span><span style="color: #797593">(</span><span class="nx">g</span><span style="color: #797593">),</span> <span style="color: #d7827e">uint8</span><span style="color: #797593">(</span><span class="nx">b</span><span style="color: #797593">),</span> <span style="color: #d7827e">uint8</span><span style="color: #797593">(</span><span class="nx">a</span><span style="color: #797593">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #797593">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #797593">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span style="color: #797593">,</span> <span class="nx">err</span> <span style="color: #797593">:=</span> <span class="nx">os</span><span style="color: #797593">.</span><span style="color: #d7827e">Create</span><span style="color: #797593">(</span><span style="color: #ea9d34">&#34;mandelbulb.png&#34;</span><span style="color: #797593">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #286983">if</span> <span class="nx">err</span> <span style="color: #797593">!=</span> <span style="color: #286983">nil</span> <span style="color: #797593">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span style="color: #797593">.</span><span style="color: #d7827e">Println</span><span style="color: #797593">(</span><span style="color: #ea9d34">&#34;Error creating file:&#34;</span><span style="color: #797593">,</span> <span class="nx">err</span><span style="color: #797593">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #286983">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #797593">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #286983">defer</span> <span class="nx">file</span><span style="color: #797593">.</span><span style="color: #d7827e">Close</span><span style="color: #797593">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span style="color: #797593">=</span> <span class="nx">png</span><span style="color: #797593">.</span><span style="color: #d7827e">Encode</span><span style="color: #797593">(</span><span class="nx">file</span><span style="color: #797593">,</span> <span class="nx">img</span><span style="color: #797593">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #286983">if</span> <span class="nx">err</span> <span style="color: #797593">!=</span> <span style="color: #286983">nil</span> <span style="color: #797593">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span style="color: #797593">.</span><span style="color: #d7827e">Println</span><span style="color: #797593">(</span><span style="color: #ea9d34">&#34;Error encoding image:&#34;</span><span style="color: #797593">,</span> <span class="nx">err</span><span style="color: #797593">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #797593">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #797593">}</span></span></span></code></pre></code><a name='rose-pine-moon'><h2><a id='stylelink' href='rose-pine-moon.html' alt='View only rose-pine-moon'>rose-pine-moon</a></h2></a><code><pre style="color: #e0def4; background-color: #232136;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #c4a7e7">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #6e6a86">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #6e6a86"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #6e6a86"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #6e6a86"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c4a7e7">import</span> <span style="color: #908caa">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #f6c177">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #f6c177">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #f6c177">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #f6c177">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #f6c177">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #f6c177">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #f6c177">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #3e8fb0">const</span> <span style="color: #908caa">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span style="color: #908caa">,</span> <span class="nx">height</span>      <span style="color: #908caa">=</span> <span style="color: #f6c177">1920</span><span style="color: #908caa">,</span> <span style="color: #f6c177">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span style="color: #908caa">,</span> <span class="nx">ssHeight</span>  <span style="color: #908caa">=</span> <span style="color: #f6c177">3840</span><span style="color: #908caa">,</span> <span style="color: #f6c177">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span style="color: #908caa">=</span> <span style="color: #ea9a97">float64</span><span style="color: #908caa">(</span><span class="nx">ssWidth</span><span style="color: #908caa">)</span> <span style="color: #908caa">/</span> <span style="color: #ea9a97">float64</span><span style="color: #908caa">(</span><span class="nx">ssHeight</span><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span style="color: #908caa">=</span> <span class="nx">math</span><span style="color: #908caa">.</span><span class="nx">Pi</span> <span style="color: #908caa">/</span> <span style="color: #f6c177">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span style="color: #908caa">=</span> <span style="color: #f6c177">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span style="color: #908caa">=</span> <span style="color: #f6c177">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span style="color: #908caa">=</span> <span style="color: #f6c177">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span style="color: #908caa">=</span> <span style="color: #f6c177">2</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #3e8fb0">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span style="color: #908caa">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #3e8fb0">type</span> <span class="nx">vec3</span> <span style="color: #3e8fb0">struct</span><span style="color: #908caa">{</span> <span class="nx">x</span><span style="color: #908caa">,</span> <span class="nx">y</span><span style="color: #908caa">,</span> <span class="nx">z</span> <span style="color: #3e8fb0">float64</span> <span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #3e8fb0">func</span> <span style="color: #908caa">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #908caa">)</span> <span style="color: #ea9a97">add</span><span style="color: #908caa">(</span><span class="nx">w</span> <span class="nx">vec3</span><span style="color: #908caa">)</span> <span class="nx">vec3</span>    <span style="color: #908caa">{</span> <span style="color: #3e8fb0">return</span> <span class="nx">vec3</span><span style="color: #908caa">{</span><span class="nx">v</span><span style="color: #908caa">.</span><span class="nx">x</span> <span style="color: #908caa">+</span> <span class="nx">w</span><span style="color: #908caa">.</span><span class="nx">x</span><span style="color: #908caa">,</span> <span class="nx">v</span><span style="color: #908caa">.</span><span class="nx">y</span> <span style="color: #908caa">+</span> <span class="nx">w</span><span style="color: #908caa">.</span><span class="nx">y</span><span style="color: #908caa">,</span> <span class="nx">v</span><span style="color: #908caa">.</span><span class="nx">z</span> <span style="color: #908caa">+</span> <span class="nx">w</span><span style="color: #908caa">.</span><span class="nx">z</span><span style="color: #908caa">}</span> <span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #3e8fb0">func</span> <span style="color: #908caa">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #908caa">)</span> <span style="color: #ea9a97">mul</span><span style="color: #908caa">(</span><span class="nx">s</span> <span style="color: #3e8fb0">float64</span><span style="color: #908caa">)</span> <span class="nx">vec3</span> <span style="color: #908caa">{</span> <span style="color: #3e8fb0">return</span> <span class="nx">vec3</span><span style="color: #908caa">{</span><span class="nx">v</span><span style="color: #908caa">.</span><span class="nx">x</span> <span style="color: #908caa">*</span> <span class="nx">s</span><span style="color: #908caa">,</span> <span class="nx">v</span><span style="color: #908caa">.</span><span class="nx">y</span> <span style="color: #908caa">*</span> <span class="nx">s</span><span style="color: #908caa">,</span> <span class="nx">v</span><span style="color: #908caa">.</span><span class="nx">z</span> <span style="color: #908caa">*</span> <span class="nx">s</span><span style="color: #908caa">}</span> <span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #3e8fb0">func</span> <span style="color: #908caa">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #908caa">)</span> <span style="color: #ea9a97">length</span><span style="color: #908caa">()</span> <span style="color: #3e8fb0">float64</span>    <span style="color: #908caa">{</span> <span style="color: #3e8fb0">return</span> <span class="nx">math</span><span style="color: #908caa">.</span><span style="color: #ea9a97">Sqrt</span><span style="color: #908caa">(</span><span class="nx">v</span><span style="color: #908caa">.</span><span class="nx">x</span><span style="color: #908caa">*</span><span class="nx">v</span><span style="color: #908caa">.</span><span class="nx">x</span> <span style="color: #908caa">+</span> <span class="nx">v</span><span style="color: #908caa">.</span><span class="nx">y</span><span style="color: #908caa">*</span><span class="nx">v</span><span style="color: #908caa">.</span><span class="nx">y</span> <span style="color: #908caa">+</span> <span class="nx">v</span><span style="color: #908caa">.</span><span class="nx">z</span><span style="color: #908caa">*</span><span class="nx">v</span><span style="color: #908caa">.</span><span class="nx">z</span><span style="color: #908caa">)</span> <span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #3e8fb0">func</span> <span style="color: #908caa">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #908caa">)</span> <span style="color: #ea9a97">normalize</span><span style="color: #908caa">()</span> <span class="nx">vec3</span>    <span style="color: #908caa">{</span> <span style="color: #3e8fb0">return</span> <span class="nx">v</span><span style="color: #908caa">.</span><span style="color: #ea9a97">mul</span><span style="color: #908caa">(</span><span style="color: #f6c177">1</span> <span style="color: #908caa">/</span> <span class="nx">v</span><span style="color: #908caa">.</span><span style="color: #ea9a97">length</span><span style="color: #908caa">())</span> <span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #3e8fb0">func</span> <span style="color: #ea9a97">mandelbulb</span><span style="color: #908caa">(</span><span class="nx">p</span> <span class="nx">vec3</span><span style="color: #908caa">)</span> <span style="color: #3e8fb0">float64</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span style="color: #908caa">,</span> <span class="nx">r</span><span style="color: #908caa">,</span> <span class="nx">theta</span><span style="color: #908caa">,</span> <span class="nx">phi</span> <span style="color: #908caa">:=</span> <span class="nx">p</span><span style="color: #908caa">,</span> <span style="color: #f6c177">0.0</span><span style="color: #908caa">,</span> <span style="color: #f6c177">0.0</span><span style="color: #908caa">,</span> <span style="color: #f6c177">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #3e8fb0">for</span> <span class="nx">i</span> <span style="color: #908caa">:=</span> <span style="color: #f6c177">0</span><span style="color: #908caa">;</span> <span class="nx">i</span> <span style="color: #908caa">&lt;</span> <span class="nx">maxIter</span><span style="color: #908caa">;</span> <span class="nx">i</span><span style="color: #908caa">++</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span style="color: #908caa">=</span> <span class="nx">z</span><span style="color: #908caa">.</span><span style="color: #ea9a97">length</span><span style="color: #908caa">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #3e8fb0">if</span> <span class="nx">r</span> <span style="color: #908caa">&gt;</span> <span class="nx">escapeRadius</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #3e8fb0">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span style="color: #908caa">,</span> <span class="nx">phi</span> <span style="color: #908caa">=</span> <span class="nx">math</span><span style="color: #908caa">.</span><span style="color: #ea9a97">Acos</span><span style="color: #908caa">(</span><span class="nx">z</span><span style="color: #908caa">.</span><span class="nx">z</span><span style="color: #908caa">/</span><span class="nx">r</span><span style="color: #908caa">)</span><span style="color: #908caa">*</span><span class="nx">power</span><span style="color: #908caa">,</span> <span class="nx">math</span><span style="color: #908caa">.</span><span style="color: #ea9a97">Atan2</span><span style="color: #908caa">(</span><span class="nx">z</span><span style="color: #908caa">.</span><span class="nx">y</span><span style="color: #908caa">,</span> <span class="nx">z</span><span style="color: #908caa">.</span><span class="nx">x</span><span style="color: #908caa">)</span><span style="color: #908caa">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span style="color: #908caa">=</span> <span class="nx">math</span><span style="color: #908caa">.</span><span style="color: #ea9a97">Pow</span><span style="color: #908caa">(</span><span class="nx">r</span><span style="color: #908caa">,</span> <span class="nx">power</span><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span style="color: #908caa">.</span><span class="nx">x</span><span style="color: #908caa">,</span> <span class="nx">z</span><span style="color: #908caa">.</span><span class="nx">y</span><span style="color: #908caa">,</span> <span class="nx">z</span><span style="color: #908caa">.</span><span class="nx">z</span> <span style="color: #908caa">=</span> <span class="nx">p</span><span style="color: #908caa">.</span><span class="nx">x</span><span style="color: #908caa">+</span><span class="nx">r</span><span style="color: #908caa">*</span><span class="nx">math</span><span style="color: #908caa">.</span><span style="color: #ea9a97">Sin</span><span style="color: #908caa">(</span><span class="nx">theta</span><span style="color: #908caa">)</span><span style="color: #908caa">*</span><span class="nx">math</span><span style="color: #908caa">.</span><span style="color: #ea9a97">Cos</span><span style="color: #908caa">(</span><span class="nx">phi</span><span style="color: #908caa">),</span> <span class="nx">p</span><span style="color: #908caa">.</span><span class="nx">y</span><span style="color: #908caa">+</span><span class="nx">r</span><span style="color: #908caa">*</span><span class="nx">math</span><span style="color: #908caa">.</span><span style="color: #ea9a97">Sin</span><span style="color: #908caa">(</span><span class="nx">theta</span><span style="color: #908caa">)</span><span style="color: #908caa">*</span><span class="nx">math</span><span style="color: #908caa">.</span><span style="color: #ea9a97">Sin</span><span style="color: #908caa">(</span><span class="nx">phi</span><span style="color: #908caa">),</span> <span class="nx">p</span><span style="color: #908caa">.</span><span class="nx">z</span><span style="color: #908caa">+</span><span class="nx">r</span><span style="color: #908caa">*</span><span class="nx">math</span><span style="color: #908caa">.</span><span style="color: #ea9a97">Cos</span><span style="color: #908caa">(</span><span class="nx">theta</span><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #3e8fb0">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #3e8fb0">func</span> <span style="color: #ea9a97">renderPixel</span><span style="color: #908caa">(</span><span class="nx">x</span><span style="color: #908caa">,</span> <span class="nx">y</span> <span style="color: #3e8fb0">int</span><span style="color: #908caa">)</span> <span class="nx">color</span><span style="color: #908caa">.</span><span class="nx">Color</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span style="color: #908caa">,</span> <span class="nx">py</span> <span style="color: #908caa">:=</span> <span style="color: #908caa">(</span><span style="color: #f6c177">2</span><span style="color: #908caa">*</span><span style="color: #ea9a97">float64</span><span style="color: #908caa">(</span><span class="nx">x</span><span style="color: #908caa">)</span><span style="color: #908caa">/</span><span style="color: #ea9a97">float64</span><span style="color: #908caa">(</span><span class="nx">ssWidth</span><span style="color: #908caa">)</span><span style="color: #908caa">-</span><span style="color: #f6c177">1</span><span style="color: #908caa">)</span><span style="color: #908caa">*</span><span class="nx">aspectRatio</span><span style="color: #908caa">*</span><span class="nx">math</span><span style="color: #908caa">.</span><span style="color: #ea9a97">Tan</span><span style="color: #908caa">(</span><span class="nx">fov</span><span style="color: #908caa">/</span><span style="color: #f6c177">2</span><span style="color: #908caa">),</span> <span style="color: #908caa">(</span><span style="color: #f6c177">1</span><span style="color: #908caa">-</span><span style="color: #f6c177">2</span><span style="color: #908caa">*</span><span style="color: #ea9a97">float64</span><span style="color: #908caa">(</span><span class="nx">y</span><span style="color: #908caa">)</span><span style="color: #908caa">/</span><span style="color: #ea9a97">float64</span><span style="color: #908caa">(</span><span class="nx">ssHeight</span><span style="color: #908caa">))</span><span style="color: #908caa">*</span><span class="nx">math</span><span style="color: #908caa">.</span><span style="color: #ea9a97">Tan</span><span style="color: #908caa">(</span><span class="nx">fov</span><span style="color: #908caa">/</span><span style="color: #f6c177">2</span><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span style="color: #908caa">:=</span> <span class="nx">vec3</span><span style="color: #908caa">{</span><span class="nx">px</span><span style="color: #908caa">,</span> <span class="nx">py</span><span style="color: #908caa">,</span> <span style="color: #908caa">-</span><span style="color: #f6c177">1</span><span style="color: #908caa">}.</span><span style="color: #ea9a97">normalize</span><span style="color: #908caa">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span style="color: #908caa">:=</span> <span style="color: #f6c177">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #3e8fb0">for</span> <span class="nx">i</span> <span style="color: #908caa">:=</span> <span style="color: #f6c177">0</span><span style="color: #908caa">;</span> <span class="nx">i</span> <span style="color: #908caa">&lt;</span> <span class="nx">maxIter</span><span style="color: #908caa">;</span> <span class="nx">i</span><span style="color: #908caa">++</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span style="color: #908caa">:=</span> <span class="nx">direction</span><span style="color: #908caa">.</span><span style="color: #ea9a97">mul</span><span style="color: #908caa">(</span><span class="nx">t</span><span style="color: #908caa">).</span><span style="color: #ea9a97">add</span><span style="color: #908caa">(</span><span class="nx">vec3</span><span style="color: #908caa">{</span><span style="color: #f6c177">0</span><span style="color: #908caa">,</span> <span style="color: #f6c177">0</span><span style="color: #908caa">,</span> <span style="color: #f6c177">5</span><span style="color: #908caa">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span style="color: #908caa">:=</span> <span style="color: #ea9a97">mandelbulb</span><span style="color: #908caa">(</span><span class="nx">p</span><span style="color: #908caa">)</span> <span style="color: #908caa">-</span> <span style="color: #f6c177">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #3e8fb0">if</span> <span class="nx">d</span> <span style="color: #908caa">&lt;</span> <span style="color: #f6c177">0.001</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #3e8fb0">return</span> <span class="nx">color</span><span style="color: #908caa">.</span><span class="nx">Gray</span><span style="color: #908caa">{</span><span style="color: #ea9a97">uint8</span><span style="color: #908caa">(</span><span style="color: #f6c177">255</span> <span style="color: #908caa">-</span> <span class="nx">t</span><span style="color: #908caa">*</span><span style="color: #f6c177">255</span><span style="color: #908caa">/</span><span style="color: #f6c177">100</span><span style="color: #908caa">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span style="color: #908caa">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #3e8fb0">if</span> <span class="nx">t</span> <span style="color: #908caa">&gt;</span> <span style="color: #f6c177">100</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #3e8fb0">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #3e8fb0">return</span> <span class="nx">color</span><span style="color: #908caa">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #3e8fb0">func</span> <span style="color: #ea9a97">main</span><span style="color: #908caa">()</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span style="color: #908caa">:=</span> <span class="nx">image</span><span style="color: #908caa">.</span><span style="color: #ea9a97">NewRGBA</span><span style="color: #908caa">(</span><span class="nx">image</span><span style="color: #908caa">.</span><span style="color: #ea9a97">Rect</span><span style="color: #908caa">(</span><span style="color: #f6c177">0</span><span style="color: #908caa">,</span> <span style="color: #f6c177">0</span><span style="color: #908caa">,</span> <span class="nx">ssWidth</span><span style="color: #908caa">,</span> <span class="nx">ssHeight</span><span style="color: #908caa">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #3e8fb0">for</span> <span class="nx">y</span> <span style="color: #908caa">:=</span> <span style="color: #f6c177">0</span><span style="color: #908caa">;</span> <span class="nx">y</span> <span style="color: #908caa">&lt;</span> <span class="nx">ssHeight</span><span style="color: #908caa">;</span> <span class="nx">y</span><span style="color: #908caa">++</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span style="color: #908caa">.</span><span style="color: #ea9a97">Add</span><span style="color: #908caa">(</span><span style="color: #f6c177">1</span><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #3e8fb0">go</span> <span style="color: #3e8fb0">func</span><span style="color: #908caa">(</span><span class="nx">y</span> <span style="color: #3e8fb0">int</span><span style="color: #908caa">)</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #3e8fb0">defer</span> <span class="nx">wg</span><span style="color: #908caa">.</span><span style="color: #ea9a97">Done</span><span style="color: #908caa">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #3e8fb0">for</span> <span class="nx">x</span> <span style="color: #908caa">:=</span> <span style="color: #f6c177">0</span><span style="color: #908caa">;</span> <span class="nx">x</span> <span style="color: #908caa">&lt;</span> <span class="nx">ssWidth</span><span style="color: #908caa">;</span> <span class="nx">x</span><span style="color: #908caa">++</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span style="color: #908caa">.</span><span style="color: #ea9a97">Set</span><span style="color: #908caa">(</span><span class="nx">x</span><span style="color: #908caa">,</span> <span class="nx">y</span><span style="color: #908caa">,</span> <span style="color: #ea9a97">renderPixel</span><span style="color: #908caa">(</span><span class="nx">x</span><span style="color: #908caa">,</span> <span class="nx">y</span><span style="color: #908caa">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #908caa">}(</span><span class="nx">y</span><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span style="color: #908caa">.</span><span style="color: #ea9a97">Wait</span><span style="color: #908caa">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span style="color: #908caa">:=</span> <span class="nx">image</span><span style="color: #908caa">.</span><span style="color: #ea9a97">NewRGBA</span><span style="color: #908caa">(</span><span class="nx">image</span><span style="color: #908caa">.</span><span style="color: #ea9a97">Rect</span><span style="color: #908caa">(</span><span style="color: #f6c177">0</span><span style="color: #908caa">,</span> <span style="color: #f6c177">0</span><span style="color: #908caa">,</span> <span class="nx">width</span><span style="color: #908caa">,</span> <span class="nx">height</span><span style="color: #908caa">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #3e8fb0">for</span> <span class="nx">y</span> <span style="color: #908caa">:=</span> <span style="color: #f6c177">0</span><span style="color: #908caa">;</span> <span class="nx">y</span> <span style="color: #908caa">&lt;</span> <span class="nx">height</span><span style="color: #908caa">;</span> <span class="nx">y</span><span style="color: #908caa">++</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #3e8fb0">for</span> <span class="nx">x</span> <span style="color: #908caa">:=</span> <span style="color: #f6c177">0</span><span style="color: #908caa">;</span> <span class="nx">x</span> <span style="color: #908caa">&lt;</span> <span class="nx">width</span><span style="color: #908caa">;</span> <span class="nx">x</span><span style="color: #908caa">++</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span style="color: #908caa">,</span> <span class="nx">g</span><span style="color: #908caa">,</span> <span class="nx">b</span><span style="color: #908caa">,</span> <span class="nx">a</span> <span style="color: #908caa">:=</span> <span style="color: #f6c177">0</span><span style="color: #908caa">,</span> <span style="color: #f6c177">0</span><span style="color: #908caa">,</span> <span style="color: #f6c177">0</span><span style="color: #908caa">,</span> <span style="color: #f6c177">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #3e8fb0">for</span> <span class="nx">dy</span> <span style="color: #908caa">:=</span> <span style="color: #f6c177">0</span><span style="color: #908caa">;</span> <span class="nx">dy</span> <span style="color: #908caa">&lt;</span> <span class="nx">supersamplingRatio</span><span style="color: #908caa">;</span> <span class="nx">dy</span><span style="color: #908caa">++</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #3e8fb0">for</span> <span class="nx">dx</span> <span style="color: #908caa">:=</span> <span style="color: #f6c177">0</span><span style="color: #908caa">;</span> <span class="nx">dx</span> <span style="color: #908caa">&lt;</span> <span class="nx">supersamplingRatio</span><span style="color: #908caa">;</span> <span class="nx">dx</span><span style="color: #908caa">++</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span style="color: #908caa">:=</span> <span class="nx">ssImg</span><span style="color: #908caa">.</span><span style="color: #ea9a97">RGBAAt</span><span style="color: #908caa">(</span><span class="nx">x</span><span style="color: #908caa">*</span><span class="nx">supersamplingRatio</span><span style="color: #908caa">+</span><span class="nx">dx</span><span style="color: #908caa">,</span> <span class="nx">y</span><span style="color: #908caa">*</span><span class="nx">supersamplingRatio</span><span style="color: #908caa">+</span><span class="nx">dy</span><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span style="color: #908caa">+=</span> <span style="color: #ea9a97">int</span><span style="color: #908caa">(</span><span class="nx">c</span><span style="color: #908caa">.</span><span class="nx">R</span><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span style="color: #908caa">+=</span> <span style="color: #ea9a97">int</span><span style="color: #908caa">(</span><span class="nx">c</span><span style="color: #908caa">.</span><span class="nx">G</span><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span style="color: #908caa">+=</span> <span style="color: #ea9a97">int</span><span style="color: #908caa">(</span><span class="nx">c</span><span style="color: #908caa">.</span><span class="nx">B</span><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span style="color: #908caa">+=</span> <span style="color: #ea9a97">int</span><span style="color: #908caa">(</span><span class="nx">c</span><span style="color: #908caa">.</span><span class="nx">A</span><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span style="color: #908caa">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #908caa">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span style="color: #908caa">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #908caa">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span style="color: #908caa">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #908caa">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span style="color: #908caa">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #908caa">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span style="color: #908caa">.</span><span style="color: #ea9a97">Set</span><span style="color: #908caa">(</span><span class="nx">x</span><span style="color: #908caa">,</span> <span class="nx">y</span><span style="color: #908caa">,</span> <span class="nx">color</span><span style="color: #908caa">.</span><span class="nx">RGBA</span><span style="color: #908caa">{</span><span style="color: #ea9a97">uint8</span><span style="color: #908caa">(</span><span class="nx">r</span><span style="color: #908caa">),</span> <span style="color: #ea9a97">uint8</span><span style="color: #908caa">(</span><span class="nx">g</span><span style="color: #908caa">),</span> <span style="color: #ea9a97">uint8</span><span style="color: #908caa">(</span><span class="nx">b</span><span style="color: #908caa">),</span> <span style="color: #ea9a97">uint8</span><span style="color: #908caa">(</span><span class="nx">a</span><span style="color: #908caa">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span style="color: #908caa">,</span> <span class="nx">err</span> <span style="color: #908caa">:=</span> <span class="nx">os</span><span style="color: #908caa">.</span><span style="color: #ea9a97">Create</span><span style="color: #908caa">(</span><span style="color: #f6c177">&#34;mandelbulb.png&#34;</span><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #3e8fb0">if</span> <span class="nx">err</span> <span style="color: #908caa">!=</span> <span style="color: #3e8fb0">nil</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span style="color: #908caa">.</span><span style="color: #ea9a97">Println</span><span style="color: #908caa">(</span><span style="color: #f6c177">&#34;Error creating file:&#34;</span><span style="color: #908caa">,</span> <span class="nx">err</span><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #3e8fb0">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #3e8fb0">defer</span> <span class="nx">file</span><span style="color: #908caa">.</span><span style="color: #ea9a97">Close</span><span style="color: #908caa">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span style="color: #908caa">=</span> <span class="nx">png</span><span style="color: #908caa">.</span><span style="color: #ea9a97">Encode</span><span style="color: #908caa">(</span><span class="nx">file</span><span style="color: #908caa">,</span> <span class="nx">img</span><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #3e8fb0">if</span> <span class="nx">err</span> <span style="color: #908caa">!=</span> <span style="color: #3e8fb0">nil</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span style="color: #908caa">.</span><span style="color: #ea9a97">Println</span><span style="color: #908caa">(</span><span style="color: #f6c177">&#34;Error encoding image:&#34;</span><span style="color: #908caa">,</span> <span class="nx">err</span><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #908caa">}</span></span></span></code></pre></code><a name='rose-pine'><h2><a id='stylelink' href='rose-pine.html' alt='View only rose-pine'>rose-pine</a></h2></a><code><pre style="color: #e0def4; background-color: #191724;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #c4a7e7">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #6e6a86">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #6e6a86"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #6e6a86"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #6e6a86"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c4a7e7">import</span> <span style="color: #908caa">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #f6c177">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #f6c177">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #f6c177">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #f6c177">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #f6c177">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #f6c177">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #f6c177">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #31748f">const</span> <span style="color: #908caa">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span style="color: #908caa">,</span> <span class="nx">height</span>      <span style="color: #908caa">=</span> <span style="color: #f6c177">1920</span><span style="color: #908caa">,</span> <span style="color: #f6c177">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span style="color: #908caa">,</span> <span class="nx">ssHeight</span>  <span style="color: #908caa">=</span> <span style="color: #f6c177">3840</span><span style="color: #908caa">,</span> <span style="color: #f6c177">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span style="color: #908caa">=</span> <span style="color: #ebbcba">float64</span><span style="color: #908caa">(</span><span class="nx">ssWidth</span><span style="color: #908caa">)</span> <span style="color: #908caa">/</span> <span style="color: #ebbcba">float64</span><span style="color: #908caa">(</span><span class="nx">ssHeight</span><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span style="color: #908caa">=</span> <span class="nx">math</span><span style="color: #908caa">.</span><span class="nx">Pi</span> <span style="color: #908caa">/</span> <span style="color: #f6c177">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span style="color: #908caa">=</span> <span style="color: #f6c177">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span style="color: #908caa">=</span> <span style="color: #f6c177">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span style="color: #908caa">=</span> <span style="color: #f6c177">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span style="color: #908caa">=</span> <span style="color: #f6c177">2</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #31748f">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span style="color: #908caa">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #31748f">type</span> <span class="nx">vec3</span> <span style="color: #31748f">struct</span><span style="color: #908caa">{</span> <span class="nx">x</span><span style="color: #908caa">,</span> <span class="nx">y</span><span style="color: #908caa">,</span> <span class="nx">z</span> <span style="color: #31748f">float64</span> <span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #31748f">func</span> <span style="color: #908caa">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #908caa">)</span> <span style="color: #ebbcba">add</span><span style="color: #908caa">(</span><span class="nx">w</span> <span class="nx">vec3</span><span style="color: #908caa">)</span> <span class="nx">vec3</span>    <span style="color: #908caa">{</span> <span style="color: #31748f">return</span> <span class="nx">vec3</span><span style="color: #908caa">{</span><span class="nx">v</span><span style="color: #908caa">.</span><span class="nx">x</span> <span style="color: #908caa">+</span> <span class="nx">w</span><span style="color: #908caa">.</span><span class="nx">x</span><span style="color: #908caa">,</span> <span class="nx">v</span><span style="color: #908caa">.</span><span class="nx">y</span> <span style="color: #908caa">+</span> <span class="nx">w</span><span style="color: #908caa">.</span><span class="nx">y</span><span style="color: #908caa">,</span> <span class="nx">v</span><span style="color: #908caa">.</span><span class="nx">z</span> <span style="color: #908caa">+</span> <span class="nx">w</span><span style="color: #908caa">.</span><span class="nx">z</span><span style="color: #908caa">}</span> <span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #31748f">func</span> <span style="color: #908caa">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #908caa">)</span> <span style="color: #ebbcba">mul</span><span style="color: #908caa">(</span><span class="nx">s</span> <span style="color: #31748f">float64</span><span style="color: #908caa">)</span> <span class="nx">vec3</span> <span style="color: #908caa">{</span> <span style="color: #31748f">return</span> <span class="nx">vec3</span><span style="color: #908caa">{</span><span class="nx">v</span><span style="color: #908caa">.</span><span class="nx">x</span> <span style="color: #908caa">*</span> <span class="nx">s</span><span style="color: #908caa">,</span> <span class="nx">v</span><span style="color: #908caa">.</span><span class="nx">y</span> <span style="color: #908caa">*</span> <span class="nx">s</span><span style="color: #908caa">,</span> <span class="nx">v</span><span style="color: #908caa">.</span><span class="nx">z</span> <span style="color: #908caa">*</span> <span class="nx">s</span><span style="color: #908caa">}</span> <span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #31748f">func</span> <span style="color: #908caa">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #908caa">)</span> <span style="color: #ebbcba">length</span><span style="color: #908caa">()</span> <span style="color: #31748f">float64</span>    <span style="color: #908caa">{</span> <span style="color: #31748f">return</span> <span class="nx">math</span><span style="color: #908caa">.</span><span style="color: #ebbcba">Sqrt</span><span style="color: #908caa">(</span><span class="nx">v</span><span style="color: #908caa">.</span><span class="nx">x</span><span style="color: #908caa">*</span><span class="nx">v</span><span style="color: #908caa">.</span><span class="nx">x</span> <span style="color: #908caa">+</span> <span class="nx">v</span><span style="color: #908caa">.</span><span class="nx">y</span><span style="color: #908caa">*</span><span class="nx">v</span><span style="color: #908caa">.</span><span class="nx">y</span> <span style="color: #908caa">+</span> <span class="nx">v</span><span style="color: #908caa">.</span><span class="nx">z</span><span style="color: #908caa">*</span><span class="nx">v</span><span style="color: #908caa">.</span><span class="nx">z</span><span style="color: #908caa">)</span> <span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #31748f">func</span> <span style="color: #908caa">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #908caa">)</span> <span style="color: #ebbcba">normalize</span><span style="color: #908caa">()</span> <span class="nx">vec3</span>    <span style="color: #908caa">{</span> <span style="color: #31748f">return</span> <span class="nx">v</span><span style="color: #908caa">.</span><span style="color: #ebbcba">mul</span><span style="color: #908caa">(</span><span style="color: #f6c177">1</span> <span style="color: #908caa">/</span> <span class="nx">v</span><span style="color: #908caa">.</span><span style="color: #ebbcba">length</span><span style="color: #908caa">())</span> <span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #31748f">func</span> <span style="color: #ebbcba">mandelbulb</span><span style="color: #908caa">(</span><span class="nx">p</span> <span class="nx">vec3</span><span style="color: #908caa">)</span> <span style="color: #31748f">float64</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span style="color: #908caa">,</span> <span class="nx">r</span><span style="color: #908caa">,</span> <span class="nx">theta</span><span style="color: #908caa">,</span> <span class="nx">phi</span> <span style="color: #908caa">:=</span> <span class="nx">p</span><span style="color: #908caa">,</span> <span style="color: #f6c177">0.0</span><span style="color: #908caa">,</span> <span style="color: #f6c177">0.0</span><span style="color: #908caa">,</span> <span style="color: #f6c177">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #31748f">for</span> <span class="nx">i</span> <span style="color: #908caa">:=</span> <span style="color: #f6c177">0</span><span style="color: #908caa">;</span> <span class="nx">i</span> <span style="color: #908caa">&lt;</span> <span class="nx">maxIter</span><span style="color: #908caa">;</span> <span class="nx">i</span><span style="color: #908caa">++</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span style="color: #908caa">=</span> <span class="nx">z</span><span style="color: #908caa">.</span><span style="color: #ebbcba">length</span><span style="color: #908caa">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #31748f">if</span> <span class="nx">r</span> <span style="color: #908caa">&gt;</span> <span class="nx">escapeRadius</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #31748f">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span style="color: #908caa">,</span> <span class="nx">phi</span> <span style="color: #908caa">=</span> <span class="nx">math</span><span style="color: #908caa">.</span><span style="color: #ebbcba">Acos</span><span style="color: #908caa">(</span><span class="nx">z</span><span style="color: #908caa">.</span><span class="nx">z</span><span style="color: #908caa">/</span><span class="nx">r</span><span style="color: #908caa">)</span><span style="color: #908caa">*</span><span class="nx">power</span><span style="color: #908caa">,</span> <span class="nx">math</span><span style="color: #908caa">.</span><span style="color: #ebbcba">Atan2</span><span style="color: #908caa">(</span><span class="nx">z</span><span style="color: #908caa">.</span><span class="nx">y</span><span style="color: #908caa">,</span> <span class="nx">z</span><span style="color: #908caa">.</span><span class="nx">x</span><span style="color: #908caa">)</span><span style="color: #908caa">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span style="color: #908caa">=</span> <span class="nx">math</span><span style="color: #908caa">.</span><span style="color: #ebbcba">Pow</span><span style="color: #908caa">(</span><span class="nx">r</span><span style="color: #908caa">,</span> <span class="nx">power</span><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span style="color: #908caa">.</span><span class="nx">x</span><span style="color: #908caa">,</span> <span class="nx">z</span><span style="color: #908caa">.</span><span class="nx">y</span><span style="color: #908caa">,</span> <span class="nx">z</span><span style="color: #908caa">.</span><span class="nx">z</span> <span style="color: #908caa">=</span> <span class="nx">p</span><span style="color: #908caa">.</span><span class="nx">x</span><span style="color: #908caa">+</span><span class="nx">r</span><span style="color: #908caa">*</span><span class="nx">math</span><span style="color: #908caa">.</span><span style="color: #ebbcba">Sin</span><span style="color: #908caa">(</span><span class="nx">theta</span><span style="color: #908caa">)</span><span style="color: #908caa">*</span><span class="nx">math</span><span style="color: #908caa">.</span><span style="color: #ebbcba">Cos</span><span style="color: #908caa">(</span><span class="nx">phi</span><span style="color: #908caa">),</span> <span class="nx">p</span><span style="color: #908caa">.</span><span class="nx">y</span><span style="color: #908caa">+</span><span class="nx">r</span><span style="color: #908caa">*</span><span class="nx">math</span><span style="color: #908caa">.</span><span style="color: #ebbcba">Sin</span><span style="color: #908caa">(</span><span class="nx">theta</span><span style="color: #908caa">)</span><span style="color: #908caa">*</span><span class="nx">math</span><span style="color: #908caa">.</span><span style="color: #ebbcba">Sin</span><span style="color: #908caa">(</span><span class="nx">phi</span><span style="color: #908caa">),</span> <span class="nx">p</span><span style="color: #908caa">.</span><span class="nx">z</span><span style="color: #908caa">+</span><span class="nx">r</span><span style="color: #908caa">*</span><span class="nx">math</span><span style="color: #908caa">.</span><span style="color: #ebbcba">Cos</span><span style="color: #908caa">(</span><span class="nx">theta</span><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #31748f">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #31748f">func</span> <span style="color: #ebbcba">renderPixel</span><span style="color: #908caa">(</span><span class="nx">x</span><span style="color: #908caa">,</span> <span class="nx">y</span> <span style="color: #31748f">int</span><span style="color: #908caa">)</span> <span class="nx">color</span><span style="color: #908caa">.</span><span class="nx">Color</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span style="color: #908caa">,</span> <span class="nx">py</span> <span style="color: #908caa">:=</span> <span style="color: #908caa">(</span><span style="color: #f6c177">2</span><span style="color: #908caa">*</span><span style="color: #ebbcba">float64</span><span style="color: #908caa">(</span><span class="nx">x</span><span style="color: #908caa">)</span><span style="color: #908caa">/</span><span style="color: #ebbcba">float64</span><span style="color: #908caa">(</span><span class="nx">ssWidth</span><span style="color: #908caa">)</span><span style="color: #908caa">-</span><span style="color: #f6c177">1</span><span style="color: #908caa">)</span><span style="color: #908caa">*</span><span class="nx">aspectRatio</span><span style="color: #908caa">*</span><span class="nx">math</span><span style="color: #908caa">.</span><span style="color: #ebbcba">Tan</span><span style="color: #908caa">(</span><span class="nx">fov</span><span style="color: #908caa">/</span><span style="color: #f6c177">2</span><span style="color: #908caa">),</span> <span style="color: #908caa">(</span><span style="color: #f6c177">1</span><span style="color: #908caa">-</span><span style="color: #f6c177">2</span><span style="color: #908caa">*</span><span style="color: #ebbcba">float64</span><span style="color: #908caa">(</span><span class="nx">y</span><span style="color: #908caa">)</span><span style="color: #908caa">/</span><span style="color: #ebbcba">float64</span><span style="color: #908caa">(</span><span class="nx">ssHeight</span><span style="color: #908caa">))</span><span style="color: #908caa">*</span><span class="nx">math</span><span style="color: #908caa">.</span><span style="color: #ebbcba">Tan</span><span style="color: #908caa">(</span><span class="nx">fov</span><span style="color: #908caa">/</span><span style="color: #f6c177">2</span><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span style="color: #908caa">:=</span> <span class="nx">vec3</span><span style="color: #908caa">{</span><span class="nx">px</span><span style="color: #908caa">,</span> <span class="nx">py</span><span style="color: #908caa">,</span> <span style="color: #908caa">-</span><span style="color: #f6c177">1</span><span style="color: #908caa">}.</span><span style="color: #ebbcba">normalize</span><span style="color: #908caa">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span style="color: #908caa">:=</span> <span style="color: #f6c177">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #31748f">for</span> <span class="nx">i</span> <span style="color: #908caa">:=</span> <span style="color: #f6c177">0</span><span style="color: #908caa">;</span> <span class="nx">i</span> <span style="color: #908caa">&lt;</span> <span class="nx">maxIter</span><span style="color: #908caa">;</span> <span class="nx">i</span><span style="color: #908caa">++</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span style="color: #908caa">:=</span> <span class="nx">direction</span><span style="color: #908caa">.</span><span style="color: #ebbcba">mul</span><span style="color: #908caa">(</span><span class="nx">t</span><span style="color: #908caa">).</span><span style="color: #ebbcba">add</span><span style="color: #908caa">(</span><span class="nx">vec3</span><span style="color: #908caa">{</span><span style="color: #f6c177">0</span><span style="color: #908caa">,</span> <span style="color: #f6c177">0</span><span style="color: #908caa">,</span> <span style="color: #f6c177">5</span><span style="color: #908caa">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span style="color: #908caa">:=</span> <span style="color: #ebbcba">mandelbulb</span><span style="color: #908caa">(</span><span class="nx">p</span><span style="color: #908caa">)</span> <span style="color: #908caa">-</span> <span style="color: #f6c177">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #31748f">if</span> <span class="nx">d</span> <span style="color: #908caa">&lt;</span> <span style="color: #f6c177">0.001</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #31748f">return</span> <span class="nx">color</span><span style="color: #908caa">.</span><span class="nx">Gray</span><span style="color: #908caa">{</span><span style="color: #ebbcba">uint8</span><span style="color: #908caa">(</span><span style="color: #f6c177">255</span> <span style="color: #908caa">-</span> <span class="nx">t</span><span style="color: #908caa">*</span><span style="color: #f6c177">255</span><span style="color: #908caa">/</span><span style="color: #f6c177">100</span><span style="color: #908caa">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span style="color: #908caa">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #31748f">if</span> <span class="nx">t</span> <span style="color: #908caa">&gt;</span> <span style="color: #f6c177">100</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #31748f">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #31748f">return</span> <span class="nx">color</span><span style="color: #908caa">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #31748f">func</span> <span style="color: #ebbcba">main</span><span style="color: #908caa">()</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span style="color: #908caa">:=</span> <span class="nx">image</span><span style="color: #908caa">.</span><span style="color: #ebbcba">NewRGBA</span><span style="color: #908caa">(</span><span class="nx">image</span><span style="color: #908caa">.</span><span style="color: #ebbcba">Rect</span><span style="color: #908caa">(</span><span style="color: #f6c177">0</span><span style="color: #908caa">,</span> <span style="color: #f6c177">0</span><span style="color: #908caa">,</span> <span class="nx">ssWidth</span><span style="color: #908caa">,</span> <span class="nx">ssHeight</span><span style="color: #908caa">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #31748f">for</span> <span class="nx">y</span> <span style="color: #908caa">:=</span> <span style="color: #f6c177">0</span><span style="color: #908caa">;</span> <span class="nx">y</span> <span style="color: #908caa">&lt;</span> <span class="nx">ssHeight</span><span style="color: #908caa">;</span> <span class="nx">y</span><span style="color: #908caa">++</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span style="color: #908caa">.</span><span style="color: #ebbcba">Add</span><span style="color: #908caa">(</span><span style="color: #f6c177">1</span><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #31748f">go</span> <span style="color: #31748f">func</span><span style="color: #908caa">(</span><span class="nx">y</span> <span style="color: #31748f">int</span><span style="color: #908caa">)</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #31748f">defer</span> <span class="nx">wg</span><span style="color: #908caa">.</span><span style="color: #ebbcba">Done</span><span style="color: #908caa">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #31748f">for</span> <span class="nx">x</span> <span style="color: #908caa">:=</span> <span style="color: #f6c177">0</span><span style="color: #908caa">;</span> <span class="nx">x</span> <span style="color: #908caa">&lt;</span> <span class="nx">ssWidth</span><span style="color: #908caa">;</span> <span class="nx">x</span><span style="color: #908caa">++</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span style="color: #908caa">.</span><span style="color: #ebbcba">Set</span><span style="color: #908caa">(</span><span class="nx">x</span><span style="color: #908caa">,</span> <span class="nx">y</span><span style="color: #908caa">,</span> <span style="color: #ebbcba">renderPixel</span><span style="color: #908caa">(</span><span class="nx">x</span><span style="color: #908caa">,</span> <span class="nx">y</span><span style="color: #908caa">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #908caa">}(</span><span class="nx">y</span><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span style="color: #908caa">.</span><span style="color: #ebbcba">Wait</span><span style="color: #908caa">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span style="color: #908caa">:=</span> <span class="nx">image</span><span style="color: #908caa">.</span><span style="color: #ebbcba">NewRGBA</span><span style="color: #908caa">(</span><span class="nx">image</span><span style="color: #908caa">.</span><span style="color: #ebbcba">Rect</span><span style="color: #908caa">(</span><span style="color: #f6c177">0</span><span style="color: #908caa">,</span> <span style="color: #f6c177">0</span><span style="color: #908caa">,</span> <span class="nx">width</span><span style="color: #908caa">,</span> <span class="nx">height</span><span style="color: #908caa">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #31748f">for</span> <span class="nx">y</span> <span style="color: #908caa">:=</span> <span style="color: #f6c177">0</span><span style="color: #908caa">;</span> <span class="nx">y</span> <span style="color: #908caa">&lt;</span> <span class="nx">height</span><span style="color: #908caa">;</span> <span class="nx">y</span><span style="color: #908caa">++</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #31748f">for</span> <span class="nx">x</span> <span style="color: #908caa">:=</span> <span style="color: #f6c177">0</span><span style="color: #908caa">;</span> <span class="nx">x</span> <span style="color: #908caa">&lt;</span> <span class="nx">width</span><span style="color: #908caa">;</span> <span class="nx">x</span><span style="color: #908caa">++</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span style="color: #908caa">,</span> <span class="nx">g</span><span style="color: #908caa">,</span> <span class="nx">b</span><span style="color: #908caa">,</span> <span class="nx">a</span> <span style="color: #908caa">:=</span> <span style="color: #f6c177">0</span><span style="color: #908caa">,</span> <span style="color: #f6c177">0</span><span style="color: #908caa">,</span> <span style="color: #f6c177">0</span><span style="color: #908caa">,</span> <span style="color: #f6c177">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #31748f">for</span> <span class="nx">dy</span> <span style="color: #908caa">:=</span> <span style="color: #f6c177">0</span><span style="color: #908caa">;</span> <span class="nx">dy</span> <span style="color: #908caa">&lt;</span> <span class="nx">supersamplingRatio</span><span style="color: #908caa">;</span> <span class="nx">dy</span><span style="color: #908caa">++</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #31748f">for</span> <span class="nx">dx</span> <span style="color: #908caa">:=</span> <span style="color: #f6c177">0</span><span style="color: #908caa">;</span> <span class="nx">dx</span> <span style="color: #908caa">&lt;</span> <span class="nx">supersamplingRatio</span><span style="color: #908caa">;</span> <span class="nx">dx</span><span style="color: #908caa">++</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span style="color: #908caa">:=</span> <span class="nx">ssImg</span><span style="color: #908caa">.</span><span style="color: #ebbcba">RGBAAt</span><span style="color: #908caa">(</span><span class="nx">x</span><span style="color: #908caa">*</span><span class="nx">supersamplingRatio</span><span style="color: #908caa">+</span><span class="nx">dx</span><span style="color: #908caa">,</span> <span class="nx">y</span><span style="color: #908caa">*</span><span class="nx">supersamplingRatio</span><span style="color: #908caa">+</span><span class="nx">dy</span><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span style="color: #908caa">+=</span> <span style="color: #ebbcba">int</span><span style="color: #908caa">(</span><span class="nx">c</span><span style="color: #908caa">.</span><span class="nx">R</span><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span style="color: #908caa">+=</span> <span style="color: #ebbcba">int</span><span style="color: #908caa">(</span><span class="nx">c</span><span style="color: #908caa">.</span><span class="nx">G</span><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span style="color: #908caa">+=</span> <span style="color: #ebbcba">int</span><span style="color: #908caa">(</span><span class="nx">c</span><span style="color: #908caa">.</span><span class="nx">B</span><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span style="color: #908caa">+=</span> <span style="color: #ebbcba">int</span><span style="color: #908caa">(</span><span class="nx">c</span><span style="color: #908caa">.</span><span class="nx">A</span><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span style="color: #908caa">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #908caa">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span style="color: #908caa">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #908caa">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span style="color: #908caa">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #908caa">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span style="color: #908caa">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #908caa">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span style="color: #908caa">.</span><span style="color: #ebbcba">Set</span><span style="color: #908caa">(</span><span class="nx">x</span><span style="color: #908caa">,</span> <span class="nx">y</span><span style="color: #908caa">,</span> <span class="nx">color</span><span style="color: #908caa">.</span><span class="nx">RGBA</span><span style="color: #908caa">{</span><span style="color: #ebbcba">uint8</span><span style="color: #908caa">(</span><span class="nx">r</span><span style="color: #908caa">),</span> <span style="color: #ebbcba">uint8</span><span style="color: #908caa">(</span><span class="nx">g</span><span style="color: #908caa">),</span> <span style="color: #ebbcba">uint8</span><span style="color: #908caa">(</span><span class="nx">b</span><span style="color: #908caa">),</span> <span style="color: #ebbcba">uint8</span><span style="color: #908caa">(</span><span class="nx">a</span><span style="color: #908caa">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span style="color: #908caa">,</span> <span class="nx">err</span> <span style="color: #908caa">:=</span> <span class="nx">os</span><span style="color: #908caa">.</span><span style="color: #ebbcba">Create</span><span style="color: #908caa">(</span><span style="color: #f6c177">&#34;mandelbulb.png&#34;</span><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #31748f">if</span> <span class="nx">err</span> <span style="color: #908caa">!=</span> <span style="color: #31748f">nil</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span style="color: #908caa">.</span><span style="color: #ebbcba">Println</span><span style="color: #908caa">(</span><span style="color: #f6c177">&#34;Error creating file:&#34;</span><span style="color: #908caa">,</span> <span class="nx">err</span><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #31748f">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #31748f">defer</span> <span class="nx">file</span><span style="color: #908caa">.</span><span style="color: #ebbcba">Close</span><span style="color: #908caa">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span style="color: #908caa">=</span> <span class="nx">png</span><span style="color: #908caa">.</span><span style="color: #ebbcba">Encode</span><span style="color: #908caa">(</span><span class="nx">file</span><span style="color: #908caa">,</span> <span class="nx">img</span><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #31748f">if</span> <span class="nx">err</span> <span style="color: #908caa">!=</span> <span style="color: #31748f">nil</span> <span style="color: #908caa">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span style="color: #908caa">.</span><span style="color: #ebbcba">Println</span><span style="color: #908caa">(</span><span style="color: #f6c177">&#34;Error encoding image:&#34;</span><span style="color: #908caa">,</span> <span class="nx">err</span><span style="color: #908caa">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #908caa">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #908caa">}</span></span></span></code></pre></code><a name='rrt'><h2><a id='stylelink' href='rrt.html' alt='View only rrt'>rrt</a></h2></a><code><pre style="color: #f8f8f2; background-color: #000000;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #ff0000">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #00ff00">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #00ff00"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #00ff00"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #00ff00"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #87ceeb">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #87ceeb">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #87ceeb">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #87ceeb">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #87ceeb">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #87ceeb">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #87ceeb">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span style="color: #ff6600">1920</span><span class="p">,</span> <span style="color: #ff6600">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span style="color: #ff6600">3840</span><span class="p">,</span> <span style="color: #ff6600">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span class="nb">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span class="o">/</span> <span style="color: #ff6600">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span style="color: #ff6600">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span style="color: #ff6600">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span style="color: #ff6600">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span style="color: #ff6600">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000">type</span> <span class="nx">vec3</span> <span style="color: #ff0000">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #ee82ee">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #ffff00">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #ff0000">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #ffff00">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #ee82ee">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #ff0000">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #ffff00">length</span><span class="p">()</span> <span style="color: #ee82ee">float64</span>    <span class="p">{</span> <span style="color: #ff0000">return</span> <span class="nx">math</span><span class="p">.</span><span style="color: #ffff00">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #ffff00">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #ff0000">return</span> <span class="nx">v</span><span class="p">.</span><span style="color: #ffff00">mul</span><span class="p">(</span><span style="color: #ff6600">1</span> <span class="o">/</span> <span class="nx">v</span><span class="p">.</span><span style="color: #ffff00">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000">func</span> <span style="color: #ffff00">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #ee82ee">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="o">:=</span> <span class="nx">p</span><span class="p">,</span> <span style="color: #ff6600">0.0</span><span class="p">,</span> <span style="color: #ff6600">0.0</span><span class="p">,</span> <span style="color: #ff6600">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff0000">for</span> <span class="nx">i</span> <span class="o">:=</span> <span style="color: #ff6600">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span style="color: #ffff00">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff0000">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff0000">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #ffff00">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span class="o">/</span><span class="nx">r</span><span class="p">)</span><span class="o">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span style="color: #ffff00">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="o">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #ffff00">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #ffff00">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #ffff00">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #ffff00">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #ffff00">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #ffff00">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff0000">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000">func</span> <span style="color: #ffff00">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #ee82ee">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span class="o">:=</span> <span class="p">(</span><span style="color: #ff6600">2</span><span class="o">*</span><span class="nb">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="o">/</span><span class="nb">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span class="o">-</span><span style="color: #ff6600">1</span><span class="p">)</span><span class="o">*</span><span class="nx">aspectRatio</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #ffff00">Tan</span><span class="p">(</span><span class="nx">fov</span><span class="o">/</span><span style="color: #ff6600">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #ff6600">1</span><span class="o">-</span><span style="color: #ff6600">2</span><span class="o">*</span><span class="nb">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span class="o">/</span><span class="nb">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #ffff00">Tan</span><span class="p">(</span><span class="nx">fov</span><span class="o">/</span><span style="color: #ff6600">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span class="o">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span class="o">-</span><span style="color: #ff6600">1</span><span class="p">}.</span><span style="color: #ffff00">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span class="o">:=</span> <span style="color: #ff6600">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff0000">for</span> <span class="nx">i</span> <span class="o">:=</span> <span style="color: #ff6600">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span class="o">:=</span> <span class="nx">direction</span><span class="p">.</span><span style="color: #ffff00">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span style="color: #ffff00">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span style="color: #ff6600">0</span><span class="p">,</span> <span style="color: #ff6600">0</span><span class="p">,</span> <span style="color: #ff6600">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span class="o">:=</span> <span style="color: #ffff00">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="o">-</span> <span style="color: #ff6600">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff0000">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span style="color: #ff6600">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff0000">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span class="nb">uint8</span><span class="p">(</span><span style="color: #ff6600">255</span> <span class="o">-</span> <span class="nx">t</span><span class="o">*</span><span style="color: #ff6600">255</span><span class="o">/</span><span style="color: #ff6600">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span class="o">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff0000">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span style="color: #ff6600">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff0000">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff0000">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ff0000">func</span> <span style="color: #ffff00">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #ffff00">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #ffff00">Rect</span><span class="p">(</span><span style="color: #ff6600">0</span><span class="p">,</span> <span style="color: #ff6600">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff0000">for</span> <span class="nx">y</span> <span class="o">:=</span> <span style="color: #ff6600">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span style="color: #ffff00">Add</span><span class="p">(</span><span style="color: #ff6600">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff0000">go</span> <span style="color: #ff0000">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #ee82ee">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff0000">defer</span> <span class="nx">wg</span><span class="p">.</span><span style="color: #ffff00">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff0000">for</span> <span class="nx">x</span> <span class="o">:=</span> <span style="color: #ff6600">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span style="color: #ffff00">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span style="color: #ffff00">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span style="color: #ffff00">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #ffff00">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #ffff00">Rect</span><span class="p">(</span><span style="color: #ff6600">0</span><span class="p">,</span> <span style="color: #ff6600">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff0000">for</span> <span class="nx">y</span> <span class="o">:=</span> <span style="color: #ff6600">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff0000">for</span> <span class="nx">x</span> <span class="o">:=</span> <span style="color: #ff6600">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span class="o">:=</span> <span style="color: #ff6600">0</span><span class="p">,</span> <span style="color: #ff6600">0</span><span class="p">,</span> <span style="color: #ff6600">0</span><span class="p">,</span> <span style="color: #ff6600">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ff0000">for</span> <span class="nx">dy</span> <span class="o">:=</span> <span style="color: #ff6600">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #ff0000">for</span> <span class="nx">dx</span> <span class="o">:=</span> <span style="color: #ff6600">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span class="o">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span style="color: #ffff00">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span class="o">*</span><span class="nx">supersamplingRatio</span><span class="o">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span class="o">*</span><span class="nx">supersamplingRatio</span><span class="o">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span style="color: #ffff00">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span class="nb">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span style="color: #ffff00">Create</span><span class="p">(</span><span style="color: #87ceeb">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff0000">if</span> <span class="nx">err</span> <span class="o">!=</span> <span style="color: #ff0000">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #ffff00">Println</span><span class="p">(</span><span style="color: #87ceeb">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ff0000">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff0000">defer</span> <span class="nx">file</span><span class="p">.</span><span style="color: #ffff00">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span style="color: #ffff00">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ff0000">if</span> <span class="nx">err</span> <span class="o">!=</span> <span style="color: #ff0000">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #ffff00">Println</span><span class="p">(</span><span style="color: #87ceeb">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='solarized-dark'><h2><a id='stylelink' href='solarized-dark.html' alt='View only solarized-dark'>solarized-dark</a></h2></a><code><pre style="color: #93a1a1; background-color: #002b36;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #719e07">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #586e75">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #586e75"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #586e75"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #586e75"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #719e07">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2aa198">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2aa198">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2aa198">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2aa198">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2aa198">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2aa198">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2aa198">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #268bd2">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span style="color: #2aa198">1920</span><span class="p">,</span> <span style="color: #2aa198">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span style="color: #2aa198">3840</span><span class="p">,</span> <span style="color: #2aa198">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span style="color: #b58900">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span style="color: #719e07">/</span> <span style="color: #b58900">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span style="color: #719e07">/</span> <span style="color: #2aa198">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span style="color: #2aa198">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span style="color: #2aa198">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span style="color: #2aa198">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span style="color: #2aa198">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #268bd2">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #268bd2">type</span> <span class="nx">vec3</span> <span style="color: #268bd2">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #dc322f">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #268bd2">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #268bd2">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #719e07">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #719e07">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #719e07">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #719e07">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #268bd2">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #268bd2">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #dc322f">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #719e07">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #719e07">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #719e07">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #719e07">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #268bd2">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #268bd2">length</span><span class="p">()</span> <span style="color: #dc322f">float64</span>    <span class="p">{</span> <span style="color: #719e07">return</span> <span class="nx">math</span><span class="p">.</span><span style="color: #268bd2">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span style="color: #719e07">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #719e07">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span style="color: #719e07">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #719e07">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span style="color: #719e07">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #268bd2">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #268bd2">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #719e07">return</span> <span class="nx">v</span><span class="p">.</span><span style="color: #268bd2">mul</span><span class="p">(</span><span style="color: #2aa198">1</span> <span style="color: #719e07">/</span> <span class="nx">v</span><span class="p">.</span><span style="color: #268bd2">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #268bd2">func</span> <span style="color: #268bd2">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #dc322f">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span style="color: #719e07">:=</span> <span class="nx">p</span><span class="p">,</span> <span style="color: #2aa198">0.0</span><span class="p">,</span> <span style="color: #2aa198">0.0</span><span class="p">,</span> <span style="color: #2aa198">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #719e07">for</span> <span class="nx">i</span> <span style="color: #719e07">:=</span> <span style="color: #2aa198">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #719e07">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span style="color: #268bd2">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #719e07">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #719e07">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #268bd2">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span style="color: #719e07">/</span><span class="nx">r</span><span class="p">)</span><span style="color: #719e07">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span style="color: #268bd2">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span style="color: #719e07">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #268bd2">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span style="color: #719e07">+</span><span class="nx">r</span><span style="color: #719e07">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #268bd2">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #719e07">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #268bd2">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span style="color: #719e07">+</span><span class="nx">r</span><span style="color: #719e07">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #268bd2">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #719e07">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #268bd2">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span style="color: #719e07">+</span><span class="nx">r</span><span style="color: #719e07">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #268bd2">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #719e07">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #268bd2">func</span> <span style="color: #268bd2">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #dc322f">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span style="color: #719e07">:=</span> <span class="p">(</span><span style="color: #2aa198">2</span><span style="color: #719e07">*</span><span style="color: #b58900">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span style="color: #719e07">/</span><span style="color: #b58900">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span style="color: #719e07">-</span><span style="color: #2aa198">1</span><span class="p">)</span><span style="color: #719e07">*</span><span class="nx">aspectRatio</span><span style="color: #719e07">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #268bd2">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #719e07">/</span><span style="color: #2aa198">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #2aa198">1</span><span style="color: #719e07">-</span><span style="color: #2aa198">2</span><span style="color: #719e07">*</span><span style="color: #b58900">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span style="color: #719e07">/</span><span style="color: #b58900">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span style="color: #719e07">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #268bd2">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #719e07">/</span><span style="color: #2aa198">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span style="color: #719e07">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span style="color: #719e07">-</span><span style="color: #2aa198">1</span><span class="p">}.</span><span style="color: #268bd2">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span style="color: #719e07">:=</span> <span style="color: #2aa198">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #719e07">for</span> <span class="nx">i</span> <span style="color: #719e07">:=</span> <span style="color: #2aa198">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #719e07">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span style="color: #719e07">:=</span> <span class="nx">direction</span><span class="p">.</span><span style="color: #268bd2">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span style="color: #268bd2">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span style="color: #2aa198">0</span><span class="p">,</span> <span style="color: #2aa198">0</span><span class="p">,</span> <span style="color: #2aa198">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span style="color: #719e07">:=</span> <span style="color: #268bd2">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span style="color: #719e07">-</span> <span style="color: #2aa198">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #719e07">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span style="color: #2aa198">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #719e07">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span style="color: #b58900">uint8</span><span class="p">(</span><span style="color: #2aa198">255</span> <span style="color: #719e07">-</span> <span class="nx">t</span><span style="color: #719e07">*</span><span style="color: #2aa198">255</span><span style="color: #719e07">/</span><span style="color: #2aa198">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span style="color: #719e07">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #719e07">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span style="color: #2aa198">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #719e07">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #719e07">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #268bd2">func</span> <span style="color: #268bd2">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span style="color: #719e07">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #268bd2">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #268bd2">Rect</span><span class="p">(</span><span style="color: #2aa198">0</span><span class="p">,</span> <span style="color: #2aa198">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #719e07">for</span> <span class="nx">y</span> <span style="color: #719e07">:=</span> <span style="color: #2aa198">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span style="color: #719e07">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span style="color: #268bd2">Add</span><span class="p">(</span><span style="color: #2aa198">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #719e07">go</span> <span style="color: #268bd2">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #dc322f">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #719e07">defer</span> <span class="nx">wg</span><span class="p">.</span><span style="color: #268bd2">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #719e07">for</span> <span class="nx">x</span> <span style="color: #719e07">:=</span> <span style="color: #2aa198">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span style="color: #719e07">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span style="color: #268bd2">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span style="color: #268bd2">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span style="color: #268bd2">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span style="color: #719e07">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #268bd2">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #268bd2">Rect</span><span class="p">(</span><span style="color: #2aa198">0</span><span class="p">,</span> <span style="color: #2aa198">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #719e07">for</span> <span class="nx">y</span> <span style="color: #719e07">:=</span> <span style="color: #2aa198">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span style="color: #719e07">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #719e07">for</span> <span class="nx">x</span> <span style="color: #719e07">:=</span> <span style="color: #2aa198">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span style="color: #719e07">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span style="color: #719e07">:=</span> <span style="color: #2aa198">0</span><span class="p">,</span> <span style="color: #2aa198">0</span><span class="p">,</span> <span style="color: #2aa198">0</span><span class="p">,</span> <span style="color: #2aa198">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #719e07">for</span> <span class="nx">dy</span> <span style="color: #719e07">:=</span> <span style="color: #2aa198">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span style="color: #719e07">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #719e07">for</span> <span class="nx">dx</span> <span style="color: #719e07">:=</span> <span style="color: #2aa198">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span style="color: #719e07">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span style="color: #719e07">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span style="color: #268bd2">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span style="color: #719e07">*</span><span class="nx">supersamplingRatio</span><span style="color: #719e07">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span style="color: #719e07">*</span><span class="nx">supersamplingRatio</span><span style="color: #719e07">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span style="color: #719e07">+=</span> <span style="color: #b58900">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span style="color: #719e07">+=</span> <span style="color: #b58900">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span style="color: #719e07">+=</span> <span style="color: #b58900">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span style="color: #719e07">+=</span> <span style="color: #b58900">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span style="color: #719e07">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #719e07">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span style="color: #719e07">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #719e07">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span style="color: #719e07">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #719e07">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span style="color: #719e07">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #719e07">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span style="color: #268bd2">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span style="color: #b58900">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span style="color: #b58900">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span style="color: #b58900">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span style="color: #b58900">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span style="color: #719e07">:=</span> <span class="nx">os</span><span class="p">.</span><span style="color: #268bd2">Create</span><span class="p">(</span><span style="color: #2aa198">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #719e07">if</span> <span class="nx">err</span> <span style="color: #719e07">!=</span> <span style="color: #cb4b16">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #268bd2">Println</span><span class="p">(</span><span style="color: #2aa198">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #719e07">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #719e07">defer</span> <span class="nx">file</span><span class="p">.</span><span style="color: #268bd2">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span style="color: #268bd2">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #719e07">if</span> <span class="nx">err</span> <span style="color: #719e07">!=</span> <span style="color: #cb4b16">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #268bd2">Println</span><span class="p">(</span><span style="color: #2aa198">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='solarized-dark256'><h2><a id='stylelink' href='solarized-dark256.html' alt='View only solarized-dark256'>solarized-dark256</a></h2></a><code><pre style="color: #8a8a8a; background-color: #1c1c1c;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #d75f00">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #4e4e4e">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #4e4e4e"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #4e4e4e"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #4e4e4e"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #d75f00">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #00afaf">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #00afaf">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #00afaf">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #00afaf">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #00afaf">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #00afaf">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #00afaf">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0087ff">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span style="color: #00afaf">1920</span><span class="p">,</span> <span style="color: #00afaf">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span style="color: #00afaf">3840</span><span class="p">,</span> <span style="color: #00afaf">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span style="color: #0087ff">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span class="o">/</span> <span style="color: #0087ff">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span class="o">/</span> <span style="color: #00afaf">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span style="color: #00afaf">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span style="color: #00afaf">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span style="color: #00afaf">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span style="color: #00afaf">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0087ff">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0087ff">type</span> <span class="nx">vec3</span> <span style="color: #0087ff">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #af0000">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0087ff">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #0087ff">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #5f8700">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0087ff">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #0087ff">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #af0000">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #5f8700">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0087ff">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #0087ff">length</span><span class="p">()</span> <span style="color: #af0000">float64</span>    <span class="p">{</span> <span style="color: #5f8700">return</span> <span class="nx">math</span><span class="p">.</span><span style="color: #0087ff">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0087ff">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #0087ff">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #5f8700">return</span> <span class="nx">v</span><span class="p">.</span><span style="color: #0087ff">mul</span><span class="p">(</span><span style="color: #00afaf">1</span> <span class="o">/</span> <span class="nx">v</span><span class="p">.</span><span style="color: #0087ff">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0087ff">func</span> <span style="color: #0087ff">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #af0000">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="o">:=</span> <span class="nx">p</span><span class="p">,</span> <span style="color: #00afaf">0.0</span><span class="p">,</span> <span style="color: #00afaf">0.0</span><span class="p">,</span> <span style="color: #00afaf">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #5f8700">for</span> <span class="nx">i</span> <span class="o">:=</span> <span style="color: #00afaf">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span style="color: #0087ff">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #5f8700">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #5f8700">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #0087ff">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span class="o">/</span><span class="nx">r</span><span class="p">)</span><span class="o">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span style="color: #0087ff">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="o">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #0087ff">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #0087ff">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #0087ff">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #0087ff">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #0087ff">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #0087ff">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #5f8700">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0087ff">func</span> <span style="color: #0087ff">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #af0000">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span class="o">:=</span> <span class="p">(</span><span style="color: #00afaf">2</span><span class="o">*</span><span style="color: #0087ff">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="o">/</span><span style="color: #0087ff">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span class="o">-</span><span style="color: #00afaf">1</span><span class="p">)</span><span class="o">*</span><span class="nx">aspectRatio</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #0087ff">Tan</span><span class="p">(</span><span class="nx">fov</span><span class="o">/</span><span style="color: #00afaf">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #00afaf">1</span><span class="o">-</span><span style="color: #00afaf">2</span><span class="o">*</span><span style="color: #0087ff">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span class="o">/</span><span style="color: #0087ff">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #0087ff">Tan</span><span class="p">(</span><span class="nx">fov</span><span class="o">/</span><span style="color: #00afaf">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span class="o">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span class="o">-</span><span style="color: #00afaf">1</span><span class="p">}.</span><span style="color: #0087ff">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span class="o">:=</span> <span style="color: #00afaf">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #5f8700">for</span> <span class="nx">i</span> <span class="o">:=</span> <span style="color: #00afaf">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span class="o">:=</span> <span class="nx">direction</span><span class="p">.</span><span style="color: #0087ff">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span style="color: #0087ff">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span style="color: #00afaf">0</span><span class="p">,</span> <span style="color: #00afaf">0</span><span class="p">,</span> <span style="color: #00afaf">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span class="o">:=</span> <span style="color: #0087ff">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="o">-</span> <span style="color: #00afaf">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #5f8700">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span style="color: #00afaf">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #5f8700">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span style="color: #0087ff">uint8</span><span class="p">(</span><span style="color: #00afaf">255</span> <span class="o">-</span> <span class="nx">t</span><span class="o">*</span><span style="color: #00afaf">255</span><span class="o">/</span><span style="color: #00afaf">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span class="o">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #5f8700">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span style="color: #00afaf">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #5f8700">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #5f8700">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0087ff">func</span> <span style="color: #0087ff">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #0087ff">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #0087ff">Rect</span><span class="p">(</span><span style="color: #00afaf">0</span><span class="p">,</span> <span style="color: #00afaf">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #5f8700">for</span> <span class="nx">y</span> <span class="o">:=</span> <span style="color: #00afaf">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span style="color: #0087ff">Add</span><span class="p">(</span><span style="color: #00afaf">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #5f8700">go</span> <span style="color: #0087ff">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #af0000">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #5f8700">defer</span> <span class="nx">wg</span><span class="p">.</span><span style="color: #0087ff">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #5f8700">for</span> <span class="nx">x</span> <span class="o">:=</span> <span style="color: #00afaf">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span style="color: #0087ff">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span style="color: #0087ff">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span style="color: #0087ff">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #0087ff">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #0087ff">Rect</span><span class="p">(</span><span style="color: #00afaf">0</span><span class="p">,</span> <span style="color: #00afaf">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #5f8700">for</span> <span class="nx">y</span> <span class="o">:=</span> <span style="color: #00afaf">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #5f8700">for</span> <span class="nx">x</span> <span class="o">:=</span> <span style="color: #00afaf">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span class="o">:=</span> <span style="color: #00afaf">0</span><span class="p">,</span> <span style="color: #00afaf">0</span><span class="p">,</span> <span style="color: #00afaf">0</span><span class="p">,</span> <span style="color: #00afaf">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #5f8700">for</span> <span class="nx">dy</span> <span class="o">:=</span> <span style="color: #00afaf">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #5f8700">for</span> <span class="nx">dx</span> <span class="o">:=</span> <span style="color: #00afaf">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span class="o">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span style="color: #0087ff">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span class="o">*</span><span class="nx">supersamplingRatio</span><span class="o">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span class="o">*</span><span class="nx">supersamplingRatio</span><span class="o">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span class="o">+=</span> <span style="color: #0087ff">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span class="o">+=</span> <span style="color: #0087ff">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span class="o">+=</span> <span style="color: #0087ff">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span class="o">+=</span> <span style="color: #0087ff">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span style="color: #0087ff">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span style="color: #0087ff">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span style="color: #0087ff">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span style="color: #0087ff">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span style="color: #0087ff">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span style="color: #0087ff">Create</span><span class="p">(</span><span style="color: #00afaf">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #5f8700">if</span> <span class="nx">err</span> <span class="o">!=</span> <span style="color: #d75f00">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #0087ff">Println</span><span class="p">(</span><span style="color: #00afaf">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #5f8700">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #5f8700">defer</span> <span class="nx">file</span><span class="p">.</span><span style="color: #0087ff">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span style="color: #0087ff">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #5f8700">if</span> <span class="nx">err</span> <span class="o">!=</span> <span style="color: #d75f00">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #0087ff">Println</span><span class="p">(</span><span style="color: #00afaf">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='solarized-light'><h2><a id='stylelink' href='solarized-light.html' alt='View only solarized-light'>solarized-light</a></h2></a><code><pre style="color: #586e75; background-color: #eee8d5;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #dc322f; font-weight: bold">package</span> <span style="color: #268bd2">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #93a1a1; font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #93a1a1; font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #93a1a1; font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #93a1a1; font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #dc322f; font-weight: bold">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2aa198">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2aa198">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2aa198">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2aa198">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2aa198">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2aa198">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #2aa198">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #859900">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #268bd2">width</span><span class="p">,</span> <span style="color: #268bd2">height</span>      <span class="p">=</span> <span style="color: #2aa198; font-weight: bold">1920</span><span class="p">,</span> <span style="color: #2aa198; font-weight: bold">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #268bd2">ssWidth</span><span class="p">,</span> <span style="color: #268bd2">ssHeight</span>  <span class="p">=</span> <span style="color: #2aa198; font-weight: bold">3840</span><span class="p">,</span> <span style="color: #2aa198; font-weight: bold">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #268bd2">aspectRatio</span>        <span class="p">=</span> <span style="color: #cb4b16">float64</span><span class="p">(</span><span style="color: #268bd2">ssWidth</span><span class="p">)</span> <span class="o">/</span> <span style="color: #cb4b16">float64</span><span class="p">(</span><span style="color: #268bd2">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #268bd2">fov</span>                <span class="p">=</span> <span style="color: #268bd2">math</span><span class="p">.</span><span style="color: #268bd2">Pi</span> <span class="o">/</span> <span style="color: #2aa198; font-weight: bold">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #268bd2">maxIter</span>            <span class="p">=</span> <span style="color: #2aa198; font-weight: bold">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #268bd2">power</span>              <span class="p">=</span> <span style="color: #2aa198; font-weight: bold">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #268bd2">escapeRadius</span>       <span class="p">=</span> <span style="color: #2aa198; font-weight: bold">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #268bd2">supersamplingRatio</span> <span class="p">=</span> <span style="color: #2aa198; font-weight: bold">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #859900">var</span> <span style="color: #268bd2">wg</span> <span style="color: #268bd2">sync</span><span class="p">.</span><span style="color: #268bd2">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #859900">type</span> <span style="color: #268bd2">vec3</span> <span style="color: #859900">struct</span><span class="p">{</span> <span style="color: #268bd2">x</span><span class="p">,</span> <span style="color: #268bd2">y</span><span class="p">,</span> <span style="color: #268bd2">z</span> <span style="color: #859900; font-weight: bold">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #859900">func</span> <span class="p">(</span><span style="color: #268bd2">v</span> <span style="color: #268bd2">vec3</span><span class="p">)</span> <span style="color: #268bd2">add</span><span class="p">(</span><span style="color: #268bd2">w</span> <span style="color: #268bd2">vec3</span><span class="p">)</span> <span style="color: #268bd2">vec3</span>    <span class="p">{</span> <span style="color: #859900">return</span> <span style="color: #268bd2">vec3</span><span class="p">{</span><span style="color: #268bd2">v</span><span class="p">.</span><span style="color: #268bd2">x</span> <span class="o">+</span> <span style="color: #268bd2">w</span><span class="p">.</span><span style="color: #268bd2">x</span><span class="p">,</span> <span style="color: #268bd2">v</span><span class="p">.</span><span style="color: #268bd2">y</span> <span class="o">+</span> <span style="color: #268bd2">w</span><span class="p">.</span><span style="color: #268bd2">y</span><span class="p">,</span> <span style="color: #268bd2">v</span><span class="p">.</span><span style="color: #268bd2">z</span> <span class="o">+</span> <span style="color: #268bd2">w</span><span class="p">.</span><span style="color: #268bd2">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #859900">func</span> <span class="p">(</span><span style="color: #268bd2">v</span> <span style="color: #268bd2">vec3</span><span class="p">)</span> <span style="color: #268bd2">mul</span><span class="p">(</span><span style="color: #268bd2">s</span> <span style="color: #859900; font-weight: bold">float64</span><span class="p">)</span> <span style="color: #268bd2">vec3</span> <span class="p">{</span> <span style="color: #859900">return</span> <span style="color: #268bd2">vec3</span><span class="p">{</span><span style="color: #268bd2">v</span><span class="p">.</span><span style="color: #268bd2">x</span> <span class="o">*</span> <span style="color: #268bd2">s</span><span class="p">,</span> <span style="color: #268bd2">v</span><span class="p">.</span><span style="color: #268bd2">y</span> <span class="o">*</span> <span style="color: #268bd2">s</span><span class="p">,</span> <span style="color: #268bd2">v</span><span class="p">.</span><span style="color: #268bd2">z</span> <span class="o">*</span> <span style="color: #268bd2">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #859900">func</span> <span class="p">(</span><span style="color: #268bd2">v</span> <span style="color: #268bd2">vec3</span><span class="p">)</span> <span style="color: #268bd2">length</span><span class="p">()</span> <span style="color: #859900; font-weight: bold">float64</span>    <span class="p">{</span> <span style="color: #859900">return</span> <span style="color: #268bd2">math</span><span class="p">.</span><span style="color: #268bd2">Sqrt</span><span class="p">(</span><span style="color: #268bd2">v</span><span class="p">.</span><span style="color: #268bd2">x</span><span class="o">*</span><span style="color: #268bd2">v</span><span class="p">.</span><span style="color: #268bd2">x</span> <span class="o">+</span> <span style="color: #268bd2">v</span><span class="p">.</span><span style="color: #268bd2">y</span><span class="o">*</span><span style="color: #268bd2">v</span><span class="p">.</span><span style="color: #268bd2">y</span> <span class="o">+</span> <span style="color: #268bd2">v</span><span class="p">.</span><span style="color: #268bd2">z</span><span class="o">*</span><span style="color: #268bd2">v</span><span class="p">.</span><span style="color: #268bd2">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #859900">func</span> <span class="p">(</span><span style="color: #268bd2">v</span> <span style="color: #268bd2">vec3</span><span class="p">)</span> <span style="color: #268bd2">normalize</span><span class="p">()</span> <span style="color: #268bd2">vec3</span>    <span class="p">{</span> <span style="color: #859900">return</span> <span style="color: #268bd2">v</span><span class="p">.</span><span style="color: #268bd2">mul</span><span class="p">(</span><span style="color: #2aa198; font-weight: bold">1</span> <span class="o">/</span> <span style="color: #268bd2">v</span><span class="p">.</span><span style="color: #268bd2">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #859900">func</span> <span style="color: #268bd2">mandelbulb</span><span class="p">(</span><span style="color: #268bd2">p</span> <span style="color: #268bd2">vec3</span><span class="p">)</span> <span style="color: #859900; font-weight: bold">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #268bd2">z</span><span class="p">,</span> <span style="color: #268bd2">r</span><span class="p">,</span> <span style="color: #268bd2">theta</span><span class="p">,</span> <span style="color: #268bd2">phi</span> <span class="o">:=</span> <span style="color: #268bd2">p</span><span class="p">,</span> <span style="color: #2aa198; font-weight: bold">0.0</span><span class="p">,</span> <span style="color: #2aa198; font-weight: bold">0.0</span><span class="p">,</span> <span style="color: #2aa198; font-weight: bold">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #859900">for</span> <span style="color: #268bd2">i</span> <span class="o">:=</span> <span style="color: #2aa198; font-weight: bold">0</span><span class="p">;</span> <span style="color: #268bd2">i</span> <span class="p">&lt;</span> <span style="color: #268bd2">maxIter</span><span class="p">;</span> <span style="color: #268bd2">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #268bd2">r</span> <span class="p">=</span> <span style="color: #268bd2">z</span><span class="p">.</span><span style="color: #268bd2">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #859900">if</span> <span style="color: #268bd2">r</span> <span class="p">&gt;</span> <span style="color: #268bd2">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #859900">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #268bd2">theta</span><span class="p">,</span> <span style="color: #268bd2">phi</span> <span class="p">=</span> <span style="color: #268bd2">math</span><span class="p">.</span><span style="color: #268bd2">Acos</span><span class="p">(</span><span style="color: #268bd2">z</span><span class="p">.</span><span style="color: #268bd2">z</span><span class="o">/</span><span style="color: #268bd2">r</span><span class="p">)</span><span class="o">*</span><span style="color: #268bd2">power</span><span class="p">,</span> <span style="color: #268bd2">math</span><span class="p">.</span><span style="color: #268bd2">Atan2</span><span class="p">(</span><span style="color: #268bd2">z</span><span class="p">.</span><span style="color: #268bd2">y</span><span class="p">,</span> <span style="color: #268bd2">z</span><span class="p">.</span><span style="color: #268bd2">x</span><span class="p">)</span><span class="o">*</span><span style="color: #268bd2">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #268bd2">r</span> <span class="p">=</span> <span style="color: #268bd2">math</span><span class="p">.</span><span style="color: #268bd2">Pow</span><span class="p">(</span><span style="color: #268bd2">r</span><span class="p">,</span> <span style="color: #268bd2">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #268bd2">z</span><span class="p">.</span><span style="color: #268bd2">x</span><span class="p">,</span> <span style="color: #268bd2">z</span><span class="p">.</span><span style="color: #268bd2">y</span><span class="p">,</span> <span style="color: #268bd2">z</span><span class="p">.</span><span style="color: #268bd2">z</span> <span class="p">=</span> <span style="color: #268bd2">p</span><span class="p">.</span><span style="color: #268bd2">x</span><span class="o">+</span><span style="color: #268bd2">r</span><span class="o">*</span><span style="color: #268bd2">math</span><span class="p">.</span><span style="color: #268bd2">Sin</span><span class="p">(</span><span style="color: #268bd2">theta</span><span class="p">)</span><span class="o">*</span><span style="color: #268bd2">math</span><span class="p">.</span><span style="color: #268bd2">Cos</span><span class="p">(</span><span style="color: #268bd2">phi</span><span class="p">),</span> <span style="color: #268bd2">p</span><span class="p">.</span><span style="color: #268bd2">y</span><span class="o">+</span><span style="color: #268bd2">r</span><span class="o">*</span><span style="color: #268bd2">math</span><span class="p">.</span><span style="color: #268bd2">Sin</span><span class="p">(</span><span style="color: #268bd2">theta</span><span class="p">)</span><span class="o">*</span><span style="color: #268bd2">math</span><span class="p">.</span><span style="color: #268bd2">Sin</span><span class="p">(</span><span style="color: #268bd2">phi</span><span class="p">),</span> <span style="color: #268bd2">p</span><span class="p">.</span><span style="color: #268bd2">z</span><span class="o">+</span><span style="color: #268bd2">r</span><span class="o">*</span><span style="color: #268bd2">math</span><span class="p">.</span><span style="color: #268bd2">Cos</span><span class="p">(</span><span style="color: #268bd2">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #859900">return</span> <span style="color: #268bd2">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #859900">func</span> <span style="color: #268bd2">renderPixel</span><span class="p">(</span><span style="color: #268bd2">x</span><span class="p">,</span> <span style="color: #268bd2">y</span> <span style="color: #859900; font-weight: bold">int</span><span class="p">)</span> <span style="color: #268bd2">color</span><span class="p">.</span><span style="color: #268bd2">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #268bd2">px</span><span class="p">,</span> <span style="color: #268bd2">py</span> <span class="o">:=</span> <span class="p">(</span><span style="color: #2aa198; font-weight: bold">2</span><span class="o">*</span><span style="color: #cb4b16">float64</span><span class="p">(</span><span style="color: #268bd2">x</span><span class="p">)</span><span class="o">/</span><span style="color: #cb4b16">float64</span><span class="p">(</span><span style="color: #268bd2">ssWidth</span><span class="p">)</span><span class="o">-</span><span style="color: #2aa198; font-weight: bold">1</span><span class="p">)</span><span class="o">*</span><span style="color: #268bd2">aspectRatio</span><span class="o">*</span><span style="color: #268bd2">math</span><span class="p">.</span><span style="color: #268bd2">Tan</span><span class="p">(</span><span style="color: #268bd2">fov</span><span class="o">/</span><span style="color: #2aa198; font-weight: bold">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #2aa198; font-weight: bold">1</span><span class="o">-</span><span style="color: #2aa198; font-weight: bold">2</span><span class="o">*</span><span style="color: #cb4b16">float64</span><span class="p">(</span><span style="color: #268bd2">y</span><span class="p">)</span><span class="o">/</span><span style="color: #cb4b16">float64</span><span class="p">(</span><span style="color: #268bd2">ssHeight</span><span class="p">))</span><span class="o">*</span><span style="color: #268bd2">math</span><span class="p">.</span><span style="color: #268bd2">Tan</span><span class="p">(</span><span style="color: #268bd2">fov</span><span class="o">/</span><span style="color: #2aa198; font-weight: bold">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #268bd2">direction</span> <span class="o">:=</span> <span style="color: #268bd2">vec3</span><span class="p">{</span><span style="color: #268bd2">px</span><span class="p">,</span> <span style="color: #268bd2">py</span><span class="p">,</span> <span class="o">-</span><span style="color: #2aa198; font-weight: bold">1</span><span class="p">}.</span><span style="color: #268bd2">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #268bd2">t</span> <span class="o">:=</span> <span style="color: #2aa198; font-weight: bold">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #859900">for</span> <span style="color: #268bd2">i</span> <span class="o">:=</span> <span style="color: #2aa198; font-weight: bold">0</span><span class="p">;</span> <span style="color: #268bd2">i</span> <span class="p">&lt;</span> <span style="color: #268bd2">maxIter</span><span class="p">;</span> <span style="color: #268bd2">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #268bd2">p</span> <span class="o">:=</span> <span style="color: #268bd2">direction</span><span class="p">.</span><span style="color: #268bd2">mul</span><span class="p">(</span><span style="color: #268bd2">t</span><span class="p">).</span><span style="color: #268bd2">add</span><span class="p">(</span><span style="color: #268bd2">vec3</span><span class="p">{</span><span style="color: #2aa198; font-weight: bold">0</span><span class="p">,</span> <span style="color: #2aa198; font-weight: bold">0</span><span class="p">,</span> <span style="color: #2aa198; font-weight: bold">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #268bd2">d</span> <span class="o">:=</span> <span style="color: #268bd2">mandelbulb</span><span class="p">(</span><span style="color: #268bd2">p</span><span class="p">)</span> <span class="o">-</span> <span style="color: #2aa198; font-weight: bold">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #859900">if</span> <span style="color: #268bd2">d</span> <span class="p">&lt;</span> <span style="color: #2aa198; font-weight: bold">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #859900">return</span> <span style="color: #268bd2">color</span><span class="p">.</span><span style="color: #268bd2">Gray</span><span class="p">{</span><span style="color: #cb4b16">uint8</span><span class="p">(</span><span style="color: #2aa198; font-weight: bold">255</span> <span class="o">-</span> <span style="color: #268bd2">t</span><span class="o">*</span><span style="color: #2aa198; font-weight: bold">255</span><span class="o">/</span><span style="color: #2aa198; font-weight: bold">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #268bd2">t</span> <span class="o">+=</span> <span style="color: #268bd2">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #859900">if</span> <span style="color: #268bd2">t</span> <span class="p">&gt;</span> <span style="color: #2aa198; font-weight: bold">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #859900">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #859900">return</span> <span style="color: #268bd2">color</span><span class="p">.</span><span style="color: #268bd2">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #859900">func</span> <span style="color: #268bd2">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #268bd2">ssImg</span> <span class="o">:=</span> <span style="color: #268bd2">image</span><span class="p">.</span><span style="color: #268bd2">NewRGBA</span><span class="p">(</span><span style="color: #268bd2">image</span><span class="p">.</span><span style="color: #268bd2">Rect</span><span class="p">(</span><span style="color: #2aa198; font-weight: bold">0</span><span class="p">,</span> <span style="color: #2aa198; font-weight: bold">0</span><span class="p">,</span> <span style="color: #268bd2">ssWidth</span><span class="p">,</span> <span style="color: #268bd2">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #859900">for</span> <span style="color: #268bd2">y</span> <span class="o">:=</span> <span style="color: #2aa198; font-weight: bold">0</span><span class="p">;</span> <span style="color: #268bd2">y</span> <span class="p">&lt;</span> <span style="color: #268bd2">ssHeight</span><span class="p">;</span> <span style="color: #268bd2">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #268bd2">wg</span><span class="p">.</span><span style="color: #268bd2">Add</span><span class="p">(</span><span style="color: #2aa198; font-weight: bold">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #859900">go</span> <span style="color: #859900">func</span><span class="p">(</span><span style="color: #268bd2">y</span> <span style="color: #859900; font-weight: bold">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #859900">defer</span> <span style="color: #268bd2">wg</span><span class="p">.</span><span style="color: #268bd2">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #859900">for</span> <span style="color: #268bd2">x</span> <span class="o">:=</span> <span style="color: #2aa198; font-weight: bold">0</span><span class="p">;</span> <span style="color: #268bd2">x</span> <span class="p">&lt;</span> <span style="color: #268bd2">ssWidth</span><span class="p">;</span> <span style="color: #268bd2">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #268bd2">ssImg</span><span class="p">.</span><span style="color: #268bd2">Set</span><span class="p">(</span><span style="color: #268bd2">x</span><span class="p">,</span> <span style="color: #268bd2">y</span><span class="p">,</span> <span style="color: #268bd2">renderPixel</span><span class="p">(</span><span style="color: #268bd2">x</span><span class="p">,</span> <span style="color: #268bd2">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span style="color: #268bd2">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #268bd2">wg</span><span class="p">.</span><span style="color: #268bd2">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #268bd2">img</span> <span class="o">:=</span> <span style="color: #268bd2">image</span><span class="p">.</span><span style="color: #268bd2">NewRGBA</span><span class="p">(</span><span style="color: #268bd2">image</span><span class="p">.</span><span style="color: #268bd2">Rect</span><span class="p">(</span><span style="color: #2aa198; font-weight: bold">0</span><span class="p">,</span> <span style="color: #2aa198; font-weight: bold">0</span><span class="p">,</span> <span style="color: #268bd2">width</span><span class="p">,</span> <span style="color: #268bd2">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #859900">for</span> <span style="color: #268bd2">y</span> <span class="o">:=</span> <span style="color: #2aa198; font-weight: bold">0</span><span class="p">;</span> <span style="color: #268bd2">y</span> <span class="p">&lt;</span> <span style="color: #268bd2">height</span><span class="p">;</span> <span style="color: #268bd2">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #859900">for</span> <span style="color: #268bd2">x</span> <span class="o">:=</span> <span style="color: #2aa198; font-weight: bold">0</span><span class="p">;</span> <span style="color: #268bd2">x</span> <span class="p">&lt;</span> <span style="color: #268bd2">width</span><span class="p">;</span> <span style="color: #268bd2">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #268bd2">r</span><span class="p">,</span> <span style="color: #268bd2">g</span><span class="p">,</span> <span style="color: #268bd2">b</span><span class="p">,</span> <span style="color: #268bd2">a</span> <span class="o">:=</span> <span style="color: #2aa198; font-weight: bold">0</span><span class="p">,</span> <span style="color: #2aa198; font-weight: bold">0</span><span class="p">,</span> <span style="color: #2aa198; font-weight: bold">0</span><span class="p">,</span> <span style="color: #2aa198; font-weight: bold">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #859900">for</span> <span style="color: #268bd2">dy</span> <span class="o">:=</span> <span style="color: #2aa198; font-weight: bold">0</span><span class="p">;</span> <span style="color: #268bd2">dy</span> <span class="p">&lt;</span> <span style="color: #268bd2">supersamplingRatio</span><span class="p">;</span> <span style="color: #268bd2">dy</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #859900">for</span> <span style="color: #268bd2">dx</span> <span class="o">:=</span> <span style="color: #2aa198; font-weight: bold">0</span><span class="p">;</span> <span style="color: #268bd2">dx</span> <span class="p">&lt;</span> <span style="color: #268bd2">supersamplingRatio</span><span class="p">;</span> <span style="color: #268bd2">dx</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #268bd2">c</span> <span class="o">:=</span> <span style="color: #268bd2">ssImg</span><span class="p">.</span><span style="color: #268bd2">RGBAAt</span><span class="p">(</span><span style="color: #268bd2">x</span><span class="o">*</span><span style="color: #268bd2">supersamplingRatio</span><span class="o">+</span><span style="color: #268bd2">dx</span><span class="p">,</span> <span style="color: #268bd2">y</span><span class="o">*</span><span style="color: #268bd2">supersamplingRatio</span><span class="o">+</span><span style="color: #268bd2">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #268bd2">r</span> <span class="o">+=</span> <span style="color: #cb4b16">int</span><span class="p">(</span><span style="color: #268bd2">c</span><span class="p">.</span><span style="color: #268bd2">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #268bd2">g</span> <span class="o">+=</span> <span style="color: #cb4b16">int</span><span class="p">(</span><span style="color: #268bd2">c</span><span class="p">.</span><span style="color: #268bd2">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #268bd2">b</span> <span class="o">+=</span> <span style="color: #cb4b16">int</span><span class="p">(</span><span style="color: #268bd2">c</span><span class="p">.</span><span style="color: #268bd2">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #268bd2">a</span> <span class="o">+=</span> <span style="color: #cb4b16">int</span><span class="p">(</span><span style="color: #268bd2">c</span><span class="p">.</span><span style="color: #268bd2">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #268bd2">r</span> <span class="o">/=</span> <span style="color: #268bd2">supersamplingRatio</span> <span class="o">*</span> <span style="color: #268bd2">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #268bd2">g</span> <span class="o">/=</span> <span style="color: #268bd2">supersamplingRatio</span> <span class="o">*</span> <span style="color: #268bd2">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #268bd2">b</span> <span class="o">/=</span> <span style="color: #268bd2">supersamplingRatio</span> <span class="o">*</span> <span style="color: #268bd2">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #268bd2">a</span> <span class="o">/=</span> <span style="color: #268bd2">supersamplingRatio</span> <span class="o">*</span> <span style="color: #268bd2">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #268bd2">img</span><span class="p">.</span><span style="color: #268bd2">Set</span><span class="p">(</span><span style="color: #268bd2">x</span><span class="p">,</span> <span style="color: #268bd2">y</span><span class="p">,</span> <span style="color: #268bd2">color</span><span class="p">.</span><span style="color: #268bd2">RGBA</span><span class="p">{</span><span style="color: #cb4b16">uint8</span><span class="p">(</span><span style="color: #268bd2">r</span><span class="p">),</span> <span style="color: #cb4b16">uint8</span><span class="p">(</span><span style="color: #268bd2">g</span><span class="p">),</span> <span style="color: #cb4b16">uint8</span><span class="p">(</span><span style="color: #268bd2">b</span><span class="p">),</span> <span style="color: #cb4b16">uint8</span><span class="p">(</span><span style="color: #268bd2">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #268bd2">file</span><span class="p">,</span> <span style="color: #268bd2">err</span> <span class="o">:=</span> <span style="color: #268bd2">os</span><span class="p">.</span><span style="color: #268bd2">Create</span><span class="p">(</span><span style="color: #2aa198">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #859900">if</span> <span style="color: #268bd2">err</span> <span class="o">!=</span> <span style="color: #859900; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #268bd2">fmt</span><span class="p">.</span><span style="color: #268bd2">Println</span><span class="p">(</span><span style="color: #2aa198">&#34;Error creating file:&#34;</span><span class="p">,</span> <span style="color: #268bd2">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #859900">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #859900">defer</span> <span style="color: #268bd2">file</span><span class="p">.</span><span style="color: #268bd2">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #268bd2">err</span> <span class="p">=</span> <span style="color: #268bd2">png</span><span class="p">.</span><span style="color: #268bd2">Encode</span><span class="p">(</span><span style="color: #268bd2">file</span><span class="p">,</span> <span style="color: #268bd2">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #859900">if</span> <span style="color: #268bd2">err</span> <span class="o">!=</span> <span style="color: #859900; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #268bd2">fmt</span><span class="p">.</span><span style="color: #268bd2">Println</span><span class="p">(</span><span style="color: #2aa198">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span style="color: #268bd2">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='swapoff'><h2><a id='stylelink' href='swapoff.html' alt='View only swapoff'>swapoff</a></h2></a><code><pre style="color: #e5e5e5; background-color: #000000;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #ffffff; font-weight: bold">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #007f7f">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #007f7f"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #007f7f"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #007f7f"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ffffff; font-weight: bold">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #00ffff; font-weight: bold">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #00ffff; font-weight: bold">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #00ffff; font-weight: bold">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #00ffff; font-weight: bold">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #00ffff; font-weight: bold">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #00ffff; font-weight: bold">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #00ffff; font-weight: bold">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ffffff; font-weight: bold">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span style="color: #ffff00; font-weight: bold">1920</span><span class="p">,</span> <span style="color: #ffff00; font-weight: bold">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span style="color: #ffff00; font-weight: bold">3840</span><span class="p">,</span> <span style="color: #ffff00; font-weight: bold">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span style="color: #ffffff; font-weight: bold">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span class="o">/</span> <span style="color: #ffffff; font-weight: bold">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span class="o">/</span> <span style="color: #ffff00; font-weight: bold">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span style="color: #ffff00; font-weight: bold">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span style="color: #ffff00; font-weight: bold">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span style="color: #ffff00; font-weight: bold">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span style="color: #ffff00; font-weight: bold">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ffffff; font-weight: bold">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ffffff; font-weight: bold">type</span> <span class="nx">vec3</span> <span style="color: #ffffff; font-weight: bold">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #ffffff; font-weight: bold">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ffffff; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nf">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #ffffff; font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ffffff; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nf">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #ffffff; font-weight: bold">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #ffffff; font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ffffff; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nf">length</span><span class="p">()</span> <span style="color: #ffffff; font-weight: bold">float64</span>    <span class="p">{</span> <span style="color: #ffffff; font-weight: bold">return</span> <span class="nx">math</span><span class="p">.</span><span class="nf">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ffffff; font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nf">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #ffffff; font-weight: bold">return</span> <span class="nx">v</span><span class="p">.</span><span class="nf">mul</span><span class="p">(</span><span style="color: #ffff00; font-weight: bold">1</span> <span class="o">/</span> <span class="nx">v</span><span class="p">.</span><span class="nf">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ffffff; font-weight: bold">func</span> <span class="nf">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #ffffff; font-weight: bold">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="o">:=</span> <span class="nx">p</span><span class="p">,</span> <span style="color: #ffff00; font-weight: bold">0.0</span><span class="p">,</span> <span style="color: #ffff00; font-weight: bold">0.0</span><span class="p">,</span> <span style="color: #ffff00; font-weight: bold">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ffffff; font-weight: bold">for</span> <span class="nx">i</span> <span class="o">:=</span> <span style="color: #ffff00; font-weight: bold">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span class="nf">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ffffff; font-weight: bold">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ffffff; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nf">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span class="o">/</span><span class="nx">r</span><span class="p">)</span><span class="o">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span class="nf">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="o">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nf">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ffffff; font-weight: bold">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ffffff; font-weight: bold">func</span> <span class="nf">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #ffffff; font-weight: bold">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span class="o">:=</span> <span class="p">(</span><span style="color: #ffff00; font-weight: bold">2</span><span class="o">*</span><span style="color: #ffffff; font-weight: bold">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="o">/</span><span style="color: #ffffff; font-weight: bold">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span class="o">-</span><span style="color: #ffff00; font-weight: bold">1</span><span class="p">)</span><span class="o">*</span><span class="nx">aspectRatio</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Tan</span><span class="p">(</span><span class="nx">fov</span><span class="o">/</span><span style="color: #ffff00; font-weight: bold">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #ffff00; font-weight: bold">1</span><span class="o">-</span><span style="color: #ffff00; font-weight: bold">2</span><span class="o">*</span><span style="color: #ffffff; font-weight: bold">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span class="o">/</span><span style="color: #ffffff; font-weight: bold">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Tan</span><span class="p">(</span><span class="nx">fov</span><span class="o">/</span><span style="color: #ffff00; font-weight: bold">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span class="o">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span class="o">-</span><span style="color: #ffff00; font-weight: bold">1</span><span class="p">}.</span><span class="nf">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span class="o">:=</span> <span style="color: #ffff00; font-weight: bold">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ffffff; font-weight: bold">for</span> <span class="nx">i</span> <span class="o">:=</span> <span style="color: #ffff00; font-weight: bold">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span class="o">:=</span> <span class="nx">direction</span><span class="p">.</span><span class="nf">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span class="nf">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span style="color: #ffff00; font-weight: bold">0</span><span class="p">,</span> <span style="color: #ffff00; font-weight: bold">0</span><span class="p">,</span> <span style="color: #ffff00; font-weight: bold">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span class="o">:=</span> <span class="nf">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="o">-</span> <span style="color: #ffff00; font-weight: bold">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ffffff; font-weight: bold">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span style="color: #ffff00; font-weight: bold">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ffffff; font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span style="color: #ffffff; font-weight: bold">uint8</span><span class="p">(</span><span style="color: #ffff00; font-weight: bold">255</span> <span class="o">-</span> <span class="nx">t</span><span class="o">*</span><span style="color: #ffff00; font-weight: bold">255</span><span class="o">/</span><span style="color: #ffff00; font-weight: bold">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span class="o">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ffffff; font-weight: bold">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span style="color: #ffff00; font-weight: bold">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ffffff; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ffffff; font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ffffff; font-weight: bold">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span class="nf">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span class="nf">Rect</span><span class="p">(</span><span style="color: #ffff00; font-weight: bold">0</span><span class="p">,</span> <span style="color: #ffff00; font-weight: bold">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ffffff; font-weight: bold">for</span> <span class="nx">y</span> <span class="o">:=</span> <span style="color: #ffff00; font-weight: bold">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span style="color: #ffff00; font-weight: bold">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ffffff; font-weight: bold">go</span> <span style="color: #ffffff; font-weight: bold">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #ffffff; font-weight: bold">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ffffff; font-weight: bold">defer</span> <span class="nx">wg</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ffffff; font-weight: bold">for</span> <span class="nx">x</span> <span class="o">:=</span> <span style="color: #ffff00; font-weight: bold">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nf">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span class="nf">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span class="nf">Rect</span><span class="p">(</span><span style="color: #ffff00; font-weight: bold">0</span><span class="p">,</span> <span style="color: #ffff00; font-weight: bold">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ffffff; font-weight: bold">for</span> <span class="nx">y</span> <span class="o">:=</span> <span style="color: #ffff00; font-weight: bold">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ffffff; font-weight: bold">for</span> <span class="nx">x</span> <span class="o">:=</span> <span style="color: #ffff00; font-weight: bold">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span class="o">:=</span> <span style="color: #ffff00; font-weight: bold">0</span><span class="p">,</span> <span style="color: #ffff00; font-weight: bold">0</span><span class="p">,</span> <span style="color: #ffff00; font-weight: bold">0</span><span class="p">,</span> <span style="color: #ffff00; font-weight: bold">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #ffffff; font-weight: bold">for</span> <span class="nx">dy</span> <span class="o">:=</span> <span style="color: #ffff00; font-weight: bold">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #ffffff; font-weight: bold">for</span> <span class="nx">dx</span> <span class="o">:=</span> <span style="color: #ffff00; font-weight: bold">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span class="o">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span class="nf">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span class="o">*</span><span class="nx">supersamplingRatio</span><span class="o">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span class="o">*</span><span class="nx">supersamplingRatio</span><span class="o">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span class="o">+=</span> <span style="color: #ffffff; font-weight: bold">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span class="o">+=</span> <span style="color: #ffffff; font-weight: bold">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span class="o">+=</span> <span style="color: #ffffff; font-weight: bold">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span class="o">+=</span> <span style="color: #ffffff; font-weight: bold">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span style="color: #ffffff; font-weight: bold">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span style="color: #ffffff; font-weight: bold">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span style="color: #ffffff; font-weight: bold">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span style="color: #ffffff; font-weight: bold">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span style="color: #00ffff; font-weight: bold">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ffffff; font-weight: bold">if</span> <span class="nx">err</span> <span class="o">!=</span> <span style="color: #ffffff; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span style="color: #00ffff; font-weight: bold">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #ffffff; font-weight: bold">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ffffff; font-weight: bold">defer</span> <span class="nx">file</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span class="nf">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #ffffff; font-weight: bold">if</span> <span class="nx">err</span> <span class="o">!=</span> <span style="color: #ffffff; font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span style="color: #00ffff; font-weight: bold">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='tango'><h2><a id='stylelink' href='tango.html' alt='View only tango'>tango</a></h2></a><code><pre style="background-color: #f8f8f8;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #204a87; font-weight: bold">package</span> <span style="color: #000000">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #8f5902; font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #8f5902; font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #8f5902; font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #8f5902; font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #204a87; font-weight: bold">import</span> <span style="color: #000000; font-weight: bold">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #4e9a06">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #4e9a06">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #4e9a06">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #4e9a06">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #4e9a06">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #4e9a06">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #4e9a06">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #000000; font-weight: bold">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #204a87; font-weight: bold">const</span> <span style="color: #000000; font-weight: bold">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">width</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">height</span>      <span style="color: #000000; font-weight: bold">=</span> <span style="color: #0000cf; font-weight: bold">1920</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #0000cf; font-weight: bold">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">ssWidth</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">ssHeight</span>  <span style="color: #000000; font-weight: bold">=</span> <span style="color: #0000cf; font-weight: bold">3840</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #0000cf; font-weight: bold">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">aspectRatio</span>        <span style="color: #000000; font-weight: bold">=</span> <span style="color: #204a87">float64</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">ssWidth</span><span style="color: #000000; font-weight: bold">)</span> <span style="color: #ce5c00; font-weight: bold">/</span> <span style="color: #204a87">float64</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">ssHeight</span><span style="color: #000000; font-weight: bold">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">fov</span>                <span style="color: #000000; font-weight: bold">=</span> <span style="color: #000000">math</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">Pi</span> <span style="color: #ce5c00; font-weight: bold">/</span> <span style="color: #0000cf; font-weight: bold">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">maxIter</span>            <span style="color: #000000; font-weight: bold">=</span> <span style="color: #0000cf; font-weight: bold">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">power</span>              <span style="color: #000000; font-weight: bold">=</span> <span style="color: #0000cf; font-weight: bold">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">escapeRadius</span>       <span style="color: #000000; font-weight: bold">=</span> <span style="color: #0000cf; font-weight: bold">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">supersamplingRatio</span> <span style="color: #000000; font-weight: bold">=</span> <span style="color: #0000cf; font-weight: bold">2</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #000000; font-weight: bold">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #204a87; font-weight: bold">var</span> <span style="color: #000000">wg</span> <span style="color: #000000">sync</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #204a87; font-weight: bold">type</span> <span style="color: #000000">vec3</span> <span style="color: #204a87; font-weight: bold">struct</span><span style="color: #000000; font-weight: bold">{</span> <span style="color: #000000">x</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">y</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">z</span> <span style="color: #204a87; font-weight: bold">float64</span> <span style="color: #000000; font-weight: bold">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #204a87; font-weight: bold">func</span> <span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">v</span> <span style="color: #000000">vec3</span><span style="color: #000000; font-weight: bold">)</span> <span style="color: #000000">add</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">w</span> <span style="color: #000000">vec3</span><span style="color: #000000; font-weight: bold">)</span> <span style="color: #000000">vec3</span>    <span style="color: #000000; font-weight: bold">{</span> <span style="color: #204a87; font-weight: bold">return</span> <span style="color: #000000">vec3</span><span style="color: #000000; font-weight: bold">{</span><span style="color: #000000">v</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">x</span> <span style="color: #ce5c00; font-weight: bold">+</span> <span style="color: #000000">w</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">x</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">v</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">y</span> <span style="color: #ce5c00; font-weight: bold">+</span> <span style="color: #000000">w</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">y</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">v</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">z</span> <span style="color: #ce5c00; font-weight: bold">+</span> <span style="color: #000000">w</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">z</span><span style="color: #000000; font-weight: bold">}</span> <span style="color: #000000; font-weight: bold">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #204a87; font-weight: bold">func</span> <span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">v</span> <span style="color: #000000">vec3</span><span style="color: #000000; font-weight: bold">)</span> <span style="color: #000000">mul</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">s</span> <span style="color: #204a87; font-weight: bold">float64</span><span style="color: #000000; font-weight: bold">)</span> <span style="color: #000000">vec3</span> <span style="color: #000000; font-weight: bold">{</span> <span style="color: #204a87; font-weight: bold">return</span> <span style="color: #000000">vec3</span><span style="color: #000000; font-weight: bold">{</span><span style="color: #000000">v</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">x</span> <span style="color: #ce5c00; font-weight: bold">*</span> <span style="color: #000000">s</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">v</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">y</span> <span style="color: #ce5c00; font-weight: bold">*</span> <span style="color: #000000">s</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">v</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">z</span> <span style="color: #ce5c00; font-weight: bold">*</span> <span style="color: #000000">s</span><span style="color: #000000; font-weight: bold">}</span> <span style="color: #000000; font-weight: bold">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #204a87; font-weight: bold">func</span> <span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">v</span> <span style="color: #000000">vec3</span><span style="color: #000000; font-weight: bold">)</span> <span style="color: #000000">length</span><span style="color: #000000; font-weight: bold">()</span> <span style="color: #204a87; font-weight: bold">float64</span>    <span style="color: #000000; font-weight: bold">{</span> <span style="color: #204a87; font-weight: bold">return</span> <span style="color: #000000">math</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">Sqrt</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">v</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">x</span><span style="color: #ce5c00; font-weight: bold">*</span><span style="color: #000000">v</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">x</span> <span style="color: #ce5c00; font-weight: bold">+</span> <span style="color: #000000">v</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">y</span><span style="color: #ce5c00; font-weight: bold">*</span><span style="color: #000000">v</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">y</span> <span style="color: #ce5c00; font-weight: bold">+</span> <span style="color: #000000">v</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">z</span><span style="color: #ce5c00; font-weight: bold">*</span><span style="color: #000000">v</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">z</span><span style="color: #000000; font-weight: bold">)</span> <span style="color: #000000; font-weight: bold">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #204a87; font-weight: bold">func</span> <span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">v</span> <span style="color: #000000">vec3</span><span style="color: #000000; font-weight: bold">)</span> <span style="color: #000000">normalize</span><span style="color: #000000; font-weight: bold">()</span> <span style="color: #000000">vec3</span>    <span style="color: #000000; font-weight: bold">{</span> <span style="color: #204a87; font-weight: bold">return</span> <span style="color: #000000">v</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">mul</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #0000cf; font-weight: bold">1</span> <span style="color: #ce5c00; font-weight: bold">/</span> <span style="color: #000000">v</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">length</span><span style="color: #000000; font-weight: bold">())</span> <span style="color: #000000; font-weight: bold">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #204a87; font-weight: bold">func</span> <span style="color: #000000">mandelbulb</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">p</span> <span style="color: #000000">vec3</span><span style="color: #000000; font-weight: bold">)</span> <span style="color: #204a87; font-weight: bold">float64</span> <span style="color: #000000; font-weight: bold">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">z</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">r</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">theta</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">phi</span> <span style="color: #ce5c00; font-weight: bold">:=</span> <span style="color: #000000">p</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #0000cf; font-weight: bold">0.0</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #0000cf; font-weight: bold">0.0</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #0000cf; font-weight: bold">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #204a87; font-weight: bold">for</span> <span style="color: #000000">i</span> <span style="color: #ce5c00; font-weight: bold">:=</span> <span style="color: #0000cf; font-weight: bold">0</span><span style="color: #000000; font-weight: bold">;</span> <span style="color: #000000">i</span> <span style="color: #000000; font-weight: bold">&lt;</span> <span style="color: #000000">maxIter</span><span style="color: #000000; font-weight: bold">;</span> <span style="color: #000000">i</span><span style="color: #ce5c00; font-weight: bold">++</span> <span style="color: #000000; font-weight: bold">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000">r</span> <span style="color: #000000; font-weight: bold">=</span> <span style="color: #000000">z</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">length</span><span style="color: #000000; font-weight: bold">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #204a87; font-weight: bold">if</span> <span style="color: #000000">r</span> <span style="color: #000000; font-weight: bold">&gt;</span> <span style="color: #000000">escapeRadius</span> <span style="color: #000000; font-weight: bold">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #204a87; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000; font-weight: bold">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000">theta</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">phi</span> <span style="color: #000000; font-weight: bold">=</span> <span style="color: #000000">math</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">Acos</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">z</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">z</span><span style="color: #ce5c00; font-weight: bold">/</span><span style="color: #000000">r</span><span style="color: #000000; font-weight: bold">)</span><span style="color: #ce5c00; font-weight: bold">*</span><span style="color: #000000">power</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">math</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">Atan2</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">z</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">y</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">z</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">x</span><span style="color: #000000; font-weight: bold">)</span><span style="color: #ce5c00; font-weight: bold">*</span><span style="color: #000000">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000">r</span> <span style="color: #000000; font-weight: bold">=</span> <span style="color: #000000">math</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">Pow</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">r</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">power</span><span style="color: #000000; font-weight: bold">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000">z</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">x</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">z</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">y</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">z</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">z</span> <span style="color: #000000; font-weight: bold">=</span> <span style="color: #000000">p</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">x</span><span style="color: #ce5c00; font-weight: bold">+</span><span style="color: #000000">r</span><span style="color: #ce5c00; font-weight: bold">*</span><span style="color: #000000">math</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">Sin</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">theta</span><span style="color: #000000; font-weight: bold">)</span><span style="color: #ce5c00; font-weight: bold">*</span><span style="color: #000000">math</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">Cos</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">phi</span><span style="color: #000000; font-weight: bold">),</span> <span style="color: #000000">p</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">y</span><span style="color: #ce5c00; font-weight: bold">+</span><span style="color: #000000">r</span><span style="color: #ce5c00; font-weight: bold">*</span><span style="color: #000000">math</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">Sin</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">theta</span><span style="color: #000000; font-weight: bold">)</span><span style="color: #ce5c00; font-weight: bold">*</span><span style="color: #000000">math</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">Sin</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">phi</span><span style="color: #000000; font-weight: bold">),</span> <span style="color: #000000">p</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">z</span><span style="color: #ce5c00; font-weight: bold">+</span><span style="color: #000000">r</span><span style="color: #ce5c00; font-weight: bold">*</span><span style="color: #000000">math</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">Cos</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">theta</span><span style="color: #000000; font-weight: bold">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000; font-weight: bold">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #204a87; font-weight: bold">return</span> <span style="color: #000000">r</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #000000; font-weight: bold">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #204a87; font-weight: bold">func</span> <span style="color: #000000">renderPixel</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">x</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">y</span> <span style="color: #204a87; font-weight: bold">int</span><span style="color: #000000; font-weight: bold">)</span> <span style="color: #000000">color</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">Color</span> <span style="color: #000000; font-weight: bold">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">px</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">py</span> <span style="color: #ce5c00; font-weight: bold">:=</span> <span style="color: #000000; font-weight: bold">(</span><span style="color: #0000cf; font-weight: bold">2</span><span style="color: #ce5c00; font-weight: bold">*</span><span style="color: #204a87">float64</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">x</span><span style="color: #000000; font-weight: bold">)</span><span style="color: #ce5c00; font-weight: bold">/</span><span style="color: #204a87">float64</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">ssWidth</span><span style="color: #000000; font-weight: bold">)</span><span style="color: #ce5c00; font-weight: bold">-</span><span style="color: #0000cf; font-weight: bold">1</span><span style="color: #000000; font-weight: bold">)</span><span style="color: #ce5c00; font-weight: bold">*</span><span style="color: #000000">aspectRatio</span><span style="color: #ce5c00; font-weight: bold">*</span><span style="color: #000000">math</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">Tan</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">fov</span><span style="color: #ce5c00; font-weight: bold">/</span><span style="color: #0000cf; font-weight: bold">2</span><span style="color: #000000; font-weight: bold">),</span> <span style="color: #000000; font-weight: bold">(</span><span style="color: #0000cf; font-weight: bold">1</span><span style="color: #ce5c00; font-weight: bold">-</span><span style="color: #0000cf; font-weight: bold">2</span><span style="color: #ce5c00; font-weight: bold">*</span><span style="color: #204a87">float64</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">y</span><span style="color: #000000; font-weight: bold">)</span><span style="color: #ce5c00; font-weight: bold">/</span><span style="color: #204a87">float64</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">ssHeight</span><span style="color: #000000; font-weight: bold">))</span><span style="color: #ce5c00; font-weight: bold">*</span><span style="color: #000000">math</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">Tan</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">fov</span><span style="color: #ce5c00; font-weight: bold">/</span><span style="color: #0000cf; font-weight: bold">2</span><span style="color: #000000; font-weight: bold">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">direction</span> <span style="color: #ce5c00; font-weight: bold">:=</span> <span style="color: #000000">vec3</span><span style="color: #000000; font-weight: bold">{</span><span style="color: #000000">px</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">py</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #ce5c00; font-weight: bold">-</span><span style="color: #0000cf; font-weight: bold">1</span><span style="color: #000000; font-weight: bold">}.</span><span style="color: #000000">normalize</span><span style="color: #000000; font-weight: bold">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">t</span> <span style="color: #ce5c00; font-weight: bold">:=</span> <span style="color: #0000cf; font-weight: bold">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #204a87; font-weight: bold">for</span> <span style="color: #000000">i</span> <span style="color: #ce5c00; font-weight: bold">:=</span> <span style="color: #0000cf; font-weight: bold">0</span><span style="color: #000000; font-weight: bold">;</span> <span style="color: #000000">i</span> <span style="color: #000000; font-weight: bold">&lt;</span> <span style="color: #000000">maxIter</span><span style="color: #000000; font-weight: bold">;</span> <span style="color: #000000">i</span><span style="color: #ce5c00; font-weight: bold">++</span> <span style="color: #000000; font-weight: bold">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000">p</span> <span style="color: #ce5c00; font-weight: bold">:=</span> <span style="color: #000000">direction</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">mul</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">t</span><span style="color: #000000; font-weight: bold">).</span><span style="color: #000000">add</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">vec3</span><span style="color: #000000; font-weight: bold">{</span><span style="color: #0000cf; font-weight: bold">0</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #0000cf; font-weight: bold">0</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #0000cf; font-weight: bold">5</span><span style="color: #000000; font-weight: bold">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000">d</span> <span style="color: #ce5c00; font-weight: bold">:=</span> <span style="color: #000000">mandelbulb</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">p</span><span style="color: #000000; font-weight: bold">)</span> <span style="color: #ce5c00; font-weight: bold">-</span> <span style="color: #0000cf; font-weight: bold">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #204a87; font-weight: bold">if</span> <span style="color: #000000">d</span> <span style="color: #000000; font-weight: bold">&lt;</span> <span style="color: #0000cf; font-weight: bold">0.001</span> <span style="color: #000000; font-weight: bold">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #204a87; font-weight: bold">return</span> <span style="color: #000000">color</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">Gray</span><span style="color: #000000; font-weight: bold">{</span><span style="color: #204a87">uint8</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #0000cf; font-weight: bold">255</span> <span style="color: #ce5c00; font-weight: bold">-</span> <span style="color: #000000">t</span><span style="color: #ce5c00; font-weight: bold">*</span><span style="color: #0000cf; font-weight: bold">255</span><span style="color: #ce5c00; font-weight: bold">/</span><span style="color: #0000cf; font-weight: bold">100</span><span style="color: #000000; font-weight: bold">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000; font-weight: bold">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000">t</span> <span style="color: #ce5c00; font-weight: bold">+=</span> <span style="color: #000000">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #204a87; font-weight: bold">if</span> <span style="color: #000000">t</span> <span style="color: #000000; font-weight: bold">&gt;</span> <span style="color: #0000cf; font-weight: bold">100</span> <span style="color: #000000; font-weight: bold">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #204a87; font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000; font-weight: bold">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000; font-weight: bold">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #204a87; font-weight: bold">return</span> <span style="color: #000000">color</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #000000; font-weight: bold">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #204a87; font-weight: bold">func</span> <span style="color: #000000">main</span><span style="color: #000000; font-weight: bold">()</span> <span style="color: #000000; font-weight: bold">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">ssImg</span> <span style="color: #ce5c00; font-weight: bold">:=</span> <span style="color: #000000">image</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">NewRGBA</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">image</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">Rect</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #0000cf; font-weight: bold">0</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #0000cf; font-weight: bold">0</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">ssWidth</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">ssHeight</span><span style="color: #000000; font-weight: bold">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #204a87; font-weight: bold">for</span> <span style="color: #000000">y</span> <span style="color: #ce5c00; font-weight: bold">:=</span> <span style="color: #0000cf; font-weight: bold">0</span><span style="color: #000000; font-weight: bold">;</span> <span style="color: #000000">y</span> <span style="color: #000000; font-weight: bold">&lt;</span> <span style="color: #000000">ssHeight</span><span style="color: #000000; font-weight: bold">;</span> <span style="color: #000000">y</span><span style="color: #ce5c00; font-weight: bold">++</span> <span style="color: #000000; font-weight: bold">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000">wg</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">Add</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #0000cf; font-weight: bold">1</span><span style="color: #000000; font-weight: bold">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #204a87; font-weight: bold">go</span> <span style="color: #204a87; font-weight: bold">func</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">y</span> <span style="color: #204a87; font-weight: bold">int</span><span style="color: #000000; font-weight: bold">)</span> <span style="color: #000000; font-weight: bold">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #204a87; font-weight: bold">defer</span> <span style="color: #000000">wg</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">Done</span><span style="color: #000000; font-weight: bold">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #204a87; font-weight: bold">for</span> <span style="color: #000000">x</span> <span style="color: #ce5c00; font-weight: bold">:=</span> <span style="color: #0000cf; font-weight: bold">0</span><span style="color: #000000; font-weight: bold">;</span> <span style="color: #000000">x</span> <span style="color: #000000; font-weight: bold">&lt;</span> <span style="color: #000000">ssWidth</span><span style="color: #000000; font-weight: bold">;</span> <span style="color: #000000">x</span><span style="color: #ce5c00; font-weight: bold">++</span> <span style="color: #000000; font-weight: bold">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #000000">ssImg</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">Set</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">x</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">y</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">renderPixel</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">x</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">y</span><span style="color: #000000; font-weight: bold">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000000; font-weight: bold">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000; font-weight: bold">}(</span><span style="color: #000000">y</span><span style="color: #000000; font-weight: bold">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000; font-weight: bold">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">wg</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">Wait</span><span style="color: #000000; font-weight: bold">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">img</span> <span style="color: #ce5c00; font-weight: bold">:=</span> <span style="color: #000000">image</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">NewRGBA</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">image</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">Rect</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #0000cf; font-weight: bold">0</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #0000cf; font-weight: bold">0</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">width</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">height</span><span style="color: #000000; font-weight: bold">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #204a87; font-weight: bold">for</span> <span style="color: #000000">y</span> <span style="color: #ce5c00; font-weight: bold">:=</span> <span style="color: #0000cf; font-weight: bold">0</span><span style="color: #000000; font-weight: bold">;</span> <span style="color: #000000">y</span> <span style="color: #000000; font-weight: bold">&lt;</span> <span style="color: #000000">height</span><span style="color: #000000; font-weight: bold">;</span> <span style="color: #000000">y</span><span style="color: #ce5c00; font-weight: bold">++</span> <span style="color: #000000; font-weight: bold">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #204a87; font-weight: bold">for</span> <span style="color: #000000">x</span> <span style="color: #ce5c00; font-weight: bold">:=</span> <span style="color: #0000cf; font-weight: bold">0</span><span style="color: #000000; font-weight: bold">;</span> <span style="color: #000000">x</span> <span style="color: #000000; font-weight: bold">&lt;</span> <span style="color: #000000">width</span><span style="color: #000000; font-weight: bold">;</span> <span style="color: #000000">x</span><span style="color: #ce5c00; font-weight: bold">++</span> <span style="color: #000000; font-weight: bold">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000000">r</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">g</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">b</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">a</span> <span style="color: #ce5c00; font-weight: bold">:=</span> <span style="color: #0000cf; font-weight: bold">0</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #0000cf; font-weight: bold">0</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #0000cf; font-weight: bold">0</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #0000cf; font-weight: bold">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #204a87; font-weight: bold">for</span> <span style="color: #000000">dy</span> <span style="color: #ce5c00; font-weight: bold">:=</span> <span style="color: #0000cf; font-weight: bold">0</span><span style="color: #000000; font-weight: bold">;</span> <span style="color: #000000">dy</span> <span style="color: #000000; font-weight: bold">&lt;</span> <span style="color: #000000">supersamplingRatio</span><span style="color: #000000; font-weight: bold">;</span> <span style="color: #000000">dy</span><span style="color: #ce5c00; font-weight: bold">++</span> <span style="color: #000000; font-weight: bold">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #204a87; font-weight: bold">for</span> <span style="color: #000000">dx</span> <span style="color: #ce5c00; font-weight: bold">:=</span> <span style="color: #0000cf; font-weight: bold">0</span><span style="color: #000000; font-weight: bold">;</span> <span style="color: #000000">dx</span> <span style="color: #000000; font-weight: bold">&lt;</span> <span style="color: #000000">supersamplingRatio</span><span style="color: #000000; font-weight: bold">;</span> <span style="color: #000000">dx</span><span style="color: #ce5c00; font-weight: bold">++</span> <span style="color: #000000; font-weight: bold">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #000000">c</span> <span style="color: #ce5c00; font-weight: bold">:=</span> <span style="color: #000000">ssImg</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">RGBAAt</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">x</span><span style="color: #ce5c00; font-weight: bold">*</span><span style="color: #000000">supersamplingRatio</span><span style="color: #ce5c00; font-weight: bold">+</span><span style="color: #000000">dx</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">y</span><span style="color: #ce5c00; font-weight: bold">*</span><span style="color: #000000">supersamplingRatio</span><span style="color: #ce5c00; font-weight: bold">+</span><span style="color: #000000">dy</span><span style="color: #000000; font-weight: bold">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #000000">r</span> <span style="color: #ce5c00; font-weight: bold">+=</span> <span style="color: #204a87">int</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">c</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">R</span><span style="color: #000000; font-weight: bold">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #000000">g</span> <span style="color: #ce5c00; font-weight: bold">+=</span> <span style="color: #204a87">int</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">c</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">G</span><span style="color: #000000; font-weight: bold">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #000000">b</span> <span style="color: #ce5c00; font-weight: bold">+=</span> <span style="color: #204a87">int</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">c</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">B</span><span style="color: #000000; font-weight: bold">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #000000">a</span> <span style="color: #ce5c00; font-weight: bold">+=</span> <span style="color: #204a87">int</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">c</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">A</span><span style="color: #000000; font-weight: bold">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #000000; font-weight: bold">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000000; font-weight: bold">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000000">r</span> <span style="color: #ce5c00; font-weight: bold">/=</span> <span style="color: #000000">supersamplingRatio</span> <span style="color: #ce5c00; font-weight: bold">*</span> <span style="color: #000000">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000000">g</span> <span style="color: #ce5c00; font-weight: bold">/=</span> <span style="color: #000000">supersamplingRatio</span> <span style="color: #ce5c00; font-weight: bold">*</span> <span style="color: #000000">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000000">b</span> <span style="color: #ce5c00; font-weight: bold">/=</span> <span style="color: #000000">supersamplingRatio</span> <span style="color: #ce5c00; font-weight: bold">*</span> <span style="color: #000000">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000000">a</span> <span style="color: #ce5c00; font-weight: bold">/=</span> <span style="color: #000000">supersamplingRatio</span> <span style="color: #ce5c00; font-weight: bold">*</span> <span style="color: #000000">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000000">img</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">Set</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">x</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">y</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">color</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">RGBA</span><span style="color: #000000; font-weight: bold">{</span><span style="color: #204a87">uint8</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">r</span><span style="color: #000000; font-weight: bold">),</span> <span style="color: #204a87">uint8</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">g</span><span style="color: #000000; font-weight: bold">),</span> <span style="color: #204a87">uint8</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">b</span><span style="color: #000000; font-weight: bold">),</span> <span style="color: #204a87">uint8</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">a</span><span style="color: #000000; font-weight: bold">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000; font-weight: bold">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000; font-weight: bold">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">file</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">err</span> <span style="color: #ce5c00; font-weight: bold">:=</span> <span style="color: #000000">os</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">Create</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #4e9a06">&#34;mandelbulb.png&#34;</span><span style="color: #000000; font-weight: bold">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #204a87; font-weight: bold">if</span> <span style="color: #000000">err</span> <span style="color: #ce5c00; font-weight: bold">!=</span> <span style="color: #204a87; font-weight: bold">nil</span> <span style="color: #000000; font-weight: bold">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000">fmt</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">Println</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #4e9a06">&#34;Error creating file:&#34;</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">err</span><span style="color: #000000; font-weight: bold">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #204a87; font-weight: bold">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000; font-weight: bold">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #204a87; font-weight: bold">defer</span> <span style="color: #000000">file</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">Close</span><span style="color: #000000; font-weight: bold">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">err</span> <span style="color: #000000; font-weight: bold">=</span> <span style="color: #000000">png</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">Encode</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #000000">file</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">img</span><span style="color: #000000; font-weight: bold">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #204a87; font-weight: bold">if</span> <span style="color: #000000">err</span> <span style="color: #ce5c00; font-weight: bold">!=</span> <span style="color: #204a87; font-weight: bold">nil</span> <span style="color: #000000; font-weight: bold">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000">fmt</span><span style="color: #000000; font-weight: bold">.</span><span style="color: #000000">Println</span><span style="color: #000000; font-weight: bold">(</span><span style="color: #4e9a06">&#34;Error encoding image:&#34;</span><span style="color: #000000; font-weight: bold">,</span> <span style="color: #000000">err</span><span style="color: #000000; font-weight: bold">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000; font-weight: bold">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #000000; font-weight: bold">}</span></span></span></code></pre></code><a name='trac'><h2><a id='stylelink' href='trac.html' alt='View only trac'>trac</a></h2></a><code><pre style="background-color: #ffffff;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="font-weight: bold">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #999988; font-style: italic">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #999988; font-style: italic"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #999988; font-style: italic"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #999988; font-style: italic"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #bb8844">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #bb8844">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #bb8844">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #bb8844">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #bb8844">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #bb8844">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #bb8844">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span style="color: #009999">1920</span><span class="p">,</span> <span style="color: #009999">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span style="color: #009999">3840</span><span class="p">,</span> <span style="color: #009999">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span style="color: #999999">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span style="font-weight: bold">/</span> <span style="color: #999999">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span style="font-weight: bold">/</span> <span style="color: #009999">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span style="color: #009999">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span style="color: #009999">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span style="color: #009999">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span style="color: #009999">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold">type</span> <span class="nx">vec3</span> <span style="font-weight: bold">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #445588; font-weight: bold">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #990000; font-weight: bold">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="font-weight: bold">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="font-weight: bold">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="font-weight: bold">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #990000; font-weight: bold">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #445588; font-weight: bold">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="font-weight: bold">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="font-weight: bold">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="font-weight: bold">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="font-weight: bold">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #990000; font-weight: bold">length</span><span class="p">()</span> <span style="color: #445588; font-weight: bold">float64</span>    <span class="p">{</span> <span style="font-weight: bold">return</span> <span class="nx">math</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span style="font-weight: bold">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="font-weight: bold">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span style="font-weight: bold">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="font-weight: bold">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span style="font-weight: bold">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #990000; font-weight: bold">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="font-weight: bold">return</span> <span class="nx">v</span><span class="p">.</span><span style="color: #990000; font-weight: bold">mul</span><span class="p">(</span><span style="color: #009999">1</span> <span style="font-weight: bold">/</span> <span class="nx">v</span><span class="p">.</span><span style="color: #990000; font-weight: bold">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold">func</span> <span style="color: #990000; font-weight: bold">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #445588; font-weight: bold">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span style="font-weight: bold">:=</span> <span class="nx">p</span><span class="p">,</span> <span style="color: #009999">0.0</span><span class="p">,</span> <span style="color: #009999">0.0</span><span class="p">,</span> <span style="color: #009999">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold">for</span> <span class="nx">i</span> <span style="font-weight: bold">:=</span> <span style="color: #009999">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="font-weight: bold">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span style="color: #990000; font-weight: bold">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="font-weight: bold">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span style="font-weight: bold">/</span><span class="nx">r</span><span class="p">)</span><span style="font-weight: bold">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span style="font-weight: bold">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span style="font-weight: bold">+</span><span class="nx">r</span><span style="font-weight: bold">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="font-weight: bold">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span style="font-weight: bold">+</span><span class="nx">r</span><span style="font-weight: bold">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="font-weight: bold">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span style="font-weight: bold">+</span><span class="nx">r</span><span style="font-weight: bold">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold">func</span> <span style="color: #990000; font-weight: bold">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #445588; font-weight: bold">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span style="font-weight: bold">:=</span> <span class="p">(</span><span style="color: #009999">2</span><span style="font-weight: bold">*</span><span style="color: #999999">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span style="font-weight: bold">/</span><span style="color: #999999">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span style="font-weight: bold">-</span><span style="color: #009999">1</span><span class="p">)</span><span style="font-weight: bold">*</span><span class="nx">aspectRatio</span><span style="font-weight: bold">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="font-weight: bold">/</span><span style="color: #009999">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #009999">1</span><span style="font-weight: bold">-</span><span style="color: #009999">2</span><span style="font-weight: bold">*</span><span style="color: #999999">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span style="font-weight: bold">/</span><span style="color: #999999">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span style="font-weight: bold">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="font-weight: bold">/</span><span style="color: #009999">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span style="font-weight: bold">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span style="font-weight: bold">-</span><span style="color: #009999">1</span><span class="p">}.</span><span style="color: #990000; font-weight: bold">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span style="font-weight: bold">:=</span> <span style="color: #009999">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold">for</span> <span class="nx">i</span> <span style="font-weight: bold">:=</span> <span style="color: #009999">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="font-weight: bold">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span style="font-weight: bold">:=</span> <span class="nx">direction</span><span class="p">.</span><span style="color: #990000; font-weight: bold">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span style="color: #990000; font-weight: bold">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span style="color: #009999">0</span><span class="p">,</span> <span style="color: #009999">0</span><span class="p">,</span> <span style="color: #009999">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span style="font-weight: bold">:=</span> <span style="color: #990000; font-weight: bold">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span style="font-weight: bold">-</span> <span style="color: #009999">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="font-weight: bold">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span style="color: #009999">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span style="color: #999999">uint8</span><span class="p">(</span><span style="color: #009999">255</span> <span style="font-weight: bold">-</span> <span class="nx">t</span><span style="font-weight: bold">*</span><span style="color: #009999">255</span><span style="font-weight: bold">/</span><span style="color: #009999">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span style="font-weight: bold">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="font-weight: bold">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span style="color: #009999">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="font-weight: bold">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="font-weight: bold">func</span> <span style="color: #990000; font-weight: bold">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span style="font-weight: bold">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #990000; font-weight: bold">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Rect</span><span class="p">(</span><span style="color: #009999">0</span><span class="p">,</span> <span style="color: #009999">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold">for</span> <span class="nx">y</span> <span style="font-weight: bold">:=</span> <span style="color: #009999">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span style="font-weight: bold">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Add</span><span class="p">(</span><span style="color: #009999">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="font-weight: bold">go</span> <span style="font-weight: bold">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #445588; font-weight: bold">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="font-weight: bold">defer</span> <span class="nx">wg</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="font-weight: bold">for</span> <span class="nx">x</span> <span style="font-weight: bold">:=</span> <span style="color: #009999">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span style="font-weight: bold">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span style="color: #990000; font-weight: bold">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span style="font-weight: bold">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #990000; font-weight: bold">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Rect</span><span class="p">(</span><span style="color: #009999">0</span><span class="p">,</span> <span style="color: #009999">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold">for</span> <span class="nx">y</span> <span style="font-weight: bold">:=</span> <span style="color: #009999">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span style="font-weight: bold">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="font-weight: bold">for</span> <span class="nx">x</span> <span style="font-weight: bold">:=</span> <span style="color: #009999">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span style="font-weight: bold">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span style="font-weight: bold">:=</span> <span style="color: #009999">0</span><span class="p">,</span> <span style="color: #009999">0</span><span class="p">,</span> <span style="color: #009999">0</span><span class="p">,</span> <span style="color: #009999">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="font-weight: bold">for</span> <span class="nx">dy</span> <span style="font-weight: bold">:=</span> <span style="color: #009999">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span style="font-weight: bold">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="font-weight: bold">for</span> <span class="nx">dx</span> <span style="font-weight: bold">:=</span> <span style="color: #009999">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span style="font-weight: bold">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span style="font-weight: bold">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span style="color: #990000; font-weight: bold">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span style="font-weight: bold">*</span><span class="nx">supersamplingRatio</span><span style="font-weight: bold">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span style="font-weight: bold">*</span><span class="nx">supersamplingRatio</span><span style="font-weight: bold">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span style="font-weight: bold">+=</span> <span style="color: #999999">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span style="font-weight: bold">+=</span> <span style="color: #999999">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span style="font-weight: bold">+=</span> <span style="color: #999999">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span style="font-weight: bold">+=</span> <span style="color: #999999">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span style="font-weight: bold">/=</span> <span class="nx">supersamplingRatio</span> <span style="font-weight: bold">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span style="font-weight: bold">/=</span> <span class="nx">supersamplingRatio</span> <span style="font-weight: bold">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span style="font-weight: bold">/=</span> <span class="nx">supersamplingRatio</span> <span style="font-weight: bold">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span style="font-weight: bold">/=</span> <span class="nx">supersamplingRatio</span> <span style="font-weight: bold">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span style="color: #999999">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span style="color: #999999">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span style="color: #999999">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span style="color: #999999">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span style="font-weight: bold">:=</span> <span class="nx">os</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Create</span><span class="p">(</span><span style="color: #bb8844">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold">if</span> <span class="nx">err</span> <span style="font-weight: bold">!=</span> <span style="font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Println</span><span class="p">(</span><span style="color: #bb8844">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="font-weight: bold">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold">defer</span> <span class="nx">file</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="font-weight: bold">if</span> <span class="nx">err</span> <span style="font-weight: bold">!=</span> <span style="font-weight: bold">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #990000; font-weight: bold">Println</span><span class="p">(</span><span style="color: #bb8844">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='vim'><h2><a id='stylelink' href='vim.html' alt='View only vim'>vim</a></h2></a><code><pre style="color: #cccccc; background-color: #000000;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #cd00cd">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #000080">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #000080"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #000080"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #000080"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #cd00cd">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cd0000">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cd0000">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cd0000">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cd0000">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cd0000">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cd0000">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cd0000">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #00cd00">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span style="color: #cd00cd">1920</span><span class="p">,</span> <span style="color: #cd00cd">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span style="color: #cd00cd">3840</span><span class="p">,</span> <span style="color: #cd00cd">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span style="color: #cd00cd">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span style="color: #3399cc">/</span> <span style="color: #cd00cd">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span style="color: #3399cc">/</span> <span style="color: #cd00cd">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span style="color: #cd00cd">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span style="color: #cd00cd">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span style="color: #cd00cd">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span style="color: #cd00cd">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #00cd00">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #00cd00">type</span> <span class="nx">vec3</span> <span style="color: #00cd00">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #00cd00">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #00cd00">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nf">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #cdcd00">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #3399cc">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #3399cc">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #3399cc">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #00cd00">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nf">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #00cd00">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #cdcd00">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #3399cc">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #3399cc">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #3399cc">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #00cd00">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nf">length</span><span class="p">()</span> <span style="color: #00cd00">float64</span>    <span class="p">{</span> <span style="color: #cdcd00">return</span> <span class="nx">math</span><span class="p">.</span><span class="nf">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span style="color: #3399cc">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #3399cc">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span style="color: #3399cc">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #3399cc">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span style="color: #3399cc">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #00cd00">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nf">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #cdcd00">return</span> <span class="nx">v</span><span class="p">.</span><span class="nf">mul</span><span class="p">(</span><span style="color: #cd00cd">1</span> <span style="color: #3399cc">/</span> <span class="nx">v</span><span class="p">.</span><span class="nf">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #00cd00">func</span> <span class="nf">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #00cd00">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span style="color: #3399cc">:=</span> <span class="nx">p</span><span class="p">,</span> <span style="color: #cd00cd">0.0</span><span class="p">,</span> <span style="color: #cd00cd">0.0</span><span class="p">,</span> <span style="color: #cd00cd">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cdcd00">for</span> <span class="nx">i</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #3399cc">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span class="nf">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #cdcd00">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #cdcd00">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nf">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span style="color: #3399cc">/</span><span class="nx">r</span><span class="p">)</span><span style="color: #3399cc">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span class="nf">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span style="color: #3399cc">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nf">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span style="color: #3399cc">+</span><span class="nx">r</span><span style="color: #3399cc">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #3399cc">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span style="color: #3399cc">+</span><span class="nx">r</span><span style="color: #3399cc">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #3399cc">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span style="color: #3399cc">+</span><span class="nx">r</span><span style="color: #3399cc">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cdcd00">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #00cd00">func</span> <span class="nf">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #00cd00">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span style="color: #3399cc">:=</span> <span class="p">(</span><span style="color: #cd00cd">2</span><span style="color: #3399cc">*</span><span style="color: #cd00cd">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span style="color: #3399cc">/</span><span style="color: #cd00cd">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span style="color: #3399cc">-</span><span style="color: #cd00cd">1</span><span class="p">)</span><span style="color: #3399cc">*</span><span class="nx">aspectRatio</span><span style="color: #3399cc">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #3399cc">/</span><span style="color: #cd00cd">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #cd00cd">1</span><span style="color: #3399cc">-</span><span style="color: #cd00cd">2</span><span style="color: #3399cc">*</span><span style="color: #cd00cd">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span style="color: #3399cc">/</span><span style="color: #cd00cd">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span style="color: #3399cc">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #3399cc">/</span><span style="color: #cd00cd">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span style="color: #3399cc">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span style="color: #3399cc">-</span><span style="color: #cd00cd">1</span><span class="p">}.</span><span class="nf">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cdcd00">for</span> <span class="nx">i</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #3399cc">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span style="color: #3399cc">:=</span> <span class="nx">direction</span><span class="p">.</span><span class="nf">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span class="nf">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span style="color: #cd00cd">0</span><span class="p">,</span> <span style="color: #cd00cd">0</span><span class="p">,</span> <span style="color: #cd00cd">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span style="color: #3399cc">:=</span> <span class="nf">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span style="color: #3399cc">-</span> <span style="color: #cd00cd">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #cdcd00">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span style="color: #cd00cd">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #cdcd00">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span style="color: #cd00cd">uint8</span><span class="p">(</span><span style="color: #cd00cd">255</span> <span style="color: #3399cc">-</span> <span class="nx">t</span><span style="color: #3399cc">*</span><span style="color: #cd00cd">255</span><span style="color: #3399cc">/</span><span style="color: #cd00cd">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span style="color: #3399cc">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #cdcd00">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span style="color: #cd00cd">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #cdcd00">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cdcd00">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #00cd00">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span style="color: #3399cc">:=</span> <span class="nx">image</span><span class="p">.</span><span class="nf">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span class="nf">Rect</span><span class="p">(</span><span style="color: #cd00cd">0</span><span class="p">,</span> <span style="color: #cd00cd">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cdcd00">for</span> <span class="nx">y</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span style="color: #3399cc">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span style="color: #cd00cd">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #cdcd00">go</span> <span style="color: #00cd00">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #00cd00">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #cdcd00">defer</span> <span class="nx">wg</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #cdcd00">for</span> <span class="nx">x</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span style="color: #3399cc">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nf">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span style="color: #3399cc">:=</span> <span class="nx">image</span><span class="p">.</span><span class="nf">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span class="nf">Rect</span><span class="p">(</span><span style="color: #cd00cd">0</span><span class="p">,</span> <span style="color: #cd00cd">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cdcd00">for</span> <span class="nx">y</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span style="color: #3399cc">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #cdcd00">for</span> <span class="nx">x</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span style="color: #3399cc">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">0</span><span class="p">,</span> <span style="color: #cd00cd">0</span><span class="p">,</span> <span style="color: #cd00cd">0</span><span class="p">,</span> <span style="color: #cd00cd">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #cdcd00">for</span> <span class="nx">dy</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span style="color: #3399cc">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #cdcd00">for</span> <span class="nx">dx</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span style="color: #3399cc">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span style="color: #3399cc">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span class="nf">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span style="color: #3399cc">*</span><span class="nx">supersamplingRatio</span><span style="color: #3399cc">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span style="color: #3399cc">*</span><span class="nx">supersamplingRatio</span><span style="color: #3399cc">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span style="color: #3399cc">+=</span> <span style="color: #cd00cd">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span style="color: #3399cc">+=</span> <span style="color: #cd00cd">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span style="color: #3399cc">+=</span> <span style="color: #cd00cd">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span style="color: #3399cc">+=</span> <span style="color: #cd00cd">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span style="color: #3399cc">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #3399cc">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span style="color: #3399cc">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #3399cc">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span style="color: #3399cc">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #3399cc">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span style="color: #3399cc">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #3399cc">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span style="color: #cd00cd">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span style="color: #cd00cd">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span style="color: #cd00cd">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span style="color: #cd00cd">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span style="color: #3399cc">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span style="color: #cd0000">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cdcd00">if</span> <span class="nx">err</span> <span style="color: #3399cc">!=</span> <span style="color: #cdcd00">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span style="color: #cd0000">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #cdcd00">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cdcd00">defer</span> <span class="nx">file</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span class="nf">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #cdcd00">if</span> <span class="nx">err</span> <span style="color: #3399cc">!=</span> <span style="color: #cdcd00">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span style="color: #cd0000">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='vs'><h2><a id='stylelink' href='vs.html' alt='View only vs'>vs</a></h2></a><code><pre style="background-color: #ffffff;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #0000ff">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #008000">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #008000"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #008000"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #008000"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a31515">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a31515">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a31515">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a31515">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a31515">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a31515">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a31515">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span class="mi">1920</span><span class="p">,</span> <span class="mi">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span class="mi">3840</span><span class="p">,</span> <span class="mi">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span class="nb">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span class="o">/</span> <span class="mi">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span class="mi">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span class="mi">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span class="mf">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span class="mi">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">type</span> <span class="nx">vec3</span> <span style="color: #0000ff">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #2b91af">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nf">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #0000ff">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nf">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #2b91af">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #0000ff">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nf">length</span><span class="p">()</span> <span style="color: #2b91af">float64</span>    <span class="p">{</span> <span style="color: #0000ff">return</span> <span class="nx">math</span><span class="p">.</span><span class="nf">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nf">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #0000ff">return</span> <span class="nx">v</span><span class="p">.</span><span class="nf">mul</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="nx">v</span><span class="p">.</span><span class="nf">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">func</span> <span class="nf">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #2b91af">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="o">:=</span> <span class="nx">p</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span class="nf">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000ff">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #0000ff">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nf">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span class="o">/</span><span class="nx">r</span><span class="p">)</span><span class="o">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span class="nf">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="o">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nf">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">func</span> <span class="nf">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #2b91af">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span class="o">:=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nb">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="o">/</span><span class="nb">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nx">aspectRatio</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Tan</span><span class="p">(</span><span class="nx">fov</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="nb">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span class="o">/</span><span class="nb">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nf">Tan</span><span class="p">(</span><span class="nx">fov</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span class="o">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">}.</span><span class="nf">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span class="o">:=</span> <span class="mf">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span class="o">:=</span> <span class="nx">direction</span><span class="p">.</span><span class="nf">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span class="nf">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span class="o">:=</span> <span class="nf">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000ff">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span class="mf">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #0000ff">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span class="nb">uint8</span><span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">t</span><span class="o">*</span><span class="mi">255</span><span class="o">/</span><span class="mi">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span class="o">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000ff">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span class="mi">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #0000ff">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #0000ff">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span class="nf">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span class="nf">Rect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">for</span> <span class="nx">y</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000ff">go</span> <span style="color: #0000ff">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #2b91af">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #0000ff">defer</span> <span class="nx">wg</span><span class="p">.</span><span class="nf">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #0000ff">for</span> <span class="nx">x</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nf">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span class="nf">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span class="nf">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span class="nf">Rect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">for</span> <span class="nx">y</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000ff">for</span> <span class="nx">x</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #0000ff">for</span> <span class="nx">dy</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #0000ff">for</span> <span class="nx">dx</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span class="o">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span class="nf">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span class="o">*</span><span class="nx">supersamplingRatio</span><span class="o">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span class="o">*</span><span class="nx">supersamplingRatio</span><span class="o">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span class="nb">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span style="color: #a31515">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">if</span> <span class="nx">err</span> <span class="o">!=</span> <span style="color: #0000ff">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span style="color: #a31515">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #0000ff">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">defer</span> <span class="nx">file</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span class="nf">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #0000ff">if</span> <span class="nx">err</span> <span class="o">!=</span> <span style="color: #0000ff">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span style="color: #a31515">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='vulcan'><h2><a id='stylelink' href='vulcan.html' alt='View only vulcan'>vulcan</a></h2></a><code><pre style="color: #c9c9c9; background-color: #282c34;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #bc74c4">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #3e4460">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #3e4460"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #3e4460"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #3e4460"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #bc74c4">import</span> <span style="color: #56b6c2">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #82cc6a">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #82cc6a">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #82cc6a">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #82cc6a">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #82cc6a">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #82cc6a">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #82cc6a">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #56b6c2">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #7fbaf5">const</span> <span style="color: #56b6c2">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span style="color: #56b6c2">,</span> <span class="nx">height</span>      <span style="color: #56b6c2">=</span> <span style="color: #56b6c2">1920</span><span style="color: #56b6c2">,</span> <span style="color: #56b6c2">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span style="color: #56b6c2">,</span> <span class="nx">ssHeight</span>  <span style="color: #56b6c2">=</span> <span style="color: #56b6c2">3840</span><span style="color: #56b6c2">,</span> <span style="color: #56b6c2">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span style="color: #56b6c2">=</span> <span style="color: #7fbaf5">float64</span><span style="color: #56b6c2">(</span><span class="nx">ssWidth</span><span style="color: #56b6c2">)</span> <span style="color: #bc74c4">/</span> <span style="color: #7fbaf5">float64</span><span style="color: #56b6c2">(</span><span class="nx">ssHeight</span><span style="color: #56b6c2">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span style="color: #56b6c2">=</span> <span class="nx">math</span><span style="color: #56b6c2">.</span><span class="nx">Pi</span> <span style="color: #bc74c4">/</span> <span style="color: #56b6c2">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span style="color: #56b6c2">=</span> <span style="color: #56b6c2">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span style="color: #56b6c2">=</span> <span style="color: #56b6c2">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span style="color: #56b6c2">=</span> <span style="color: #56b6c2">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span style="color: #56b6c2">=</span> <span style="color: #56b6c2">2</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #56b6c2">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #7fbaf5">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span style="color: #56b6c2">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #7fbaf5">type</span> <span class="nx">vec3</span> <span style="color: #7fbaf5">struct</span><span style="color: #56b6c2">{</span> <span class="nx">x</span><span style="color: #56b6c2">,</span> <span class="nx">y</span><span style="color: #56b6c2">,</span> <span class="nx">z</span> <span style="color: #57c7ff; font-weight: bold">float64</span> <span style="color: #56b6c2">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #7fbaf5">func</span> <span style="color: #56b6c2">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #56b6c2">)</span> <span style="color: #57c7ff">add</span><span style="color: #56b6c2">(</span><span class="nx">w</span> <span class="nx">vec3</span><span style="color: #56b6c2">)</span> <span class="nx">vec3</span>    <span style="color: #56b6c2">{</span> <span style="color: #7fbaf5">return</span> <span class="nx">vec3</span><span style="color: #56b6c2">{</span><span class="nx">v</span><span style="color: #56b6c2">.</span><span class="nx">x</span> <span style="color: #bc74c4">+</span> <span class="nx">w</span><span style="color: #56b6c2">.</span><span class="nx">x</span><span style="color: #56b6c2">,</span> <span class="nx">v</span><span style="color: #56b6c2">.</span><span class="nx">y</span> <span style="color: #bc74c4">+</span> <span class="nx">w</span><span style="color: #56b6c2">.</span><span class="nx">y</span><span style="color: #56b6c2">,</span> <span class="nx">v</span><span style="color: #56b6c2">.</span><span class="nx">z</span> <span style="color: #bc74c4">+</span> <span class="nx">w</span><span style="color: #56b6c2">.</span><span class="nx">z</span><span style="color: #56b6c2">}</span> <span style="color: #56b6c2">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #7fbaf5">func</span> <span style="color: #56b6c2">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #56b6c2">)</span> <span style="color: #57c7ff">mul</span><span style="color: #56b6c2">(</span><span class="nx">s</span> <span style="color: #57c7ff; font-weight: bold">float64</span><span style="color: #56b6c2">)</span> <span class="nx">vec3</span> <span style="color: #56b6c2">{</span> <span style="color: #7fbaf5">return</span> <span class="nx">vec3</span><span style="color: #56b6c2">{</span><span class="nx">v</span><span style="color: #56b6c2">.</span><span class="nx">x</span> <span style="color: #bc74c4">*</span> <span class="nx">s</span><span style="color: #56b6c2">,</span> <span class="nx">v</span><span style="color: #56b6c2">.</span><span class="nx">y</span> <span style="color: #bc74c4">*</span> <span class="nx">s</span><span style="color: #56b6c2">,</span> <span class="nx">v</span><span style="color: #56b6c2">.</span><span class="nx">z</span> <span style="color: #bc74c4">*</span> <span class="nx">s</span><span style="color: #56b6c2">}</span> <span style="color: #56b6c2">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #7fbaf5">func</span> <span style="color: #56b6c2">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #56b6c2">)</span> <span style="color: #57c7ff">length</span><span style="color: #56b6c2">()</span> <span style="color: #57c7ff; font-weight: bold">float64</span>    <span style="color: #56b6c2">{</span> <span style="color: #7fbaf5">return</span> <span class="nx">math</span><span style="color: #56b6c2">.</span><span style="color: #57c7ff">Sqrt</span><span style="color: #56b6c2">(</span><span class="nx">v</span><span style="color: #56b6c2">.</span><span class="nx">x</span><span style="color: #bc74c4">*</span><span class="nx">v</span><span style="color: #56b6c2">.</span><span class="nx">x</span> <span style="color: #bc74c4">+</span> <span class="nx">v</span><span style="color: #56b6c2">.</span><span class="nx">y</span><span style="color: #bc74c4">*</span><span class="nx">v</span><span style="color: #56b6c2">.</span><span class="nx">y</span> <span style="color: #bc74c4">+</span> <span class="nx">v</span><span style="color: #56b6c2">.</span><span class="nx">z</span><span style="color: #bc74c4">*</span><span class="nx">v</span><span style="color: #56b6c2">.</span><span class="nx">z</span><span style="color: #56b6c2">)</span> <span style="color: #56b6c2">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #7fbaf5">func</span> <span style="color: #56b6c2">(</span><span class="nx">v</span> <span class="nx">vec3</span><span style="color: #56b6c2">)</span> <span style="color: #57c7ff">normalize</span><span style="color: #56b6c2">()</span> <span class="nx">vec3</span>    <span style="color: #56b6c2">{</span> <span style="color: #7fbaf5">return</span> <span class="nx">v</span><span style="color: #56b6c2">.</span><span style="color: #57c7ff">mul</span><span style="color: #56b6c2">(</span><span style="color: #56b6c2">1</span> <span style="color: #bc74c4">/</span> <span class="nx">v</span><span style="color: #56b6c2">.</span><span style="color: #57c7ff">length</span><span style="color: #56b6c2">())</span> <span style="color: #56b6c2">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #7fbaf5">func</span> <span style="color: #57c7ff">mandelbulb</span><span style="color: #56b6c2">(</span><span class="nx">p</span> <span class="nx">vec3</span><span style="color: #56b6c2">)</span> <span style="color: #57c7ff; font-weight: bold">float64</span> <span style="color: #56b6c2">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span style="color: #56b6c2">,</span> <span class="nx">r</span><span style="color: #56b6c2">,</span> <span class="nx">theta</span><span style="color: #56b6c2">,</span> <span class="nx">phi</span> <span style="color: #bc74c4">:=</span> <span class="nx">p</span><span style="color: #56b6c2">,</span> <span style="color: #56b6c2">0.0</span><span style="color: #56b6c2">,</span> <span style="color: #56b6c2">0.0</span><span style="color: #56b6c2">,</span> <span style="color: #56b6c2">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #7fbaf5">for</span> <span class="nx">i</span> <span style="color: #bc74c4">:=</span> <span style="color: #56b6c2">0</span><span style="color: #56b6c2">;</span> <span class="nx">i</span> <span style="color: #56b6c2">&lt;</span> <span class="nx">maxIter</span><span style="color: #56b6c2">;</span> <span class="nx">i</span><span style="color: #bc74c4">++</span> <span style="color: #56b6c2">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span style="color: #56b6c2">=</span> <span class="nx">z</span><span style="color: #56b6c2">.</span><span style="color: #57c7ff">length</span><span style="color: #56b6c2">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #7fbaf5">if</span> <span class="nx">r</span> <span style="color: #56b6c2">&gt;</span> <span class="nx">escapeRadius</span> <span style="color: #56b6c2">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #7fbaf5">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #56b6c2">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span style="color: #56b6c2">,</span> <span class="nx">phi</span> <span style="color: #56b6c2">=</span> <span class="nx">math</span><span style="color: #56b6c2">.</span><span style="color: #57c7ff">Acos</span><span style="color: #56b6c2">(</span><span class="nx">z</span><span style="color: #56b6c2">.</span><span class="nx">z</span><span style="color: #bc74c4">/</span><span class="nx">r</span><span style="color: #56b6c2">)</span><span style="color: #bc74c4">*</span><span class="nx">power</span><span style="color: #56b6c2">,</span> <span class="nx">math</span><span style="color: #56b6c2">.</span><span style="color: #57c7ff">Atan2</span><span style="color: #56b6c2">(</span><span class="nx">z</span><span style="color: #56b6c2">.</span><span class="nx">y</span><span style="color: #56b6c2">,</span> <span class="nx">z</span><span style="color: #56b6c2">.</span><span class="nx">x</span><span style="color: #56b6c2">)</span><span style="color: #bc74c4">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span style="color: #56b6c2">=</span> <span class="nx">math</span><span style="color: #56b6c2">.</span><span style="color: #57c7ff">Pow</span><span style="color: #56b6c2">(</span><span class="nx">r</span><span style="color: #56b6c2">,</span> <span class="nx">power</span><span style="color: #56b6c2">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span style="color: #56b6c2">.</span><span class="nx">x</span><span style="color: #56b6c2">,</span> <span class="nx">z</span><span style="color: #56b6c2">.</span><span class="nx">y</span><span style="color: #56b6c2">,</span> <span class="nx">z</span><span style="color: #56b6c2">.</span><span class="nx">z</span> <span style="color: #56b6c2">=</span> <span class="nx">p</span><span style="color: #56b6c2">.</span><span class="nx">x</span><span style="color: #bc74c4">+</span><span class="nx">r</span><span style="color: #bc74c4">*</span><span class="nx">math</span><span style="color: #56b6c2">.</span><span style="color: #57c7ff">Sin</span><span style="color: #56b6c2">(</span><span class="nx">theta</span><span style="color: #56b6c2">)</span><span style="color: #bc74c4">*</span><span class="nx">math</span><span style="color: #56b6c2">.</span><span style="color: #57c7ff">Cos</span><span style="color: #56b6c2">(</span><span class="nx">phi</span><span style="color: #56b6c2">),</span> <span class="nx">p</span><span style="color: #56b6c2">.</span><span class="nx">y</span><span style="color: #bc74c4">+</span><span class="nx">r</span><span style="color: #bc74c4">*</span><span class="nx">math</span><span style="color: #56b6c2">.</span><span style="color: #57c7ff">Sin</span><span style="color: #56b6c2">(</span><span class="nx">theta</span><span style="color: #56b6c2">)</span><span style="color: #bc74c4">*</span><span class="nx">math</span><span style="color: #56b6c2">.</span><span style="color: #57c7ff">Sin</span><span style="color: #56b6c2">(</span><span class="nx">phi</span><span style="color: #56b6c2">),</span> <span class="nx">p</span><span style="color: #56b6c2">.</span><span class="nx">z</span><span style="color: #bc74c4">+</span><span class="nx">r</span><span style="color: #bc74c4">*</span><span class="nx">math</span><span style="color: #56b6c2">.</span><span style="color: #57c7ff">Cos</span><span style="color: #56b6c2">(</span><span class="nx">theta</span><span style="color: #56b6c2">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #56b6c2">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #7fbaf5">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #56b6c2">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #7fbaf5">func</span> <span style="color: #57c7ff">renderPixel</span><span style="color: #56b6c2">(</span><span class="nx">x</span><span style="color: #56b6c2">,</span> <span class="nx">y</span> <span style="color: #57c7ff; font-weight: bold">int</span><span style="color: #56b6c2">)</span> <span class="nx">color</span><span style="color: #56b6c2">.</span><span class="nx">Color</span> <span style="color: #56b6c2">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span style="color: #56b6c2">,</span> <span class="nx">py</span> <span style="color: #bc74c4">:=</span> <span style="color: #56b6c2">(</span><span style="color: #56b6c2">2</span><span style="color: #bc74c4">*</span><span style="color: #7fbaf5">float64</span><span style="color: #56b6c2">(</span><span class="nx">x</span><span style="color: #56b6c2">)</span><span style="color: #bc74c4">/</span><span style="color: #7fbaf5">float64</span><span style="color: #56b6c2">(</span><span class="nx">ssWidth</span><span style="color: #56b6c2">)</span><span style="color: #bc74c4">-</span><span style="color: #56b6c2">1</span><span style="color: #56b6c2">)</span><span style="color: #bc74c4">*</span><span class="nx">aspectRatio</span><span style="color: #bc74c4">*</span><span class="nx">math</span><span style="color: #56b6c2">.</span><span style="color: #57c7ff">Tan</span><span style="color: #56b6c2">(</span><span class="nx">fov</span><span style="color: #bc74c4">/</span><span style="color: #56b6c2">2</span><span style="color: #56b6c2">),</span> <span style="color: #56b6c2">(</span><span style="color: #56b6c2">1</span><span style="color: #bc74c4">-</span><span style="color: #56b6c2">2</span><span style="color: #bc74c4">*</span><span style="color: #7fbaf5">float64</span><span style="color: #56b6c2">(</span><span class="nx">y</span><span style="color: #56b6c2">)</span><span style="color: #bc74c4">/</span><span style="color: #7fbaf5">float64</span><span style="color: #56b6c2">(</span><span class="nx">ssHeight</span><span style="color: #56b6c2">))</span><span style="color: #bc74c4">*</span><span class="nx">math</span><span style="color: #56b6c2">.</span><span style="color: #57c7ff">Tan</span><span style="color: #56b6c2">(</span><span class="nx">fov</span><span style="color: #bc74c4">/</span><span style="color: #56b6c2">2</span><span style="color: #56b6c2">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span style="color: #bc74c4">:=</span> <span class="nx">vec3</span><span style="color: #56b6c2">{</span><span class="nx">px</span><span style="color: #56b6c2">,</span> <span class="nx">py</span><span style="color: #56b6c2">,</span> <span style="color: #bc74c4">-</span><span style="color: #56b6c2">1</span><span style="color: #56b6c2">}.</span><span style="color: #57c7ff">normalize</span><span style="color: #56b6c2">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span style="color: #bc74c4">:=</span> <span style="color: #56b6c2">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #7fbaf5">for</span> <span class="nx">i</span> <span style="color: #bc74c4">:=</span> <span style="color: #56b6c2">0</span><span style="color: #56b6c2">;</span> <span class="nx">i</span> <span style="color: #56b6c2">&lt;</span> <span class="nx">maxIter</span><span style="color: #56b6c2">;</span> <span class="nx">i</span><span style="color: #bc74c4">++</span> <span style="color: #56b6c2">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span style="color: #bc74c4">:=</span> <span class="nx">direction</span><span style="color: #56b6c2">.</span><span style="color: #57c7ff">mul</span><span style="color: #56b6c2">(</span><span class="nx">t</span><span style="color: #56b6c2">).</span><span style="color: #57c7ff">add</span><span style="color: #56b6c2">(</span><span class="nx">vec3</span><span style="color: #56b6c2">{</span><span style="color: #56b6c2">0</span><span style="color: #56b6c2">,</span> <span style="color: #56b6c2">0</span><span style="color: #56b6c2">,</span> <span style="color: #56b6c2">5</span><span style="color: #56b6c2">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span style="color: #bc74c4">:=</span> <span style="color: #57c7ff">mandelbulb</span><span style="color: #56b6c2">(</span><span class="nx">p</span><span style="color: #56b6c2">)</span> <span style="color: #bc74c4">-</span> <span style="color: #56b6c2">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #7fbaf5">if</span> <span class="nx">d</span> <span style="color: #56b6c2">&lt;</span> <span style="color: #56b6c2">0.001</span> <span style="color: #56b6c2">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #7fbaf5">return</span> <span class="nx">color</span><span style="color: #56b6c2">.</span><span class="nx">Gray</span><span style="color: #56b6c2">{</span><span style="color: #7fbaf5">uint8</span><span style="color: #56b6c2">(</span><span style="color: #56b6c2">255</span> <span style="color: #bc74c4">-</span> <span class="nx">t</span><span style="color: #bc74c4">*</span><span style="color: #56b6c2">255</span><span style="color: #bc74c4">/</span><span style="color: #56b6c2">100</span><span style="color: #56b6c2">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #56b6c2">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span style="color: #bc74c4">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #7fbaf5">if</span> <span class="nx">t</span> <span style="color: #56b6c2">&gt;</span> <span style="color: #56b6c2">100</span> <span style="color: #56b6c2">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #7fbaf5">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #56b6c2">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #56b6c2">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #7fbaf5">return</span> <span class="nx">color</span><span style="color: #56b6c2">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #56b6c2">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #7fbaf5">func</span> <span style="color: #57c7ff">main</span><span style="color: #56b6c2">()</span> <span style="color: #56b6c2">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span style="color: #bc74c4">:=</span> <span class="nx">image</span><span style="color: #56b6c2">.</span><span style="color: #57c7ff">NewRGBA</span><span style="color: #56b6c2">(</span><span class="nx">image</span><span style="color: #56b6c2">.</span><span style="color: #57c7ff">Rect</span><span style="color: #56b6c2">(</span><span style="color: #56b6c2">0</span><span style="color: #56b6c2">,</span> <span style="color: #56b6c2">0</span><span style="color: #56b6c2">,</span> <span class="nx">ssWidth</span><span style="color: #56b6c2">,</span> <span class="nx">ssHeight</span><span style="color: #56b6c2">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #7fbaf5">for</span> <span class="nx">y</span> <span style="color: #bc74c4">:=</span> <span style="color: #56b6c2">0</span><span style="color: #56b6c2">;</span> <span class="nx">y</span> <span style="color: #56b6c2">&lt;</span> <span class="nx">ssHeight</span><span style="color: #56b6c2">;</span> <span class="nx">y</span><span style="color: #bc74c4">++</span> <span style="color: #56b6c2">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span style="color: #56b6c2">.</span><span style="color: #57c7ff">Add</span><span style="color: #56b6c2">(</span><span style="color: #56b6c2">1</span><span style="color: #56b6c2">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #7fbaf5">go</span> <span style="color: #7fbaf5">func</span><span style="color: #56b6c2">(</span><span class="nx">y</span> <span style="color: #57c7ff; font-weight: bold">int</span><span style="color: #56b6c2">)</span> <span style="color: #56b6c2">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #7fbaf5">defer</span> <span class="nx">wg</span><span style="color: #56b6c2">.</span><span style="color: #57c7ff">Done</span><span style="color: #56b6c2">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #7fbaf5">for</span> <span class="nx">x</span> <span style="color: #bc74c4">:=</span> <span style="color: #56b6c2">0</span><span style="color: #56b6c2">;</span> <span class="nx">x</span> <span style="color: #56b6c2">&lt;</span> <span class="nx">ssWidth</span><span style="color: #56b6c2">;</span> <span class="nx">x</span><span style="color: #bc74c4">++</span> <span style="color: #56b6c2">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span style="color: #56b6c2">.</span><span style="color: #57c7ff">Set</span><span style="color: #56b6c2">(</span><span class="nx">x</span><span style="color: #56b6c2">,</span> <span class="nx">y</span><span style="color: #56b6c2">,</span> <span style="color: #57c7ff">renderPixel</span><span style="color: #56b6c2">(</span><span class="nx">x</span><span style="color: #56b6c2">,</span> <span class="nx">y</span><span style="color: #56b6c2">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #56b6c2">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #56b6c2">}(</span><span class="nx">y</span><span style="color: #56b6c2">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #56b6c2">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span style="color: #56b6c2">.</span><span style="color: #57c7ff">Wait</span><span style="color: #56b6c2">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span style="color: #bc74c4">:=</span> <span class="nx">image</span><span style="color: #56b6c2">.</span><span style="color: #57c7ff">NewRGBA</span><span style="color: #56b6c2">(</span><span class="nx">image</span><span style="color: #56b6c2">.</span><span style="color: #57c7ff">Rect</span><span style="color: #56b6c2">(</span><span style="color: #56b6c2">0</span><span style="color: #56b6c2">,</span> <span style="color: #56b6c2">0</span><span style="color: #56b6c2">,</span> <span class="nx">width</span><span style="color: #56b6c2">,</span> <span class="nx">height</span><span style="color: #56b6c2">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #7fbaf5">for</span> <span class="nx">y</span> <span style="color: #bc74c4">:=</span> <span style="color: #56b6c2">0</span><span style="color: #56b6c2">;</span> <span class="nx">y</span> <span style="color: #56b6c2">&lt;</span> <span class="nx">height</span><span style="color: #56b6c2">;</span> <span class="nx">y</span><span style="color: #bc74c4">++</span> <span style="color: #56b6c2">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #7fbaf5">for</span> <span class="nx">x</span> <span style="color: #bc74c4">:=</span> <span style="color: #56b6c2">0</span><span style="color: #56b6c2">;</span> <span class="nx">x</span> <span style="color: #56b6c2">&lt;</span> <span class="nx">width</span><span style="color: #56b6c2">;</span> <span class="nx">x</span><span style="color: #bc74c4">++</span> <span style="color: #56b6c2">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span style="color: #56b6c2">,</span> <span class="nx">g</span><span style="color: #56b6c2">,</span> <span class="nx">b</span><span style="color: #56b6c2">,</span> <span class="nx">a</span> <span style="color: #bc74c4">:=</span> <span style="color: #56b6c2">0</span><span style="color: #56b6c2">,</span> <span style="color: #56b6c2">0</span><span style="color: #56b6c2">,</span> <span style="color: #56b6c2">0</span><span style="color: #56b6c2">,</span> <span style="color: #56b6c2">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #7fbaf5">for</span> <span class="nx">dy</span> <span style="color: #bc74c4">:=</span> <span style="color: #56b6c2">0</span><span style="color: #56b6c2">;</span> <span class="nx">dy</span> <span style="color: #56b6c2">&lt;</span> <span class="nx">supersamplingRatio</span><span style="color: #56b6c2">;</span> <span class="nx">dy</span><span style="color: #bc74c4">++</span> <span style="color: #56b6c2">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #7fbaf5">for</span> <span class="nx">dx</span> <span style="color: #bc74c4">:=</span> <span style="color: #56b6c2">0</span><span style="color: #56b6c2">;</span> <span class="nx">dx</span> <span style="color: #56b6c2">&lt;</span> <span class="nx">supersamplingRatio</span><span style="color: #56b6c2">;</span> <span class="nx">dx</span><span style="color: #bc74c4">++</span> <span style="color: #56b6c2">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span style="color: #bc74c4">:=</span> <span class="nx">ssImg</span><span style="color: #56b6c2">.</span><span style="color: #57c7ff">RGBAAt</span><span style="color: #56b6c2">(</span><span class="nx">x</span><span style="color: #bc74c4">*</span><span class="nx">supersamplingRatio</span><span style="color: #bc74c4">+</span><span class="nx">dx</span><span style="color: #56b6c2">,</span> <span class="nx">y</span><span style="color: #bc74c4">*</span><span class="nx">supersamplingRatio</span><span style="color: #bc74c4">+</span><span class="nx">dy</span><span style="color: #56b6c2">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span style="color: #bc74c4">+=</span> <span style="color: #7fbaf5">int</span><span style="color: #56b6c2">(</span><span class="nx">c</span><span style="color: #56b6c2">.</span><span class="nx">R</span><span style="color: #56b6c2">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span style="color: #bc74c4">+=</span> <span style="color: #7fbaf5">int</span><span style="color: #56b6c2">(</span><span class="nx">c</span><span style="color: #56b6c2">.</span><span class="nx">G</span><span style="color: #56b6c2">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span style="color: #bc74c4">+=</span> <span style="color: #7fbaf5">int</span><span style="color: #56b6c2">(</span><span class="nx">c</span><span style="color: #56b6c2">.</span><span class="nx">B</span><span style="color: #56b6c2">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span style="color: #bc74c4">+=</span> <span style="color: #7fbaf5">int</span><span style="color: #56b6c2">(</span><span class="nx">c</span><span style="color: #56b6c2">.</span><span class="nx">A</span><span style="color: #56b6c2">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #56b6c2">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #56b6c2">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span style="color: #bc74c4">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #bc74c4">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span style="color: #bc74c4">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #bc74c4">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span style="color: #bc74c4">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #bc74c4">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span style="color: #bc74c4">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #bc74c4">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span style="color: #56b6c2">.</span><span style="color: #57c7ff">Set</span><span style="color: #56b6c2">(</span><span class="nx">x</span><span style="color: #56b6c2">,</span> <span class="nx">y</span><span style="color: #56b6c2">,</span> <span class="nx">color</span><span style="color: #56b6c2">.</span><span class="nx">RGBA</span><span style="color: #56b6c2">{</span><span style="color: #7fbaf5">uint8</span><span style="color: #56b6c2">(</span><span class="nx">r</span><span style="color: #56b6c2">),</span> <span style="color: #7fbaf5">uint8</span><span style="color: #56b6c2">(</span><span class="nx">g</span><span style="color: #56b6c2">),</span> <span style="color: #7fbaf5">uint8</span><span style="color: #56b6c2">(</span><span class="nx">b</span><span style="color: #56b6c2">),</span> <span style="color: #7fbaf5">uint8</span><span style="color: #56b6c2">(</span><span class="nx">a</span><span style="color: #56b6c2">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #56b6c2">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #56b6c2">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span style="color: #56b6c2">,</span> <span class="nx">err</span> <span style="color: #bc74c4">:=</span> <span class="nx">os</span><span style="color: #56b6c2">.</span><span style="color: #57c7ff">Create</span><span style="color: #56b6c2">(</span><span style="color: #82cc6a">&#34;mandelbulb.png&#34;</span><span style="color: #56b6c2">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #7fbaf5">if</span> <span class="nx">err</span> <span style="color: #bc74c4">!=</span> <span style="color: #cf5967; background-color: #43454f">nil</span> <span style="color: #56b6c2">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span style="color: #56b6c2">.</span><span style="color: #57c7ff">Println</span><span style="color: #56b6c2">(</span><span style="color: #82cc6a">&#34;Error creating file:&#34;</span><span style="color: #56b6c2">,</span> <span class="nx">err</span><span style="color: #56b6c2">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #7fbaf5">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #56b6c2">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #7fbaf5">defer</span> <span class="nx">file</span><span style="color: #56b6c2">.</span><span style="color: #57c7ff">Close</span><span style="color: #56b6c2">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span style="color: #56b6c2">=</span> <span class="nx">png</span><span style="color: #56b6c2">.</span><span style="color: #57c7ff">Encode</span><span style="color: #56b6c2">(</span><span class="nx">file</span><span style="color: #56b6c2">,</span> <span class="nx">img</span><span style="color: #56b6c2">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #7fbaf5">if</span> <span class="nx">err</span> <span style="color: #bc74c4">!=</span> <span style="color: #cf5967; background-color: #43454f">nil</span> <span style="color: #56b6c2">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span style="color: #56b6c2">.</span><span style="color: #57c7ff">Println</span><span style="color: #56b6c2">(</span><span style="color: #82cc6a">&#34;Error encoding image:&#34;</span><span style="color: #56b6c2">,</span> <span class="nx">err</span><span style="color: #56b6c2">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #56b6c2">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #56b6c2">}</span></span></span></code></pre></code><a name='witchhazel'><h2><a id='stylelink' href='witchhazel.html' alt='View only witchhazel'>witchhazel</a></h2></a><code><pre style="color: #f8f8f2; background-color: #433e56;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #ffb8d1">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #b0bec5">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #b0bec5"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #b0bec5"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #b0bec5"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #ffb8d1">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #1bc5e0">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #1bc5e0">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #1bc5e0">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #1bc5e0">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #1bc5e0">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #1bc5e0">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #1bc5e0">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c2ffdf">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span style="color: #c5a3ff">1920</span><span class="p">,</span> <span style="color: #c5a3ff">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span style="color: #c5a3ff">3840</span><span class="p">,</span> <span style="color: #c5a3ff">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span class="nb">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span style="color: #ffb8d1">/</span> <span class="nb">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span style="color: #ffb8d1">/</span> <span style="color: #c5a3ff">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span style="color: #c5a3ff">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span style="color: #c5a3ff">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span style="color: #c5a3ff">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span style="color: #c5a3ff">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c2ffdf">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c2ffdf">type</span> <span class="nx">vec3</span> <span style="color: #c2ffdf">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #c2ffdf">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c2ffdf">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #ceb1ff">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #c2ffdf">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #ffb8d1">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #ffb8d1">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #ffb8d1">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c2ffdf">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #ceb1ff">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #c2ffdf">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #c2ffdf">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #ffb8d1">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #ffb8d1">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span style="color: #ffb8d1">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c2ffdf">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #ceb1ff">length</span><span class="p">()</span> <span style="color: #c2ffdf">float64</span>    <span class="p">{</span> <span style="color: #c2ffdf">return</span> <span class="nx">math</span><span class="p">.</span><span style="color: #ceb1ff">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span style="color: #ffb8d1">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span style="color: #ffb8d1">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span style="color: #ffb8d1">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span style="color: #ffb8d1">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span style="color: #ffb8d1">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c2ffdf">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #ceb1ff">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #c2ffdf">return</span> <span class="nx">v</span><span class="p">.</span><span style="color: #ceb1ff">mul</span><span class="p">(</span><span style="color: #c5a3ff">1</span> <span style="color: #ffb8d1">/</span> <span class="nx">v</span><span class="p">.</span><span style="color: #ceb1ff">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c2ffdf">func</span> <span style="color: #ceb1ff">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #c2ffdf">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span style="color: #ffb8d1">:=</span> <span class="nx">p</span><span class="p">,</span> <span style="color: #c5a3ff">0.0</span><span class="p">,</span> <span style="color: #c5a3ff">0.0</span><span class="p">,</span> <span style="color: #c5a3ff">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c2ffdf">for</span> <span class="nx">i</span> <span style="color: #ffb8d1">:=</span> <span style="color: #c5a3ff">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #ffb8d1">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span style="color: #ceb1ff">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c2ffdf">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c2ffdf">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #ceb1ff">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span style="color: #ffb8d1">/</span><span class="nx">r</span><span class="p">)</span><span style="color: #ffb8d1">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span style="color: #ceb1ff">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span style="color: #ffb8d1">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #ceb1ff">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span style="color: #ffb8d1">+</span><span class="nx">r</span><span style="color: #ffb8d1">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #ceb1ff">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #ffb8d1">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #ceb1ff">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span style="color: #ffb8d1">+</span><span class="nx">r</span><span style="color: #ffb8d1">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #ceb1ff">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span style="color: #ffb8d1">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #ceb1ff">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span style="color: #ffb8d1">+</span><span class="nx">r</span><span style="color: #ffb8d1">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #ceb1ff">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c2ffdf">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c2ffdf">func</span> <span style="color: #ceb1ff">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #c2ffdf">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span style="color: #ffb8d1">:=</span> <span class="p">(</span><span style="color: #c5a3ff">2</span><span style="color: #ffb8d1">*</span><span class="nb">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span style="color: #ffb8d1">/</span><span class="nb">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span style="color: #ffb8d1">-</span><span style="color: #c5a3ff">1</span><span class="p">)</span><span style="color: #ffb8d1">*</span><span class="nx">aspectRatio</span><span style="color: #ffb8d1">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #ceb1ff">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #ffb8d1">/</span><span style="color: #c5a3ff">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #c5a3ff">1</span><span style="color: #ffb8d1">-</span><span style="color: #c5a3ff">2</span><span style="color: #ffb8d1">*</span><span class="nb">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span style="color: #ffb8d1">/</span><span class="nb">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span style="color: #ffb8d1">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #ceb1ff">Tan</span><span class="p">(</span><span class="nx">fov</span><span style="color: #ffb8d1">/</span><span style="color: #c5a3ff">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span style="color: #ffb8d1">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span style="color: #ffb8d1">-</span><span style="color: #c5a3ff">1</span><span class="p">}.</span><span style="color: #ceb1ff">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span style="color: #ffb8d1">:=</span> <span style="color: #c5a3ff">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c2ffdf">for</span> <span class="nx">i</span> <span style="color: #ffb8d1">:=</span> <span style="color: #c5a3ff">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span style="color: #ffb8d1">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span style="color: #ffb8d1">:=</span> <span class="nx">direction</span><span class="p">.</span><span style="color: #ceb1ff">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span style="color: #ceb1ff">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span style="color: #c5a3ff">0</span><span class="p">,</span> <span style="color: #c5a3ff">0</span><span class="p">,</span> <span style="color: #c5a3ff">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span style="color: #ffb8d1">:=</span> <span style="color: #ceb1ff">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span style="color: #ffb8d1">-</span> <span style="color: #c5a3ff">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c2ffdf">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span style="color: #c5a3ff">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c2ffdf">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span class="nb">uint8</span><span class="p">(</span><span style="color: #c5a3ff">255</span> <span style="color: #ffb8d1">-</span> <span class="nx">t</span><span style="color: #ffb8d1">*</span><span style="color: #c5a3ff">255</span><span style="color: #ffb8d1">/</span><span style="color: #c5a3ff">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span style="color: #ffb8d1">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c2ffdf">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span style="color: #c5a3ff">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c2ffdf">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c2ffdf">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #c2ffdf">func</span> <span style="color: #ceb1ff">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span style="color: #ffb8d1">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #ceb1ff">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #ceb1ff">Rect</span><span class="p">(</span><span style="color: #c5a3ff">0</span><span class="p">,</span> <span style="color: #c5a3ff">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c2ffdf">for</span> <span class="nx">y</span> <span style="color: #ffb8d1">:=</span> <span style="color: #c5a3ff">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span style="color: #ffb8d1">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span style="color: #ceb1ff">Add</span><span class="p">(</span><span style="color: #c5a3ff">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c2ffdf">go</span> <span style="color: #c2ffdf">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #c2ffdf">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c2ffdf">defer</span> <span class="nx">wg</span><span class="p">.</span><span style="color: #ceb1ff">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c2ffdf">for</span> <span class="nx">x</span> <span style="color: #ffb8d1">:=</span> <span style="color: #c5a3ff">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span style="color: #ffb8d1">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span style="color: #ceb1ff">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span style="color: #ceb1ff">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span style="color: #ceb1ff">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span style="color: #ffb8d1">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #ceb1ff">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #ceb1ff">Rect</span><span class="p">(</span><span style="color: #c5a3ff">0</span><span class="p">,</span> <span style="color: #c5a3ff">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c2ffdf">for</span> <span class="nx">y</span> <span style="color: #ffb8d1">:=</span> <span style="color: #c5a3ff">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span style="color: #ffb8d1">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c2ffdf">for</span> <span class="nx">x</span> <span style="color: #ffb8d1">:=</span> <span style="color: #c5a3ff">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span style="color: #ffb8d1">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span style="color: #ffb8d1">:=</span> <span style="color: #c5a3ff">0</span><span class="p">,</span> <span style="color: #c5a3ff">0</span><span class="p">,</span> <span style="color: #c5a3ff">0</span><span class="p">,</span> <span style="color: #c5a3ff">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #c2ffdf">for</span> <span class="nx">dy</span> <span style="color: #ffb8d1">:=</span> <span style="color: #c5a3ff">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span style="color: #ffb8d1">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #c2ffdf">for</span> <span class="nx">dx</span> <span style="color: #ffb8d1">:=</span> <span style="color: #c5a3ff">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span style="color: #ffb8d1">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span style="color: #ffb8d1">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span style="color: #ceb1ff">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span style="color: #ffb8d1">*</span><span class="nx">supersamplingRatio</span><span style="color: #ffb8d1">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span style="color: #ffb8d1">*</span><span class="nx">supersamplingRatio</span><span style="color: #ffb8d1">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span style="color: #ffb8d1">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span style="color: #ffb8d1">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span style="color: #ffb8d1">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span style="color: #ffb8d1">+=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span style="color: #ffb8d1">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #ffb8d1">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span style="color: #ffb8d1">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #ffb8d1">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span style="color: #ffb8d1">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #ffb8d1">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span style="color: #ffb8d1">/=</span> <span class="nx">supersamplingRatio</span> <span style="color: #ffb8d1">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span style="color: #ceb1ff">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span class="nb">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span class="nb">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span style="color: #ffb8d1">:=</span> <span class="nx">os</span><span class="p">.</span><span style="color: #ceb1ff">Create</span><span class="p">(</span><span style="color: #1bc5e0">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c2ffdf">if</span> <span class="nx">err</span> <span style="color: #ffb8d1">!=</span> <span style="color: #c2ffdf">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #ceb1ff">Println</span><span class="p">(</span><span style="color: #1bc5e0">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #c2ffdf">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c2ffdf">defer</span> <span class="nx">file</span><span class="p">.</span><span style="color: #ceb1ff">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span style="color: #ceb1ff">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c2ffdf">if</span> <span class="nx">err</span> <span style="color: #ffb8d1">!=</span> <span style="color: #c2ffdf">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #ceb1ff">Println</span><span class="p">(</span><span style="color: #1bc5e0">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='xcode-dark'><h2><a id='stylelink' href='xcode-dark.html' alt='View only xcode-dark'>xcode-dark</a></h2></a><code><pre style="color: #ffffff; background-color: #1f1f24;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #fc5fa3">package</span> <span class="nx">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #6c7986">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #6c7986"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #6c7986"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #6c7986"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fc5fa3">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fc6a5d">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fc6a5d">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fc6a5d">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fc6a5d">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fc6a5d">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fc6a5d">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fc6a5d">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fc5fa3">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">width</span><span class="p">,</span> <span class="nx">height</span>      <span class="p">=</span> <span style="color: #d0bf69">1920</span><span class="p">,</span> <span style="color: #d0bf69">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span>  <span class="p">=</span> <span style="color: #d0bf69">3840</span><span class="p">,</span> <span style="color: #d0bf69">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">aspectRatio</span>        <span class="p">=</span> <span style="color: #d0a8ff">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span> <span class="o">/</span> <span style="color: #d0a8ff">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">fov</span>                <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span> <span class="o">/</span> <span style="color: #d0bf69">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">maxIter</span>            <span class="p">=</span> <span style="color: #d0bf69">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">power</span>              <span class="p">=</span> <span style="color: #d0bf69">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">escapeRadius</span>       <span class="p">=</span> <span style="color: #d0bf69">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">supersamplingRatio</span> <span class="p">=</span> <span style="color: #d0bf69">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fc5fa3">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fc5fa3">type</span> <span class="nx">vec3</span> <span style="color: #fc5fa3">struct</span><span class="p">{</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span style="color: #fc5fa3">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fc5fa3">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #41a1c0">add</span><span class="p">(</span><span class="nx">w</span> <span class="nx">vec3</span><span class="p">)</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #fc5fa3">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">+</span> <span class="nx">w</span><span class="p">.</span><span class="nx">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fc5fa3">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #41a1c0">mul</span><span class="p">(</span><span class="nx">s</span> <span style="color: #fc5fa3">float64</span><span class="p">)</span> <span class="nx">vec3</span> <span class="p">{</span> <span style="color: #fc5fa3">return</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fc5fa3">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #41a1c0">length</span><span class="p">()</span> <span style="color: #fc5fa3">float64</span>    <span class="p">{</span> <span style="color: #fc5fa3">return</span> <span class="nx">math</span><span class="p">.</span><span style="color: #41a1c0">Sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="o">*</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fc5fa3">func</span> <span class="p">(</span><span class="nx">v</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #41a1c0">normalize</span><span class="p">()</span> <span class="nx">vec3</span>    <span class="p">{</span> <span style="color: #fc5fa3">return</span> <span class="nx">v</span><span class="p">.</span><span style="color: #41a1c0">mul</span><span class="p">(</span><span style="color: #d0bf69">1</span> <span class="o">/</span> <span class="nx">v</span><span class="p">.</span><span style="color: #41a1c0">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fc5fa3">func</span> <span style="color: #41a1c0">mandelbulb</span><span class="p">(</span><span class="nx">p</span> <span class="nx">vec3</span><span class="p">)</span> <span style="color: #fc5fa3">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">z</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="o">:=</span> <span class="nx">p</span><span class="p">,</span> <span style="color: #d0bf69">0.0</span><span class="p">,</span> <span style="color: #d0bf69">0.0</span><span class="p">,</span> <span style="color: #d0bf69">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fc5fa3">for</span> <span class="nx">i</span> <span class="o">:=</span> <span style="color: #d0bf69">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span style="color: #41a1c0">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #fc5fa3">if</span> <span class="nx">r</span> <span class="p">&gt;</span> <span class="nx">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #fc5fa3">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">theta</span><span class="p">,</span> <span class="nx">phi</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #41a1c0">Acos</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">z</span><span class="o">/</span><span class="nx">r</span><span class="p">)</span><span class="o">*</span><span class="nx">power</span><span class="p">,</span> <span class="nx">math</span><span class="p">.</span><span style="color: #41a1c0">Atan2</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span><span class="o">*</span><span class="nx">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">r</span> <span class="p">=</span> <span class="nx">math</span><span class="p">.</span><span style="color: #41a1c0">Pow</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">z</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #41a1c0">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #41a1c0">Cos</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #41a1c0">Sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #41a1c0">Sin</span><span class="p">(</span><span class="nx">phi</span><span class="p">),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span class="o">+</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #41a1c0">Cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fc5fa3">return</span> <span class="nx">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fc5fa3">func</span> <span style="color: #41a1c0">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span style="color: #fc5fa3">int</span><span class="p">)</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">px</span><span class="p">,</span> <span class="nx">py</span> <span class="o">:=</span> <span class="p">(</span><span style="color: #d0bf69">2</span><span class="o">*</span><span style="color: #d0a8ff">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="o">/</span><span style="color: #d0a8ff">float64</span><span class="p">(</span><span class="nx">ssWidth</span><span class="p">)</span><span class="o">-</span><span style="color: #d0bf69">1</span><span class="p">)</span><span class="o">*</span><span class="nx">aspectRatio</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #41a1c0">Tan</span><span class="p">(</span><span class="nx">fov</span><span class="o">/</span><span style="color: #d0bf69">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #d0bf69">1</span><span class="o">-</span><span style="color: #d0bf69">2</span><span class="o">*</span><span style="color: #d0a8ff">float64</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span class="o">/</span><span style="color: #d0a8ff">float64</span><span class="p">(</span><span class="nx">ssHeight</span><span class="p">))</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span style="color: #41a1c0">Tan</span><span class="p">(</span><span class="nx">fov</span><span class="o">/</span><span style="color: #d0bf69">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">direction</span> <span class="o">:=</span> <span class="nx">vec3</span><span class="p">{</span><span class="nx">px</span><span class="p">,</span> <span class="nx">py</span><span class="p">,</span> <span class="o">-</span><span style="color: #d0bf69">1</span><span class="p">}.</span><span style="color: #41a1c0">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">t</span> <span class="o">:=</span> <span style="color: #d0bf69">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fc5fa3">for</span> <span class="nx">i</span> <span class="o">:=</span> <span style="color: #d0bf69">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">maxIter</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">p</span> <span class="o">:=</span> <span class="nx">direction</span><span class="p">.</span><span style="color: #41a1c0">mul</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span style="color: #41a1c0">add</span><span class="p">(</span><span class="nx">vec3</span><span class="p">{</span><span style="color: #d0bf69">0</span><span class="p">,</span> <span style="color: #d0bf69">0</span><span class="p">,</span> <span style="color: #d0bf69">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">d</span> <span class="o">:=</span> <span style="color: #41a1c0">mandelbulb</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="o">-</span> <span style="color: #d0bf69">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #fc5fa3">if</span> <span class="nx">d</span> <span class="p">&lt;</span> <span style="color: #d0bf69">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #fc5fa3">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Gray</span><span class="p">{</span><span style="color: #d0a8ff">uint8</span><span class="p">(</span><span style="color: #d0bf69">255</span> <span class="o">-</span> <span class="nx">t</span><span class="o">*</span><span style="color: #d0bf69">255</span><span class="o">/</span><span style="color: #d0bf69">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">t</span> <span class="o">+=</span> <span class="nx">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #fc5fa3">if</span> <span class="nx">t</span> <span class="p">&gt;</span> <span style="color: #d0bf69">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #fc5fa3">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fc5fa3">return</span> <span class="nx">color</span><span class="p">.</span><span class="nx">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #fc5fa3">func</span> <span style="color: #41a1c0">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">ssImg</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #41a1c0">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #41a1c0">Rect</span><span class="p">(</span><span style="color: #d0bf69">0</span><span class="p">,</span> <span style="color: #d0bf69">0</span><span class="p">,</span> <span class="nx">ssWidth</span><span class="p">,</span> <span class="nx">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fc5fa3">for</span> <span class="nx">y</span> <span class="o">:=</span> <span style="color: #d0bf69">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">ssHeight</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">wg</span><span class="p">.</span><span style="color: #41a1c0">Add</span><span class="p">(</span><span style="color: #d0bf69">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #fc5fa3">go</span> <span style="color: #fc5fa3">func</span><span class="p">(</span><span class="nx">y</span> <span style="color: #fc5fa3">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #fc5fa3">defer</span> <span class="nx">wg</span><span class="p">.</span><span style="color: #41a1c0">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #fc5fa3">for</span> <span class="nx">x</span> <span class="o">:=</span> <span style="color: #d0bf69">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">ssWidth</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="nx">ssImg</span><span class="p">.</span><span style="color: #41a1c0">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span style="color: #41a1c0">renderPixel</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span class="nx">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">wg</span><span class="p">.</span><span style="color: #41a1c0">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">img</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span style="color: #41a1c0">NewRGBA</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span style="color: #41a1c0">Rect</span><span class="p">(</span><span style="color: #d0bf69">0</span><span class="p">,</span> <span style="color: #d0bf69">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fc5fa3">for</span> <span class="nx">y</span> <span class="o">:=</span> <span style="color: #d0bf69">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">height</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #fc5fa3">for</span> <span class="nx">x</span> <span class="o">:=</span> <span style="color: #d0bf69">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">width</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span> <span class="o">:=</span> <span style="color: #d0bf69">0</span><span class="p">,</span> <span style="color: #d0bf69">0</span><span class="p">,</span> <span style="color: #d0bf69">0</span><span class="p">,</span> <span style="color: #d0bf69">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #fc5fa3">for</span> <span class="nx">dy</span> <span class="o">:=</span> <span style="color: #d0bf69">0</span><span class="p">;</span> <span class="nx">dy</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dy</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #fc5fa3">for</span> <span class="nx">dx</span> <span class="o">:=</span> <span style="color: #d0bf69">0</span><span class="p">;</span> <span class="nx">dx</span> <span class="p">&lt;</span> <span class="nx">supersamplingRatio</span><span class="p">;</span> <span class="nx">dx</span><span class="o">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">c</span> <span class="o">:=</span> <span class="nx">ssImg</span><span class="p">.</span><span style="color: #41a1c0">RGBAAt</span><span class="p">(</span><span class="nx">x</span><span class="o">*</span><span class="nx">supersamplingRatio</span><span class="o">+</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span><span class="o">*</span><span class="nx">supersamplingRatio</span><span class="o">+</span><span class="nx">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">r</span> <span class="o">+=</span> <span style="color: #d0a8ff">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">g</span> <span class="o">+=</span> <span style="color: #d0a8ff">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">b</span> <span class="o">+=</span> <span style="color: #d0a8ff">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span class="nx">a</span> <span class="o">+=</span> <span style="color: #d0a8ff">int</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">r</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">g</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">b</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">a</span> <span class="o">/=</span> <span class="nx">supersamplingRatio</span> <span class="o">*</span> <span class="nx">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="nx">img</span><span class="p">.</span><span style="color: #41a1c0">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">{</span><span style="color: #d0a8ff">uint8</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span style="color: #d0a8ff">uint8</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span style="color: #d0a8ff">uint8</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span style="color: #d0a8ff">uint8</span><span class="p">(</span><span class="nx">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span style="color: #41a1c0">Create</span><span class="p">(</span><span style="color: #fc6a5d">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fc5fa3">if</span> <span class="nx">err</span> <span class="o">!=</span> <span style="color: #fc5fa3">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #41a1c0">Println</span><span class="p">(</span><span style="color: #fc6a5d">&#34;Error creating file:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #fc5fa3">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fc5fa3">defer</span> <span class="nx">file</span><span class="p">.</span><span style="color: #41a1c0">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="nx">err</span> <span class="p">=</span> <span class="nx">png</span><span class="p">.</span><span style="color: #41a1c0">Encode</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #fc5fa3">if</span> <span class="nx">err</span> <span class="o">!=</span> <span style="color: #fc5fa3">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span style="color: #41a1c0">Println</span><span class="p">(</span><span style="color: #fc6a5d">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><a name='xcode'><h2><a id='stylelink' href='xcode.html' alt='View only xcode'>xcode</a></h2></a><code><pre style="background-color: #ffffff;" class="chroma"><code><span style="display: flex;"><span class="cl"><span style="color: #a90d91">package</span> <span style="color: #000000">main</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #177500">/* This program renders a supersampled Mandelbulb.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #177500"> * It takes about 12 seconds to run on my laptop.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #177500"> * CC0 licensed.
</span></span></span><span style="display: flex;"><span class="cl"><span style="color: #177500"> */</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #a90d91">import</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c41a16">&#34;fmt&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c41a16">&#34;image&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c41a16">&#34;image/color&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c41a16">&#34;image/png&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c41a16">&#34;math&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c41a16">&#34;os&#34;</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #c41a16">&#34;sync&#34;</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #a90d91">const</span> <span class="p">(</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">width</span><span class="p">,</span> <span style="color: #000000">height</span>      <span class="p">=</span> <span style="color: #1c01ce">1920</span><span class="p">,</span> <span style="color: #1c01ce">1080</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">ssWidth</span><span class="p">,</span> <span style="color: #000000">ssHeight</span>  <span class="p">=</span> <span style="color: #1c01ce">3840</span><span class="p">,</span> <span style="color: #1c01ce">2160</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">aspectRatio</span>        <span class="p">=</span> <span style="color: #a90d91">float64</span><span class="p">(</span><span style="color: #000000">ssWidth</span><span class="p">)</span> <span style="color: #000000">/</span> <span style="color: #a90d91">float64</span><span class="p">(</span><span style="color: #000000">ssHeight</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">fov</span>                <span class="p">=</span> <span style="color: #000000">math</span><span class="p">.</span><span style="color: #000000">Pi</span> <span style="color: #000000">/</span> <span style="color: #1c01ce">8</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">maxIter</span>            <span class="p">=</span> <span style="color: #1c01ce">1000</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">power</span>              <span class="p">=</span> <span style="color: #1c01ce">9</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">escapeRadius</span>       <span class="p">=</span> <span style="color: #1c01ce">1.6</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">supersamplingRatio</span> <span class="p">=</span> <span style="color: #1c01ce">2</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #a90d91">var</span> <span style="color: #000000">wg</span> <span style="color: #000000">sync</span><span class="p">.</span><span style="color: #000000">WaitGroup</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #a90d91">type</span> <span style="color: #000000">vec3</span> <span style="color: #a90d91">struct</span><span class="p">{</span> <span style="color: #000000">x</span><span class="p">,</span> <span style="color: #000000">y</span><span class="p">,</span> <span style="color: #000000">z</span> <span style="color: #a90d91">float64</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #a90d91">func</span> <span class="p">(</span><span style="color: #000000">v</span> <span style="color: #000000">vec3</span><span class="p">)</span> <span style="color: #000000">add</span><span class="p">(</span><span style="color: #000000">w</span> <span style="color: #000000">vec3</span><span class="p">)</span> <span style="color: #000000">vec3</span>    <span class="p">{</span> <span style="color: #a90d91">return</span> <span style="color: #000000">vec3</span><span class="p">{</span><span style="color: #000000">v</span><span class="p">.</span><span style="color: #000000">x</span> <span style="color: #000000">+</span> <span style="color: #000000">w</span><span class="p">.</span><span style="color: #000000">x</span><span class="p">,</span> <span style="color: #000000">v</span><span class="p">.</span><span style="color: #000000">y</span> <span style="color: #000000">+</span> <span style="color: #000000">w</span><span class="p">.</span><span style="color: #000000">y</span><span class="p">,</span> <span style="color: #000000">v</span><span class="p">.</span><span style="color: #000000">z</span> <span style="color: #000000">+</span> <span style="color: #000000">w</span><span class="p">.</span><span style="color: #000000">z</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #a90d91">func</span> <span class="p">(</span><span style="color: #000000">v</span> <span style="color: #000000">vec3</span><span class="p">)</span> <span style="color: #000000">mul</span><span class="p">(</span><span style="color: #000000">s</span> <span style="color: #a90d91">float64</span><span class="p">)</span> <span style="color: #000000">vec3</span> <span class="p">{</span> <span style="color: #a90d91">return</span> <span style="color: #000000">vec3</span><span class="p">{</span><span style="color: #000000">v</span><span class="p">.</span><span style="color: #000000">x</span> <span style="color: #000000">*</span> <span style="color: #000000">s</span><span class="p">,</span> <span style="color: #000000">v</span><span class="p">.</span><span style="color: #000000">y</span> <span style="color: #000000">*</span> <span style="color: #000000">s</span><span class="p">,</span> <span style="color: #000000">v</span><span class="p">.</span><span style="color: #000000">z</span> <span style="color: #000000">*</span> <span style="color: #000000">s</span><span class="p">}</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #a90d91">func</span> <span class="p">(</span><span style="color: #000000">v</span> <span style="color: #000000">vec3</span><span class="p">)</span> <span style="color: #000000">length</span><span class="p">()</span> <span style="color: #a90d91">float64</span>    <span class="p">{</span> <span style="color: #a90d91">return</span> <span style="color: #000000">math</span><span class="p">.</span><span style="color: #000000">Sqrt</span><span class="p">(</span><span style="color: #000000">v</span><span class="p">.</span><span style="color: #000000">x</span><span style="color: #000000">*</span><span style="color: #000000">v</span><span class="p">.</span><span style="color: #000000">x</span> <span style="color: #000000">+</span> <span style="color: #000000">v</span><span class="p">.</span><span style="color: #000000">y</span><span style="color: #000000">*</span><span style="color: #000000">v</span><span class="p">.</span><span style="color: #000000">y</span> <span style="color: #000000">+</span> <span style="color: #000000">v</span><span class="p">.</span><span style="color: #000000">z</span><span style="color: #000000">*</span><span style="color: #000000">v</span><span class="p">.</span><span style="color: #000000">z</span><span class="p">)</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span style="color: #a90d91">func</span> <span class="p">(</span><span style="color: #000000">v</span> <span style="color: #000000">vec3</span><span class="p">)</span> <span style="color: #000000">normalize</span><span class="p">()</span> <span style="color: #000000">vec3</span>    <span class="p">{</span> <span style="color: #a90d91">return</span> <span style="color: #000000">v</span><span class="p">.</span><span style="color: #000000">mul</span><span class="p">(</span><span style="color: #1c01ce">1</span> <span style="color: #000000">/</span> <span style="color: #000000">v</span><span class="p">.</span><span style="color: #000000">length</span><span class="p">())</span> <span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #a90d91">func</span> <span style="color: #000000">mandelbulb</span><span class="p">(</span><span style="color: #000000">p</span> <span style="color: #000000">vec3</span><span class="p">)</span> <span style="color: #a90d91">float64</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">z</span><span class="p">,</span> <span style="color: #000000">r</span><span class="p">,</span> <span style="color: #000000">theta</span><span class="p">,</span> <span style="color: #000000">phi</span> <span style="color: #000000">:=</span> <span style="color: #000000">p</span><span class="p">,</span> <span style="color: #1c01ce">0.0</span><span class="p">,</span> <span style="color: #1c01ce">0.0</span><span class="p">,</span> <span style="color: #1c01ce">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a90d91">for</span> <span style="color: #000000">i</span> <span style="color: #000000">:=</span> <span style="color: #1c01ce">0</span><span class="p">;</span> <span style="color: #000000">i</span> <span class="p">&lt;</span> <span style="color: #000000">maxIter</span><span class="p">;</span> <span style="color: #000000">i</span><span style="color: #000000">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000">r</span> <span class="p">=</span> <span style="color: #000000">z</span><span class="p">.</span><span style="color: #000000">length</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #a90d91">if</span> <span style="color: #000000">r</span> <span class="p">&gt;</span> <span style="color: #000000">escapeRadius</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #a90d91">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000">theta</span><span class="p">,</span> <span style="color: #000000">phi</span> <span class="p">=</span> <span style="color: #000000">math</span><span class="p">.</span><span style="color: #000000">Acos</span><span class="p">(</span><span style="color: #000000">z</span><span class="p">.</span><span style="color: #000000">z</span><span style="color: #000000">/</span><span style="color: #000000">r</span><span class="p">)</span><span style="color: #000000">*</span><span style="color: #000000">power</span><span class="p">,</span> <span style="color: #000000">math</span><span class="p">.</span><span style="color: #000000">Atan2</span><span class="p">(</span><span style="color: #000000">z</span><span class="p">.</span><span style="color: #000000">y</span><span class="p">,</span> <span style="color: #000000">z</span><span class="p">.</span><span style="color: #000000">x</span><span class="p">)</span><span style="color: #000000">*</span><span style="color: #000000">power</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000">r</span> <span class="p">=</span> <span style="color: #000000">math</span><span class="p">.</span><span style="color: #000000">Pow</span><span class="p">(</span><span style="color: #000000">r</span><span class="p">,</span> <span style="color: #000000">power</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000">z</span><span class="p">.</span><span style="color: #000000">x</span><span class="p">,</span> <span style="color: #000000">z</span><span class="p">.</span><span style="color: #000000">y</span><span class="p">,</span> <span style="color: #000000">z</span><span class="p">.</span><span style="color: #000000">z</span> <span class="p">=</span> <span style="color: #000000">p</span><span class="p">.</span><span style="color: #000000">x</span><span style="color: #000000">+</span><span style="color: #000000">r</span><span style="color: #000000">*</span><span style="color: #000000">math</span><span class="p">.</span><span style="color: #000000">Sin</span><span class="p">(</span><span style="color: #000000">theta</span><span class="p">)</span><span style="color: #000000">*</span><span style="color: #000000">math</span><span class="p">.</span><span style="color: #000000">Cos</span><span class="p">(</span><span style="color: #000000">phi</span><span class="p">),</span> <span style="color: #000000">p</span><span class="p">.</span><span style="color: #000000">y</span><span style="color: #000000">+</span><span style="color: #000000">r</span><span style="color: #000000">*</span><span style="color: #000000">math</span><span class="p">.</span><span style="color: #000000">Sin</span><span class="p">(</span><span style="color: #000000">theta</span><span class="p">)</span><span style="color: #000000">*</span><span style="color: #000000">math</span><span class="p">.</span><span style="color: #000000">Sin</span><span class="p">(</span><span style="color: #000000">phi</span><span class="p">),</span> <span style="color: #000000">p</span><span class="p">.</span><span style="color: #000000">z</span><span style="color: #000000">+</span><span style="color: #000000">r</span><span style="color: #000000">*</span><span style="color: #000000">math</span><span class="p">.</span><span style="color: #000000">Cos</span><span class="p">(</span><span style="color: #000000">theta</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a90d91">return</span> <span style="color: #000000">r</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #a90d91">func</span> <span style="color: #000000">renderPixel</span><span class="p">(</span><span style="color: #000000">x</span><span class="p">,</span> <span style="color: #000000">y</span> <span style="color: #a90d91">int</span><span class="p">)</span> <span style="color: #000000">color</span><span class="p">.</span><span style="color: #000000">Color</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">px</span><span class="p">,</span> <span style="color: #000000">py</span> <span style="color: #000000">:=</span> <span class="p">(</span><span style="color: #1c01ce">2</span><span style="color: #000000">*</span><span style="color: #a90d91">float64</span><span class="p">(</span><span style="color: #000000">x</span><span class="p">)</span><span style="color: #000000">/</span><span style="color: #a90d91">float64</span><span class="p">(</span><span style="color: #000000">ssWidth</span><span class="p">)</span><span style="color: #000000">-</span><span style="color: #1c01ce">1</span><span class="p">)</span><span style="color: #000000">*</span><span style="color: #000000">aspectRatio</span><span style="color: #000000">*</span><span style="color: #000000">math</span><span class="p">.</span><span style="color: #000000">Tan</span><span class="p">(</span><span style="color: #000000">fov</span><span style="color: #000000">/</span><span style="color: #1c01ce">2</span><span class="p">),</span> <span class="p">(</span><span style="color: #1c01ce">1</span><span style="color: #000000">-</span><span style="color: #1c01ce">2</span><span style="color: #000000">*</span><span style="color: #a90d91">float64</span><span class="p">(</span><span style="color: #000000">y</span><span class="p">)</span><span style="color: #000000">/</span><span style="color: #a90d91">float64</span><span class="p">(</span><span style="color: #000000">ssHeight</span><span class="p">))</span><span style="color: #000000">*</span><span style="color: #000000">math</span><span class="p">.</span><span style="color: #000000">Tan</span><span class="p">(</span><span style="color: #000000">fov</span><span style="color: #000000">/</span><span style="color: #1c01ce">2</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">direction</span> <span style="color: #000000">:=</span> <span style="color: #000000">vec3</span><span class="p">{</span><span style="color: #000000">px</span><span class="p">,</span> <span style="color: #000000">py</span><span class="p">,</span> <span style="color: #000000">-</span><span style="color: #1c01ce">1</span><span class="p">}.</span><span style="color: #000000">normalize</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">t</span> <span style="color: #000000">:=</span> <span style="color: #1c01ce">0.0</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a90d91">for</span> <span style="color: #000000">i</span> <span style="color: #000000">:=</span> <span style="color: #1c01ce">0</span><span class="p">;</span> <span style="color: #000000">i</span> <span class="p">&lt;</span> <span style="color: #000000">maxIter</span><span class="p">;</span> <span style="color: #000000">i</span><span style="color: #000000">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000">p</span> <span style="color: #000000">:=</span> <span style="color: #000000">direction</span><span class="p">.</span><span style="color: #000000">mul</span><span class="p">(</span><span style="color: #000000">t</span><span class="p">).</span><span style="color: #000000">add</span><span class="p">(</span><span style="color: #000000">vec3</span><span class="p">{</span><span style="color: #1c01ce">0</span><span class="p">,</span> <span style="color: #1c01ce">0</span><span class="p">,</span> <span style="color: #1c01ce">5</span><span class="p">})</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000">d</span> <span style="color: #000000">:=</span> <span style="color: #000000">mandelbulb</span><span class="p">(</span><span style="color: #000000">p</span><span class="p">)</span> <span style="color: #000000">-</span> <span style="color: #1c01ce">1</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #a90d91">if</span> <span style="color: #000000">d</span> <span class="p">&lt;</span> <span style="color: #1c01ce">0.001</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #a90d91">return</span> <span style="color: #000000">color</span><span class="p">.</span><span style="color: #000000">Gray</span><span class="p">{</span><span style="color: #a90d91">uint8</span><span class="p">(</span><span style="color: #1c01ce">255</span> <span style="color: #000000">-</span> <span style="color: #000000">t</span><span style="color: #000000">*</span><span style="color: #1c01ce">255</span><span style="color: #000000">/</span><span style="color: #1c01ce">100</span><span class="p">)}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000">t</span> <span style="color: #000000">+=</span> <span style="color: #000000">d</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #a90d91">if</span> <span style="color: #000000">t</span> <span class="p">&gt;</span> <span style="color: #1c01ce">100</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #a90d91">break</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a90d91">return</span> <span style="color: #000000">color</span><span class="p">.</span><span style="color: #000000">Black</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl"><span style="color: #a90d91">func</span> <span style="color: #000000">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">ssImg</span> <span style="color: #000000">:=</span> <span style="color: #000000">image</span><span class="p">.</span><span style="color: #000000">NewRGBA</span><span class="p">(</span><span style="color: #000000">image</span><span class="p">.</span><span style="color: #000000">Rect</span><span class="p">(</span><span style="color: #1c01ce">0</span><span class="p">,</span> <span style="color: #1c01ce">0</span><span class="p">,</span> <span style="color: #000000">ssWidth</span><span class="p">,</span> <span style="color: #000000">ssHeight</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a90d91">for</span> <span style="color: #000000">y</span> <span style="color: #000000">:=</span> <span style="color: #1c01ce">0</span><span class="p">;</span> <span style="color: #000000">y</span> <span class="p">&lt;</span> <span style="color: #000000">ssHeight</span><span class="p">;</span> <span style="color: #000000">y</span><span style="color: #000000">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000">wg</span><span class="p">.</span><span style="color: #000000">Add</span><span class="p">(</span><span style="color: #1c01ce">1</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #a90d91">go</span> <span style="color: #a90d91">func</span><span class="p">(</span><span style="color: #000000">y</span> <span style="color: #a90d91">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #a90d91">defer</span> <span style="color: #000000">wg</span><span class="p">.</span><span style="color: #000000">Done</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #a90d91">for</span> <span style="color: #000000">x</span> <span style="color: #000000">:=</span> <span style="color: #1c01ce">0</span><span class="p">;</span> <span style="color: #000000">x</span> <span class="p">&lt;</span> <span style="color: #000000">ssWidth</span><span class="p">;</span> <span style="color: #000000">x</span><span style="color: #000000">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #000000">ssImg</span><span class="p">.</span><span style="color: #000000">Set</span><span class="p">(</span><span style="color: #000000">x</span><span class="p">,</span> <span style="color: #000000">y</span><span class="p">,</span> <span style="color: #000000">renderPixel</span><span class="p">(</span><span style="color: #000000">x</span><span class="p">,</span> <span style="color: #000000">y</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}(</span><span style="color: #000000">y</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">wg</span><span class="p">.</span><span style="color: #000000">Wait</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">img</span> <span style="color: #000000">:=</span> <span style="color: #000000">image</span><span class="p">.</span><span style="color: #000000">NewRGBA</span><span class="p">(</span><span style="color: #000000">image</span><span class="p">.</span><span style="color: #000000">Rect</span><span class="p">(</span><span style="color: #1c01ce">0</span><span class="p">,</span> <span style="color: #1c01ce">0</span><span class="p">,</span> <span style="color: #000000">width</span><span class="p">,</span> <span style="color: #000000">height</span><span class="p">))</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a90d91">for</span> <span style="color: #000000">y</span> <span style="color: #000000">:=</span> <span style="color: #1c01ce">0</span><span class="p">;</span> <span style="color: #000000">y</span> <span class="p">&lt;</span> <span style="color: #000000">height</span><span class="p">;</span> <span style="color: #000000">y</span><span style="color: #000000">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #a90d91">for</span> <span style="color: #000000">x</span> <span style="color: #000000">:=</span> <span style="color: #1c01ce">0</span><span class="p">;</span> <span style="color: #000000">x</span> <span class="p">&lt;</span> <span style="color: #000000">width</span><span class="p">;</span> <span style="color: #000000">x</span><span style="color: #000000">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000000">r</span><span class="p">,</span> <span style="color: #000000">g</span><span class="p">,</span> <span style="color: #000000">b</span><span class="p">,</span> <span style="color: #000000">a</span> <span style="color: #000000">:=</span> <span style="color: #1c01ce">0</span><span class="p">,</span> <span style="color: #1c01ce">0</span><span class="p">,</span> <span style="color: #1c01ce">0</span><span class="p">,</span> <span style="color: #1c01ce">0</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #a90d91">for</span> <span style="color: #000000">dy</span> <span style="color: #000000">:=</span> <span style="color: #1c01ce">0</span><span class="p">;</span> <span style="color: #000000">dy</span> <span class="p">&lt;</span> <span style="color: #000000">supersamplingRatio</span><span class="p">;</span> <span style="color: #000000">dy</span><span style="color: #000000">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">				<span style="color: #a90d91">for</span> <span style="color: #000000">dx</span> <span style="color: #000000">:=</span> <span style="color: #1c01ce">0</span><span class="p">;</span> <span style="color: #000000">dx</span> <span class="p">&lt;</span> <span style="color: #000000">supersamplingRatio</span><span class="p">;</span> <span style="color: #000000">dx</span><span style="color: #000000">++</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #000000">c</span> <span style="color: #000000">:=</span> <span style="color: #000000">ssImg</span><span class="p">.</span><span style="color: #000000">RGBAAt</span><span class="p">(</span><span style="color: #000000">x</span><span style="color: #000000">*</span><span style="color: #000000">supersamplingRatio</span><span style="color: #000000">+</span><span style="color: #000000">dx</span><span class="p">,</span> <span style="color: #000000">y</span><span style="color: #000000">*</span><span style="color: #000000">supersamplingRatio</span><span style="color: #000000">+</span><span style="color: #000000">dy</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #000000">r</span> <span style="color: #000000">+=</span> <span style="color: #a90d91">int</span><span class="p">(</span><span style="color: #000000">c</span><span class="p">.</span><span style="color: #000000">R</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #000000">g</span> <span style="color: #000000">+=</span> <span style="color: #a90d91">int</span><span class="p">(</span><span style="color: #000000">c</span><span class="p">.</span><span style="color: #000000">G</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #000000">b</span> <span style="color: #000000">+=</span> <span style="color: #a90d91">int</span><span class="p">(</span><span style="color: #000000">c</span><span class="p">.</span><span style="color: #000000">B</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">					<span style="color: #000000">a</span> <span style="color: #000000">+=</span> <span style="color: #a90d91">int</span><span class="p">(</span><span style="color: #000000">c</span><span class="p">.</span><span style="color: #000000">A</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">				<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000000">r</span> <span style="color: #000000">/=</span> <span style="color: #000000">supersamplingRatio</span> <span style="color: #000000">*</span> <span style="color: #000000">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000000">g</span> <span style="color: #000000">/=</span> <span style="color: #000000">supersamplingRatio</span> <span style="color: #000000">*</span> <span style="color: #000000">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000000">b</span> <span style="color: #000000">/=</span> <span style="color: #000000">supersamplingRatio</span> <span style="color: #000000">*</span> <span style="color: #000000">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000000">a</span> <span style="color: #000000">/=</span> <span style="color: #000000">supersamplingRatio</span> <span style="color: #000000">*</span> <span style="color: #000000">supersamplingRatio</span>
</span></span><span style="display: flex;"><span class="cl">			<span style="color: #000000">img</span><span class="p">.</span><span style="color: #000000">Set</span><span class="p">(</span><span style="color: #000000">x</span><span class="p">,</span> <span style="color: #000000">y</span><span class="p">,</span> <span style="color: #000000">color</span><span class="p">.</span><span style="color: #000000">RGBA</span><span class="p">{</span><span style="color: #a90d91">uint8</span><span class="p">(</span><span style="color: #000000">r</span><span class="p">),</span> <span style="color: #a90d91">uint8</span><span class="p">(</span><span style="color: #000000">g</span><span class="p">),</span> <span style="color: #a90d91">uint8</span><span class="p">(</span><span style="color: #000000">b</span><span class="p">),</span> <span style="color: #a90d91">uint8</span><span class="p">(</span><span style="color: #000000">a</span><span class="p">)})</span>
</span></span><span style="display: flex;"><span class="cl">		<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">file</span><span class="p">,</span> <span style="color: #000000">err</span> <span style="color: #000000">:=</span> <span style="color: #000000">os</span><span class="p">.</span><span style="color: #000000">Create</span><span class="p">(</span><span style="color: #c41a16">&#34;mandelbulb.png&#34;</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a90d91">if</span> <span style="color: #000000">err</span> <span style="color: #000000">!=</span> <span style="color: #a90d91">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000">fmt</span><span class="p">.</span><span style="color: #000000">Println</span><span class="p">(</span><span style="color: #c41a16">&#34;Error creating file:&#34;</span><span class="p">,</span> <span style="color: #000000">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #a90d91">return</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a90d91">defer</span> <span style="color: #000000">file</span><span class="p">.</span><span style="color: #000000">Close</span><span class="p">()</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #000000">err</span> <span class="p">=</span> <span style="color: #000000">png</span><span class="p">.</span><span style="color: #000000">Encode</span><span class="p">(</span><span style="color: #000000">file</span><span class="p">,</span> <span style="color: #000000">img</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span style="color: #a90d91">if</span> <span style="color: #000000">err</span> <span style="color: #000000">!=</span> <span style="color: #a90d91">nil</span> <span class="p">{</span>
</span></span><span style="display: flex;"><span class="cl">		<span style="color: #000000">fmt</span><span class="p">.</span><span style="color: #000000">Println</span><span class="p">(</span><span style="color: #c41a16">&#34;Error encoding image:&#34;</span><span class="p">,</span> <span style="color: #000000">err</span><span class="p">)</span>
</span></span><span style="display: flex;"><span class="cl">	<span class="p">}</span>
</span></span><span style="display: flex;"><span class="cl"><span class="p">}</span></span></span></code></pre></code><p><a id='bottom' href='index.html' alt='Back to overview'>Back to overview</a></p><p><a id='bottom' href='../index.html' alt='Go to the other gallery'>Gallery with shorter code samples</a></p><small>Generated 2023-05-16 by <a href="https://github.com/xyproto">xyproto</a> using <a href="https://github.com/xyproto/splash">splash</a>.</small></body></html>